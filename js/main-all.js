var CodeMirror=function(){function vt(e,t){var i,v={},n=vt.defaults;for(i in n)n.hasOwnProperty(i)&&(v[i]=(t&&t.hasOwnProperty(i)?t:n)[i]);var h=v.document,c=h.createElement("div");c.className="CodeMirror"+(v.lineWrapping?" CodeMirror-wrap":""),c.innerHTML='<div style="overflow: hidden; position: relative; width: 3px; height: 0px;"><textarea style="position: absolute; padding: 0; width: 1px; height: 1em" wrap="off" autocorrect="off" autocapitalize="off"></textarea></div><div class="CodeMirror-scroll" tabindex="-1"><div style="position: relative"><div style="position: relative"><div class="CodeMirror-gutter"><div class="CodeMirror-gutter-text"></div></div><div class="CodeMirror-lines"><div style="position: relative; z-index: 0"><div style="position: absolute; width: 100%; height: 0; overflow: hidden; visibility: hidden; outline: 5px auto none"></div><pre class="CodeMirror-cursor">&#160;</pre><div style="position: relative; z-index: -1"></div><div></div></div></div></div></div></div>',e.appendChild?e.appendChild(c):e(c);var u=c.firstChild,r=u.firstChild,k=c.lastChild,P=k.firstChild,p=P.firstChild,m=p.firstChild,l=m.firstChild,f=m.nextSibling.firstChild,o=f.firstChild,g=o.nextSibling,x=g.nextSibling,E=x.nextSibling;Ve(),kt&&(r.style.width="0px"),Zt||(f.draggable=!0),f.style.outline="none",null!=v.tabindex&&(r.tabIndex=v.tabindex),v.gutter||v.lineNumbers||(m.style.display="none");try{Ke("x")}catch(e){throw e.message.match(/runtime/i)&&(e=new Error("A CodeMirror inside a P-style element does not work in Internet Explorer. (innerHTML bug)")),e}var a,T,_,d,s=new jt,y=new jt,D=new Rt([new Lt([new Ot("")])]);Be();var b,C,w,S,N,F,I,M,O,L,R,A,G,B,W={from:{line:0,ch:0},to:{line:0,ch:0},inverted:!1},H=0,U=!1,V=!1,z=0,X=0,Y=0,j=0,K="",J=He();wt(function(){ie(v.value||""),N=!1})();var q,Z=new Wt;Yt(k,"mousedown",wt(function(t){De(Xt(t,"shiftKey"));for(var e=zt(t);e!=c;e=e.parentNode)if(e.parentNode==P&&e!=p)return;for(e=zt(t);e!=c;e=e.parentNode)if(e.parentNode==l)return v.onGutterClick&&v.onGutterClick(Q,ni(l.childNodes,e)+X,t),Ut(t);var o=dt(t);switch(function(e){return e.which||(1&e.button?1:2&e.button?3:4&e.button?2:void 0)}(t)){case 3:return void(Jt&&!Pt&&ct(t));case 2:return void(o&&Ie(o.line,o.ch,!0))}if(!o)return void(zt(t)==k&&Ut(t));d||ae();var i=+new Date;{if(w&&w.time>i-400&&Qt(w.pos,o))return Ut(t),setTimeout(Ce,20),function(e){Se({line:e,ch:0},{line:e,ch:ee(e).text.length})}(o.line);if(C&&C.time>i-400&&Qt(C.pos,o))return w={time:i,pos:o},Ut(t),Ae(o);C={time:i,pos:o}}var a,r=o;if(Kt&&!v.readOnly&&!Qt(W.from,W.to)&&!ei(o,W.from)&&!ei(W.to,o)){Zt&&(f.draggable=!0);var n=Yt(h,"mouseup",wt(function(e){Zt&&(f.draggable=!1),S=!1,n(),Math.abs(t.clientX-e.clientX)+Math.abs(t.clientY-e.clientY)<10&&(Ut(e),Ie(o.line,o.ch,!0),Ce())}),!0);return void(S=!0)}Ut(t),Ie(o.line,o.ch,!0);var s=Yt(h,"mousemove",wt(function(e){clearTimeout(a),Ut(e),function e(t){var i,n=dt(t,!0);n&&!Qt(n,r)&&(d||ae(),Se(o,r=n),N=!1,i=ke(),(n.line>=i.to||n.line<i.from)&&(a=setTimeout(wt(function(){e(t)}),150)))}(e)}),!0),n=Yt(h,"mouseup",wt(function(e){clearTimeout(a);var t=dt(e);t&&Se(o,t),Ut(e),Ce(),N=!0,s(),n()}),!0)})),Yt(k,"dblclick",wt(function(e){for(var t=zt(e);t!=c;t=t.parentNode)if(t.parentNode==l)return Ut(e);var i=dt(e);if(!i)return;w={time:+new Date,pos:i},Ut(e),Ae(i)})),Yt(f,"dragstart",function(e){var t=me();ii(t),e.dataTransfer.setDragImage(ti,0,0),e.dataTransfer.setData("Text",t)}),Yt(f,"selectstart",Ut),Jt||Yt(k,"contextmenu",ct),Yt(k,"scroll",function(){H=k.scrollTop,Pe([]),v.fixedGutter&&(m.style.left=k.scrollLeft+"px"),v.onScroll&&v.onScroll(Q)}),Yt(window,"resize",function(){Pe(!0)}),Yt(r,"keyup",wt(function(e){if(v.onKeyEvent&&v.onKeyEvent(Q,Ht(e)))return;16==Xt(e,"keyCode")&&(b=null)})),Yt(r,"input",xe),Yt(r,"keydown",wt(function(e){d||ae();qt&&27==e.keyCode&&(e.returnValue=!1);if(v.onKeyEvent&&v.onKeyEvent(Q,Ht(e)))return;var t=Xt(e,"keyCode");De(16==t||Xt(e,"shiftKey"));var i=ne(e);window.opera&&(oe=i?t:null,!i&&88==t&&Xt(e,Pt?"metaKey":"ctrlKey")&&ue(""))})),Yt(r,"keypress",wt(function(e){var t=Xt(e,"keyCode"),i=Xt(e,"charCode");if(window.opera&&t==oe)return oe=null,void Ut(e);if(v.onKeyEvent&&v.onKeyEvent(Q,Ht(e)))return;if(window.opera&&!e.which&&ne(e))return;v.electricChars&&T.electricChars&&v.smartIndent&&!v.readOnly&&(i=String.fromCharCode(null==i?t:i),-1<T.electricChars.indexOf(i)&&setTimeout(wt(function(){Ge(W.to.line,"smart")}),75));xe()})),Yt(r,"focus",ae),Yt(r,"blur",re),Yt(k,"dragenter",Vt),Yt(k,"dragover",Vt),Yt(k,"drop",wt(function(e){e.preventDefault();var n=dt(e,!0),t=e.dataTransfer.files;if(!n||v.readOnly)return;if(t&&t.length&&window.FileReader&&window.File)for(var o=t.length,a=Array(o),r=0,i=0;i<o;++i)!function(e,t){var i=new FileReader;i.onload=function(){a[t]=i.result,++r==o&&(n=Oe(n),wt(function(){var e=ce(a.join(""),n,n);Se(n,e)})())},i.readAsText(e)}(t[i],i);else try{var s,l;(a=e.dataTransfer.getData("Text"))&&(s=W.from,l=W.to,Se(n,n),S&&ce("",s,l),ue(a),Ce())}catch(e){}})),Yt(k,"paste",function(){Ce(),xe()}),Yt(r,"paste",xe),Yt(r,"cut",wt(function(){v.readOnly||ue("")}));try{q=h.activeElement==r}catch(e){}function $(e){return 0<=e&&e<D.size}q?setTimeout(ae,20):re();var Q=c.CodeMirror={getValue:function(e){var t=[];return D.iter(0,D.size,function(e){t.push(e.text)}),t.join("\n")},setValue:wt(ie),getSelection:me,replaceSelection:wt(ue),focus:function(){Ce(),ae(),xe()},setOption:function(e,t){var i=v[e];v[e]=t,"mode"==e||"indentUnit"==e?Be():"readOnly"==e&&"nocursor"==t?(re(),r.blur()):"readOnly"!=e||t?"theme"==e?Ve():"lineWrapping"==e&&i!=t?wt(We)():"tabSize"==e&&wt(Ue)():be(!0),"lineNumbers"!=e&&"gutter"!=e&&"firstLineNumber"!=e&&"theme"!=e||Pe(!0)},getOption:function(e){return v[e]},undo:wt(function(){le(Z.done,Z.undone,-1)}),redo:wt(function(){le(Z.undone,Z.done,1)}),indentLine:wt(function(e,t){"string"!=typeof t&&(t=null==t?v.smartIndent?"smart":"prev":t?"add":"subtract"),$(e)&&Ge(e,t)}),indentSelection:wt(function(e){if(Qt(W.from,W.to))return Ge(W.from.line,e);for(var t=W.to.line-(W.to.ch?0:1),i=W.from.line;i<=t;++i)Ge(i,e)}),historySize:function(){return{undo:Z.done.length,redo:Z.undone.length}},clearHistory:function(){Z=new Wt},matchBrackets:wt(function(){pt(!0)}),getTokenAt:wt(function(e){return ee((e=Oe(e)).line).getTokenAt(T,ft(e.line),e.ch)}),getStateAfter:function(e){return ft((e=Me(null==e?D.size-1:e))+1)},cursorCoords:function(e){return null==e&&(e=W.inverted),it(e?W.from:W.to)},charCoords:function(e){return it(Oe(e))},coordsChar:function(e){var t=$t(f);return tt(e.x-t.left,e.y-t.top)},markText:wt(Xe),setBookmark:function(e){var t=new Mt((e=Oe(e)).ch);return ee(e.line).addMark(t),t},setMarker:wt(function(e,t,i){"number"==typeof e&&(e=ee(Me(e)));return e.gutterMarker={text:t,style:i},R=!0,e}),clearMarker:wt(function(e){"number"==typeof e&&(e=ee(Me(e)));e.gutterMarker=null,R=!0}),setLineClass:wt(function(e,t){return Ye(e,function(e){return e.className!=t&&(e.className=t,1)})}),hideLine:wt(function(e){return je(e,!0)}),showLine:wt(function(e){return je(e,!1)}),onDeleteLine:function(e,t){if("number"==typeof e){if(!$(e))return null;e=ee(e)}return(e.handlers||(e.handlers=[])).push(t),e},lineInfo:function(e){if("number"==typeof e){if(!$(e))return null;var t=e;if(!(e=ee(e)))return null}else if(null==(t=At(e)))return null;var i=e.gutterMarker;return{line:t,handle:e,text:e.text,markerText:i&&i.text,markerClass:i&&i.style,lineClass:e.className}},addWidget:function(e,t,i,n,o){var a,r=(e=et(Oe(e))).yBot,s=e.x;t.style.position="absolute",P.appendChild(t),"over"==n?r=e.y:"near"==n&&(a=Math.max(k.offsetHeight,D.height*nt()),n=Math.max(P.clientWidth,f.clientWidth)-lt(),e.yBot+t.offsetHeight>a&&e.y>t.offsetHeight&&(r=e.y-t.offsetHeight),s+t.offsetWidth>n&&(s=n-t.offsetWidth)),t.style.top=r+st()+"px",t.style.left=t.style.right="","right"==o?(s=P.clientWidth-t.offsetWidth,t.style.right="0px"):("left"==o?s=0:"middle"==o&&(s=(P.clientWidth-t.offsetWidth)/2),t.style.left=s+lt()+"px"),i&&ve(s,r,s+t.offsetWidth,r+t.offsetHeight)},lineCount:function(){return D.size},clipPos:Oe,getCursor:function(e){return null==e&&(e=W.inverted),{line:(e=e?W.from:W.to).line,ch:e.ch}},somethingSelected:function(){return!Qt(W.from,W.to)},setCursor:wt(function(e,t,i){null==t&&"number"==typeof e.line?Ie(e.line,e.ch,i):Ie(e,t,i)}),setSelection:wt(function(e,t,i){(i?Se:Ne)(Oe(e),Oe(t||e))}),getLine:function(e){if($(e))return ee(e).text},getLineHandle:function(e){if($(e))return ee(e)},setLine:wt(function(e,t){$(e)&&ce(t,{line:e,ch:0},{line:e,ch:ee(e).text.length})}),removeLine:wt(function(e){$(e)&&ce("",{line:e,ch:0},Oe({line:e+1,ch:0}))}),replaceRange:wt(ce),getRange:function(e,t){return pe(Oe(e),Oe(t))},execCommand:function(e){return _t[e](Q)},moveH:wt(function(e,t){var i=e<0?W.from:W.to;(b||Qt(W.from,W.to))&&(i=Le(e,t));Ie(i.line,i.ch,!0)}),deleteH:wt(function(e,t){Qt(W.from,W.to)?e<0?ce("",Le(e,t),W.to):ce("",W.from,Le(e,t)):ce("",W.from,W.to);F=!0}),moveV:wt(function(e,t){var i=0,n=et(W.inverted?W.from:W.to,!0);null!=Re&&(n.x=Re);"page"==t?i=Math.min(k.clientHeight,window.innerHeight||document.documentElement.clientHeight):"line"==t&&(i=nt());e=tt(n.x,n.y+i*e+2);Ie(e.line,e.ch,!0),Re=n.x}),toggleOverwrite:function(){U=!U},posFromIndex:function(t){var i,n=0;return D.iter(0,D.size,function(e){e=e.text.length+1;if(t<e)return i=t,!0;t-=e,++n}),Oe({line:n,ch:i})},indexFromPos:function(e){if(e.line<0||e.ch<0)return 0;var t=e.ch;return D.iter(0,e.line,function(e){t+=e.text.length+1}),t},scrollTo:function(e,t){null!=e&&(k.scrollTop=e),null!=t&&(k.scrollLeft=t),Pe([])},operation:function(e){return wt(e)()},refresh:function(){Pe(!0),k.scrollHeight>H&&(k.scrollTop=H)},getInputField:function(){return r},getWrapperElement:function(){return c},getScrollerElement:function(){return k},getGutterElement:function(){return m}};function ee(e){return function(e,t){for(;!e.lines;)for(var i=0;;++i){var n=e.children[i],o=n.chunkSize();if(t<o){e=n;break}t-=o}return e.lines[t]}(D,e)}function te(e,t){R=!0;for(var i=t-e.height,n=e;n;n=n.parent)n.height+=i}function ie(e){var t={line:0,ch:0};se(t,{line:D.size-1,ch:ee(D.size-1).text.length},ai(e),t,t),N=!0}function ne(e){var t,i,n=si[Xt(e,"keyCode")],o=Dt[v.keyMap].auto;function a(){return o.call?o.call(null,Q):o}if(null==n||e.altGraphKey)return o&&(v.keyMap=a()),null;if(Xt(e,"altKey")&&(n="Alt-"+n),Xt(e,"ctrlKey")&&(n="Ctrl-"+n),Xt(e,"metaKey")&&(n="Cmd-"+n),Xt(e,"shiftKey")&&(t=St("Shift-"+n,v.extraKeys,v.keyMap))?i=!0:t=St(n,v.extraKeys,v.keyMap),"string"==typeof t&&(t=_t.propertyIsEnumerable(t)?_t[t]:null),!o||!t&&function(e){e=si[Xt(e,"keyCode")];return"Ctrl"==e||"Alt"==e||"Shift"==e||"Mod"==e}(e)||(v.keyMap=a()),!t)return!1;n=b;try{v.readOnly&&(V=!0),i&&(b=null),t(Q)}finally{b=n,V=!1}return Ut(e),!0}var oe=null;function ae(){"nocursor"!=v.readOnly&&(d||(v.onFocus&&v.onFocus(Q),d=!0,-1==c.className.search(/\bCodeMirror-focused\b/)&&(c.className+=" CodeMirror-focused"),L||be(!0)),ge(),ut())}function re(){d&&(v.onBlur&&v.onBlur(Q),d=!1,G&&wt(function(){G&&(G(),G=null)})(),c.className=c.className.replace(" CodeMirror-focused","")),clearInterval(a),setTimeout(function(){d||(b=null)},150)}function se(e,t,i,n,o){if(!V){if(Z){var a=[];for(D.iter(e.line,t.line+1,function(e){a.push(e.text)}),Z.addChange(e.line,i.length,a);Z.done.length>v.undoDepth;)Z.done.shift()}de(e,t,i,n,o)}}function le(e,t,i){for(var n=e.pop(),e=n?n.length:0,o=[],a=0<i?0:e-1,r=0<i?e:-1;a!=r;a+=i){var s=n[a],l=[],d=s.start+s.added;D.iter(s.start,d,function(e){l.push(e.text)}),o.push({start:s.start,added:s.old.length,old:l});var c=Oe({line:s.start+s.old.length-1,ch:function(e,t){if(!t)return 0;if(!e)return t.length;for(var i=e.length,n=t.length;0<=i&&0<=n&&e.charAt(i)==t.charAt(n);--i,--n);return n+1}(l[l.length-1],s.old[s.old.length-1])});de({line:s.start,ch:0},{line:d-1,ch:ee(d-1).text.length},s.old,c,c)}N=!0,t.push(o)}function de(e,t,i,n,o){if(!V){var a=!1,r=K.length;v.lineWrapping||D.iter(e.line,t.line,function(e){if(e.text.length==r)return a=!0}),(e.line!=t.line||1<i.length)&&(R=!0);var s,l=t.line-e.line,d=ee(e.line),c=ee(t.line);if(0==e.ch&&0==t.ch&&""==i[i.length-1]){var u=[],h=null;e.line?(h=ee(e.line-1)).fixMarkEnds(c):c.fixMarkStarts();for(var p=0,m=i.length-1;p<m;++p)u.push(Ot.inheritMarks(i[p],h));l&&D.remove(e.line,l,A),u.length&&D.insert(e.line,u)}else if(d==c)if(1==i.length)d.replace(e.ch,t.ch,i[0]);else{c=d.split(t.ch,i[i.length-1]),d.replace(e.ch,null,i[0]),d.fixMarkEnds(c);for(u=[],p=1,m=i.length-1;p<m;++p)u.push(Ot.inheritMarks(i[p],d));u.push(c),D.insert(e.line+1,u)}else if(1==i.length)d.replace(e.ch,null,i[0]),c.replace(null,t.ch,""),d.append(c),D.remove(e.line+1,l,A);else{u=[];d.replace(e.ch,null,i[0]),c.replace(null,t.ch,i[i.length-1]),d.fixMarkEnds(c);for(p=1,m=i.length-1;p<m;++p)u.push(Ot.inheritMarks(i[p],d));1<l&&D.remove(e.line+1,l-1,A),D.insert(e.line+1,u)}v.lineWrapping?(s=k.clientWidth/rt()-3,D.iter(e.line,e.line+i.length,function(e){var t;e.hidden||(t=Math.ceil(e.text.length/s)||1)!=e.height&&te(e,t)})):(D.iter(e.line,p+i.length,function(e){e=e.text;e.length>r&&(r=(K=e).length,B=null,a=!1)}),a&&(r=0,K="",B=null,D.iter(0,D.size,function(e){e=e.text;e.length>r&&(r=e.length,K=e)})));for(var f=[],g=i.length-l-1,p=0,x=_.length;p<x;++p){var E=_[p];E<e.line?f.push(E):E>t.line&&f.push(E+g)}var y,b=e.line+Math.min(i.length,500);c=e.line,l=b,y=ft(c),D.iter(c,l,function(e){e.highlight(T,y,v.tabSize),e.stateAfter=Nt(T,y)}),f.push(b),_=f,xt(100),I.push({from:e.line,to:t.line+1,diff:g});b={from:e,to:t,text:i};if(M){for(var C=M;C.next;C=C.next);C.next=b}else M=b;Ne(n,o,w(W.from.line),w(W.to.line)),k.clientHeight&&(P.style.height=D.height*nt()+2*st()+"px")}function w(e){return e<=Math.min(t.line,t.line+g)?e:e+g}}function ce(n,o,a){function t(e){if(ei(e,o))return e;if(!ei(a,e))return r;var t=e.line+n.length-(a.line-o.line)-1,i=e.ch;return e.line==a.line&&(i+=n[n.length-1].length-(a.ch-(a.line==o.line?o.ch:0))),{line:t,ch:i}}var r;return o=Oe(o),a=a?Oe(a):o,he(n=ai(n),o,a,function(e){return r=e,{from:t(W.from),to:t(W.to)}}),r}function ue(e,t){he(ai(e),W.from,W.to,function(e){return"end"==t?{from:e,to:e}:"start"==t?{from:W.from,to:W.from}:{from:W.from,to:e}})}function he(e,t,i,n){var o=1==e.length?e[0].length+t.ch:e[e.length-1].length,o=n({line:t.line+e.length-1,ch:o});se(t,i,e,o.from,o.to)}function pe(e,t){var i=e.line,n=t.line;if(i==n)return ee(i).text.slice(e.ch,t.ch);var o=[ee(i).text.slice(e.ch)];return D.iter(i+1,n,function(e){o.push(e.text)}),o.push(ee(n).text.slice(0,t.ch)),o.join("\n")}function me(){return pe(W.from,W.to)}var fe=!1;function ge(){fe||s.set(v.pollInterval,function(){Et(),ye(),d&&ge(),yt()})}function xe(){var t=!1;fe=!0,s.set(20,function e(){Et(),ye()||t?(fe=!1,ge()):(t=!0,s.set(60,e)),yt()})}var Ee="";function ye(){if(L||!d||ri(r)||v.readOnly)return!1;var e=r.value;if(e==Ee)return!1;b=null;for(var t=0,i=Math.min(Ee.length,e.length);t<i&&Ee[t]==e[t];)++t;return t<Ee.length?W.from={line:W.from.line,ch:W.from.ch-(Ee.length-t)}:U&&Qt(W.from,W.to)&&(W.to={line:W.to.line,ch:Math.min(ee(W.to.line).text.length,W.to.ch+(e.length-t))}),ue(e.slice(t),"end"),Ee=e,!0}function be(e){Qt(W.from,W.to)?e&&(Ee=r.value=""):(Ee="",r.value=me(),r.select())}function Ce(){"nocursor"!=v.readOnly&&r.focus()}function we(){var e=et(W.inverted?W.from:W.to),t=v.lineWrapping?Math.min(e.x,f.offsetWidth):e.x;return ve(t,e.y,t,e.yBot)}function ve(e,t,i,n){var o=lt(),a=st(),r=nt();t+=a,n+=a,e+=o,i+=o;var s=k.clientHeight,l=k.scrollTop,a=!1,o=!0;t<l?(k.scrollTop=Math.max(0,t-2*r),a=!0):l+s<n&&(k.scrollTop=n+r-s,a=!0);n=k.clientWidth,r=k.scrollLeft,s=v.fixedGutter?m.clientWidth:0;return e<r+s?(e<50&&(e=0),k.scrollLeft=Math.max(0,e-10-s),a=!0):n+r-3<i&&(k.scrollLeft=i+10-n,a=!0,i>P.clientWidth&&(o=!1)),a&&v.onScroll&&v.onScroll(Q),o}function ke(){var e=nt(),t=k.scrollTop-st(),i=Math.max(0,Math.floor(t/e)),e=Math.ceil((t+k.clientHeight)/e);return{from:Gt(D,i),to:Gt(D,e)}}function Pe(e,t){if(k.clientWidth){var i=ke();if(!(!0!==e&&0==e.length&&i.from>X&&i.to<Y)){var n=Math.max(i.from-100,0),o=Math.min(D.size,i.to+100);X<n&&n-X<20&&(n=X),o<Y&&Y-o<20&&(o=Math.min(D.size,Y));for(var a=!0===e?[]:function(e,t){for(var i=0,n=t.length||0;i<n;++i){for(var o=t[i],a=[],r=o.diff||0,s=0,l=e.length;s<l;++s){var d=e[s];o.to<=d.from&&o.diff?a.push({from:d.from+r,to:d.to+r,domStart:d.domStart}):o.to<=d.from||o.from>=d.to?a.push(d):(o.from>d.from&&a.push({from:d.from,to:o.from,domStart:d.domStart}),o.to<d.to&&a.push({from:o.to+r,to:d.to+r,domStart:d.domStart+(o.to-d.from)}))}e=a}return e}([{from:X,to:Y,domStart:0}],e),r=0,s=0;s<a.length;++s){var l=a[s];l.from<n&&(l.domStart+=n-l.from,l.from=n),l.to>o&&(l.to=o),l.from>=l.to?a.splice(s--,1):r+=l.to-l.from}if(r!=o-n){a.sort(function(e,t){return e.domStart-t.domStart});var d=nt(),i=m.style.display;E.style.display="none",function(e,t,i){if(i.length){function n(e){var t=e.nextSibling;return e.parentNode.removeChild(e),t}for(var o=0,a=E.firstChild,r=0;r<i.length;++r){for(var s=i[r];s.domStart>o;)a=n(a),o++;for(var l=0,d=s.to-s.from;l<d;++l)a=a.nextSibling,o++}for(;a;)a=n(a)}else E.innerHTML="";var c=i.shift(),a=E.firstChild,l=e,u=h.createElement("div");D.iter(e,t,function(e){var t;c&&c.to==l&&(c=i.shift()),!c||c.from>l?(e.hidden?t=u.innerHTML="<pre></pre>":(t="<pre>"+e.getHTML(J)+"</pre>",e.className&&(t='<div style="position: relative"><pre class="'+e.className+'" style="position: absolute; left: 0; right: 0; top: 0; bottom: 0; z-index: -2">&#160;</pre>'+t+"</div>")),u.innerHTML=t,E.insertBefore(u.firstChild,a)):a=a.nextSibling,++l})}(n,o,a),E.style.display=m.style.display="";var c,u,e=n!=X||o!=Y||j!=k.clientHeight+d;if(e&&(j=k.clientHeight+d),Y=o,z=Bt(D,X=n),p.style.top=z*d+"px",k.clientHeight&&(P.style.height=D.height*d+2*st()+"px"),E.childNodes.length!=Y-X)throw new Error("BAD PATCH! "+JSON.stringify(a)+" size="+(Y-X)+" nodes="+E.childNodes.length);return v.lineWrapping?(B=k.clientWidth,c=E.firstChild,u=!1,D.iter(X,Y,function(e){var t;e.hidden||(t=Math.round(c.offsetHeight/d)||1,e.height!=t&&(te(e,t),R=u=!0)),c=c.nextSibling}),u&&(P.style.height=D.height*d+2*st()+"px")):(null==B&&(B=Ke(K)),B>k.clientWidth?(f.style.width=B+"px",P.style.width="",P.style.width=k.scrollWidth+"px"):f.style.width=P.style.width=""),m.style.display=i,(e||R)&&Te(),_e(),!t&&v.onUpdate&&v.onUpdate(Q),!0}}}else X=Y=z=0}function Te(){if(v.gutter||v.lineNumbers){var e=p.offsetHeight,t=k.clientHeight;m.style.height=(e-t<2?t:e)+"px";var o=[],a=X;D.iter(X,Math.max(Y,X+1),function(e){if(e.hidden)o.push("<pre></pre>");else{var t=e.gutterMarker,i=v.lineNumbers?a+v.firstLineNumber:null;t&&t.text?i=t.text.replace("%N%",null!=i?i:""):null==i&&(i=" "),o.push(t&&t.style?'<pre class="'+t.style+'">':"<pre>",i);for(var n=1;n<e.height;++n)o.push("<br/>&#160;");o.push("</pre>")}++a}),m.style.display="none",l.innerHTML=o.join("");for(var i=String(D.size).length,t=l.firstChild,n=(e=t).textContent||e.innerText||e.nodeValue||"",r="";n.length+r.length<i;)r+=" ";r&&t.insertBefore(h.createTextNode(r),t.firstChild),m.style.display="",f.style.marginLeft=m.offsetWidth+"px",R=!1}}function _e(){var o,e,t=Qt(W.from,W.to),i=et(W.from,!0),n=t?i:et(W.to,!0),a=W.inverted?i:n,r=nt(),s=$t(c),l=$t(E);function d(e,t,i,n){o+='<div class="CodeMirror-selected" style="position: absolute; left: '+e+"px; top: "+t+"px; right: "+i+"px; height: "+n+'px"></div>'}u.style.top=Math.max(0,Math.min(k.offsetHeight,a.y+l.top-s.top))+"px",u.style.left=Math.max(0,Math.min(k.offsetWidth,a.x+l.left-s.left))+"px",t?(g.style.top=a.y+"px",g.style.left=(v.lineWrapping?Math.min(a.x,f.offsetWidth):a.x)+"px",g.style.display="",x.style.display="none"):(a=i.y==n.y,o="",W.from.ch&&0<=i.y&&(e=a?f.clientWidth-n.x:0,d(i.x,i.y,e,r)),e=Math.max(0,i.y+(W.from.ch?r:0)),.2*r<(i=Math.min(n.y,f.clientHeight)-e)&&d(0,e,0,i),a&&W.from.ch||!(n.y<f.clientHeight-.5*r)||d(0,n.y,f.clientWidth-n.x,r),x.innerHTML=o,g.style.display="none",x.style.display="")}function De(e){b=e?b||(W.inverted?W.to:W.from):null}function Se(e,t){var i=b&&Oe(b);i&&(ei(i,e)?e=i:ei(t,i)&&(t=i)),Ne(e,t),F=!0}function Ne(e,t,i,n){var o;(Re=null)==i&&(i=W.from.line,n=W.to.line),Qt(W.from,e)&&Qt(W.to,t)||(ei(t,e)&&(o=t,t=e,e=o),e.line!=i&&(e=Fe(e,i,W.from.ch)),t.line!=n&&(t=Fe(t,n,W.to.ch)),Qt(e,t)||Qt(e,W.to)?W.inverted=!1:Qt(t,W.from)&&(W.inverted=!0),W.from=e,W.to=t,O=!0)}function Fe(a,e,r){function t(e){for(var t=a.line+e,i=1==e?D.size:-1;t!=i;){var n=ee(t);if(!n.hidden){var o=a.ch;return(r<o||o>n.text.length)&&(o=n.text.length),{line:t,ch:o}}t+=e}}return ee(a.line).hidden?a.line>=e?t(1)||t(-1):t(-1)||t(1):a}function Ie(e,t,i){t=Oe({line:e,ch:t||0});(i?Se:Ne)(t,t)}function Me(e){return Math.max(0,Math.min(e,D.size-1))}function Oe(e){if(e.line<0)return{line:0,ch:0};if(e.line>=D.size)return{line:D.size-1,ch:ee(D.size-1).text.length};var t=e.ch,i=ee(e.line).text.length;return null==t||i<t?{line:e.line,ch:i}:t<0?{line:e.line,ch:0}:e}function Le(n,e){var t=W.inverted?W.from:W.to,o=t.line,i=t.ch,a=ee(o);function r(e){if(i==(n<0?0:a.text.length)){if(e||!function(){for(var e=o+n,t=n<0?-1:D.size;e!=t;e+=n){var i=ee(e);if(!i.hidden)return o=e,a=i,1}}())return;i=n<0?a.text.length:0}else i+=n;return 1}if("char"==e)r();else if("column"==e)r(!0);else if("word"==e)for(var s=!1;!(n<0)||r();){if(oi(a.text.charAt(i)))s=!0;else if(s){n<0&&(n=1,r());break}if(0<n&&!r())break}return{line:o,ch:i}}var Re=null;function Ae(e){for(var t=ee(e.line).text,i=e.ch,n=e.ch;0<i&&oi(t.charAt(i-1));)--i;for(;n<t.length&&oi(t.charAt(n));)++n;Se({line:e.line,ch:i},{line:e.line,ch:n})}function Ge(e,t){var i;"smart"==(t=t||"add")&&(T.indent?i=ft(e):t="prev");var n,o=ee(e),a=o.indentation(v.tabSize),r=o.text.match(/^\s*/)[0];if("prev"==t?n=e?ee(e-1).indentation(v.tabSize):0:"smart"==t?n=T.indent(i,o.text.slice(r.length),o.text):"add"==t?n=a+v.indentUnit:"subtract"==t&&(n=a-v.indentUnit),(n=Math.max(0,n))-a){var s="",l=0;if(v.indentWithTabs)for(var d=Math.floor(n/v.tabSize);d;--d)l+=v.tabSize,s+="\t";for(;l<n;)++l,s+=" "}else{if(W.from.line!=e&&W.to.line!=e)return;var s=r}ce(s,{line:e,ch:0},{line:e,ch:r.length})}function Be(){T=vt.getMode(v,v.mode),D.iter(0,D.size,function(e){e.stateAfter=null}),_=[0],xt()}function We(e,t){var i;v.lineWrapping?(c.className+=" CodeMirror-wrap",i=k.clientWidth/rt()-3,D.iter(0,D.size,function(e){var t;e.hidden||1!=(t=Math.ceil(e.text.length/i)||1)&&te(e,t)}),f.style.width=P.style.width=""):(c.className=c.className.replace(" CodeMirror-wrap",""),B=null,K="",D.iter(0,D.size,function(e){1==e.height||e.hidden||te(e,1),e.text.length>K.length&&(K=e.text)})),I.push({from:0,to:D.size})}function He(){for(var e='<span class="cm-tab">',t=0;t<v.tabSize;++t)e+=" ";return e+"</span>"}function Ue(){J=He(),Pe(!0)}function Ve(){k.className=k.className.replace(/\s*cm-s-\w+/g,"")+v.theme.replace(/(^|\s)\s*/g," cm-s-")}function ze(){this.set=[]}function Xe(e,t,i){e=Oe(e),t=Oe(t);var o=new ze;function n(e,t,i,n){ee(e).addMark(new It(t,i,n,o.set))}if(e.line==t.line)n(e.line,e.ch,t.ch,i);else{n(e.line,e.ch,null,i);for(var a=e.line+1,r=t.line;a<r;++a)n(a,null,null,i);n(t.line,null,t.ch,i)}return I.push({from:e.line,to:t.line+1}),o}function Ye(e,t){var i=e,n=e;return"number"==typeof e?n=ee(Me(e)):i=At(e),null!=i&&t(n,i)?(I.push({from:i,to:i+1}),n):null}function je(e,n){return Ye(e,function(e,t){if(e.hidden!=n){e.hidden=n,te(e,n?0:1);var i=W.from.line,e=W.to.line;return!n||i!=t&&e!=t||Ne(i==t?Fe({line:i,ch:0},i,0):W.from,e==t?Fe({line:e,ch:0},e,0):W.to),R=!0}})}function Ke(e){return o.innerHTML="<pre><span>x</span></pre>",o.firstChild.firstChild.firstChild.nodeValue=e,o.firstChild.firstChild.offsetWidth||10}ze.prototype.clear=wt(function(){for(var e=1/0,t=-1/0,i=0,n=this.set.length;i<n;++i){var o=this.set[i],a=o.marked;if(a&&o.parent)for(var o=At(o),e=Math.min(e,o),t=Math.max(t,o),r=0;r<a.length;++r)a[r].set==this.set&&a.splice(r--,1)}e!=1/0&&I.push({from:e,to:t+1})}),ze.prototype.find=function(){for(var e,t,i=0,n=this.set.length;i<n;++i)for(var o=this.set[i],a=o.marked,r=0;r<a.length;++r){var s,l=a[r];l.set==this.set&&(null==l.from&&null==l.to||null!=(s=At(o))&&(null!=l.from&&(e={line:s,ch:l.from}),null!=l.to&&(t={line:s,ch:l.to})))}return{from:e,to:t}};var Je,qe,Ze,$e=Math.floor(16777215*Math.random()).toString(16);function Qe(e,t){if(0==t)return{top:0,left:0};var i="";v.lineWrapping&&(n=e.text.indexOf(" ",t+2),i=ii(e.text.slice(t+1,n<0?e.text.length:n+(qt?5:0)))),o.innerHTML="<pre>"+e.getHTML(J,t)+'<span id="CodeMirror-temp-'+$e+'">'+ii(e.text.charAt(t)||" ")+"</span>"+i+"</pre>";var n=document.getElementById("CodeMirror-temp-"+$e),e=n.offsetTop,t=n.offsetLeft;return qt&&0==e&&0==t&&((i=document.createElement("span")).innerHTML="x",n.parentNode.insertBefore(i,n.nextSibling),e=i.offsetTop),{top:e,left:t}}function et(e,t){var i,n=nt(),t=n*(Bt(D,e.line)-(t?z:0));return 0==e.ch?i=0:(i=(e=Qe(ee(e.line),e.ch)).left,v.lineWrapping&&(t+=Math.max(0,e.top))),{x:i,y:t,yBot:t+n}}function tt(e,t){t<0&&(t=0);var i=nt(),n=rt(),o=z+Math.floor(t/i),a=Gt(D,o);if(a>=D.size)return{line:D.size-1,ch:ee(D.size-1).text.length};var r=ee(a),t=r.text,s=v.lineWrapping,l=s?o-Bt(D,a):0;if(e<=0&&0==l)return{line:a,ch:0};function d(e){var t=Qe(r,e);if(s){e=Math.round(t.top/i);return Math.max(0,t.left+(e-l)*k.clientWidth)}return t.left}for(var c,u=0,h=0,p=t.length,m=Math.min(p,Math.ceil((e+l*k.clientWidth*.9)/n));;){var f=d(m);if(!(f<=e&&m<p)){c=f,p=m;break}m=Math.min(p,Math.ceil(1.2*m))}if(c<e)return{line:a,ch:p};for((f=d(m=Math.floor(.8*p)))<e&&(u=m,h=f);;){if(p-u<=1)return{line:a,ch:e-h<c-e?u:p};var g=Math.ceil((u+p)/2),x=d(g);e<x?(p=g,c=x):(u=g,h=x)}}function it(e){var t=et(e,!0),e=$t(f);return{x:e.left+t.x,y:e.top+t.y,yBot:e.top+t.yBot}}function nt(){if(null==Ze){Ze="<pre>";for(var e=0;e<49;++e)Ze+="x<br/>";Ze+="x</pre>"}var t=E.clientHeight;return t==qe||(qe=t,o.innerHTML=Ze,Je=o.firstChild.offsetHeight/50||1,o.innerHTML=""),Je}var ot,at=0;function rt(){return k.clientWidth==at?ot:(at=k.clientWidth,ot=Ke("x"))}function st(){return f.offsetTop}function lt(){return f.offsetLeft}function dt(e,t){var i,n,o=$t(k,!0);try{i=e.clientX,n=e.clientY}catch(e){return null}if(!t&&(i-o.left>k.clientWidth||n-o.top>k.clientHeight))return null;o=$t(f,!0);return tt(i-o.left,n-o.top)}function ct(e){var t,i,n,o=dt(e);function a(){var e=ai(r.value).join("\n");e!=i&&wt(ue)(e,"end"),u.style.position="relative",r.style.cssText=t,be(!(L=!1)),ge()}o&&!window.opera&&(!Qt(W.from,W.to)&&!ei(o,W.from)&&ei(o,W.to)||wt(Ie)(o.line,o.ch),t=r.style.cssText,u.style.position="absolute",r.style.cssText="position: fixed; width: 30px; height: 30px; top: "+(e.clientY-5)+"px; left: "+(e.clientX-5)+"px; z-index: 1000; background: white; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);",L=!0,i=r.value=me(),Ce(),r.select(),Jt?(Vt(e),n=Yt(window,"mouseup",function(){n(),setTimeout(a,20)},!0)):setTimeout(a,50))}function ut(){clearInterval(a);var e=!0;g.style.visibility="",a=setInterval(function(){g.style.visibility=(e=!e)?"":"hidden"},650)}var ht={"(":")>",")":"(<","[":"]>","]":"[<","{":"}>","}":"{<"};function pt(e){var t=W.inverted?W.from:W.to,i=ee(t.line),n=t.ch-1,o=0<=n&&ht[i.text.charAt(n)]||ht[i.text.charAt(++n)];if(o){o.charAt(0);for(var h=">"==o.charAt(1),p=h?1:-1,a=i.styles,r=n+1,s=0,l=a.length;s<l;s+=2)if((r-=a[s].length)<=0){var m=a[s+1];break}for(var f=[i.text.charAt(n)],g=/[(){}[\]]/,s=t.line,l=h?Math.min(s+100,D.size):Math.max(-1,s-100);s!=l;s+=p){var i=ee(s),d=s==t.line,c=function(e,t,i){if(e.text)for(var n,o=e.styles,a=h?0:e.text.length-1,r=h?0:o.length-2,s=h?o.length:-2;r!=s;r+=2*p){var l=o[r];if(null==o[r+1]||o[r+1]==m){for(var d=h?0:l.length-1,c=h?l.length:-1;d!=c;d+=p,a+=p)if(t<=a&&a<i&&g.test(n=l.charAt(d))){var u=ht[n];if(">"==u.charAt(1)==h)f.push(n);else{if(f.pop()!=u.charAt(0))return{pos:a,match:!1};if(!f.length)return{pos:a,match:!0}}}}else a+=p*l.length}}(i,d&&h?n+1:0,d&&!h?n:i.text.length);if(c)break}var m=(c=c||{pos:null,match:!1}).match?"CodeMirror-matchingbracket":"CodeMirror-nonmatchingbracket",u=Xe({line:t.line,ch:n},{line:t.line,ch:n+1},m),x=null!=c.pos&&Xe({line:s,ch:c.pos},{line:s,ch:c.pos+1},m),o=wt(function(){u.clear(),x&&x.clear()});e?setTimeout(o,800):G=o}}function mt(e){for(var t,i,n=e,o=e-40;o<n;--n){if(0==n)return 0;var a=ee(n-1);if(a.stateAfter)return n;a=a.indentation(v.tabSize);(null==i||a<t)&&(i=n-1,t=a)}return i}function ft(e){var t=mt(e),i=(i=t&&ee(t-1).stateAfter)?Nt(T,i):Ft(T);return D.iter(t,e,function(e){e.highlight(T,i,v.tabSize),e.stateAfter=Nt(T,i)}),t<e&&I.push({from:t,to:e}),e<D.size&&!ee(e).stateAfter&&_.push(e),i}function gt(){for(var n,o=+new Date+v.workTime,e=_.length;_.length;)if(!((n=ee(X).stateAfter?_.pop():X)>=D.size)){var t=mt(n),a=(a=t&&ee(t-1).stateAfter)?Nt(T,a):Ft(T),r=0,s=T.compareStates,l=!1,d=t,c=!1;if(D.iter(d,D.size,function(e){var t=e.stateAfter;if(+new Date>o)return _.push(d),xt(v.workDelay),l&&I.push({from:n,to:d+1}),c=!0;var i=e.highlight(T,a,v.tabSize);if(i&&(l=!0),e.stateAfter=Nt(T,a),s){if(t&&s(t,a))return!0}else if(!1===i&&t){if(3<++r&&(!T.indent||T.indent(t,"")==T.indent(a,"")))return!0}else r=0;++d}),c)return;l&&I.push({from:n,to:d+1})}e&&v.onHighlightComplete&&v.onHighlightComplete(Q)}function xt(e){_.length&&y.set(e,wt(gt))}function Et(){N=F=M=null,O=!(I=[]),A=[]}function yt(){var e,t=!1;O&&(t=!we()),I.length?e=Pe(I,!0):(O&&_e(),R&&Te()),t&&we(),O&&(g.getBoundingClientRect&&(t=g.getBoundingClientRect(),qt&&t.top==t.bottom||(i=window.innerHeight||Math.max(document.body.offsetHeight,document.documentElement.offsetHeight),(t.top<0||t.bottom>i)&&g.scrollIntoView())),ut()),d&&!L&&(!0===N||!1!==N&&O)&&be(F),O&&v.matchBrackets&&setTimeout(wt(function(){G&&(G(),G=null),Qt(W.from,W.to)&&pt(!1)}),20);var i=M,n=A;O&&v.onCursorActivity&&v.onCursorActivity(Q),i&&v.onChange&&Q&&v.onChange(Q,i);for(var o=0;o<n.length;++o)n[o](Q);e&&v.onUpdate&&v.onUpdate(Q)}var bt,Ct=0;function wt(t){return function(){Ct++||Et();try{var e=t.apply(this,arguments)}finally{--Ct||yt()}return e}}for(bt in Tt)Tt.propertyIsEnumerable(bt)&&!Q.propertyIsEnumerable(bt)&&(Q[bt]=Tt[bt]);return Q}vt.defaults={value:"",mode:null,theme:"default",indentUnit:2,indentWithTabs:!1,smartIndent:!0,tabSize:4,keyMap:"default",extraKeys:null,electricChars:!0,onKeyEvent:null,lineWrapping:!1,lineNumbers:!1,gutter:!1,fixedGutter:!1,firstLineNumber:1,readOnly:!1,onChange:null,onCursorActivity:null,onGutterClick:null,onHighlightComplete:null,onUpdate:null,onFocus:null,onBlur:null,onScroll:null,matchBrackets:!1,workTime:100,workDelay:200,pollInterval:100,undoDepth:40,tabindex:null,document:window.document};var kt=/AppleWebKit/.test(navigator.userAgent)&&/Mobile\/\w+/.test(navigator.userAgent),Pt=kt||/Mac/.test(navigator.platform),o=(/Win/.test(navigator.platform),{}),a={};vt.defineMode=function(e,t){vt.defaults.mode||"null"==e||(vt.defaults.mode=e),o[e]=t},vt.defineMIME=function(e,t){a[e]=t},vt.getMode=function(e,t){var i,n;"string"==typeof t&&a.hasOwnProperty(t)&&(t=a[t]),"string"==typeof t?(i=t,n={}):null!=t&&(i=t.name,n=t);t=o[i];return t?t(e,n||{}):(window.console&&console.warn("No mode "+i+" found, falling back to plain text."),vt.getMode(e,"text/plain"))},vt.listModes=function(){var e,t=[];for(e in o)o.propertyIsEnumerable(e)&&t.push(e);return t},vt.listMIMEs=function(){var e,t=[];for(e in a)a.propertyIsEnumerable(e)&&t.push({mime:e,mode:a[e]});return t};var Tt=vt.extensions={};vt.defineExtension=function(e,t){Tt[e]=t};var _t=vt.commands={selectAll:function(e){e.setSelection({line:0,ch:0},{line:e.lineCount()-1})},killLine:function(e){var t=e.getCursor(!0),i=e.getCursor(!1),n=!Qt(t,i);n||e.getLine(t.line).length!=t.ch?e.replaceRange("",t,n?i:{line:t.line}):e.replaceRange("",t,{line:t.line+1,ch:0})},deleteLine:function(e){var t=e.getCursor().line;e.replaceRange("",{line:t,ch:0},{line:t})},undo:function(e){e.undo()},redo:function(e){e.redo()},goDocStart:function(e){e.setCursor(0,0,!0)},goDocEnd:function(e){e.setSelection({line:e.lineCount()-1},null,!0)},goLineStart:function(e){e.setCursor(e.getCursor().line,0,!0)},goLineStartSmart:function(e){var t=e.getCursor(),i=e.getLine(t.line),i=Math.max(0,i.search(/\S/));e.setCursor(t.line,t.ch<=i&&t.ch?0:i,!0)},goLineEnd:function(e){e.setSelection({line:e.getCursor().line},null,!0)},goLineUp:function(e){e.moveV(-1,"line")},goLineDown:function(e){e.moveV(1,"line")},goPageUp:function(e){e.moveV(-1,"page")},goPageDown:function(e){e.moveV(1,"page")},goCharLeft:function(e){e.moveH(-1,"char")},goCharRight:function(e){e.moveH(1,"char")},goColumnLeft:function(e){e.moveH(-1,"column")},goColumnRight:function(e){e.moveH(1,"column")},goWordLeft:function(e){e.moveH(-1,"word")},goWordRight:function(e){e.moveH(1,"word")},delCharLeft:function(e){e.deleteH(-1,"char")},delCharRight:function(e){e.deleteH(1,"char")},delWordLeft:function(e){e.deleteH(-1,"word")},delWordRight:function(e){e.deleteH(1,"word")},indentAuto:function(e){e.indentSelection("smart")},indentMore:function(e){e.indentSelection("add")},indentLess:function(e){e.indentSelection("subtract")},insertTab:function(e){e.replaceSelection("\t","end")},transposeChars:function(e){var t=e.getCursor(),i=e.getLine(t.line);0<t.ch&&t.ch<i.length-1&&e.replaceRange(i.charAt(t.ch)+i.charAt(t.ch-1),{line:t.line,ch:t.ch-1},{line:t.line,ch:t.ch+1})},newlineAndIndent:function(e){e.replaceSelection("\n","end"),e.indentLine(e.getCursor().line)},toggleOverwrite:function(e){e.toggleOverwrite()}},Dt=vt.keyMap={};function St(e,t,i){function r(e,t,i){var n=t[e];if(null!=n)return n;if(null==i&&(i=t.fallthrough),null==i)return t.catchall;if("string"==typeof i)return r(e,Dt[i]);for(var o=0,a=i.length;o<a;++o)if(null!=(n=r(e,Dt[i[o]])))return n;return null}return t?r(e,t,i):r(e,Dt[i])}function Nt(e,t){if(!0===t)return t;if(e.copyState)return e.copyState(t);var i,n={};for(i in t){var o=t[i];o instanceof Array&&(o=o.concat([])),n[i]=o}return n}function Ft(e,t,i){return!e.startState||e.startState(t,i)}function u(e,t){this.pos=this.start=0,this.string=e,this.tabSize=t||8}function It(e,t,i,n){this.from=e,this.to=t,this.style=i,this.set=n}function Mt(e){this.from=e,this.to=e,this.line=null}function Ot(e,t){this.styles=t||[e,null],this.text=e,this.height=1,this.marked=this.gutterMarker=this.className=this.handlers=null,this.stateAfter=this.parent=this.hidden=null}function d(e,t,i,n){for(var o=0,a=0,r=0;a<t;o+=2){var s=i[o],l=a+s.length;0==r?(e<l&&n.push(s.slice(e-a,Math.min(s.length,t-a)),i[o+1]),e<=l&&(r=1)):1==r&&(t<l?n.push(s.slice(0,t-a),i[o+1]):n.push(s,i[o+1])),a=l}}function Lt(e){this.lines=e,this.parent=null;for(var t=0,i=e.length,n=0;t<i;++t)e[t].parent=this,n+=e[t].height;this.height=n}function Rt(e){for(var t=0,i=0,n=0,o=(this.children=e).length;n<o;++n){var a=e[n];t+=a.chunkSize(),i+=a.height,a.parent=this}this.size=t,this.height=i,this.parent=null}function At(e){if(null==e.parent)return null;for(var t=e.parent,i=ni(t.lines,e),n=t.parent;n;n=(t=n).parent){var o=0;for(n.children.length;n.children[o]!=t;++o)i+=n.children[o].chunkSize()}return i}function Gt(e,t){var i=0;e:do{for(var n=0,o=e.children.length;n<o;++n){var a=e.children[n],r=a.height;if(t<r){e=a;continue e}t-=r,i+=a.chunkSize()}return i}while(!e.lines);for(n=0,o=e.lines.length;n<o;++n){var s=e.lines[n].height;if(t<s)break;t-=s}return i+n}function Bt(e,t){var i=0;e:do{for(var n=0,o=e.children.length;n<o;++n){var a=e.children[n],r=a.chunkSize();if(t<r){e=a;continue e}t-=r,i+=a.height}return i}while(!e.lines);for(n=0;n<t;++n)i+=e.lines[n].height;return i}function Wt(){this.time=0,this.done=[],this.undone=[]}function t(){Vt(this)}function Ht(e){return e.stop||(e.stop=t),e}function Ut(e){e.preventDefault?e.preventDefault():e.returnValue=!1}function i(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}function Vt(e){Ut(e),i(e)}function zt(e){return e.target||e.srcElement}function Xt(e,t){return(e.override&&e.override.hasOwnProperty(t)?e.override:e)[t]}function Yt(e,t,i,n){if("function"==typeof e.addEventListener){if(e.addEventListener(t,i,!1),n)return function(){e.removeEventListener(t,i,!1)}}else{function o(e){i(e||window.event)}if(e.attachEvent("on"+t,o),n)return function(){e.detachEvent("on"+t,o)}}}function jt(){this.id=null}Dt.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharRight",Backspace:"delCharLeft",Tab:"indentMore","Shift-Tab":"indentLess",Enter:"newlineAndIndent",Insert:"toggleOverwrite"},Dt.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Alt-Up":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Down":"goDocEnd","Ctrl-Left":"goWordLeft","Ctrl-Right":"goWordRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delWordLeft","Ctrl-Delete":"delWordRight","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll",fallthrough:"basic"},Dt.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goWordLeft","Alt-Right":"goWordRight","Cmd-Left":"goLineStart","Cmd-Right":"goLineEnd","Alt-Backspace":"delWordLeft","Ctrl-Alt-Backspace":"delWordRight","Alt-Delete":"delWordRight","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll",fallthrough:["basic","emacsy"]},Dt.default=Pt?Dt.macDefault:Dt.pcDefault,Dt.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Alt-F":"goWordRight","Alt-B":"goWordLeft","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageUp","Shift-Ctrl-V":"goPageDown","Ctrl-D":"delCharRight","Ctrl-H":"delCharLeft","Alt-D":"delWordRight","Alt-Backspace":"delWordLeft","Ctrl-K":"killLine","Ctrl-T":"transposeChars"},vt.fromTextArea=function(t,e){function i(){t.value=a.getValue()}var n,o;(e=e||{}).value=t.value,!e.tabindex&&t.tabindex&&(e.tabindex=t.tabindex),t.form&&(n=Yt(t.form,"submit",i,!0),"function"==typeof t.form.submit&&(o=t.form.submit,t.form.submit=function e(){i(),t.form.submit=o,t.form.submit(),t.form.submit=e})),t.style.display="none";var a=vt(function(e){t.parentNode.insertBefore(e,t.nextSibling)},e);return a.save=i,a.getTextArea=function(){return t},a.toTextArea=function(){i(),t.parentNode.removeChild(a.getWrapperElement()),t.style.display="",t.form&&(n(),"function"==typeof t.form.submit&&(t.form.submit=o))},a},vt.copyState=Nt,vt.startState=Ft,u.prototype={eol:function(){return this.pos>=this.string.length},sol:function(){return 0==this.pos},peek:function(){return this.string.charAt(this.pos)},next:function(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)},eat:function(e){var t=this.string.charAt(this.pos);if("string"==typeof e?t==e:t&&(e.test?e.test(t):e(t)))return++this.pos,t},eatWhile:function(e){for(var t=this.pos;this.eat(e););return this.pos>t},eatSpace:function(){for(var e=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>e},skipToEnd:function(){this.pos=this.string.length},skipTo:function(e){e=this.string.indexOf(e,this.pos);if(-1<e)return this.pos=e,!0},backUp:function(e){this.pos-=e},column:function(){return n(this.string,this.start,this.tabSize)},indentation:function(){return n(this.string,null,this.tabSize)},match:function(e,t,i){if("string"!=typeof e){var n=this.string.slice(this.pos).match(e);return n&&!1!==t&&(this.pos+=n[0].length),n}function o(e){return i?e.toLowerCase():e}if(o(this.string).indexOf(o(e),this.pos)==this.pos)return!1!==t&&(this.pos+=e.length),!0},current:function(){return this.string.slice(this.start,this.pos)}},vt.StringStream=u,It.prototype={attach:function(e){this.set.push(e)},detach:function(e){e=ni(this.set,e);-1<e&&this.set.splice(e,1)},split:function(e,t){return this.to<=e&&null!=this.to?null:new It(this.from<e||null==this.from?null:this.from-e+t,null==this.to?null:this.to-e+t,this.style,this.set)},dup:function(){return new It(null,null,this.style,this.set)},clipTo:function(e,t,i,n,o){null!=this.from&&this.from>=t&&(this.from=Math.max(n,this.from)+o),null!=this.to&&this.to>t&&(this.to=n<this.to?this.to+o:t),e&&n>this.from&&(n<this.to||null==this.to)&&(this.from=null),i&&(t<this.to||null==this.to)&&(t>this.from||null==this.from)&&(this.to=null)},isDead:function(){return null!=this.from&&null!=this.to&&this.from>=this.to},sameSet:function(e){return this.set==e.set}},Mt.prototype={attach:function(e){this.line=e},detach:function(e){this.line==e&&(this.line=null)},split:function(e,t){if(e<this.from)return this.from=this.to=this.from-e+t,this},isDead:function(){return this.from>this.to},clipTo:function(e,t,i,n,o){(e||t<this.from)&&(i||n>this.to)?(this.from=0,this.to=-1):this.from>t&&(this.from=this.to=Math.max(n,this.from)+o)},sameSet:function(e){return!1},find:function(){return this.line&&this.line.parent?{line:At(this.line),ch:this.from}:null},clear:function(){var e;this.line&&(-1!=(e=ni(this.line.marked,this))&&this.line.marked.splice(e,1),this.line=null)}},Ot.inheritMarks=function(e,t){var i=new Ot(e),n=t&&t.marked;if(n)for(var o,a,r=0;r<n.length;++r)null==n[r].to&&n[r].style&&(o=i.marked||(i.marked=[]),a=n[r].dup(),o.push(a),a.attach(i));return i},Ot.prototype={replace:function(e,t,i){var n=[],o=this.marked,a=null==t?this.text.length:t;if(d(0,e,this.styles,n),i&&n.push(i,null),d(a,this.text.length,this.styles,n),this.styles=n,this.text=this.text.slice(0,e)+i+this.text.slice(a),this.stateAfter=null,o)for(var r=i.length-(a-e),s=0;s<o.length;++s){var l=o[s];l.clipTo(null==e,e||0,null==t,a,r),l.isDead()&&(l.detach(this),o.splice(s--,1))}},split:function(e,t){var i=[t,null],n=this.marked;d(e,this.text.length,this.styles,i);var o=new Ot(t+this.text.slice(e),i);if(n)for(var a=0;a<n.length;++a){var r=n[a].split(e,t.length);r&&(o.marked||(o.marked=[]),o.marked.push(r),r.attach(o))}return o},append:function(e){var t=this.text.length,i=e.marked,n=this.marked;if(this.text+=e.text,d(0,e.text.length,e.styles,this.styles),n)for(var o=0;o<n.length;++o)null==n[o].to&&(n[o].to=t);if(i&&i.length){n||(this.marked=n=[]);e:for(o=0;o<i.length;++o){var a=i[o];if(!a.from)for(var r=0;r<n.length;++r){var s=n[r];if(s.to==t&&s.sameSet(a)){s.to=null==a.to?null:a.to+t,s.isDead()&&(s.detach(this),i.splice(o--,1));continue e}}n.push(a),a.attach(this),a.from+=t,null!=a.to&&(a.to+=t)}}},fixMarkEnds:function(e){var t=this.marked,i=e.marked;if(t)for(var n=0;n<t.length;++n){var o=t[n],a=null==o.to;if(a&&i)for(var r=0;r<i.length;++r)if(i[r].sameSet(o)){a=!1;break}a&&(o.to=this.text.length)}},fixMarkStarts:function(){var e=this.marked;if(e)for(var t=0;t<e.length;++t)null==e[t].from&&(e[t].from=0)},addMark:function(e){e.attach(this),null==this.marked&&(this.marked=[]),this.marked.push(e),this.marked.sort(function(e,t){return(e.from||0)-(t.from||0)})},highlight:function(e,t,i){var n,o=new u(this.text,i),a=this.styles,r=0,s=!1,l=a[0];for(""==this.text&&e.blankLine&&e.blankLine(t);!o.eol();){var d=e.token(o,t),c=this.text.slice(o.start,o.pos);if(o.start=o.pos,r&&a[r-1]==d?a[r-2]+=c:c&&(!s&&(a[r+1]!=d||r&&a[r-2]!=n)&&(s=!0),a[r++]=c,a[r++]=d,n=l,l=a[r]),5e3<o.pos){a[r++]=this.text.slice(o.pos),a[r++]=null;break}}return a.length!=r&&(a.length=r,s=!0),r&&a[r-2]!=n&&(s=!0),s||a.length<5&&this.text.length<10&&null},getTokenAt:function(e,t,i){for(var n=new u(this.text);n.pos<i&&!n.eol();){n.start=n.pos;var o=e.token(n,t)}return{start:n.start,end:n.pos,string:n.current(),className:o||null,state:t}},indentation:function(e){return n(this.text,null,e)},getHTML:function(i,e){var n=[],o=!0;function t(e,t){e&&(o&&qt&&" "==e.charAt(0)&&(e=" "+e.slice(1)),o=!1,t?n.push('<span class="',t,'">',ii(e).replace(/\t/g,i),"</span>"):n.push(ii(e).replace(/\t/g,i)))}var a=this.styles,r=this.text,s=this.marked,l=r.length;function d(e){return e?"cm-"+e.replace(/ +/g," cm-"):null}if(null!=e&&(l=Math.min(e,l)),r||null!=e)if(s&&s.length){var c=0,u=0,h="",p=s[0].from||0,m=[],f=0;for(;c<l;){p==c&&function(){for(var e;f<s.length&&((e=s[f]).from==c||null==e.from);)null!=e.style&&m.push(e),++f;p=f<s.length?s[f].from:1/0;for(var t=0;t<m.length;++t){var i=m[t].to||1/0;i==c?m.splice(t--,1):p=Math.min(i,p)}}();for(var g=Math.min(l,p);;){if(h){for(var x=c+h.length,E=w,y=0;y<m.length;++y)E=(E?E+" ":"")+m[y].style;if(t(g<x?h.slice(0,g-c):h,E),g<=x){h=h.slice(g-c),c=g;break}c=x}h=a[u++],w=d(a[u++])}}}else for(var u=0,b=0;b<l;u+=2){var C=a[u],w=a[u+1],v=C.length;l<b+v&&(C=C.slice(0,l-b)),b+=v,t(C,d(w))}else t(" ");return n.join("")},cleanUp:function(){if(this.parent=null,this.marked)for(var e=0,t=this.marked.length;e<t;++e)this.marked[e].detach(this)}},Lt.prototype={chunkSize:function(){return this.lines.length},remove:function(e,t,i){for(var n=e,o=e+t;n<o;++n){var a=this.lines[n];if(this.height-=a.height,a.cleanUp(),a.handlers)for(var r=0;r<a.handlers.length;++r)i.push(a.handlers[r])}this.lines.splice(e,t)},collapse:function(e){e.splice.apply(e,[e.length,0].concat(this.lines))},insertHeight:function(e,t,i){this.height+=i,this.lines.splice.apply(this.lines,[e,0].concat(t));for(var n=0,o=t.length;n<o;++n)t[n].parent=this},iterN:function(e,t,i){for(var n=e+t;e<n;++e)if(i(this.lines[e]))return!0}},Rt.prototype={chunkSize:function(){return this.size},remove:function(e,t,i){this.size-=t;for(var n,o=0;o<this.children.length;++o){var a=this.children[o],r=a.chunkSize();if(e<r){var s=Math.min(t,r-e),l=a.height;if(a.remove(e,s,i),this.height-=l-a.height,r==s&&(this.children.splice(o--,1),a.parent=null),0==(t-=s))break;e=0}else e-=r}this.size-t<25&&(n=[],this.collapse(n),this.children=[new Lt(n)],this.children[0].parent=this)},collapse:function(e){for(var t=0,i=this.children.length;t<i;++t)this.children[t].collapse(e)},insert:function(e,t){for(var i=0,n=0,o=t.length;n<o;++n)i+=t[n].height;this.insertHeight(e,t,i)},insertHeight:function(e,t,i){this.size+=t.length,this.height+=i;for(var n=0,o=this.children.length;n<o;++n){var a=this.children[n],r=a.chunkSize();if(e<=r){if(a.insertHeight(e,t,i),a.lines&&50<a.lines.length){for(;50<a.lines.length;){var s=new Lt(a.lines.splice(a.lines.length-25,25));a.height-=s.height,this.children.splice(n+1,0,s),s.parent=this}this.maybeSpill()}break}e-=r}},maybeSpill:function(){if(!(this.children.length<=10)){var e=this;do{var t,i=new Rt(e.children.splice(e.children.length-5,5))}while(e.parent?(e.size-=i.size,e.height-=i.height,t=ni(e.parent.children,e),e.parent.children.splice(t+1,0,i)):(((t=new Rt(e.children)).parent=e).children=[t,i],e=t),i.parent=e.parent,10<e.children.length);e.parent.maybeSpill()}},iter:function(e,t,i){this.iterN(e,t-e,i)},iterN:function(e,t,i){for(var n=0,o=this.children.length;n<o;++n){var a=this.children[n],r=a.chunkSize();if(e<r){var s=Math.min(t,r-e);if(a.iterN(e,s,i))return!0;if(0==(t-=s))break;e=0}else e-=r}}},Wt.prototype={addChange:function(e,t,i){this.undone.length=0;var n=+new Date,o=this.done[this.done.length-1],a=o&&o[o.length-1];if(400<n-this.time||!a)this.done.push([{start:e,added:t,old:i}]);else if(a.start>e+t||a.start+a.added<e-a.added+a.old.length)o.push({start:e,added:t,old:i});else{o=0;if(e<a.start){for(var r=a.start-e-1;0<=r;--r)a.old.unshift(i[r]);a.added+=a.start-e,a.start=e}else a.start<e&&(t+=o=e-a.start);for(var r=a.added-o,s=i.length;r<s;++r)a.old.push(i[r]);a.added<t&&(a.added=t)}this.time=n}},vt.e_stop=Vt,vt.e_preventDefault=Ut,vt.e_stopPropagation=i,vt.connect=Yt,jt.prototype={set:function(e,t){clearTimeout(this.id),this.id=setTimeout(t,e)}};var e,Kt=!/MSIE [1-8]\b/.test(navigator.userAgent)&&"draggable"in document.createElement("div"),Jt=/gecko\/\d{7}/i.test(navigator.userAgent),qt=/MSIE \d/.test(navigator.userAgent),Zt=/WebKit\//.test(navigator.userAgent);function n(e,t,i){null==t&&-1==(t=e.search(/[^\s\u00a0]/))&&(t=e.length);for(var n=0,o=0;n<t;++n)"\t"==e.charAt(n)?o+=i-o%i:++o;return o}function $t(e,t){for(var i=e.ownerDocument.body,n=0,o=0,a=!1,r=e;r;r=r.offsetParent){var s=r.offsetLeft,l=r.offsetTop;r==i?(n+=Math.abs(s),o+=Math.abs(l)):(n+=s,o+=l),t&&"fixed"==((l=r).currentStyle||window.getComputedStyle(l,null)).position&&(a=!0)}for(var d=t&&!a?null:i,r=e.parentNode;r!=d;r=r.parentNode)null!=r.scrollLeft&&(n-=r.scrollLeft,o-=r.scrollTop);return{left:n,top:o}}function Qt(e,t){return e.line==t.line&&e.ch==t.ch}function ei(e,t){return e.line<t.line||e.line==t.line&&e.ch<t.ch}(e=document.createElement("textarea")).value="foo\nbar",e.value.indexOf("\r"),null!=document.documentElement.getBoundingClientRect&&($t=function(e,t){try{var i={top:(i=e.getBoundingClientRect()).top,left:i.left}}catch(e){i={top:0,left:0}}return t||(null==window.pageYOffset?(null==(t=document.documentElement||document.body.parentNode).scrollTop&&(t=document.body),i.top+=t.scrollTop,i.left+=t.scrollLeft):(i.top+=window.pageYOffset,i.left+=window.pageXOffset)),i});var ti=document.createElement("pre");function ii(e){return ti.textContent=e,ti.innerHTML}function ni(e,t){if(e.indexOf)return e.indexOf(t);for(var i=0,n=e.length;i<n;++i)if(e[i]==t)return i;return-1}function oi(e){return/\w/.test(e)||e.toUpperCase()!=e.toLowerCase()}"\na"==ii("a")?ii=function(e){return ti.textContent=e,ti.innerHTML.slice(1)}:"\t"!=ii("\t")&&(ii=function(e){return ti.innerHTML="",ti.appendChild(document.createTextNode(e)),ti.innerHTML}),vt.htmlEscape=ii;var ai=3!="\n\nb".split(/\n/).length?function(e){for(var t,i=0,n=[];-1<(t=e.indexOf("\n",i));)n.push(e.slice(i,"\r"==e.charAt(t-1)?t-1:t)),i=t+1;return n.push(e.slice(i)),n}:function(e){return e.split(/\r?\n/)};vt.splitLines=ai;var ri=window.getSelection?function(e){try{return e.selectionStart!=e.selectionEnd}catch(e){return!1}}:function(e){try{var t=e.ownerDocument.selection.createRange()}catch(e){}return!(!t||t.parentElement()!=e)&&0!=t.compareEndPoints("StartToEnd",t)};vt.defineMode("null",function(){return{token:function(e){e.skipToEnd()}}}),vt.defineMIME("text/plain","null");var si={3:"Enter",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",91:"Mod",92:"Mod",93:"Mod",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",63276:"PageUp",63277:"PageDown",63275:"End",63273:"Home",63234:"Left",63232:"Up",63235:"Right",63233:"Down",63302:"Insert",63272:"Delete"};return vt.keyNames=si,function(){for(var e=0;e<10;e++)si[e+48]=String(e);for(e=65;e<=90;e++)si[e]=String.fromCharCode(e);for(e=1;e<=12;e++)si[e+111]=si[e+63235]="F"+e}(),vt}();function log(){console&&console.log.apply(this,arguments)}function _(t){try{var e=i18n[t];return void 0===e&&log("FIX ME : i18n not found for the string: "+(e=t)),e}catch(e){return t}}function XHR(o){var a=o.success,r=o.failure,s=o.callback;o.url="./do/"+o.params.task,delete o.params.task,o.params=Ext.applyIf({csrfToken:csrfToken},o.params),o.failure=o.success=Ext.emptyFn,o.callback=function(e,t,i){var n=null;try{n=Ext.decode(i.responseText)}catch(e){log("Invalid XHR JSON Response:"+i.responseText)}t&&n&&n.success?void 0!==a&&Ext.callback(a,o.scope,[i,e]):void 0!==r&&Ext.callback(r,o.scope,[i,e]),void 0!==s&&Ext.callback(s,o.scope,[e,t,i])},Ext.Ajax.request(o)}function renderLibel(e){return _(e)}CodeMirror.defineMode("clojure",function(e,t){var c="bracket";function i(e){for(var t={},i=e.split(" "),n=0;n<i.length;++n)t[i[n]]=!0;return t}var u=i("true false nil"),h=i("defn defn- def def- defonce defmulti defmethod defmacro defstruct deftype defprotocol defrecord deftest slice defalias defhinted defmacro- defn-memo defnk defnk defonce- defunbound defunbound- defvar defvar- let letfn do case cond condp for loop recur when when-not when-let when-first if if-let if-not . .. -> ->> doto and or dosync doseq dotimes dorun doall load import unimport ns in-ns refer try catch finally throw with-open with-local-vars binding gen-class gen-and-load-class gen-and-save-class handler-case handle* *1 *2 *3 *agent* *allow-unresolved-vars* *assert *clojure-version* *command-line-args* *compile-files* *compile-path* *e *err* *file* *flush-on-newline* *in* *macro-meta* *math-context* *ns* *out* *print-dup* *print-length* *print-level* *print-meta* *print-readably* *read-eval* *source-path* *use-context-classloader* *warn-on-reflection* + - / < <= = == > >= accessor aclone agent agent-errors aget alength alias all-ns alter alter-meta! alter-var-root amap ancestors and apply areduce array-map aset aset-boolean aset-byte aset-char aset-double aset-float aset-int aset-long aset-short assert assoc assoc! assoc-in associative? atom await await-for await1 bases bean bigdec bigint binding bit-and bit-and-not bit-clear bit-flip bit-not bit-or bit-set bit-shift-left bit-shift-right bit-test bit-xor boolean boolean-array booleans bound-fn bound-fn* butlast byte byte-array bytes case cast char char-array char-escape-string char-name-string char? chars chunk chunk-append chunk-buffer chunk-cons chunk-first chunk-next chunk-rest chunked-seq? class class? clear-agent-errors clojure-version coll? comment commute comp comparator compare compare-and-set! compile complement concat cond condp conj conj! cons constantly construct-proxy contains? count counted? create-ns create-struct cycle dec decimal? declare definline defmacro defmethod defmulti defn defn- defonce defstruct delay delay? deliver deref derive descendants destructure disj disj! dissoc dissoc! distinct distinct? doall doc dorun doseq dosync dotimes doto double double-array doubles drop drop-last drop-while empty empty? ensure enumeration-seq eval even? every? extend extend-protocol extend-type extends? extenders false? ffirst file-seq filter find find-doc find-ns find-var first float float-array float? floats flush fn fn? fnext for force format future future-call future-cancel future-cancelled? future-done? future? gen-class gen-interface gensym get get-in get-method get-proxy-class get-thread-bindings get-validator hash hash-map hash-set identical? identity if-let if-not ifn? import in-ns inc init-proxy instance? int int-array integer? interleave intern interpose into into-array ints io! isa? iterate iterator-seq juxt key keys keyword keyword? last lazy-cat lazy-seq let letfn line-seq list list* list? load load-file load-reader load-string loaded-libs locking long long-array longs loop macroexpand macroexpand-1 make-array make-hierarchy map map? mapcat max max-key memfn memoize merge merge-with meta method-sig methods min min-key mod name namespace neg? newline next nfirst nil? nnext not not-any? not-empty not-every? not= ns ns-aliases ns-imports ns-interns ns-map ns-name ns-publics ns-refers ns-resolve ns-unalias ns-unmap nth nthnext num number? odd? or parents partial partition pcalls peek persistent! pmap pop pop! pop-thread-bindings pos? pr pr-str prefer-method prefers primitives-classnames print print-ctor print-doc print-dup print-method print-namespace-doc print-simple print-special-doc print-str printf println println-str prn prn-str promise proxy proxy-call-with-super proxy-mappings proxy-name proxy-super push-thread-bindings pvalues quot rand rand-int range ratio? rational? rationalize re-find re-groups re-matcher re-matches re-pattern re-seq read read-line read-string reify reduce ref ref-history-count ref-max-history ref-min-history ref-set refer refer-clojure release-pending-sends rem remove remove-method remove-ns repeat repeatedly replace replicate require reset! reset-meta! resolve rest resultset-seq reverse reversible? rseq rsubseq satisfies? second select-keys send send-off seq seq? seque sequence sequential? set set-validator! set? short short-array shorts shutdown-agents slurp some sort sort-by sorted-map sorted-map-by sorted-set sorted-set-by sorted? special-form-anchor special-symbol? split-at split-with str stream? string? struct struct-map subs subseq subvec supers swap! symbol symbol? sync syntax-symbol-anchor take take-last take-nth take-while test the-ns time to-array to-array-2d trampoline transient tree-seq true? type unchecked-add unchecked-dec unchecked-divide unchecked-inc unchecked-multiply unchecked-negate unchecked-remainder unchecked-subtract underive unquote unquote-splicing update-in update-proxy use val vals var-get var-set var? vary-meta vec vector vector? when when-first when-let when-not while with-bindings with-bindings* with-in-str with-loading-context with-local-vars with-meta with-open with-out-str with-precision xml-seq"),p=i("ns fn def defn defmethod bound-fn if if-not case condp when while when-not when-first do future comment doto locking proxy with-open with-precision reify deftype defrecord defprotocol extend extend-protocol extend-type try catchlet letfn binding loop for doseq dotimes when-let if-letdefstruct struct-map assoctesting deftesthandler-case handle dotrace deftrace"),m={digit:/\d/,digit_or_colon:/[\d:]/,hex:/[0-9a-fA-F]/,sign:/[+-]/,exponent:/[eE]/,keyword_char:/[^\s\(\[\;\)\]]/,basic:/[\w\$_\-]/,lang_keyword:/[\w*+!\-_?:\/]/};function n(e,t,i){this.indent=e,this.type=t,this.prev=i}function f(e,t,i){e.indentStack=new n(t,i,e.indentStack)}return{startState:function(){return{indentStack:null,indentation:0,mode:!1}},token:function(e,t){if(null==t.indentStack&&e.sol()&&(t.indentation=e.indentation()),e.eatSpace())return null;var i,n,o=null;if("string"===t.mode){for(var a,r=!1;null!=(a=e.next());){if('"'==a&&!r){t.mode=!1;break}r=!r&&"\\"==a}o="string"}else{var s=e.next();if('"'==s)o=t.mode="string";else if("'"!=s||m.digit_or_colon.test(e.peek()))if(";"==s)e.skipToEnd(),o="comment";else if(n=e,"0"===(i=s)&&"x"==n.peek().toLowerCase()?(n.eat("x"),n.eatWhile(m.hex),1):("+"!=i&&"-"!=i||(n.eat(m.sign),i=n.next()),m.digit.test(i)?(n.eat(i),n.eatWhile(m.digit),"."==n.peek()&&(n.eat("."),n.eatWhile(m.digit)),"e"==n.peek().toLowerCase()&&(n.eat(m.exponent),n.eat(m.sign),n.eatWhile(m.digit)),1):void 0))o="number";else if("("==s||"["==s){for(var l="",d=e.column();null!=(letter=e.eat(m.keyword_char));)l+=letter;0<l.length&&p.propertyIsEnumerable(l)?f(t,d+2,s):(e.eatSpace(),e.eol()||";"==e.peek()?f(t,d+1,s):f(t,d+e.current().length,s)),e.backUp(e.current().length-1),o=c}else if(")"==s||"]"==s)o=c,null!=t.indentStack&&t.indentStack.type==(")"==s?"(":"[")&&((d=t).indentStack=d.indentStack.prev);else{if(":"==s)return e.eatWhile(m.lang_keyword),"tag";e.eatWhile(m.basic),o=h&&h.propertyIsEnumerable(e.current())?"builtin":u&&u.propertyIsEnumerable(e.current())?"atom":null}else o="atom"}return o},indent:function(e,t){return null==e.indentStack?e.indentation:e.indentStack.indent}}}),CodeMirror.defineMIME("text/x-clojure","clojure"),CodeMirror.defineMode("xml",function(e,t){var a,r,o,s,l=e.indentUnit,d=t.htmlMode?{autoSelfClosers:{br:!0,img:!0,hr:!0,link:!0,input:!0,meta:!0,col:!0,frame:!0,base:!0,area:!0},doNotIndent:{pre:!0},allowUnquoted:!0}:{autoSelfClosers:{},doNotIndent:{},allowUnquoted:!1},c=t.alignCDATA;function u(t,i){function e(e){return(i.tokenize=e)(t,i)}var n,o=t.next();if("<"==o){if(t.eat("!"))return t.eat("[")?t.match("CDATA[")?e(p("atom","]]>")):null:t.match("--")?e(p("comment","--\x3e")):t.match("DOCTYPE",!0,!0)?(t.eatWhile(/[\w\._\-]/),e(function n(o){return function(e,t){for(var i;null!=(i=e.next());){if("<"==i)return t.tokenize=n(o+1),t.tokenize(e,t);if(">"==i){if(1!=o)return t.tokenize=n(o-1),t.tokenize(e,t);t.tokenize=u;break}}return"meta"}}(1))):null;if(t.eat("?"))return t.eatWhile(/[\w\._\-]/),i.tokenize=p("meta","?>"),"meta";for(r=t.eat("/")?"closeTag":"openTag",t.eatSpace(),a="";n=t.eat(/[^\s\u00a0=<>\"\'\/?]/);)a+=n;return i.tokenize=h,"tag"}if("&"!=o)return t.eatWhile(/[^&<]/),null;o=t.eat("#")?t.eat("x")?t.eatWhile(/[a-fA-F\d]/)&&t.eat(";"):t.eatWhile(/[\d]/)&&t.eat(";"):t.eatWhile(/[\w\.\-:]/)&&t.eat(";");return o?"atom":"error"}function h(e,t){var i,n=e.next();return">"==n||"/"==n&&e.eat(">")?(t.tokenize=u,r=">"==n?"endTag":"selfcloseTag","tag"):"="==n?(r="equals",null):/[\'\"]/.test(n)?(t.tokenize=(i=n,function(e,t){for(;!e.eol();)if(e.next()==i){t.tokenize=h;break}return"string"}),t.tokenize(e,t)):(e.eatWhile(/[^\s\u00a0=<>\"\'\/?]/),"word")}function p(i,n){return function(e,t){for(;!e.eol();){if(e.match(n)){t.tokenize=u;break}e.next()}return i}}function i(){for(var e=arguments.length-1;0<=e;e--)o.cc.push(arguments[e])}function m(){return i.apply(null,arguments),!0}function n(e){if("openTag"==e)return o.tagName=a,m(f,(n=o.startOfLine,function(e){return"selfcloseTag"==e||"endTag"==e&&d.autoSelfClosers.hasOwnProperty(o.tagName.toLowerCase())||"endTag"==e&&(t=o.tagName,i=n,e=d.doNotIndent.hasOwnProperty(t)||o.context&&o.context.noIndent,o.context={prev:o.context,tagName:t,indent:o.indented,startOfLine:i,noIndent:e}),m();var t,i}));if("closeTag"!=e)return m();var t,n,e=!1;return(e=!o.context||o.context.tagName!=a)&&(s="error"),m((t=e,function(e){return t&&(s="error"),"endTag"==e?(o.context&&(o.context=o.context.prev),m()):(s="error",m(arguments.callee))}))}function f(e){return"word"==e?(s="attribute",m(f)):"equals"==e?m(g,f):"string"==e?(s="error",m(f)):i()}function g(e){return"word"==e&&d.allowUnquoted?(s="string",m()):"string"==e?m(x):i()}function x(e){return"string"==e?m(x):i()}return{startState:function(){return{tokenize:u,cc:[],indented:0,startOfLine:!0,tagName:null,context:null}},token:function(e,t){if(e.sol()&&(t.startOfLine=!0,t.indented=e.indentation()),e.eatSpace())return null;s=r=a=null;var i=t.tokenize(e,t);if(t.type=r,(i||r)&&"comment"!=i)for(o=t;;)if((t.cc.pop()||n)(r||i))break;return t.startOfLine=!1,s||i},indent:function(e,t,i){var n=e.context;if(e.tokenize!=h&&e.tokenize!=u||n&&n.noIndent)return i?i.match(/^(\s*)/)[0].length:0;if(c&&/<!\[CDATA\[/.test(t))return 0;for(n&&/^<\//.test(t)&&(n=n.prev);n&&!n.startOfLine;)n=n.prev;return n?n.indent+l:0},compareStates:function(e,t){if(e.indented!=t.indented||e.tokenize!=t.tokenize)return!1;for(var i=e.context,n=t.context;;i=i.prev,n=n.prev){if(!i||!n)return i==n;if(i.tagName!=n.tagName)return!1}},electricChars:"/"}}),CodeMirror.defineMIME("application/xml","xml"),CodeMirror.defineMIME("text/html",{name:"xml",htmlMode:!0}),CodeMirror.defineMode("javascript",function(e,t){var i,n,a=e.indentUnit,r=t.json,o=(i=s("keyword a"),n=s("keyword b"),e=s("keyword c"),t=s("operator"),{if:i,while:i,with:i,else:n,do:n,try:n,finally:n,return:e,break:e,continue:e,new:e,delete:e,throw:e,var:s("var"),const:s("var"),let:s("var"),function:s("function"),catch:s("catch"),for:s("for"),switch:s("switch"),case:s("case"),default:s("default"),in:t,typeof:t,instanceof:t,true:t={type:"atom",style:"atom"},false:t,null:t,undefined:t,NaN:t,Infinity:t});function s(e){return{type:e,style:"keyword"}}var l,d,c=/[+\-*&%=<>!?|]/;function u(e,t,i){return(t.tokenize=i)(e,t)}function h(e,t){for(var i,n=!1;null!=(i=e.next());){if(i==t&&!n)return;n=!n&&"\\"==i}return n}function p(e,t,i){return l=e,d=i,t}function m(e,t){var i=e.next();if('"'==i||"'"==i)return u(e,t,(n=i,function(e,t){return h(e,n)||(t.tokenize=m),p("string","string")}));if(/[\[\]{}\(\),;\:\.]/.test(i))return p(i);if("0"==i&&e.eat(/x/i))return e.eatWhile(/[\da-f]/i),p("number","number");if(/\d/.test(i))return e.match(/^\d*(?:\.\d*)?(?:[eE][+\-]?\d+)?/),p("number","number");if("/"==i)return e.eat("*")?u(e,t,f):e.eat("/")?(e.skipToEnd(),p("comment","comment")):t.reAllowed?(h(e,"/"),e.eatWhile(/[gimy]/),p("regexp","string-2")):(e.eatWhile(c),p("operator",null,e.current()));if("#"==i)return e.skipToEnd(),p("error","error");if(c.test(i))return e.eatWhile(c),p("operator",null,e.current());e.eatWhile(/[\w\$_]/);var n,i=e.current(),e=o.propertyIsEnumerable(i)&&o[i];return e&&t.kwAllowed?p(e.type,e.style,i):p("variable","variable",i)}function f(e,t){for(var i,n=!1;i=e.next();){if("/"==i&&n){t.tokenize=m;break}n="*"==i}return p("comment","comment")}var g={atom:!0,number:!0,variable:!0,string:!0,regexp:!0};function x(e,t,i,n,o,a){this.indented=e,this.column=t,this.type=i,this.prev=o,this.info=a,null!=n&&(this.align=n)}function E(e,t,i,n,o){var a=e.cc;for(y.state=e,y.stream=o,y.marked=null,y.cc=a,e.lexical.hasOwnProperty("align")||(e.lexical.align=!0);;)if((a.length?a.pop():r?N:S)(i,n)){for(;a.length&&a[a.length-1].lex;)a.pop()();return y.marked?y.marked:"variable"==i&&function(e,t){for(var i=e.localVars;i;i=i.next)if(i.name==t)return 1}(e,n)?"variable-2":t}}var y={state:null,column:null,marked:null,cc:null};function b(){for(var e=arguments.length-1;0<=e;e--)y.cc.push(arguments[e])}function C(){return b.apply(null,arguments),!0}function w(e){var t=y.state;if(t.context){y.marked="def";for(var i=t.localVars;i;i=i.next)if(i.name==e)return;t.localVars={name:e,next:t.localVars}}}var v={name:"this",next:{name:"arguments"}};function k(){y.state.context||(y.state.localVars=v),y.state.context={prev:y.state.context,vars:y.state.localVars}}function P(){y.state.localVars=y.state.context.vars,y.state.context=y.state.context.prev}function T(t,i){function e(){var e=y.state;e.lexical=new x(e.indented,y.stream.column(),t,null,e.lexical,i)}return e.lex=!0,e}function _(){var e=y.state;e.lexical.prev&&(")"==e.lexical.type&&(e.indented=e.lexical.indented),e.lexical=e.lexical.prev)}function D(t){return function(e){return e==t?C():";"==t?b():C(arguments.callee)}}function S(e){return"var"==e?C(T("vardef"),G,D(";"),_):"keyword a"==e?C(T("form"),N,S,_):"keyword b"==e?C(T("form"),S,_):"{"==e?C(T("}"),A,_):";"==e?C():"function"==e?C(z):"for"==e?C(T("form"),D("("),T(")"),W,D(")"),_,S,_):"variable"==e?C(T("stat"),M):"switch"==e?C(T("form"),N,T("}","switch"),D("{"),A,_,_):"case"==e?C(N,D(":")):"default"==e?C(D(":")):"catch"==e?C(T("form"),k,D("("),X,D(")"),S,_,P):b(T("stat"),N,D(";"),_)}function N(e){return g.hasOwnProperty(e)?C(I):"function"==e?C(z):"keyword c"==e?C(F):"("==e?C(T(")"),F,D(")"),_,I):"operator"==e?C(N):"["==e?C(T("]"),R(N,"]"),_,I):"{"==e?C(T("}"),R(L,"}"),_,I):C()}function F(e){return e.match(/[;\}\)\],]/)?b():b(N)}function I(e,t){return"operator"==e&&/\+\+|--/.test(t)?C(I):"operator"==e?C(N):";"!=e?"("==e?C(T(")"),R(N,")"),_,I):"."==e?C(O,I):"["==e?C(T("]"),N,D("]"),_,I):void 0:void 0}function M(e){return":"==e?C(_,S):b(I,D(";"),_)}function O(e){if("variable"==e)return y.marked="property",C()}function L(e){if("variable"==e&&(y.marked="property"),g.hasOwnProperty(e))return C(D(":"),N)}function R(t,i){function n(e){return","==e?C(t,n):e==i?C():C(D(i))}return function(e){return e==i?C():b(t,n)}}function A(e){return"}"==e?C():b(S,A)}function G(e,t){return"variable"==e?(w(t),C(B)):C()}function B(e,t){return"="==t?C(N,B):","==e?C(G):void 0}function W(e){return"var"==e?C(G,U):";"!=e&&"variable"==e?C(H):b(U)}function H(e,t){return"in"==t?C(N):C(I,U)}function U(e,t){return";"==e?C(V):"in"==t?C(N):C(N,D(";"),V)}function V(e){")"!=e&&C(N)}function z(e,t){return"variable"==e?(w(t),C(z)):"("==e?C(T(")"),k,R(X,")"),_,S,P):void 0}function X(e,t){if("variable"==e)return w(t),C()}return _.lex=!0,{startState:function(e){return{tokenize:m,reAllowed:!0,kwAllowed:!0,cc:[],lexical:new x((e||0)-a,0,"block",!1),localVars:null,context:null,indented:0}},token:function(e,t){if(e.sol()&&(t.lexical.hasOwnProperty("align")||(t.lexical.align=!1),t.indented=e.indentation()),e.eatSpace())return null;var i=t.tokenize(e,t);return"comment"==l?i:(t.reAllowed="operator"==l||"keyword c"==l||l.match(/^[\[{}\(,;:]$/),t.kwAllowed="."!=l,E(t,i,l,d,e))},indent:function(e,t){if(e.tokenize!=m)return 0;var i=t&&t.charAt(0),n=e.lexical,o=n.type,e=i==o;return"vardef"==o?n.indented+4:"form"==o&&"{"==i?n.indented:"stat"==o||"form"==o?n.indented+a:"switch"!=n.info||e?n.align?n.column+(e?0:1):n.indented+(e?0:a):n.indented+(/^(?:case|default)\b/.test(t)?a:2*a)},electricChars:":{}"}}),CodeMirror.defineMIME("text/javascript","javascript"),CodeMirror.defineMIME("application/json",{name:"javascript",json:!0}),CodeMirror.defineMode("clike",function(e,t){var o,n=e.indentUnit,r=t.keywords||{},s=t.blockKeywords||{},l=t.atoms||{},d=t.hooks||{},c=t.multiLineStrings,u=/[+\-*&%=<>!?|\/]/;function h(e,t){var a,i=e.next();if(d[i]){var n=d[i](e,t);if(!1!==n)return n}if('"'==i||"'"==i)return t.tokenize=(a=i,function(e,t){for(var i,n=!1,o=!1;null!=(i=e.next());){if(i==a&&!n){o=!0;break}n=!n&&"\\"==i}return!o&&(n||c)||(t.tokenize=h),"string"}),t.tokenize(e,t);if(/[\[\]{}\(\),;\:\.]/.test(i))return o=i,null;if(/\d/.test(i))return e.eatWhile(/[\w\.]/),"number";if("/"==i){if(e.eat("*"))return(t.tokenize=p)(e,t);if(e.eat("/"))return e.skipToEnd(),"comment"}if(u.test(i))return e.eatWhile(u),"operator";e.eatWhile(/[\w\$_]/);e=e.current();return r.propertyIsEnumerable(e)?(s.propertyIsEnumerable(e)&&(o="newstatement"),"keyword"):l.propertyIsEnumerable(e)?"atom":"word"}function p(e,t){for(var i,n=!1;i=e.next();){if("/"==i&&n){t.tokenize=h;break}n="*"==i}return"comment"}function a(e,t,i,n,o){this.indented=e,this.column=t,this.type=i,this.align=n,this.prev=o}function m(e,t,i){return e.context=new a(e.indented,t,i,null,e.context)}function f(e){var t=e.context.type;return")"!=t&&"]"!=t&&"}"!=t||(e.indented=e.context.indented),e.context=e.context.prev}return{startState:function(e){return{tokenize:null,context:new a((e||0)-n,0,"top",!1),indented:0,startOfLine:!0}},token:function(e,t){var i=t.context;if(e.sol()&&(null==i.align&&(i.align=!1),t.indented=e.indentation(),t.startOfLine=!0),e.eatSpace())return null;o=null;var n=(t.tokenize||h)(e,t);if("comment"==n||"meta"==n)return n;if(null==i.align&&(i.align=!0),";"!=o&&":"!=o||"statement"!=i.type)if("{"==o)m(t,e.column(),"}");else if("["==o)m(t,e.column(),"]");else if("("==o)m(t,e.column(),")");else if("}"==o){for(;"statement"==i.type;)i=f(t);for("}"==i.type&&(i=f(t));"statement"==i.type;)i=f(t)}else o==i.type?f(t):("}"==i.type||"top"==i.type||"statement"==i.type&&"newstatement"==o)&&m(t,e.column(),"statement");else f(t);return t.startOfLine=!1,n},indent:function(e,t){if(e.tokenize!=h&&null!=e.tokenize)return 0;var i=e.context,e=t&&t.charAt(0);"statement"==i.type&&"}"==e&&(i=i.prev);t=e==i.type;return"statement"==i.type?i.indented+("{"==e?0:n):i.align?i.column+(t?0:1):i.indented+(t?0:n)},electricChars:"{}"}}),function(){function e(e){for(var t={},i=e.split(" "),n=0;n<i.length;++n)t[i[n]]=!0;return t}var t="auto if break int case long char register continue return default short do sizeof double static else struct entry switch extern typedef float union for unsigned goto while enum void const signed volatile";function i(e,t){return!!t.startOfLine&&(e.skipToEnd(),"meta")}function n(e,t){for(var i;null!=(i=e.next());)if('"'==i&&!e.eat('"')){t.tokenize=null;break}return"string"}CodeMirror.defineMIME("text/x-csrc",{name:"clike",keywords:e(t),blockKeywords:e("case do else for if switch while struct"),atoms:e("null"),hooks:{"#":i}}),CodeMirror.defineMIME("text/x-c++src",{name:"clike",keywords:e(t+" asm dynamic_cast namespace reinterpret_cast try bool explicit new static_cast typeid catch operator template typename class friend private this using const_cast inline public throw virtual delete mutable protected wchar_t"),blockKeywords:e("catch class do else finally for if struct switch try while"),atoms:e("true false null"),hooks:{"#":i}}),CodeMirror.defineMIME("text/x-java",{name:"clike",keywords:e("abstract assert boolean break byte case catch char class const continue default do double else enum extends final finally float for goto if implements import instanceof int interface long native new package private protected public return short static strictfp super switch synchronized this throw throws transient try void volatile while"),blockKeywords:e("catch class do else finally for if switch try while"),atoms:e("true false null"),hooks:{"@":function(e,t){return e.eatWhile(/[\w\$_]/),"meta"}}}),CodeMirror.defineMIME("text/x-csharp",{name:"clike",keywords:e("abstract as base bool break byte case catch char checked class const continue decimal default delegate do double else enum event explicit extern finally fixed float for foreach goto if implicit in int interface internal is lock long namespace new object operator out override params private protected public readonly ref return sbyte sealed short sizeof stackalloc static string struct switch this throw try typeof uint ulong unchecked unsafe ushort using virtual void volatile while add alias ascending descending dynamic from get global group into join let orderby partial remove select set value var yield"),blockKeywords:e("catch class do else finally for foreach if struct switch try while"),atoms:e("true false null"),hooks:{"@":function(e,t){return e.eat('"')?(t.tokenize=n)(e,t):(e.eatWhile(/[\w\$_]/),"meta")}}})}(),CodeMirror.defineMode("xmlpure",function(e,t){var o="error",i="comment",n="comment",a="tag",r="attribute",s="string",l="atom",d="string",c="!instruction",u="!cdata",h="!comment",p="!text",m={"!cdata":!0,"!comment":!0,"!text":!0,"!instruction":!0},f=e.indentUnit;function g(e,t,i){return(t.tokenize=i)(e,t)}function x(i,n,o){return function(e,t){for(;!e.eol();){if(e.match(n)){y(t),t.tokenize=o;break}e.next()}return i}}function E(e,t){var i=m.hasOwnProperty(t)||e.context&&e.context.doIndent,i={tagName:t,prev:e.context,indent:e.context?e.context.indent+f:0,lineNumber:e.lineNumber,indented:e.indented,noIndent:i};e.context=i}function y(e){if(e.context){var t=e.context;return e.context=t.prev,t}return null}function b(e){return e.sol()||" "==e.string.charAt(e.start-1)||"\t"==e.string.charAt(e.start-1)}function C(e,t){return e.eat("<")?e.eat("?")?(E(t,c),t.tokenize=D,i):e.match("!--")?(E(t,h),g(e,t,x(n,"--\x3e",C))):e.eatSpace()||e.eol()?(e.skipToEnd(),o):(t.tokenize=w,a):(e.skipToEnd(),o)}function w(e,t){var i=e.pos;if(e.match(/^[a-zA-Z_:][-a-zA-Z0-9_:.]*/))return E(t,e.string.substring(i,e.pos)),t.tokenize=v,a;if(e.match(/^\/[a-zA-Z_:][-a-zA-Z0-9_:.]*( )*>/)){var n=e.string.substring(i+1,e.pos-1).trim(),i=y(t);return t.tokenize=null==t.context?C:T,null==i||n!=i.tagName?o:a}return t.tokenize=null==t.context?C:T,e.eatWhile(/[^>]/),e.eat(">"),o}function v(e,t){return e.match(/^\/>/)?(y(t),t.tokenize=null==t.context?C:T,a):e.eat(/^>/)?(t.tokenize=T,a):b(e)&&e.match(/^[a-zA-Z_:][-a-zA-Z0-9_:.]*( )*=/)?(t.tokenize=k,r):(t.tokenize=(t.context,C),e.eatWhile(/[^>]/),e.eat(">"),o)}function k(e,t){var i=e.next();return'"'!=i&&"'"!=i?(e.skipToEnd(),t.tokenize=v,o):(t.tokParams.quote=i,t.tokenize=P,s)}function P(e,t){for(var i="";!e.eol();){if((i=e.next())==t.tokParams.quote)return t.tokenize=v,s;if("<"==i)return e.skipToEnd(),t.tokenize=v,o;if("&"==i){if(";"==(i=e.next()))return e.skipToEnd(),t.tokenize=v,o;for(;!e.eol()&&";"!=i;){if("<"==i)return e.skipToEnd(),t.tokenize=v,o;i=e.next()}if(e.eol()&&";"!=i)return e.skipToEnd(),t.tokenize=v,o}}return s}function T(e,t){return e.eat("<")?e.match("?")?(E(t,c),t.tokenize=D,i):e.match("!--")?(E(t,h),g(e,t,x(n,"--\x3e",null==t.context?C:T))):e.match("![CDATA[")?(E(t,u),g(e,t,x(l,"]]>",null==t.context?C:T))):e.eatSpace()||e.eol()?(e.skipToEnd(),o):(t.tokenize=w,a):e.eat("&")?(e.eatWhile(/[^;]/),e.eat(";"),d):(E(t,p),t.tokenize=_,null)}function _(e,t){return e.eatWhile(/[^<]/),e.eol()||(y(t),t.tokenize=T),l}function D(e,t){return e.match("xml",!0,!0)?1<t.lineNumber||5<e.pos?(t.tokenize=C,e.skipToEnd(),o):(t.tokenize=N,i):b(e)||e.match("?>")?(t.tokenize=C,e.skipToEnd(),o):(t.tokenize=S,i)}function S(e,t){return e.eatWhile(/[^?]/),e.eat("?")&&e.eat(">")&&(y(t),t.tokenize=null==t.context?C:T),i}function N(e,t){return t.tokenize=F,b(e)&&e.match(/^version( )*=( )*"([a-zA-Z0-9_.:]|\-)+"/)?i:(e.skipToEnd(),o)}function F(e,t){return t.tokenize=I,b(e)&&e.match(/^encoding( )*=( )*"[A-Za-z]([A-Za-z0-9._]|\-)*"/)?i:null}function I(e,t){return t.tokenize=M,b(e)&&e.match(/^standalone( )*=( )*"(yes|no)"/)?i:null}function M(e,t){return t.tokenize=C,e.match("?>")&&e.eol()?(y(t),i):(e.skipToEnd(),o)}return{electricChars:"/[",startState:function(){return{tokenize:C,tokParams:{},lineNumber:0,lineError:!1,context:null,indented:0}},token:function(e,t){if(e.sol()&&(t.lineNumber++,t.lineError=!1,t.indented=e.indentation()),e.eatSpace())return null;e=t.tokenize(e,t);return t.lineError=t.lineError||"error"==e,e},blankLine:function(e){e.lineNumber++,e.lineError=!1},indent:function(e,t){return e.context?1==e.context.noIndent?void 0:t.match(/^<\/.*/)?e.context.indent:t.match(/^<!\[CDATA\[/)?0:e.context.indent+f:0},compareStates:function(e,t){if(e.indented!=t.indented)return!1;for(var i=e.context,n=t.context;;i=i.prev,n=n.prev){if(!i||!n)return i==n;if(i.tagName!=n.tagName)return!1}}}}),CodeMirror.defineMIME("application/xml","purexml"),CodeMirror.defineMIME("text/xml","purexml"),CodeMirror.defineMode("css",function(e){var a,n=e.indentUnit;function r(e,t){return a=t,e}function s(e,t){var o,i=e.next();return"@"==i?(e.eatWhile(/[\w\\\-]/),r("meta",e.current())):"/"==i&&e.eat("*")?(t.tokenize=l)(e,t):"<"==i&&e.eat("!")?(t.tokenize=d)(e,t):"="!=i?"~"!=i&&"|"!=i||!e.eat("=")?'"'==i||"'"==i?(t.tokenize=(o=i,function(e,t){for(var i,n=!1;null!=(i=e.next())&&(i!=o||n);)n=!n&&"\\"==i;return n||(t.tokenize=s),a="string"}),t.tokenize(e,t)):"#"==i?(e.eatWhile(/[\w\\\-]/),a="hash","atom"):"!"==i?(e.match(/^\s*\w*/),a="important","keyword"):/\d/.test(i)?(e.eatWhile(/[\w.%]/),a="unit","number"):/[,.+>*\/]/.test(i)?(a="select-op",null):/[;{}:\[\]]/.test(i)?r(null,i):(e.eatWhile(/[\w\\\-]/),a="variable"):(a="compare",null):void(a="compare")}function l(e,t){for(var i,n=!1;null!=(i=e.next());){if(n&&"/"==i){t.tokenize=s;break}n="*"==i}return a="comment"}function d(e,t){for(var i,n=0;null!=(i=e.next());){if(2<=n&&">"==i){t.tokenize=s;break}n="-"==i?n+1:0}return a="comment"}return{startState:function(e){return{tokenize:s,baseIndent:e||0,stack:[]}},token:function(e,t){if(e.eatSpace())return null;var i=t.tokenize(e,t),e=t.stack[t.stack.length-1];return"hash"==a&&"rule"==e?i="atom":"variable"==i&&("rule"==e?i="number":e&&"@media{"!=e||(i="tag")),"rule"==e&&/^[\{\};]$/.test(a)&&t.stack.pop(),"{"==a?"@media"==e?t.stack[t.stack.length-1]="@media{":t.stack.push("{"):"}"==a?t.stack.pop():"@media"==a?t.stack.push("@media"):"{"==e&&"comment"!=a&&t.stack.push("rule"),i},indent:function(e,t){var i=e.stack.length;return/^\}/.test(t)&&(i-="rule"==e.stack[e.stack.length-1]?2:1),e.baseIndent+i*n},electricChars:"}"}}),CodeMirror.defineMIME("text/css","css"),function(){function e(e){for(var t={},i=e.split(" "),n=0;n<i.length;++n)t[i[n]]=!0;return t}var i={name:"clike",keywords:e("abstract and array as break case catch cfunction class clone const continue declare default do else elseif enddeclare endfor endforeach endif endswitch endwhile extends final for foreach function global goto if implements interface instanceof namespace new or private protected public static switch throw try use var while xor returndie echo empty exit eval include include_once isset list require require_once print unset"),blockKeywords:e("catch do else elseif for foreach if switch try while"),atoms:e("true false null TRUE FALSE NULL"),multiLineStrings:!0,hooks:{$:function(e,t){return e.eatWhile(/[\w\$_]/),"variable-2"},"<":function(e,t){return!!e.match(/<</)&&(e.eatWhile(/[\w\.]/),t.tokenize=(i=e.current().slice(3),function(e,t){return e.match(i)?t.tokenize=null:e.skipToEnd(),"string"}),t.tokenize(e,t));var i},"#":function(e,t){return e.skipToEnd(),"comment"}}};CodeMirror.defineMode("php",function(e,t){var a=CodeMirror.getMode(e,{name:"xml",htmlMode:!0}),o=CodeMirror.getMode(e,"javascript"),r=CodeMirror.getMode(e,"css"),s=CodeMirror.getMode(e,i);return{startState:function(){var e=a.startState();return{html:e,php:s.startState(),curMode:t.startOpen?s:a,curState:t.startOpen?s.startState():e,curClose:t.startOpen?/^\?>/:null,mode:t.startOpen?"php":"html"}},copyState:function(e){var t=e.html,i=CodeMirror.copyState(a,t),n=e.php,o=CodeMirror.copyState(s,n),n=e.curState==t?i:e.curState==n?o:CodeMirror.copyState(e.curMode,e.curState);return{html:i,php:o,curMode:e.curMode,curState:n,curClose:e.curClose,mode:e.mode}},token:function e(t,i){if(i.curMode!=a)return t.match(i.curClose,!1)?(i.curMode=a,i.curState=i.html,i.curClose=null,i.mode="html",e(t,i)):i.curMode.token(t,i.curState);var n=a.token(t,i.curState);return"meta"==n&&/^<\?/.test(t.current())?(i.curMode=s,i.curState=i.php,i.curClose=/^\?>/,i.mode="php"):"tag"==n&&">"==t.current()&&i.curState.context&&(/^script$/i.test(i.curState.context.tagName)?(i.curMode=o,i.curState=o.startState(a.indent(i.curState,"")),i.curClose=/^<\/\s*script\s*>/i,i.mode="javascript"):/^style$/i.test(i.curState.context.tagName)&&(i.curMode=r,i.curState=r.startState(a.indent(i.curState,"")),i.curClose=/^<\/\s*style\s*>/i,i.mode="css")),n},indent:function(e,t){return e.curMode!=s&&/^\s*<\//.test(t)||e.curMode==s&&/^\?>/.test(t)?a.indent(e.html,t):e.curMode.indent(e.curState,t)},electricChars:"/{}:"}}),CodeMirror.defineMIME("application/x-httpd-php","php"),CodeMirror.defineMIME("application/x-httpd-php-open",{name:"php",startOpen:!0}),CodeMirror.defineMIME("text/x-php",i)}(),CodeMirror.defineMode("htmlmixed",function(e,t){var n=CodeMirror.getMode(e,{name:"xml",htmlMode:!0}),o=CodeMirror.getMode(e,"javascript"),a=CodeMirror.getMode(e,"css");function i(e,t){var i=n.token(e,t.htmlState);return"tag"==i&&">"==e.current()&&t.htmlState.context&&(/^script$/i.test(t.htmlState.context.tagName)?(t.token=s,t.localState=o.startState(n.indent(t.htmlState,"")),t.mode="javascript"):/^style$/i.test(t.htmlState.context.tagName)&&(t.token=l,t.localState=a.startState(n.indent(t.htmlState,"")),t.mode="css")),i}function r(e,t,i){var n=e.current(),t=n.search(t);return-1<t&&e.backUp(n.length-t),i}function s(e,t){return e.match(/^<\/\s*script\s*>/i,!1)?(t.token=i,t.curState=null,t.mode="html",i(e,t)):r(e,/<\/\s*script\s*>/,o.token(e,t.localState))}function l(e,t){return e.match(/^<\/\s*style\s*>/i,!1)?(t.token=i,t.localState=null,t.mode="html",i(e,t)):r(e,/<\/\s*style\s*>/,a.token(e,t.localState))}return{startState:function(){return{token:i,localState:null,mode:"html",htmlState:n.startState()}},copyState:function(e){var t;return e.localState&&(t=CodeMirror.copyState(e.token==l?a:o,e.localState)),{token:e.token,localState:t,mode:e.mode,htmlState:CodeMirror.copyState(n,e.htmlState)}},token:function(e,t){return t.token(e,t)},indent:function(e,t){return e.token==i||/^\s*<\//.test(t)?n.indent(e.htmlState,t):(e.token==s?o:a).indent(e.localState,t)},compareStates:function(e,t){return n.compareStates(e.htmlState,t.htmlState)},electricChars:"/{}:"}}),CodeMirror.defineMIME("text/html","htmlmixed"),CodeMirror.defineMode("rst",function(t,e){function c(e,t,i){e.fn=t,n(e,i)}function n(e,t){e.ctx=t||{}}function u(e,t){var i;t&&"string"!=typeof t&&(t=(i=t.current())[i.length-1]),c(e,d,{back:t})}function i(e){return function(e){if(e){var t,i=CodeMirror.listModes();for(t in i)if(i[t]==e)return 1}}(e)?CodeMirror.getMode(t,e):null}var h=i(e.verbatim),p=i("python"),m=/^[!"#$%&'()*+,-./:;<=>?@[\\\]^_`{|}~]/,o=/^\s*\w([-:.\w]*\w)?::(\s|$)/,a=/^\s*_[\w-]+:(\s|$)/,r=/^\s*\[(\d+|#)\](\s|$)/,s=/^\s*\[[A-Za-z][\w-]*\](\s|$)/,f=/^\[(\d+|#)\]_/,g=/^\[[A-Za-z][\w-]*\]_/,x=/^\.\.(\s|$)/,E=/^::\s*$/,y=/^[-\s"([{</:]/,l=/^[-\s`'")\]}>/:.,;!?\\_]/,b=/^\s+(>>>|In \[\d+\]:)\s/;function d(t,i){var n,e;if(t.eat(/\\/))return d=t.next(),u(i,d),null;if((n=t.sol())&&(d=t.eat(m))){for(e=0;t.eat(d);e++);if(3<=e&&t.match(/^\s*$/))return u(i,null),"header";t.backUp(e+1)}if(n&&t.match(x))return t.eol()||c(i,w),"meta";if(t.match(E))return h?c(i,P,{mode:l=h,local:l.startState()}):c(i,P),"meta";if(n&&t.match(b,!1))return p?(c(i,P,{mode:l=p,local:l.startState()}),null):(c(i,P),"meta");function o(e){return n||!i.ctx.back||e.test(i.ctx.back)}function a(e){return t.match(e)&&o(/\W/)&&(t.eol()||t.match(/\W/,!1))}if(a(f))return u(i,t),"footnote";if(a(g))return u(i,t),"citation";if(d=t.next(),o(y)){if((":"===d||"|"===d)&&t.eat(/\S/))return c(i,C,{ch:d,wide:!1,prev:null,token:r=":"===d?"builtin":"atom"}),r;if("*"===d||"`"===d){var r,s=d,l=!1,d=t.next();if(d==s&&(l=!0,d=t.next()),d&&!/\s/.test(d))return c(i,C,{ch:s,wide:l,prev:null,token:r="*"===s?l?"strong":"em":l?"string":"string-2"}),r}}return u(i,d),null}function C(e,t){var i=e.next(),n=t.ctx.token;function o(e){return t.ctx.prev=e,n}return i!=t.ctx.ch||/\s/.test(t.ctx.prev)||t.ctx.wide&&(i=e.next())!=t.ctx.ch?o(i):e.eol()||l.test(e.peek())?(c(t,d),u(t,i),n):(t.ctx.wide&&e.backUp(1),o(i))}function w(e,t){var i=null;if(e.match(o))i="attribute";else if(e.match(a))i="link";else if(e.match(r))i="quote";else{if(!e.match(s))return e.eatSpace(),e.eol()?(u(t,e),null):(e.skipToEnd(),c(t,k),"comment");i="quote"}return c(t,v,{start:!0}),i}function v(e,t){return!t.ctx.start||e.sol()?T(e,t,"body"):(e.skipToEnd(),n(t),"body")}function k(e,t){return T(e,t,"comment")}function P(e,t){return h?e.sol()?(e.eatSpace()||u(t,e),null):h.token(e,t.ctx.local):T(e,t,"meta")}function T(e,t,i){return e.eol()||e.eatSpace()?(e.skipToEnd(),i):(u(t,e),null)}return{startState:function(){return{fn:d,ctx:{}}},copyState:function(e){return{fn:e.fn,ctx:e.ctx}},token:function(e,t){return t.fn(e,t)}}}),CodeMirror.defineMIME("text/x-rst","rst"),function(){function t(){this.posFrom=this.posTo=this.query=null,this.marked=[]}function a(e){return e._searchState||(e._searchState=new t)}function r(e,t,i,n){e.openDialog?e.openDialog(t,n):n(prompt(i,""))}function s(e){var t=e.match(/^\/(.*)\/$/);return t?new RegExp(t[1]):e}var e=_("Search")+': <input type="text" style="width: 10em"> <span style="color: #888">('+_("Use /re/ syntax for regexp search")+")</span>";function i(i,n){var o=a(i);if(o.query)return l(i,n);r(i,e,"Search for:",function(t){i.operation(function(){if(t&&!o.query){if(o.query=s(t),i.lineCount()<2e3)for(var e=i.getSearchCursor(t);e.findNext();)o.marked.push(i.markText(e.from(),e.to(),"CodeMirror-searching"));o.posFrom=o.posTo=i.getCursor(),l(i,n)}})})}function l(i,n){i.operation(function(){var e=a(i),t=i.getSearchCursor(e.query,n?e.posFrom:e.posTo);(t.find(n)||(t=i.getSearchCursor(e.query,n?{line:i.lineCount()-1}:{line:0,ch:0})).find(n))&&(i.setSelection(t.from(),t.to()),e.posFrom=t.from(),e.posTo=t.to())})}function n(i){i.operation(function(){var e=a(i);if(e.query){e.query=null;for(var t=0;t<e.marked.length;++t)e.marked[t].clear();e.marked.length=0}})}function o(d,e){r(d,'Replace: <input type="text" style="width: 10em"> <span style="color: #888">(Use /re/ syntax for regexp search)</span>',"Replace:",function(l){l&&(l=s(l),r(d,'With: <input type="text" style="width: 10em">',"Replace with:",function(a){function r(){var e,t,i,n,o=s.from();!(e=s.findNext())&&(s=d.getSearchCursor(l),!(e=s.findNext())||s.from().line==o.line&&s.from().ch==o.ch)||(d.setSelection(s.from(),s.to()),t="Replace? <button>Yes</button> <button>No</button> <button>Stop</button>",i="Replace?",n=[function(){var i;i=e,s.replace("string"==typeof l?a:a.replace(/\$(\d)/,function(e,t){return i[t]})),r()},r],(o=d).openConfirm?o.openConfirm(t,n):confirm(i)&&n[0]())}var s;e?d.operation(function(){for(var i,e=d.getSearchCursor(l);e.findNext();)"string"!=typeof l?(i=d.getRange(e.from(),e.to()).match(l),e.replace(a.replace(/\$(\d)/,function(e,t){return i[t]}))):e.replace(a)}):(n(d),s=d.getSearchCursor(l,d.getCursor()),r())}))})}CodeMirror.commands.find=function(e){n(e),i(e)},CodeMirror.commands.findNext=i,CodeMirror.commands.findPrev=function(e){i(e,!0)},CodeMirror.commands.clearSearch=n,CodeMirror.commands.replace=o,CodeMirror.commands.replaceAll=function(e){o(e,!0)}}(),function(){function n(d,r,e,t){var c,u;this.atOccurrence=!1,this.cm=d,null==t&&(t="string"==typeof r&&r==r.toLowerCase()),e=e?d.clipPos(e):{line:0,ch:0},this.pos={from:e,to:e},"string"!=typeof r?this.matches=function(e,t){if(e)for(var i=(a=d.getLine(t.line).slice(0,t.ch)).match(r),n=0;i;){var o=a.indexOf(i[0]);n+=o;o=(a=a.slice(o+1)).match(r);if(!o)break;i=o,n++}else var a,n=(i=(a=d.getLine(t.line).slice(t.ch)).match(r))&&t.ch+a.indexOf(i[0]);if(i)return{from:{line:t.line,ch:n},to:{line:t.line,ch:n+i[0].length},match:i}}:(t&&(r=r.toLowerCase()),c=t?function(e){return e.toLowerCase()}:function(e){return e},1==(u=r.split("\n")).length?this.matches=function(e,t){var i,n=c(d.getLine(t.line)),o=r.length;if(e?t.ch>=o&&-1!=(i=n.lastIndexOf(r,t.ch-o)):-1!=(i=n.indexOf(r,t.ch)))return{from:{line:t.line,ch:i},to:{line:t.line,ch:i+o}}}:this.matches=function(e,t){var i=t.line,n=e?u.length-1:0,o=u[n],a=c(d.getLine(i)),r=e?a.indexOf(o)+o.length:a.lastIndexOf(o);if(!(e?r>=t.ch||r!=o.length:r<=t.ch||r!=a.length-o.length))for(;;){if(e?!i:i==d.lineCount()-1)return;if(a=c(d.getLine(i+=e?-1:1)),o=u[e?--n:++n],!(0<n&&n<u.length-1)){var s=e?a.lastIndexOf(o):a.indexOf(o)+o.length;if(e?s!=a.length-o.length:s!=o.length)return;var l={line:t.line,ch:r},s={line:i,ch:s};return{from:e?s:l,to:e?l:s}}if(a!=o)return}})}n.prototype={findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(e){var t=this,i=this.cm.clipPos(e?this.pos.from:this.pos.to);function n(e){e={line:e,ch:0};return t.pos={from:e,to:e},t.atOccurrence=!1}for(;;){if(this.pos=this.matches(e,i))return this.atOccurrence=!0,this.pos.match||!0;if(e){if(!i.line)return n(0);i={line:i.line-1,ch:this.cm.getLine(i.line-1).length}}else{var o=this.cm.lineCount();if(i.line==o-1)return n(o);i={line:i.line+1,ch:0}}}},from:function(){if(this.atOccurrence)return this.pos.from},to:function(){if(this.atOccurrence)return this.pos.to},replace:function(e){this.atOccurrence&&(this.pos.to=this.cm.replaceRange(e,this.pos.from,this.pos.to))}},CodeMirror.defineExtension("getSearchCursor",function(e,t,i){return new n(this,e,t,i)})}(),function(){function c(e,t){e=e.getWrapperElement(),e=e.insertBefore(document.createElement("div"),e.firstChild);return e.className="CodeMirror-dialog",e.innerHTML="<div>"+t+"</div>",e}CodeMirror.defineExtension("openDialog",function(e,t){var i=c(this,e),n=!1,o=this;function a(){n||(n=!0,i.parentNode.removeChild(i))}var r=i.getElementsByTagName("input")[0];return r&&(CodeMirror.connect(r,"keydown",function(e){13!=e.keyCode&&27!=e.keyCode||(CodeMirror.e_stop(e),a(),o.focus(),13==e.keyCode&&t(r.value))}),r.focus(),CodeMirror.connect(r,"blur",a)),a}),CodeMirror.defineExtension("openConfirm",function(e,t){var i=c(this,e),n=i.getElementsByTagName("button"),o=!1,a=this,r=1;function s(){o||(o=!0,i.parentNode.removeChild(i),a.focus())}n[0].focus();for(var l=0;l<n.length;++l){var d=n[l];!function(t){CodeMirror.connect(d,"click",function(e){CodeMirror.e_preventDefault(e),s(),t&&t(a)})}(t[l]),CodeMirror.connect(d,"blur",function(){--r,setTimeout(function(){r<=0&&s()},200)}),CodeMirror.connect(d,"focus",function(){++r})}})}(),Ext.BLANK_IMAGE_URL="js/ExtJs/resources/images/default/s.gif",String.prototype.ucFirst=function(){return this.substr(0,1).toUpperCase()+this.substr(1,this.length)},Ext.override(Ext.grid.CheckboxSelectionModel,{handleMouseDown:function(e,t,i){var n,o;0!==i.button||this.isLocked()||(n=this.grid.getView(),i.shiftKey&&!1!==this.last?(o=this.last,this.selectRange(o,t,i.ctrlKey),this.last=o,n.focusRow(t)):(o=this.isSelected(t))?this.deselectRow(t):o||(this.selectRow(t,!this.singleSelect),n.focusRow(t)))}}),Ext.override(Ext.form.Field,{afterRender:function(){var e;!this.tooltipText||(e=function(e){var t=null,i=null;if((t=e.getEl().up("div.x-form-item"))&&(i=t.child("label")),i)return i}(this))&&(e.addClass(this.tooltipClass||"x-textfield-tooltip"),new Ext.ToolTip({target:e,html:this.tooltipText,trackMouse:!0})),Ext.form.Field.superclass.afterRender.call(this),this.initEvents(),this.initValue()}}),Ext.ux.Portal=Ext.extend(Ext.Panel,{layout:"column",autoScroll:!0,cls:"x-portal",defaultType:"portalcolumn",initComponent:function(){Ext.ux.Portal.superclass.initComponent.call(this),this.addEvents({validatedrop:!0,beforedragover:!0,dragover:!0,beforedrop:!0,drop:!0})},initEvents:function(){Ext.ux.Portal.superclass.initEvents.call(this),this.dd=new Ext.ux.Portal.DropZone(this,this.dropConfig)},beforeDestroy:function(){this.dd&&this.dd.unreg(),Ext.ux.Portal.superclass.beforeDestroy.call(this)}}),Ext.reg("portal",Ext.ux.Portal),Ext.ux.Portal.DropZone=function(e,t){this.portal=e,Ext.dd.ScrollManager.register(e.body),Ext.ux.Portal.DropZone.superclass.constructor.call(this,e.bwrap.dom,t),e.body.ddScrollConfig=this.ddScrollConfig},Ext.extend(Ext.ux.Portal.DropZone,Ext.dd.DropTarget,{ddScrollConfig:{vthresh:50,hthresh:-1,animate:!0,increment:200},createEvent:function(e,t,i,n,o,a){return{portal:this.portal,panel:i.panel,columnIndex:n,column:o,position:a,data:i,source:e,rawEvent:t,status:this.dropAllowed}},notifyOver:function(e,t,i){var n=t.getXY(),o=this.portal,a=e.proxy;this.grid||(this.grid=this.getGrid());var r=o.body.dom.clientWidth;this.lastCW?this.lastCW!=r&&(this.lastCW=r,o.doLayout(),this.grid=this.getGrid()):this.lastCW=r;for(var s=0,l=this.grid.columnX,d=!1,c=l.length;s<c;s++)if(n[0]<l[s].x+l[s].w){d=!0;break}d||s--;for(var u,h=!1,p=0,r=o.items.itemAt(s),m=r.items.items,f=!1,c=m.length;p<c;p++){var g=(u=m[p]).el.getHeight();if(0===g)f=!0;else if(u.el.getY()+g/2>n[1]){h=!0;break}}p=(h&&u?p:r.items.getCount())+(f?-1:0);i=this.createEvent(e,t,i,s,r,p);return!1!==o.fireEvent("validatedrop",i)&&!1!==o.fireEvent("beforedragover",i)&&(a.getProxy().setWidth("auto"),u?a.moveProxy(u.el.dom.parentNode,h?u.el.dom:null):a.moveProxy(r.el.dom,null),this.lastPos={c:r,col:s,p:!!(f||h&&u)&&p},this.scrollPos=o.body.getScroll(),o.fireEvent("dragover",i)),i.status},notifyOut:function(){delete this.grid},notifyDrop:function(e,t,i){var n,o,a,r,s;delete this.grid,this.lastPos&&(n=this.lastPos.c,a=this.lastPos.col,o=this.lastPos.p,a=this.createEvent(e,t,i,a,n,!1!==o?o:n.items.getCount()),!1!==this.portal.fireEvent("validatedrop",a)&&!1!==this.portal.fireEvent("beforedrop",a)&&(e.proxy.getProxy().remove(),e.panel.el.dom.parentNode.removeChild(e.panel.el.dom),!1!==o?(n==e.panel.ownerCt&&n.items.items.indexOf(e.panel)<=o&&o++,n.insert(o,e.panel)):n.add(e.panel),n.doLayout(),this.portal.fireEvent("drop",a),(r=this.scrollPos.top)&&(s=this.portal.body.dom,setTimeout(function(){s.scrollTop=r},10))),delete this.lastPos)},getGrid:function(){var t=this.portal.bwrap.getBox();return t.columnX=[],this.portal.items.each(function(e){t.columnX.push({x:e.el.getX(),w:e.el.getWidth()})}),t},unreg:function(){Ext.ux.Portal.DropZone.superclass.unreg.call(this)}}),Ext.ux.PortalColumn=Ext.extend(Ext.Container,{layout:"anchor",defaultType:"portlet",cls:"x-portal-column"}),Ext.reg("portalcolumn",Ext.ux.PortalColumn),Ext.ux.Portlet=Ext.extend(Ext.Panel,{anchor:"100%",frame:!0,collapsible:!0,draggable:!0,cls:"x-portlet"}),Ext.reg("portlet",Ext.ux.Portlet),Ext.ns("Ext.ux.grid"),Ext.ux.grid.RowEditor=Ext.extend(Ext.Panel,{floating:!0,shadow:!1,layout:"hbox",cls:"x-small-editor",buttonAlign:"center",baseCls:"x-row-editor",elements:"header,footer,body",frameWidth:5,buttonPad:3,clicksToEdit:"auto",monitorValid:!0,focusDelay:250,errorSummary:!0,saveText:"Save",cancelText:"Cancel",commitChangesText:"You need to commit or cancel your changes",errorText:"Errors",defaults:{normalWidth:!0},initComponent:function(){Ext.ux.grid.RowEditor.superclass.initComponent.call(this),this.addEvents("beforeedit","canceledit","validateedit","afteredit")},init:function(e){this.grid=e,this.ownerCt=e,2===this.clicksToEdit?e.on("rowdblclick",this.onRowDblClick,this):(e.on("rowclick",this.onRowClick,this),Ext.isIE&&e.on("rowdblclick",this.onRowDblClick,this)),e.getStore().on("remove",function(){this.stopEditing(!1)},this),e.on({scope:this,keydown:this.onGridKey,columnresize:this.verifyLayout,columnmove:this.refreshFields,reconfigure:this.refreshFields,beforedestroy:this.beforedestroy,destroy:this.destroy,bodyscroll:{buffer:250,fn:this.positionButtons}}),e.getColumnModel().on("hiddenchange",this.verifyLayout,this,{delay:1}),e.getView().on("refresh",this.stopEditing.createDelegate(this,[]))},beforedestroy:function(){this.stopMonitoring(),this.grid.getStore().un("remove",this.onStoreRemove,this),this.stopEditing(!1),Ext.destroy(this.btns,this.tooltip)},refreshFields:function(){this.initFields(),this.verifyLayout()},isDirty:function(){var t;return this.items.each(function(e){if(String(this.values[e.id])!==String(e.getValue()))return!(t=!0)},this),t},startEditing:function(e,t){if(this.editing&&this.isDirty())this.showTooltip(this.commitChangesText);else if(Ext.isObject(e)&&(e=this.grid.getStore().indexOf(e)),!1!==this.fireEvent("beforeedit",this,e)){this.editing=!0;var i=this.grid,n=i.getView(),o=n.getRow(e),a=i.store.getAt(e);this.record=a,this.rowIndex=e,this.values={},this.rendered||this.render(n.getEditorParent());n=Ext.fly(o).getWidth();this.setSize(n),this.initialized||this.initFields();for(var r,s,l=i.getColumnModel(),d=this.items.items,c=0,u=l.getColumnCount();c<u;c++)s=this.preEditValue(a,l.getDataIndex(c)),(r=d[c]).setValue(s),this.values[r.id]=Ext.isEmpty(s)?"":s;this.verifyLayout(!0),this.isVisible()?this.el.setXY(Ext.fly(o).getXY(),{duration:.15}):this.setPagePosition(Ext.fly(o).getXY()),this.isVisible()||this.show().doLayout(),!1!==t&&this.doFocus.defer(this.focusDelay,this)}},stopEditing:function(e){if(this.editing=!1,this.isVisible()){if(!1===e||!this.isValid())return this.hide(),void this.fireEvent("canceledit",this,!1===e);for(var t,i,n,o={},a=this.record,r=!1,s=this.grid.colModel,l=this.items.items,d=0,c=s.getColumnCount();d<c;d++)s.isHidden(d)||(t=s.getDataIndex(d),Ext.isEmpty(t)||(i=a.data[t],n=this.postEditValue(l[d].getValue(),i,a,t),String(i)!==String(n)&&(o[t]=n,r=!0)));r&&!1!==this.fireEvent("validateedit",this,o,a,this.rowIndex)&&(a.beginEdit(),Ext.iterate(o,function(e,t){a.set(e,t)}),a.endEdit(),this.fireEvent("afteredit",this,o,a,this.rowIndex)),this.hide()}},verifyLayout:function(e){if(this.el&&(this.isVisible()||!0===e)){e=this.grid.getView().getRow(this.rowIndex);this.setSize(Ext.fly(e).getWidth(),Ext.isIE?Ext.fly(e).getHeight()+9:void 0);for(var t,i=this.grid.colModel,n=this.items.items,o=0,a=i.getColumnCount();o<a;o++)i.isHidden(o)?n[o].hide():(t=0,t+=o===a-1?3:1,n[o].show(),n[o].setWidth(i.getColumnWidth(o)-t));this.doLayout(),this.positionButtons()}},slideHide:function(){this.hide()},initFields:function(){var e=this.grid.getColumnModel(),t=Ext.layout.ContainerLayout.prototype.parseMargins;this.removeAll(!1);for(var i=0,n=e.getColumnCount();i<n;i++){var o=e.getColumnAt(i),a=(a=o.getEditor())||(o.displayEditor||new Ext.form.DisplayField);0==i?a.margins=t("0 1 2 1"):i==n-1?a.margins=t("0 0 2 1"):Ext.isIE?a.margins=t("0 0 2 0"):a.margins=t("0 1 2 0"),a.setWidth(e.getColumnWidth(i)),a.column=o,a.ownerCt!==this&&(a.on("focus",this.ensureVisible,this),a.on("specialkey",this.onKey,this)),this.insert(i,a)}this.initialized=!0},onKey:function(e,t){t.getKey()===t.ENTER&&(this.stopEditing(!0),t.stopPropagation())},onGridKey:function(e){var t;e.getKey()!==e.ENTER||this.isVisible()||(t=this.grid.getSelectionModel().getSelected())&&(t=this.grid.store.indexOf(t),this.startEditing(t),e.stopPropagation())},ensureVisible:function(e){this.isVisible()&&this.grid.getView().ensureVisible(this.rowIndex,this.grid.colModel.getIndexById(e.column.id),!0)},onRowClick:function(e,t,i){if("auto"==this.clicksToEdit&&(this.lastClickIndex!=(this.lastClickIndex=t)&&!this.isVisible()))return;this.startEditing(t,!1),this.doFocus.defer(this.focusDelay,this,[i.getPoint()])},onRowDblClick:function(e,t,i){this.startEditing(t,!1),this.doFocus.defer(this.focusDelay,this,[i.getPoint()])},onRender:function(){Ext.ux.grid.RowEditor.superclass.onRender.apply(this,arguments),this.el.swallowEvent(["keydown","keyup","keypress"]),this.btns=new Ext.Panel({baseCls:"x-plain",cls:"x-btns",elements:"body",layout:"table",width:2*this.minButtonWidth+2*this.frameWidth+4*this.buttonPad,items:[{ref:"saveBtn",itemId:"saveBtn",xtype:"button",text:this.saveText,width:this.minButtonWidth,handler:this.stopEditing.createDelegate(this,[!0])},{xtype:"button",text:this.cancelText,width:this.minButtonWidth,handler:this.stopEditing.createDelegate(this,[!1])}]}),this.btns.render(this.bwrap)},afterRender:function(){Ext.ux.grid.RowEditor.superclass.afterRender.apply(this,arguments),this.positionButtons(),this.monitorValid&&this.startMonitoring()},onShow:function(){this.monitorValid&&this.startMonitoring(),Ext.ux.grid.RowEditor.superclass.onShow.apply(this,arguments)},onHide:function(){Ext.ux.grid.RowEditor.superclass.onHide.apply(this,arguments),this.stopMonitoring(),this.grid.getView().focusRow(this.rowIndex)},positionButtons:function(){var e,t,i,n;this.btns&&(n=this.grid,e=this.el.dom.clientHeight,t=n.getView().scroller.dom.scrollLeft,i=this.btns.getWidth(),n=Math.min(n.getWidth(),n.getColumnModel().getTotalWidth()),this.btns.el.shift({left:n/2-i/2+t,top:e-2,stopFx:!0,duration:.2}))},preEditValue:function(e,t){t=e.data[t];return this.autoEncode&&"string"==typeof t?Ext.util.Format.htmlDecode(t):t},postEditValue:function(e,t,i,n){return this.autoEncode&&"string"==typeof e?Ext.util.Format.htmlEncode(e):e},doFocus:function(e){if(this.isVisible()){var t,i=0,n=this.grid.getColumnModel();e&&(i=this.getTargetColumnIndex(e));for(var o=i||0,a=n.getColumnCount();o<a;o++)if(!(t=n.getColumnAt(o)).hidden&&t.getEditor()){t.getEditor().focus();break}}},getTargetColumnIndex:function(e){var t,i=this.grid,n=i.view,o=e.left,a=i.colModel.config,r=0,s=!1;for(a.length;t=a[r];r++)if(!t.hidden&&Ext.fly(n.getHeaderCell(r)).getRegion().right>=o){s=r;break}return s},startMonitoring:function(){!this.bound&&this.monitorValid&&(this.bound=!0,Ext.TaskMgr.start({run:this.bindHandler,interval:this.monitorPoll||200,scope:this}))},stopMonitoring:function(){this.bound=!1,this.tooltip&&this.tooltip.hide()},isValid:function(){var t=!0;return this.items.each(function(e){if(!e.isValid(!0))return t=!1}),t},bindHandler:function(){if(!this.bound)return!1;var e=this.isValid();!e&&this.errorSummary&&this.showTooltip(this.getErrorText().join("")),this.btns.saveBtn.setDisabled(!e),this.fireEvent("validation",this,e)},lastVisibleColumn:function(){for(var e,t=this.items.getCount()-1;0<=t;t--)if(!(e=this.items.items[t]).hidden)return e},showTooltip:function(e){var t=(t=this.tooltip)||(this.tooltip=new Ext.ToolTip({maxWidth:600,cls:"errorTip",width:300,title:this.errorText,autoHide:!1,anchor:"left",anchorToTarget:!0,mouseOffset:[40,0]})),i=this.grid.getView(),n=parseInt(this.el.dom.style.top,10);i.scroller.dom.scrollTop<=n+this.el.getHeight()?(t.initTarget(this.lastVisibleColumn().getEl()),t.rendered||(t.show(),t.hide()),t.body.update(e),t.doAutoWidth(20),t.show()):t.rendered&&t.hide()},getErrorText:function(){var t=["<ul>"];return this.items.each(function(e){e.isValid(!0)||t.push("<li>",e.getActiveError(),"</li>")}),t.push("</ul>"),t}}),Ext.preg("roweditor",Ext.ux.grid.RowEditor),Ext.ux.Spinner=Ext.extend(Ext.util.Observable,{incrementValue:1,alternateIncrementValue:5,triggerClass:"x-form-spinner-trigger",splitterClass:"x-form-spinner-splitter",alternateKey:Ext.EventObject.shiftKey,defaultValue:0,accelerate:!1,constructor:function(e){Ext.ux.Spinner.superclass.constructor.call(this,e),Ext.apply(this,e),this.mimicing=!1},init:function(e){(this.field=e).afterMethod("onRender",this.doRender,this),e.afterMethod("onEnable",this.doEnable,this),e.afterMethod("onDisable",this.doDisable,this),e.afterMethod("afterRender",this.doAfterRender,this),e.afterMethod("onResize",this.doResize,this),e.afterMethod("onFocus",this.doFocus,this),e.beforeMethod("onDestroy",this.doDestroy,this)},doRender:function(e,t){var i=this.el=this.field.getEl(),n=this.field;n.wrap?this.wrap=n.wrap.addClass("x-form-field-wrap"):n.wrap=this.wrap=i.wrap({cls:"x-form-field-wrap"}),this.trigger=this.wrap.createChild({tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger "+this.triggerClass}),n.width||this.wrap.setWidth(i.getWidth()+this.trigger.getWidth()),this.splitter=this.wrap.createChild({tag:"div",cls:this.splitterClass,style:"width:13px; height:2px;"}),this.splitter.setRight(Ext.isIE?1:2).setTop(10).show(),this.proxy=this.trigger.createProxy("",this.splitter,!0),this.proxy.addClass("x-form-spinner-proxy"),this.proxy.setStyle("left","0px"),this.proxy.setSize(14,1),this.proxy.hide(),this.dd=new Ext.dd.DDProxy(this.splitter.dom.id,"SpinnerDrag",{dragElId:this.proxy.id}),this.initTrigger(),this.initSpinner()},doAfterRender:function(){var e;Ext.isIE&&this.el.getY()!=(e=this.trigger.getY())&&(this.el.position(),this.el.setY(e))},doEnable:function(){this.wrap&&this.wrap.removeClass(this.field.disabledClass)},doDisable:function(){this.wrap&&(this.wrap.addClass(this.field.disabledClass),this.el.removeClass(this.field.disabledClass))},doResize:function(e,t){"number"==typeof e&&this.el.setWidth(e-this.trigger.getWidth()),this.wrap.setWidth(this.el.getWidth()+this.trigger.getWidth())},doFocus:function(){this.mimicing||(this.wrap.addClass("x-trigger-wrap-focus"),this.mimicing=!0,Ext.get(Ext.isIE?document.body:document).on("mousedown",this.mimicBlur,this,{delay:10}),this.el.on("keydown",this.checkTab,this))},checkTab:function(e){e.getKey()==e.TAB&&this.triggerBlur()},mimicBlur:function(e){!this.wrap.contains(e.target)&&this.field.validateBlur(e)&&this.triggerBlur()},triggerBlur:function(){this.mimicing=!1,Ext.get(Ext.isIE?document.body:document).un("mousedown",this.mimicBlur,this),this.el.un("keydown",this.checkTab,this),this.field.beforeBlur(),this.wrap.removeClass("x-trigger-wrap-focus"),this.field.onBlur.call(this.field)},initTrigger:function(){this.trigger.addClassOnOver("x-form-trigger-over"),this.trigger.addClassOnClick("x-form-trigger-click")},initSpinner:function(){this.field.addEvents({spin:!0,spinup:!0,spindown:!0}),this.keyNav=new Ext.KeyNav(this.el,{up:function(e){e.preventDefault(),this.onSpinUp()},down:function(e){e.preventDefault(),this.onSpinDown()},pageUp:function(e){e.preventDefault(),this.onSpinUpAlternate()},pageDown:function(e){e.preventDefault(),this.onSpinDownAlternate()},scope:this}),this.repeater=new Ext.util.ClickRepeater(this.trigger,{accelerate:this.accelerate}),this.field.mon(this.repeater,"click",this.onTriggerClick,this,{preventDefault:!0}),this.field.mon(this.trigger,{mouseover:this.onMouseOver,mouseout:this.onMouseOut,mousemove:this.onMouseMove,mousedown:this.onMouseDown,mouseup:this.onMouseUp,scope:this,preventDefault:!0}),this.field.mon(this.wrap,"mousewheel",this.handleMouseWheel,this),this.dd.setXConstraint(0,0,10),this.dd.setYConstraint(1500,1500,10),this.dd.endDrag=this.endDrag.createDelegate(this),this.dd.startDrag=this.startDrag.createDelegate(this),this.dd.onDrag=this.onDrag.createDelegate(this)},onMouseOver:function(){var e;this.disabled||(e=this.getMiddle(),this.tmpHoverClass=Ext.EventObject.getPageY()<e?"x-form-spinner-overup":"x-form-spinner-overdown",this.trigger.addClass(this.tmpHoverClass))},onMouseOut:function(){this.trigger.removeClass(this.tmpHoverClass)},onMouseMove:function(){var e;this.disabled||(e=this.getMiddle(),Ext.EventObject.getPageY()>e&&"x-form-spinner-overup"==this.tmpHoverClass||Ext.EventObject.getPageY()<e&&this.tmpHoverClass)},onMouseDown:function(){var e;this.disabled||(e=this.getMiddle(),this.tmpClickClass=Ext.EventObject.getPageY()<e?"x-form-spinner-clickup":"x-form-spinner-clickdown",this.trigger.addClass(this.tmpClickClass))},onMouseUp:function(){this.trigger.removeClass(this.tmpClickClass)},onTriggerClick:function(){var e;this.disabled||this.el.dom.readOnly||(e=this.getMiddle(),this["onSpin"+(Ext.EventObject.getPageY()<e?"Up":"Down")]())},getMiddle:function(){return this.trigger.getTop()+this.trigger.getHeight()/2},isSpinnable:function(){return!this.disabled&&!this.el.dom.readOnly||(Ext.EventObject.preventDefault(),!1)},handleMouseWheel:function(e){var t;0!=this.wrap.hasClass("x-trigger-wrap-focus")&&(0<(t=e.getWheelDelta())?(this.onSpinUp(),e.stopEvent()):t<0&&(this.onSpinDown(),e.stopEvent()))},startDrag:function(){this.proxy.show(),this._previousY=Ext.fly(this.dd.getDragEl()).getTop()},endDrag:function(){this.proxy.hide()},onDrag:function(){var e,t;this.disabled||(e=Ext.fly(this.dd.getDragEl()).getTop(),t="",this._previousY>e&&(t="Up"),this._previousY<e&&(t="Down"),""!=t&&this["onSpin"+t](),this._previousY=e)},onSpinUp:function(){0!=this.isSpinnable()&&(1!=Ext.EventObject.shiftKey?(this.spin(!1,!1),this.field.fireEvent("spin",this),this.field.fireEvent("spinup",this)):this.onSpinUpAlternate())},onSpinDown:function(){0!=this.isSpinnable()&&(1!=Ext.EventObject.shiftKey?(this.spin(!0,!1),this.field.fireEvent("spin",this),this.field.fireEvent("spindown",this)):this.onSpinDownAlternate())},onSpinUpAlternate:function(){0!=this.isSpinnable()&&(this.spin(!1,!0),this.field.fireEvent("spin",this),this.field.fireEvent("spinup",this))},onSpinDownAlternate:function(){0!=this.isSpinnable()&&(this.spin(!0,!0),this.field.fireEvent("spin",this),this.field.fireEvent("spindown",this))},spin:function(e,t){var i=parseFloat(this.field.getValue()),t=1==t?this.alternateIncrementValue:this.incrementValue;1==e?i-=t:i+=t,i=isNaN(i)?this.defaultValue:i,i=this.fixBoundries(i),this.field.setRawValue(i)},fixBoundries:function(e){return null!=this.field.minValue&&e<this.field.minValue&&(e=this.field.minValue),null!=this.field.maxValue&&e>this.field.maxValue&&(e=this.field.maxValue),this.fixPrecision(e)},fixPrecision:function(e){var t=isNaN(e);return this.field.allowDecimals&&-1!=this.field.decimalPrecision&&!t&&e?parseFloat(parseFloat(e).toFixed(this.field.decimalPrecision)):t?"":e},doDestroy:function(){this.trigger&&this.trigger.remove(),this.wrap&&(this.wrap.remove(),delete this.field.wrap),this.splitter&&this.splitter.remove(),this.dd&&(this.dd.unreg(),this.dd=null),this.proxy&&this.proxy.remove(),this.repeater&&this.repeater.purgeListeners()}}),Ext.form.Spinner=Ext.ux.Spinner,Ext.ns("Ext.ux.form"),Ext.ux.form.SpinnerField=Ext.extend(Ext.form.NumberField,{actionMode:"wrap",deferHeight:!0,autoSize:Ext.emptyFn,onBlur:Ext.emptyFn,adjustSize:Ext.BoxComponent.prototype.adjustSize,constructor:function(e){var t=Ext.copyTo({},e,"incrementValue,alternateIncrementValue,accelerate,defaultValue,triggerClass,splitterClass"),t=this.spinner=new Ext.ux.Spinner(t),t=e.plugins?Ext.isArray(e.plugins)?e.plugins.push(t):[e.plugins,t]:t;Ext.ux.form.SpinnerField.superclass.constructor.call(this,Ext.apply(e,{plugins:t}))},getResizeEl:function(){return this.wrap},getPositionEl:function(){return this.wrap},alignErrorIcon:function(){this.wrap&&this.errorIcon.alignTo(this.wrap,"tl-tr",[2,0])},validateBlur:function(){return!0}}),Ext.reg("spinnerfield",Ext.ux.form.SpinnerField),Ext.form.SpinnerField=Ext.ux.form.SpinnerField,Ext.ux.StatusBar=Ext.extend(Ext.Toolbar,{cls:"x-statusbar",busyIconCls:"x-status-busy",busyText:"Loading...",autoClear:5e3,emptyText:"&nbsp;",activeThreadId:0,initComponent:function(){"right"==this.statusAlign&&(this.cls+=" x-status-right"),Ext.ux.StatusBar.superclass.initComponent.call(this)},afterRender:function(){Ext.ux.StatusBar.superclass.afterRender.call(this);var e="right"==this.statusAlign;this.currIconCls=this.iconCls||this.defaultIconCls,this.statusEl=new Ext.Toolbar.TextItem({cls:"x-status-text "+(this.currIconCls||""),text:this.text||this.defaultText||""}),e?(this.add("->"),this.add(this.statusEl)):(this.insert(0,this.statusEl),this.insert(1,"->")),this.doLayout()},setStatus:function(e){var t,i;return"string"==typeof(e=e||{})&&(e={text:e}),void 0!==e.text&&this.setText(e.text),void 0!==e.iconCls&&this.setIcon(e.iconCls),e.clear&&(t=e.clear,i=this.autoClear,e={useDefaults:!0,anim:!0},"object"==typeof t?(t=Ext.applyIf(t,e)).wait&&(i=t.wait):"number"==typeof t?(i=t,t=e):"boolean"==typeof t&&(t=e),t.threadId=this.activeThreadId,this.clearStatus.defer(i,this,[t])),this},clearStatus:function(e){if((e=e||{}).threadId&&e.threadId!==this.activeThreadId)return this;var t=e.useDefaults?this.defaultText:this.emptyText,i=e.useDefaults&&this.defaultIconCls||"";return e.anim?this.statusEl.el.fadeOut({remove:!1,useDisplay:!0,scope:this,callback:function(){this.setStatus({text:t,iconCls:i}),this.statusEl.el.show()}}):(this.statusEl.hide(),this.setStatus({text:t,iconCls:i}),this.statusEl.show()),this},setText:function(e){return this.activeThreadId++,this.text=e||"",this.rendered&&this.statusEl.setText(this.text),this},getText:function(){return this.text},setIcon:function(e){return this.activeThreadId++,e=e||"",this.rendered?(this.currIconCls&&(this.statusEl.removeClass(this.currIconCls),this.currIconCls=null),0<e.length&&(this.statusEl.addClass(e),this.currIconCls=e)):this.currIconCls=e,this},showBusy:function(e){return"string"==typeof e&&(e={text:e}),e=Ext.applyIf(e||{},{text:this.busyText,iconCls:this.busyIconCls}),this.setStatus(e)}}),Ext.reg("statusbar",Ext.ux.StatusBar),Ext.ux.TabCloseMenu=Ext.extend(Object,{closeTabText:_("Close Tab"),closeOtherTabsText:_("Close Other Tabs"),showCloseAll:!0,closeAllTabsText:_("Close All Tabs"),constructor:function(e){Ext.apply(this,e||{})},init:function(e){(this.tabs=e).on({scope:this,contextmenu:this.onContextMenu,destroy:this.destroy})},destroy:function(){Ext.destroy(this.menu),delete this.menu,delete this.tabs,delete this.active},onContextMenu:function(e,t,i){this.active=t;var n=this.createMenu(),o=!0,a=!0,r=n.getComponent("closeall");n.getComponent("close").setDisabled(!t.closable),e.items.each(function(){if(this.closable&&(o=!1,this!=t))return a=!1}),n.getComponent("closeothers").setDisabled(a),r&&r.setDisabled(o),i.stopEvent(),n.showAt(i.getPoint())},createMenu:function(){var e;return this.menu||(e=[{itemId:"close",text:this.closeTabText,scope:this,handler:this.onClose}],this.showCloseAll&&e.push("-"),e.push({itemId:"closeothers",iconCls:"iconCloseOthersTabs",text:this.closeOtherTabsText,scope:this,handler:this.onCloseOthers}),this.showCloseAll&&e.push({itemId:"closeall",text:this.closeAllTabsText,scope:this,handler:this.onCloseAll}),this.menu=new Ext.menu.Menu({items:e})),this.menu},onClose:function(){this.tabs.remove(this.active)},onCloseOthers:function(){this.doClose(!0)},onCloseAll:function(){this.doClose(!1)},doClose:function(t){var i=[];this.tabs.items.each(function(e){e.closable&&(t&&e==this.active||i.push(e))},this),Ext.each(i,function(e){this.tabs.remove(e)},this)}}),Ext.preg("tabclosemenu",Ext.ux.TabCloseMenu),Ext.ns("Ext.ux.tree"),Ext.ux.tree.TreeGridSorter=Ext.extend(Ext.tree.TreeSorter,{sortClasses:["sort-asc","sort-desc"],sortAscText:"Sort Ascending",sortDescText:"Sort Descending",constructor:function(e,t){Ext.isObject(t)||(t={property:e.columns[0].dataIndex||"text",folderSort:!0}),Ext.ux.tree.TreeGridSorter.superclass.constructor.apply(this,arguments),(this.tree=e).on("headerclick",this.onHeaderClick,this),e.ddAppendOnly=!0,(me=this).defaultSortFn=function(e,t){var i=me.dir&&"desc"==me.dir.toLowerCase(),n=me.property||"text",o=me.sortType,a=me.folderSort,r=!0===me.caseSensitive,s=me.leafAttr||"leaf";if(a){if(e.attributes[s]&&!t.attributes[s])return 1;if(!e.attributes[s]&&t.attributes[s])return-1}e=o?o(e):r?e.attributes[n]:e.attributes[n].toUpperCase(),n=o?o(t):r?t.attributes[n]:t.attributes[n].toUpperCase();return e<n?i?1:-1:n<e?i?-1:1:0},e.on("afterrender",this.onAfterTreeRender,this,{single:!0}),e.on("headermenuclick",this.onHeaderMenuClick,this)},onAfterTreeRender:function(){this.tree.hmenu&&this.tree.hmenu.insert(0,{itemId:"asc",text:this.sortAscText,cls:"xg-hmenu-sort-asc"},{itemId:"desc",text:this.sortDescText,cls:"xg-hmenu-sort-desc"}),this.updateSortIcon(0,"asc")},onHeaderMenuClick:function(e,t,i){if("asc"===t||"desc"===t)return this.onHeaderClick(e,null,i),!1},onHeaderClick:function(e,t,i){var n;e&&!this.tree.headersDisabled&&((n=this).property=e.dataIndex,n.dir=e.dir="desc"===e.dir?"asc":"desc",n.sortType=e.sortType,(n.caseSensitive===Ext.isBoolean(e.caseSensitive)?e:this).caseSensitive,n.sortFn=e.sortFn||this.defaultSortFn,this.tree.root.cascade(function(e){e.isLeaf()||n.updateSort(n.tree,e)}),this.updateSortIcon(i,e.dir))},updateSortIcon:function(e,t){var i=this.sortClasses;this.tree.innerHd.select("td").removeClass(i).item(e).addClass(i["desc"==t?1:0])}}),Ext.tree.ColumnResizer=Ext.extend(Ext.util.Observable,{minWidth:14,constructor:function(e){Ext.apply(this,e),Ext.tree.ColumnResizer.superclass.constructor.call(this)},init:function(e){(this.tree=e).on("render",this.initEvents,this)},initEvents:function(e){e.mon(e.innerHd,"mousemove",this.handleHdMove,this),this.tracker=new Ext.dd.DragTracker({onBeforeStart:this.onBeforeStart.createDelegate(this),onStart:this.onStart.createDelegate(this),onDrag:this.onDrag.createDelegate(this),onEnd:this.onEnd.createDelegate(this),tolerance:3,autoStart:300}),this.tracker.initEl(e.innerHd),e.on("beforedestroy",this.tracker.destroy,this.tracker)},handleHdMove:function(e,t){var i=e.getPageX(),n=e.getTarget(".x-treegrid-hd",3,!0);if(n){var o=n.getRegion(),a=n.dom.style,e=n.dom.parentNode;if(i-o.left<=5&&n.dom!==e.firstChild){for(var r=n.dom.previousSibling;r&&Ext.fly(r).hasClass("x-treegrid-hd-hidden");)r=r.previousSibling;r&&(this.activeHd=Ext.get(r),a.cursor=Ext.isWebKit?"e-resize":"col-resize")}else if(o.right-i<=5){for(var s=n.dom;s&&Ext.fly(s).hasClass("x-treegrid-hd-hidden");)s=s.previousSibling;s&&(this.activeHd=Ext.get(s),a.cursor=Ext.isWebKit?"w-resize":"col-resize")}else delete this.activeHd,a.cursor=""}},onBeforeStart:function(e){return this.dragHd=this.activeHd,!!this.dragHd},onStart:function(e){this.tree.headersDisabled=!0,this.proxy=this.tree.body.createChild({cls:"x-treegrid-resizer"}),this.proxy.setHeight(this.tree.body.getHeight());var t=this.tracker.getXY()[0];this.hdX=this.dragHd.getX(),this.hdIndex=this.tree.findHeaderIndex(this.dragHd),this.proxy.setX(this.hdX),this.proxy.setWidth(t-this.hdX),this.maxWidth=this.tree.outerCt.getWidth()-this.tree.innerBody.translatePoints(this.hdX).left},onDrag:function(e){var t=this.tracker.getXY()[0];this.proxy.setWidth((t-this.hdX).constrain(this.minWidth,this.maxWidth))},onEnd:function(e){var t=this.proxy.getWidth(),i=this.tree;this.proxy.remove(),delete this.dragHd,i.columns[this.hdIndex].width=t,i.updateColumnWidths(),setTimeout(function(){i.headersDisabled=!1},100)}}),Ext.ux.tree.TreeGridNodeUI=Ext.extend(Ext.tree.TreeNodeUI,{isTreeGridNodeUI:!0,renderElements:function(e,t,i,n){var o,a,r,s=e.getOwnerTree(),l=s.columns,d=l[0];for(this.indentMarkup=e.parentNode?e.parentNode.ui.getChildIndent():"",a=['<tbody class="x-tree-node">','<tr ext:tree-node-id="',e.id,'" class="x-tree-node-el x-tree-node-leaf ',t.cls,'">','<td class="x-treegrid-col">','<span class="x-tree-node-indent">',this.indentMarkup,"</span>",'<img src="',this.emptyIcon,'" class="x-tree-ec-icon x-tree-elbow">','<img src="',t.icon||this.emptyIcon,'" class="x-tree-node-icon',t.icon?" x-tree-node-inline-icon":"",t.iconCls?" "+t.iconCls:"",'" unselectable="on">','<a hidefocus="on" class="x-tree-node-anchor" href="',t.href||"#",'" tabIndex="1" ',t.hrefTarget?' target="'+t.hrefTarget+'"':"",">",'<span unselectable="on">',d.tpl?d.tpl.apply(t):t[d.dataIndex]||d.text,"</span></a>","</td>"],o=1,r=l.length;o<r;o++)d=l[o],a.push('<td class="x-treegrid-col ',d.cls||"",'">','<div unselectable="on" class="x-treegrid-text"',d.align?' style="text-align: '+d.align+';"':"",">",d.tpl?d.tpl.apply(t):t[d.dataIndex],"</div>","</td>");for(a.push('</tr><tr class="x-tree-node-ct"><td colspan="',l.length,'">','<table class="x-treegrid-node-ct-table" cellpadding="0" cellspacing="0" style="table-layout: fixed; display: none; width: ',s.innerCt.getWidth(),'px;"><colgroup>'),o=0,r=l.length;o<r;o++)a.push('<col style="width: ',l[o].hidden?0:l[o].width,'px;" />');a.push("</colgroup></table></td></tr></tbody>"),!0!==n&&e.nextSibling&&e.nextSibling.ui.getEl()?this.wrap=Ext.DomHelper.insertHtml("beforeBegin",e.nextSibling.ui.getEl(),a.join("")):this.wrap=Ext.DomHelper.insertHtml("beforeEnd",i,a.join("")),this.elNode=this.wrap.childNodes[0],this.ctNode=this.wrap.childNodes[1].firstChild.firstChild;i=this.elNode.firstChild.childNodes;this.indentNode=i[0],this.ecNode=i[1],this.iconNode=i[2],this.anchor=i[3],this.textNode=i[3].firstChild},animExpand:function(e){this.ctNode.style.display="",Ext.ux.tree.TreeGridNodeUI.superclass.animExpand.call(this,e)}}),Ext.ux.tree.TreeGridRootNodeUI=Ext.extend(Ext.tree.TreeNodeUI,{isTreeGridNodeUI:!0,render:function(){var e;this.rendered||(this.wrap=this.ctNode=this.node.ownerTree.innerCt.dom,this.node.expanded=!0),Ext.isWebKit&&((e=this.ctNode).style.tableLayout=null,function(){e.style.tableLayout="fixed"}.defer(1))},destroy:function(){this.elNode&&Ext.dd.Registry.unregister(this.elNode.id),delete this.node},collapse:Ext.emptyFn,expand:Ext.emptyFn}),Ext.ux.tree.TreeGridLoader=Ext.extend(Ext.tree.TreeLoader,{createNode:function(e){return e.uiProvider||(e.uiProvider=Ext.ux.tree.TreeGridNodeUI),Ext.tree.TreeLoader.prototype.createNode.call(this,e)}}),Ext.override(Ext.list.Column,{init:function(){var e=Ext.data.Types,t=this.sortType;this.type?Ext.isString(this.type)&&(this.type=Ext.data.Types[this.type.toUpperCase()]||e.AUTO):this.type=e.AUTO,Ext.isString(t)?this.sortType=Ext.data.SortTypes[t]:Ext.isEmpty(t)&&(this.sortType=this.type.sortType)}}),Ext.tree.Column=Ext.extend(Ext.list.Column,{}),Ext.tree.NumberColumn=Ext.extend(Ext.list.NumberColumn,{}),Ext.tree.DateColumn=Ext.extend(Ext.list.DateColumn,{}),Ext.tree.BooleanColumn=Ext.extend(Ext.list.BooleanColumn,{}),Ext.reg("tgcolumn",Ext.tree.Column),Ext.reg("tgnumbercolumn",Ext.tree.NumberColumn),Ext.reg("tgdatecolumn",Ext.tree.DateColumn),Ext.reg("tgbooleancolumn",Ext.tree.BooleanColumn),Ext.ux.tree.TreeGrid=Ext.extend(Ext.tree.TreePanel,{rootVisible:!1,useArrows:!0,lines:!1,borderWidth:Ext.isBorderBox?0:2,cls:"x-treegrid",columnResize:!0,enableSort:!0,reserveScrollOffset:!0,enableHdMenu:!0,columnsText:"Columns",initComponent:function(){this.root||(this.root=new Ext.tree.AsyncTreeNode({text:"Root"}));var e=this.loader;e?Ext.isObject(e)&&!e.load?e=new Ext.ux.tree.TreeGridLoader(e):e&&(e.createNode=function(e){return e.uiProvider||(e.uiProvider=Ext.ux.tree.TreeGridNodeUI),Ext.tree.TreeLoader.prototype.createNode.call(this,e)}):e=new Ext.ux.tree.TreeGridLoader({dataUrl:this.dataUrl,requestMethod:this.requestMethod,store:this.store}),this.loader=e,Ext.ux.tree.TreeGrid.superclass.initComponent.call(this),this.initColumns(),this.enableSort&&(this.treeGridSorter=new Ext.ux.tree.TreeGridSorter(this,this.enableSort)),this.columnResize&&(this.colResizer=new Ext.tree.ColumnResizer(this.columnResize),this.colResizer.init(this));this.columns;this.internalTpl||(this.internalTpl=new Ext.XTemplate('<div class="x-grid3-header">','<div class="x-treegrid-header-inner">','<div class="x-grid3-header-offset">','<table cellspacing="0" cellpadding="0" border="0"><colgroup><tpl for="columns"><col /></tpl></colgroup>','<thead><tr class="x-grid3-hd-row">','<tpl for="columns">','<td class="x-grid3-hd x-grid3-cell x-treegrid-hd" style="text-align: {align};" id="',this.id,'-xlhd-{#}">','<div class="x-grid3-hd-inner x-treegrid-hd-inner" unselectable="on">',this.enableHdMenu?'<a class="x-grid3-hd-btn" href="#"></a>':"",'{header}<img class="x-grid3-sort-icon" src="',Ext.BLANK_IMAGE_URL,'" />',"</div>","</td></tpl>","</tr></thead>","</div></table>","</div></div>","</div>",'<div class="x-treegrid-root-node">','<table class="x-treegrid-root-table" cellpadding="0" cellspacing="0" style="table-layout: fixed;"></table>',"</div>")),this.colgroupTpl||(this.colgroupTpl=new Ext.XTemplate('<colgroup><tpl for="columns"><col style="width: {width}px"/></tpl></colgroup>'))},initColumns:function(){for(var e,t=this.columns,i=t.length,n=[],o=0;o<i;o++)(e=t[o]).isColumn||(e.xtype=e.xtype?/^tg/.test(e.xtype)?e.xtype:"tg"+e.xtype:"tgcolumn",e=Ext.create(e)),e.init(this),n.push(e),!1!==this.enableSort&&!1!==e.sortable&&(e.sortable=!0,this.enableSort=!0);this.columns=n},onRender:function(){Ext.tree.TreePanel.superclass.onRender.apply(this,arguments),this.el.addClass("x-treegrid"),this.outerCt=this.body.createChild({cls:"x-tree-root-ct x-treegrid-ct "+(this.useArrows?"x-tree-arrows":this.lines?"x-tree-lines":"x-tree-no-lines")}),this.internalTpl.overwrite(this.outerCt,{columns:this.columns}),this.mainHd=Ext.get(this.outerCt.dom.firstChild),this.innerHd=Ext.get(this.mainHd.dom.firstChild),this.innerBody=Ext.get(this.outerCt.dom.lastChild),this.innerCt=Ext.get(this.innerBody.dom.firstChild),this.colgroupTpl.insertFirst(this.innerCt,{columns:this.columns}),this.hideHeaders?this.header.dom.style.display="none":!1!==this.enableHdMenu&&(this.hmenu=new Ext.menu.Menu({id:this.id+"-hctx"}),!1!==this.enableColumnHide&&(this.colMenu=new Ext.menu.Menu({id:this.id+"-hcols-menu"}),this.colMenu.on({scope:this,beforeshow:this.beforeColMenuShow,itemclick:this.handleHdMenuClick}),this.hmenu.add({itemId:"columns",hideOnClick:!1,text:this.columnsText,menu:this.colMenu,iconCls:"x-cols-icon"})),this.hmenu.on("itemclick",this.handleHdMenuClick,this))},setRootNode:function(e){return e.attributes.uiProvider=Ext.ux.tree.TreeGridRootNodeUI,e=Ext.ux.tree.TreeGrid.superclass.setRootNode.call(this,e),this.innerCt&&this.colgroupTpl.insertFirst(this.innerCt,{columns:this.columns}),e},clearInnerCt:function(){if(Ext.isIE)for(var e=this.innerCt.dom;e.firstChild;)e.removeChild(e.firstChild);else Ext.ux.tree.TreeGrid.superclass.clearInnerCt.call(this)},initEvents:function(){Ext.ux.tree.TreeGrid.superclass.initEvents.apply(this,arguments),this.mon(this.innerBody,"scroll",this.syncScroll,this),this.mon(this.innerHd,"click",this.handleHdDown,this),this.mon(this.mainHd,{scope:this,mouseover:this.handleHdOver,mouseout:this.handleHdOut})},onResize:function(e,t){Ext.ux.tree.TreeGrid.superclass.onResize.apply(this,arguments);var i,n,o=this.innerBody.dom,a=this.innerHd.dom;o&&(Ext.isNumber(t)&&(o.style.height=this.body.getHeight(!0)-a.offsetHeight+"px"),Ext.isNumber(e)&&(i=Ext.num(this.scrollOffset,Ext.getScrollBarWidth()),this.reserveScrollOffset||10<o.offsetWidth-o.clientWidth?this.setScrollOffset(i):(n=this,setTimeout(function(){n.setScrollOffset(10<o.offsetWidth-o.clientWidth?i:0)},10))))},updateColumnWidths:function(){for(var e,t,i=this.columns,n=i.length,o=this.outerCt.query("colgroup"),a=o.length,r=0;r<n;r++)for(e=i[r],t=0;t<a;t++)o[t].childNodes[r].style.width=(e.hidden?0:e.width)+"px";for(r=0,o=this.innerHd.query("td"),len=o.length;r<len;r++)e=Ext.fly(o[r]),i[r]&&i[r].hidden?e.addClass("x-treegrid-hd-hidden"):e.removeClass("x-treegrid-hd-hidden");var s=this.getTotalColumnWidth();Ext.fly(this.innerHd.dom.firstChild).setWidth(s+(this.scrollOffset||0)),this.outerCt.select("table").setWidth(s),this.syncHeaderScroll()},getVisibleColumns:function(){for(var e=[],t=this.columns,i=t.length,n=0;n<i;n++)t[n].hidden||e.push(t[n]);return e},getTotalColumnWidth:function(){for(var e=0,t=0,i=this.getVisibleColumns(),n=i.length;t<n;t++)e+=i[t].width;return e},setScrollOffset:function(e){this.scrollOffset=e,this.updateColumnWidths()},handleHdDown:function(e,t){var i,n,o,a=e.getTarget(".x-treegrid-hd");a&&Ext.fly(t).hasClass("x-grid3-hd-btn")?(i=this.hmenu.items,(n=this.columns[o=this.findHeaderIndex(a)]).sortable,e.stopEvent(),Ext.fly(a).addClass("x-grid3-hd-menu-open"),this.hdCtxIndex=o,this.fireEvent("headerbuttonclick",i,n,a,o),this.hmenu.on("hide",function(){Ext.fly(a).removeClass("x-grid3-hd-menu-open")},this,{single:!0}),this.hmenu.show(t,"tl-bl?")):a&&(o=this.findHeaderIndex(a),this.fireEvent("headerclick",this.columns[o],a,o))},handleHdOver:function(e,t){e=e.getTarget(".x-treegrid-hd");e&&!this.headersDisabled&&(index=this.findHeaderIndex(e),this.activeHdRef=t,this.activeHdIndex=index,t=Ext.get(e),this.activeHdRegion=t.getRegion(),t.addClass("x-grid3-hd-over"),this.activeHdBtn=t.child(".x-grid3-hd-btn"),this.activeHdBtn&&(this.activeHdBtn.dom.style.height=e.firstChild.offsetHeight-1+"px"))},handleHdOut:function(e,t){var i=e.getTarget(".x-treegrid-hd");!i||Ext.isIE&&e.within(i,!0)||(this.activeHdRef=null,Ext.fly(i).removeClass("x-grid3-hd-over"),i.style.cursor="")},findHeaderIndex:function(e){for(var t,i=(e=e.dom||e).parentNode.childNodes,n=0;t=i[n];n++)if(t==e)return n;return-1},beforeColMenuShow:function(){var e,t,i=this.columns,n=i.length;for(this.colMenu.removeAll(),e=1;e<n;e++)!1!==(t=i[e]).hideable&&this.colMenu.add(new Ext.menu.CheckItem({itemId:"col-"+e,text:t.header,checked:!t.hidden,hideOnClick:!1,disabled:!1===t.hideable}))},handleHdMenuClick:function(e){var t=this.hdCtxIndex,i=e.getItemId();return!1!==this.fireEvent("headermenuclick",this.columns[t],i,t)&&0<(t=i.substr(4))&&this.columns[t]&&this.setColumnVisible(t,!e.checked),!0},setColumnVisible:function(e,t){this.columns[e].hidden=!t,this.updateColumnWidths()},scrollToTop:function(){this.innerBody.dom.scrollTop=0,this.innerBody.dom.scrollLeft=0},syncScroll:function(){this.syncHeaderScroll();var e=this.innerBody.dom;this.fireEvent("bodyscroll",e.scrollLeft,e.scrollTop)},syncHeaderScroll:function(){var e=this.innerBody.dom;this.innerHd.dom.scrollLeft=e.scrollLeft,this.innerHd.dom.scrollLeft=e.scrollLeft},registerNode:function(e){Ext.ux.tree.TreeGrid.superclass.registerNode.call(this,e),e.uiProvider||e.isRoot||e.ui.isTreeGridNodeUI||(e.ui=new Ext.ux.tree.TreeGridNodeUI(e))}}),Ext.reg("treegrid",Ext.ux.tree.TreeGrid),Ext.override(Ext.ux.tree.TreeGrid,{onResize:function(e,t){Ext.ux.tree.TreeGrid.superclass.onResize.apply(this,arguments);var i,n,o,a=this.innerBody.dom,r=this.innerHd.dom;a&&(Ext.isNumber(t)&&(a.style.height=this.body.getHeight(!0)-24+"px"),Ext.isNumber(e)&&(!Ext.isIE||Ext.isStrict&&Ext.isIE8||(i=this.body.getWidth(!0)+"px",a.style.width=i,r.style.width=i),n=Ext.num(this.scrollOffset,Ext.getScrollBarWidth()),this.reserveScrollOffset||10<a.offsetWidth-a.clientWidth?this.setScrollOffset(n):(o=this,setTimeout(function(){o.setScrollOffset(10<a.offsetWidth-a.clientWidth?n:0)},10))))}}),Ext.ux.DblClickCloseTabs=Ext.extend(Object,{init:function(e){(this.panel=e).initEvents=e.initEvents.createSequence(this.initEvents,this)},initEvents:function(){this.panel.mon(this.panel.strip,{dblclick:this.onDblClick.createDelegate(this,[this.panel],0)}),delete this.panel},onDblClick:function(e,t){e.getActiveTab().closable&&e.remove(e.getActiveTab())}}),Ext.preg("dblclickclosetabs",Ext.ux.DblClickCloseTabs),Ext.util.md5=function(e,t,o,a){function u(e,t){var i=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(i>>16)<<16|65535&i}function s(e,t,i,n,o,a){return u((a=u(u(t,e),u(n,a)))<<(o=o)|a>>>32-o,i)}function h(e,t,i,n,o,a,r){return s(t&i|~t&n,e,t,o,a,r)}function p(e,t,i,n,o,a,r){return s(t&n|i&~n,e,t,o,a,r)}function m(e,t,i,n,o,a,r){return s(t^i^n,e,t,o,a,r)}function f(e,t,i,n,o,a,r){return s(i^(t|~n),e,t,o,a,r)}function i(e,t){var i,n,o,a,r,s=1732584193,l=-271733879,d=-1732584194,c=271733878;for(e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t,i=0;i<e.length;i+=16)s=h(n=s,o=l,a=d,r=c,e[i+0],7,-680876936),c=h(c,s,l,d,e[i+1],12,-389564586),d=h(d,c,s,l,e[i+2],17,606105819),l=h(l,d,c,s,e[i+3],22,-1044525330),s=h(s,l,d,c,e[i+4],7,-176418897),c=h(c,s,l,d,e[i+5],12,1200080426),d=h(d,c,s,l,e[i+6],17,-1473231341),l=h(l,d,c,s,e[i+7],22,-45705983),s=h(s,l,d,c,e[i+8],7,1770035416),c=h(c,s,l,d,e[i+9],12,-1958414417),d=h(d,c,s,l,e[i+10],17,-42063),l=h(l,d,c,s,e[i+11],22,-1990404162),s=h(s,l,d,c,e[i+12],7,1804603682),c=h(c,s,l,d,e[i+13],12,-40341101),d=h(d,c,s,l,e[i+14],17,-1502002290),s=p(s,l=h(l,d,c,s,e[i+15],22,1236535329),d,c,e[i+1],5,-165796510),c=p(c,s,l,d,e[i+6],9,-1069501632),d=p(d,c,s,l,e[i+11],14,643717713),l=p(l,d,c,s,e[i+0],20,-373897302),s=p(s,l,d,c,e[i+5],5,-701558691),c=p(c,s,l,d,e[i+10],9,38016083),d=p(d,c,s,l,e[i+15],14,-660478335),l=p(l,d,c,s,e[i+4],20,-405537848),s=p(s,l,d,c,e[i+9],5,568446438),c=p(c,s,l,d,e[i+14],9,-1019803690),d=p(d,c,s,l,e[i+3],14,-187363961),l=p(l,d,c,s,e[i+8],20,1163531501),s=p(s,l,d,c,e[i+13],5,-1444681467),c=p(c,s,l,d,e[i+2],9,-51403784),d=p(d,c,s,l,e[i+7],14,1735328473),s=m(s,l=p(l,d,c,s,e[i+12],20,-1926607734),d,c,e[i+5],4,-378558),c=m(c,s,l,d,e[i+8],11,-2022574463),d=m(d,c,s,l,e[i+11],16,1839030562),l=m(l,d,c,s,e[i+14],23,-35309556),s=m(s,l,d,c,e[i+1],4,-1530992060),c=m(c,s,l,d,e[i+4],11,1272893353),d=m(d,c,s,l,e[i+7],16,-155497632),l=m(l,d,c,s,e[i+10],23,-1094730640),s=m(s,l,d,c,e[i+13],4,681279174),c=m(c,s,l,d,e[i+0],11,-358537222),d=m(d,c,s,l,e[i+3],16,-722521979),l=m(l,d,c,s,e[i+6],23,76029189),s=m(s,l,d,c,e[i+9],4,-640364487),c=m(c,s,l,d,e[i+12],11,-421815835),d=m(d,c,s,l,e[i+15],16,530742520),s=f(s,l=m(l,d,c,s,e[i+2],23,-995338651),d,c,e[i+0],6,-198630844),c=f(c,s,l,d,e[i+7],10,1126891415),d=f(d,c,s,l,e[i+14],15,-1416354905),l=f(l,d,c,s,e[i+5],21,-57434055),s=f(s,l,d,c,e[i+12],6,1700485571),c=f(c,s,l,d,e[i+3],10,-1894986606),d=f(d,c,s,l,e[i+10],15,-1051523),l=f(l,d,c,s,e[i+1],21,-2054922799),s=f(s,l,d,c,e[i+8],6,1873313359),c=f(c,s,l,d,e[i+15],10,-30611744),d=f(d,c,s,l,e[i+6],15,-1560198380),l=f(l,d,c,s,e[i+13],21,1309151649),s=f(s,l,d,c,e[i+4],6,-145523070),c=f(c,s,l,d,e[i+11],10,-1120210379),d=f(d,c,s,l,e[i+2],15,718787259),l=f(l,d,c,s,e[i+9],21,-343485551),s=u(s,n),l=u(l,o),d=u(d,a),c=u(c,r);return[s,l,d,c]}function n(e){for(var t=[],i=(1<<a)-1,n=0;n<e.length*a;n+=a)t[n>>5]|=(e.charCodeAt(n/a)&i)<<n%32;return t}return o=void 0!==o&&o,a=void 0===a?8:a,((t=void 0!==t&&t)?function(e){for(var t="",i=(1<<a)-1,n=0;n<32*e.length;n+=a)t+=String.fromCharCode(e[n>>5]>>>n%32&i);return t}:function(e){for(var t=o?"0123456789ABCDEF":"0123456789abcdef",i="",n=0;n<4*e.length;n++)i+=t.charAt(e[n>>2]>>n%4*8+4&15)+t.charAt(e[n>>2]>>n%4*8&15);return i})(i(n(e),e.length*a))},Ext.ux.CodeMirror=Ext.extend(Ext.BoxComponent,{lineWrapping:!1,previousLine:!1,readOnly:!1,originalContent:!1,documentDurty:!1,mode:this.parser||"xml",theme:"undefined"===this.theme?"default":this.theme,initComponent:function(){switch(this.initialized=!1,Ext.ux.CodeMirror.superclass.initComponent.apply(this,arguments),this.theme=Ext.isDefined(this.theme)?this.theme:"default",this.mode){case"html":case"htm":this.mode="text/html";break;case"css":this.mode="text/css";break;case"php":this.mode="application/x-httpd-php";break;case"xml":case"ent":this.mode={name:"xml",alignCDATA:!0};break;case"bat":this.mode="text/x-clojure";break;case"README":this.mode="text/x-rst";break;default:this.mode={name:"xmlpure"}}this.addEvents("initialize"),this.addEvents("codemodified"),this.addEvents("coderestored"),this.addEvents("cursormove"),this.addEvents("scroll"),this.ownerCt.on("resize",function(e,t,i){this.fireEvent("resize",this,t,i)},this),this.on({resize:function(e,t,i){this.resize(t,i)},afterrender:function(){var i=this;i.codeEditor=new CodeMirror(Ext.get(i.id),{theme:i.theme,readOnly:i.readOnly,mode:i.mode,lineNumbers:!0,matchBrackets:!0,lineWrapping:i.lineWrapping,indentUnit:1,tabMode:"indent",value:"",onScroll:function(){i.fireEvent("scroll",i.el.child(".CodeMirror-scroll").dom.scrollTop)},onKeyEvent:function(e,t){t.ctrlKey&&83==t.keyCode&&(t.preventDefault(),i.onSave());e=e.getCursor();i.fireEvent("cursormove",e.line,e.ch)},onCursorActivity:function(e){var t=e.getCursor();!1!==i.previousLine&&e.setLineClass(i.previousLine,null),i.previousLine=e.setLineClass(t.line,"cm2-activeline"),i.fireEvent("cursormove",t.line,t.ch)},onChange:function(e){i.manageCodeChange()}}),i.initialized=!0,i.fireEvent("initialize",!0)}})},focus:function(){return this.initialized?this.codeEditor.focus():this.initialConfig.value},getCursor:function(){return this.codeEditor.getCursor()},getLine:function(e){return this.codeEditor.getLine(e)},getValue:function(){return this.initialized?this.codeEditor.getValue():this.initialConfig.value},insertLine:function(e,t){var i=this.codeEditor.getLine(e);this.codeEditor.setLine(e,i+"\n"+t)},manageCodeChange:function(){var e=this.originalContent,t=this.getValue();btnUndo=Ext.getCmp(this.id+"-btn-undo"),e&&(e===t?!0===this.documentDurty&&(this.fireEvent("coderestored"),this.documentDurty=!1):(btnUndo&&btnUndo.enable(),!1===this.documentDurty&&(this.fireEvent("codemodified"),this.documentDurty=!0)))},onSave:function(){var e=Ext.getCmp(this.id+"-btn-save");e.disabled||e.handler.call(e.scope||e,e)},redo:function(e,t){this.codeEditor.redo(),Ext.getCmp(this.id+"-btn-undo").enable(),0==this.codeEditor.historySize().redo&&Ext.getCmp(this.id+"-btn-redo").disable()},resize:function(e,t){this.el.child(".CodeMirror-scroll").setHeight(t-89)},removeLine:function(e){return this.codeEditor.removeLine(e)},reIndentAll:function(){for(var e=this.codeEditor.lineCount(),t=0;t<e;t++)this.codeEditor.indentLine(t);this.codeEditor.focus()},scrollTo:function(e){this.el.child(".CodeMirror-scroll").dom.scrollTop=e},setOriginalContent:function(e){this.originalContent=e,this.documentDurty=!1},setLine:function(e,t){this.codeEditor.setLine(e,t)},setOption:function(e,t){this.initialized&&this.codeEditor.setOption(e,t)},setValue:function(e){this.initialized&&(this.codeEditor.setValue(e),this.originalContent=e,this.codeEditor.clearHistory())},switchTheme:function(e){this.codeEditor.setOption("theme",e)},undo:function(){this.codeEditor.undo(),Ext.getCmp(this.id+"-btn-redo").enable(),0==this.codeEditor.historySize().undo&&Ext.getCmp(this.id+"-btn-undo").disable()}}),Ext.reg("codemirror",Ext.ux.CodeMirror),Ext.ns("Ext.ux.grid"),Ext.ux.grid.GridSummary=function(e){Ext.apply(this,e)},Ext.extend(Ext.ux.grid.GridSummary,Ext.util.Observable,{init:function(e){this.grid=e,this.cm=e.getColumnModel(),this.view=e.getView();var t=this.view;t.onLayout=this.onLayout,t.afterMethod("render",this.refreshSummary,this),t.afterMethod("refresh",this.refreshSummary,this),t.afterMethod("syncScroll",this.syncSummaryScroll,this),t.afterMethod("onColumnWidthUpdated",this.doWidth,this),t.afterMethod("onAllColumnWidthsUpdated",this.doAllWidths,this),t.afterMethod("onColumnHiddenUpdated",this.doHidden,this),e.store.on({add:this.refreshSummary,remove:this.refreshSummary,clear:this.refreshSummary,update:this.refreshSummary,scope:this}),this.rowTpl||(this.rowTpl=new Ext.Template('<div class="x-grid3-summary-row x-grid3-gridsummary-row-offset">','<table class="x-grid3-summary-table" border="0" cellspacing="0" cellpadding="0" style="{tstyle}">',"<tbody><tr>{cells}</tr></tbody>","</table>","</div>"),this.rowTpl.disableFormats=!0),this.rowTpl.compile(),this.cellTpl||(this.cellTpl=new Ext.Template('<td class="x-grid3-col x-grid3-cell x-grid3-td-{id} {css}" style="{style}">','<div class="x-grid3-cell-inner x-grid3-col-{id}" unselectable="on" {attr}>{value}</div>',"</td>"),this.cellTpl.disableFormats=!0),this.cellTpl.compile()},calculate:function(e,t){for(var i,n,o,a,r,s={},l=t.config,d=0,c=l.length;d<c;d++)if(s[n=(i=l[d]).dataIndex]=0,i.summaryType)for(o=0,r=e.length;o<r;o++)a=e[o],s[n]=Ext.ux.grid.GridSummary.Calculations[i.summaryType](a.get(n),a,n,s,o);return s},onLayout:function(e,t){"number"===Ext.type(t)&&(this.grid.getGridEl().hasClass("x-grid-hide-gridsummary")||this.scroller.setHeight(t-this.summary.getHeight()))},syncSummaryScroll:function(){var e=this.view.scroller.dom;this.view.summaryWrap.dom.scrollLeft=e.scrollLeft,this.view.summaryWrap.dom.scrollLeft=e.scrollLeft},doWidth:function(e,t,i){var n=this.view.summary.dom;n.firstChild.style.width=i,n.firstChild.rows[0].childNodes[e].style.width=t},doAllWidths:function(e,t){var i,n,o=this.view.summary.dom,a=e.length;for(o.firstChild.style.width=t,i=o.firstChild.rows[0].childNodes,n=0;n<a;n++)i[n].style.width=e[n]},doHidden:function(e,t,i){var n=this.view.summary.dom,t=t?"none":"";n.firstChild.style.width=i,n.firstChild.rows[0].childNodes[e].style.display=t},renderSummary:function(e,t,i){t=t||this.view.getColumnData();for(var n,o,a,r=i.config,s=[],l=t.length-1,d=0,c=t.length;d<c;d++)n=t[d],o=r[d],(a={}).id=n.id,a.style=n.style,a.css=0===d?"x-grid3-cell-first ":d===l?"x-grid3-cell-last ":"",o.summaryType||o.summaryRenderer?a.value=(o.summaryRenderer||n.renderer)(e.data[n.name],a,e):a.value="",void 0!==a.value&&""!==a.value||(a.value="&#160;"),s[s.length]=this.cellTpl.apply(a);return this.rowTpl.apply({tstyle:"width:"+this.view.getTotalWidth()+";",cells:s.join("")})},refreshSummary:function(){var e=this.grid.store,t=this.view.getColumnData(),i=this.cm,e=e.getRange(),e=this.calculate(e,i),i=this.renderSummary({data:e},t,i);this.view.summaryWrap||(this.view.summaryWrap=Ext.DomHelper.insertAfter(this.view.scroller,{tag:"div",cls:"x-grid3-gridsummary-row-inner"},!0)),this.view.summary=this.view.summaryWrap.update(i).first()},toggleSummary:function(e){var t=this.grid.getGridEl();t&&(void 0===e&&(e=t.hasClass("x-grid-hide-gridsummary")),t[e?"removeClass":"addClass"]("x-grid-hide-gridsummary"),this.view.layout())},getSummaryNode:function(){return this.view.summary}}),Ext.reg("gridsummary",Ext.ux.grid.GridSummary),Ext.ux.grid.GridSummary.Calculations={sum:function(e,t,i,n,o){return n[i]+Ext.num(e,0)},count:function(e,t,i,n,o){return o+1},max:function(e,t,i,n,o){return Math.max(Ext.num(e,0),n[i])},min:function(e,t,i,n,o){return Math.min(Ext.num(e,0),n[i])},average:function(e,t,i,n,o){e=n[i]+Ext.num(e,0),t=t.store.getCount();return o===t-1?e/t:e}},Ext.ux.IFrameComponent=Ext.extend(Ext.BoxComponent,{frame:null,setUrl:function(e){this.frame.src=e},onRender:function(t,e){t.mask('<img src="themes/img/loading.gif" style="vertical-align: middle;" /> '+_("Loading...")),this.frame=document.createElement("iframe"),callback=function(e){t.unmask()},this.frame.id=this.id,this.frame.name=this.id,this.frame.src=this.url,this.frame.frameBorder=0,this.el=t.appendChild(this.frame),Ext.isIE&&(document.frames[this.url].name=this.id),this.frame[Ext.isIE?"onreadystatechange":"onload"]=callback.createDelegate(this.frame)}}),Ext.ux.FixedMultiSelectionModel=Ext.extend(Ext.tree.MultiSelectionModel,{normalClick:!1,init:function(e){(this.tree=e).getTreeEl().on("keydown",this.onKeyDown,this),e.on("dblclick",this.onDoubleClick,this),e.on("click",this.onNodeClick,this)},onDrag:function(){this.normalClick=!1},onNodeClick:function(e,t){t.shiftKey&&t.preventDefault(),this.tree.dragZone&&this.tree.dragZone.isMultiSelect||(this.onMouseDown(e,t),this.onMouseUp(e,t))},onMouseDown:function(e,t){if(e.isSelected()){if(t.ctrlKey)return this.unselect(e),void(this.normalClick=!1);this.normalClick=!t.shiftKey}else this.select(e,t,t.ctrlKey),this.normalClick=!1},onMouseUp:function(e,t){this.normalClick&&(this.select(e,t,t.ctrlKey),this.normalClick=!1)},onDoubleClick:function(){this.normalClick=!1},compareNodeOrder:document.compareDocumentPosition?function(e,t){return 3-(6&e.ui.elNode.compareDocumentPosition(t.ui.elNode))}:void 0!==document.documentElement.sourceIndex?function(e,t){return e.ui.elNode.sourceIndex-t.ui.elNode.sourceIndex}:function(e,t){if(e==t)return 0;e=document.createRange();e.selectNode(a.ui.elNode),e.collapse(!0);t=document.createRange();return t.selectNode(b.ui.elNode),t.collapse(!0),e.compareBoundaryPoints(Range.START_TO_END,t)},sortSelNodes:function(){1<this.selNodes.length&&this.selNodes[0].ui.elNode&&this.selNodes.sort(this.compareNodeOrder)},selectNode:function(e,t){this.isSelected(e)||(this.selNodes.push(e),(this.selMap[e.id]=e).ui.onSelectedChange(!0))},select:function(t,e,i){if(t instanceof Array){for(var n=0;n<t.length;n++)this.selectNode(t[n]);return this.sortSelNodes(),this.fireEvent("selectionchange",this,this.selNodes,this.lastSelNode),t}if(e&&e.shiftKey&&0<this.selNodes.length){this.lastSelNode=this.lastSelNode||this.selNodes[0];var o=0<this.compareNodeOrder(this.lastSelNode,t);this.clearSelections(!0);var a=!0,r=!1,s=this.lastSelNode;do{for(var l=s;null!=l&&(r=r||o&&(l==t||l.contains(t)),l.isExpanded()?l.cascade(function(e){return a!=r&&this.selectNode(e),a=a&&e!=t,!0},this):(this.selectNode(l),a=l!=t),a);l=o?l.previousSibling:l.nextSibling);if(!a)break;for(;null!=(s=s.parentNode);){if(o&&this.selectNode(s),a=a&&s!=t,o&&s.previousSibling){s=s.previousSibling;break}if(!o&&s.nextSibling){s=s.nextSibling;break}}}while(a&&null!=s);return this.selectNode(t),this.sortSelNodes(),this.fireEvent("selectionchange",this,this.selNodes,t),e.preventDefault(),t}return!0!==i&&this.clearSelections(!0),this.isSelected(t)?!0===i?(this.unselect(t),this.lastSelNode===t&&(this.lastSelNode=this.selNodes[0]),t):this.lastSelNode=t:(this.selectNode(t),this.sortSelNodes(),this.lastSelNode=t,this.fireEvent("selectionchange",this,this.selNodes,this.lastSelNode),t)},getUniqueSelectedNodes:function(){for(var e=[],t=0;t<this.selNodes.length;t++){var i=this.selNodes[t];for(e.push(i);t+1<this.selNodes.length&&i.contains(this.selNodes[t+1]);)t++}return e},unselect:function(e,t){if(t)for(var i=this.selNodes.length-1;0<=i;i--)this.selNodes[i].isAncestor(e)&&Ext.ux.FixedMultiSelectionModel.superclass.unselect.call(this,this.selNodes[i]);return Ext.ux.FixedMultiSelectionModel.superclass.unselect.call(this,e)},selectPrevious:function(e){var t=this.selNodes[0];if(!t)return null;var i=t.previousSibling;if(i){if(!i.isExpanded()||i.childNodes.length<1)return this.select(i,null,e);for(var n=i.lastChild;n&&n.isExpanded()&&0<n.childNodes.length;)n=n.lastChild;return this.select(n,null,e)}return!t.parentNode||!this.tree.rootVisible&&t.parentNode.isRoot?null:this.select(t.parentNode,null,e)},selectNext:function(e){var t=this.selNodes[this.selNodes.length-1];if(!t)return null;if(t.firstChild&&t.isExpanded())return this.select(t.firstChild,null,e);if(t.nextSibling)return this.select(t.nextSibling,null,e);if(t.parentNode){var i=null;return t.parentNode.bubble(function(){if(this.nextSibling)return i=this.getOwnerTree().selModel.select(this.nextSibling,null,e),!1}),i}return null},onKeyDown:function(e){var t=this.selNode||this.lastSelNode;if(t)switch(e.getKey()){case e.DOWN:e.stopEvent(),this.selectNext(e.shiftKey||e.ctrlKey);break;case e.UP:e.stopEvent(),this.selectPrevious(e.shiftKey||e.ctrlKey);break;case e.RIGHT:e.preventDefault(),t.hasChildNodes()&&(t.isExpanded()?t.firstChild&&this.select(t.firstChild,e,e.shiftKey||e.ctrlKey):t.expand());break;case e.LEFT:e.preventDefault(),t.hasChildNodes()&&t.isExpanded()?t.collapse():t.parentNode&&(this.tree.rootVisible||t.parentNode!=this.tree.getRootNode())&&this.select(t.parentNode,e,e.shiftKey||e.ctrlKey)}}}),Ext.ux.MultiSelectTreeDragZone=Ext.extend(Ext.tree.TreeDragZone,{isMultiSelect:!0,onBeforeDrag:function(e,t){if(e.nodes&&0<e.nodes.length){for(var i=0;i<e.nodes.length;i++)if(n=e.nodes[i],!1===n.draggable||n.disabled)return!1;return!0}return e.node&&(!1===e.node.draggable||e.node.disabled),!1},alignElWithMouse:function(e,t,i){var n;Ext.ux.MultiSelectTreeDragZone.superclass.alignElWithMouse.apply(this,arguments),!Ext.fly(e).isVisible()||(n=this.tree.getSelectionModel())&&n.onDrag&&n.onDrag.call(n)},onMouseUp:function(e){var t,i=this.tree.getSelectionModel();i&&i.onMouseUp&&(null!=(t=Ext.dd.Registry.getHandleFromEvent(e))&&i.onMouseUp.call(i,t.node,e)),Ext.ux.MultiSelectTreeDragZone.superclass.onMouseUp.apply(this,arguments)},getDragData:function(e){var t=Ext.dd.Registry.getHandleFromEvent(e);if(null!=t){var i=[],n=this.tree.getSelectionModel();if((i=n.onMouseDown?(n.onMouseDown.call(n,t.node,e),n.getUniqueSelectedNodes()):[t.node])&&!(i.length<1)){var t={nodes:i},o=document.createElement("ul");o.className="x-tree-node-ct x-tree-lines";for(var a=0,r=i.length;a<r;a++){var s=i[a].ui.wrap.cloneNode(!0),l=i[a].ui.indentNode.childNodes.length+1;if(0<l)for(var d=Ext.query(i[a].ui.indentNode.nodeName+".x-tree-node-indent",s),c=0,u=d.length;c<u;c++){var h=d[c],p=h.childNodes.length;if(p<=l)h.innerHTML="",p<l&&h.parentNode.removeChild(d[c].nextSibling);else for(var m=0;m<l;m++)d[c].removeChild(d[c].firstChild)}o.appendChild(s),Ext.fly(s).removeClass(["x-tree-selected","x-tree-node-over"])}return t.ddel=o,t}}},onInitDrag:function(e){var t=this.dragData;this.tree.eventModel.disable(),this.proxy.update(""),this.proxy.ghost.dom.appendChild(t.ddel),this.tree.fireEvent("startdrag",this.tree,t.nodes,e)},getTreeNode:function(){return this.dragData.nodes},getRepairXY:function(e,t){return t.nodes[0].ui.getDDRepairXY()},onEndDrag:function(e,t){this.tree.eventModel.enable.defer(100,this.tree.eventModel),this.tree.fireEvent("enddrag",this.tree,e.nodes||[e.node],t)},onValidDrop:function(e,t,i){this.tree.fireEvent("dragdrop",this.tree,this.dragData.nodes,e,t),this.hideProxy()},beforeInvalidDrop:function(e,t){this.tree.getSelectionModel()}}),Ext.ux.MultiSelectTreeDropZone=Ext.extend(Ext.tree.TreeDropZone,{isValidDropPoint:function(e,t,i,n,o){if(!e||!o)return!1;var a=e.node,r=o.nodes||[o.node];if(!(a&&a.isTarget&&t))return!1;if("append"==t&&!1===a.allowChildren)return!1;if(("above"==t||"below"==t)&&a.parentNode&&!1===a.parentNode.allowChildren)return!1;for(var s=0;s<r.length;s++)if(r[s]&&(a==r[s]||r[s].contains(a)))return!1;e=this.dragOverData;e.tree=this.tree,e.target=a,e.data=o,e.point=t,e.source=i,e.rawEvent=n,e.dropNode=r,e.cancel=!1;n=this.tree.fireEvent("nodedragover",e);return!1===e.cancel&&!1!==n},getDropPoint:function(e,t,i,n){var o=t.node;if(o.isRoot)return!!this.isValidDropPoint(t,"append",i,e,n)&&"append";var a=t.ddel,r=Ext.lib.Dom.getY(a),s=r+a.offsetHeight,l=Ext.lib.Event.getPageY(e),d=!1===o.allowChildren||o.isLeaf()||!this.isValidDropPoint(t,"append",i,e,n);if(!this.appendOnly&&!1!==o.parentNode.allowChildren){a=!1;this.allowParentInsert||(a=o.hasChildNodes()&&o.isExpanded());o=(s-r)/(d?2:3);if(r<=l&&l<r+o&&this.isValidDropPoint(t,"above",i,e,n))return"above";if(!a&&(d||s-o<=l&&l<=s)&&this.isValidDropPoint(t,"below",i,e,n))return"below"}return!d&&"append"},onNodeOver:function(e,t,i,n){i=this.getDropPoint(i,e,t,n),t=e.node;this.expandProcId||"append"!=i||!t.hasChildNodes()||e.node.isExpanded()?"append"!=i&&this.cancelExpand():this.queueExpand(t);n=this.dropNotAllowed;return i&&(t=e.ddel,e="above"==i?(n=e.node.isFirst()?"x-tree-drop-ok-above":"x-tree-drop-ok-between","x-tree-drag-insert-above"):"below"==i?(n=e.node.isLast()?"x-tree-drop-ok-below":"x-tree-drop-ok-between","x-tree-drag-insert-below"):(n="x-tree-drop-ok-append","x-tree-drag-append"),this.lastInsertClass!=e&&(Ext.fly(t).replaceClass(this.lastInsertClass,e),this.lastInsertClass=e)),n},onNodeDrop:function(e,t,i,n){var o=this.getDropPoint(i,e,t,n),a=e.node;if(a.ui.startDrop(),!1===o)return a.ui.endDrop(),!1;var e=n.node||(t.getTreeNode?t.getTreeNode(n,a,o,i):null),r={tree:this.tree,target:a,data:n,point:o,source:t,rawEvent:i,dropNode:e,cancel:!e,dropStatus:!1};return!1!==this.tree.fireEvent("beforenodedrop",r)&&!0!==r.cancel&&r.dropNode?(a=r.target,"append"!=o||a.isExpanded()?this.completeDrop(r):a.expand(!1,null,function(){this.completeDrop(r)}.createDelegate(this)),!0):(a.ui.endDrop(),r.dropStatus)},afterRepair:function(e){if(e&&Ext.enableFx)for(var t=e.nodes||[e.node],i=0,n=t.length;i<n;i++)t[i].ui.highlight();this.hideProxy()},onContainerDrop:function(e,t,i){if(this.allowContainerDrop&&this.isValidDropPoint({ddel:this.tree.getRootNode().ui.elNode,node:this.tree.getRootNode()},"append",e,t,i)){var n=this.tree.getRootNode();n.ui.startDrop();var o=i.node||(e.getTreeNode?e.getTreeNode(i,n,"append",t):null),a={tree:this.tree,target:n,data:i,point:"append",source:e,rawEvent:t,dropNode:o,cancel:!o,dropStatus:!1};return!1!==this.tree.fireEvent("beforenodedrop",a)&&!0!==a.cancel&&a.dropNode?((n=a.target).isExpanded()?this.completeDrop(a):n.expand(!1,null,function(){this.completeDrop(a)}.createDelegate(this)),!0):(n.ui.endDrop(),a.dropStatus)}return!1},onContainerOver:function(e,t,i){return this.allowContainerDrop&&this.isValidDropPoint({ddel:this.tree.getRootNode().ui.elNode,node:this.tree.getRootNode()},"append",e,t,i)?this.dropAllowed:this.dropNotAllowed}}),Ext.ux.MultiSelectTreePanel=Ext.extend(Ext.tree.TreePanel,{getSelectionModel:function(){return this.selModel||(this.selModel=new Ext.ux.FixedMultiSelectionModel),this.selModel},initEvents:function(){!this.enableDD&&!this.enableDrop||this.dropZone||(this.dropZone=new Ext.ux.MultiSelectTreeDropZone(this,this.dropConfig||{ddGroup:this.ddGroup||"TreeDD",appendOnly:!0===this.ddAppendOnly})),!this.enableDD&&!this.enableDrag||this.dragZone||(this.dragZone=new Ext.ux.MultiSelectTreeDragZone(this,{ddGroup:this.ddGroup||"TreeDD",scroll:this.ddScroll})),Ext.ux.MultiSelectTreePanel.superclass.initEvents.apply(this,arguments),this.on("remove",function(e,t,i){e.getSelectionModel().unselect(i,!0)})}}),Ext.reg("multiselecttreepanel",Ext.ux.MultiSelectTreePanel),Ext.namespace("Ext.ux"),Ext.ux.NotificationMgr={positions:[]},Ext.ux.Notification=Ext.extend(Ext.Window,{initComponent:function(){Ext.apply(this,{iconCls:this.iconCls||"x-icon-information",cls:"x-notification",width:250,autoHeight:!0,draggable:!1,bodyStyle:"text-align:center; padding: 10px;"}),this.autoDestroy?this.task=new Ext.util.DelayedTask(this.close,this):this.closable=!0,Ext.ux.Notification.superclass.initComponent.call(this)},setMessage:function(e){this.body.update(e)},setTitle:function(e,t){Ext.ux.Notification.superclass.setTitle.call(this,e,t||this.iconCls)},onRender:function(e,t){Ext.ux.Notification.superclass.onRender.call(this,e,t)},onDestroy:function(){Ext.ux.NotificationMgr.positions.remove(this.pos),Ext.ux.Notification.superclass.onDestroy.call(this)},cancelHiding:function(){this.addClass("fixed"),this.autoDestroy&&this.task.cancel()},afterShow:function(){Ext.ux.Notification.superclass.afterShow.call(this),Ext.fly(this.body.dom).on("click",this.cancelHiding,this),this.autoDestroy&&this.task.delay(this.hideDelay||5e3)},animShow:function(){for(this.pos=0;-1<Ext.ux.NotificationMgr.positions.indexOf(this.pos);)this.pos++;Ext.ux.NotificationMgr.positions.push(this.pos),this.setSize(200,100),this.el.alignTo(document,"br-br",[-20,-20-(this.getSize().height+10)*this.pos]),this.el.slideIn("b",{duration:1,callback:this.afterShow,scope:this})},animHide:function(){Ext.ux.NotificationMgr.positions.remove(this.pos),this.el.shadow.hide(),this.el.ghost("b",{duration:1,remove:!1,callback:function(){Ext.ux.NotificationMgr.positions.remove(this.pos),this.destroy()}.createDelegate(this)})},focus:Ext.emptyFn}),Ext.ns("Ext.ux"),Ext.ux.PanelCollapsedTitle=function(){function t(){var e,t,i="east"==this.region||"west"==this.region,n="overflow: visible; padding: 0; border: none; background: none;";i&&a?(this.collapsedHeader=this.ownerCt.layout[this.region].getCollapsedEl().createChild({tag:"div",style:"height: 100%; overflow: hidden;"}),e="http://www.w3.org/2000/svg",t=document.createElementNS(e,"svg"),this.collapsedHeader.dom.appendChild(t),t.setAttribute("width","100%"),t.setAttribute("height","100%"),(e=document.createElementNS(e,"text")).setAttribute("x",6),e.setAttribute("y",1),e.setAttribute("transform","rotate(90 6 1)"),e.setAttribute("class","x-panel-header "+o),t.appendChild(e),this.collapsedHeaderText=document.createTextNode(this.title),e.appendChild(this.collapsedHeaderText),t=Ext.fly(e).getStyle("color"),e.setAttribute("style",n+";fill: "+t+";")):(t="position: relative;",i?t+="white-space: nowrap; writing-mode: tb-rl; top: 1px; left: 3px;":(t+="top: 2px;",n+="padding-left: 4px; margin-right: 18px;"),this.collapsedHeader=this.ownerCt.layout[this.region].getCollapsedEl().createChild({tag:"div",style:n,cls:"x-panel-header "+o,html:'<span style="'+t+'">'+this.title+"</span>"}),this.collapsedHeaderText=this.collapsedHeader.first()),this.collapsedIconCls&&this.setCollapsedIconClass(this.collapsedIconCls)}var o="x-panel-header-rotated",a=!!document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1");return this.init=function(e){var n;e.collapsible&&(n="east"==e.region||"west"==e.region,e.setTitle=Ext.Panel.prototype.setTitle.createSequence(function(e){this.rendered&&this.collapsedHeaderText&&(this.collapsedHeaderText.dom?this.collapsedHeaderText.dom.innerHTML=e:this.collapsedHeaderText.replaceData&&(this.collapsedHeaderText.nodeValue=e))}),e.setCollapsedIconClass=function(e){var t,i=this.collapsedIconCls;this.collapsedIconCls=e,this.rendered&&this.collapsedHeader&&((e=(t=this.collapsedHeader).child("img.x-panel-inline-icon"))?this.collapsedIconCls?Ext.fly(e).replaceClass(i,this.collapsedIconCls):Ext.fly(e).remove():this.collapsedIconCls&&Ext.DomHelper.insertBefore(t.dom.firstChild,{tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-panel-inline-icon "+this.collapsedIconCls,style:n?"display: block; margin: 1px 2px;":"margin-top: 2px; margin-right: 4px"}))},e.on("render",function(){this.ownerCt.rendered&&this.ownerCt.layout.hasLayout?t.call(e):this.ownerCt.on("afterlayout",t,e,{single:!0})},e))},this}(),Ext.ux.SlidingTabPanel=Ext.extend(Ext.TabPanel,{initTab:function(e,t){Ext.ux.SlidingTabPanel.superclass.initTab.call(this,e,t),this.addEvents({startDrag:!0,endDrag:!0});e=this.getTemplateArgs(e);this.slidingTabsID||(this.slidingTabsID=Ext.id()),new Ext.ux.DDSlidingTab(e,this.slidingTabsID,{tabpanel:this})}}),Ext.ux.DDSlidingTab=Ext.extend(Ext.dd.DDProxy,{constructor:function(){Ext.ux.DDSlidingTab.superclass.constructor.apply(this,arguments),this.setYConstraint(0,0,0),this.tabpanel=this.config.tabpanel,this.slideDuration=this.tabpanel.slideDuration,this.slideDuration||(this.slideDuration=.1)},handleMouseDown:function(e,t){var i;this.primaryButtonOnly&&0!=e.button||this.isLocked()||(this.DDM.refreshCache(this.groups),i=new Ext.lib.Point(Ext.lib.Event.getPageX(e),Ext.lib.Event.getPageY(e)),(this.hasOuterHandles||this.DDM.isOverTarget(i,this))&&this.clickValidator(e)&&(this.setStartPosition(),this.b4MouseDown(e),this.onMouseDown(e),this.DDM.handleMouseDown(e,this)))},startDrag:function(e,t){this.tabpanel.fireEvent("startDrag",this.tabpanel,this.tabpanel.getActiveTab()),Ext.dd.DDM.useCache=!1,Ext.dd.DDM.mode=1,this.proxyWrapper=Ext.get(this.getDragEl()),this.proxyWrapper.update(),this.proxyWrapper.applyStyles("z-index:1001;border:0 none;"),this.proxyWrapper.addClass("tab-proxy"),this.stripWrap=this.proxyWrapper.insertHtml("afterBegin",'<div class="x-tab-strip x-tab-strip-top"></div>',!0),this.dragEl=this.stripWrap.insertHtml("afterBegin","<div></div>",!0),this.tab=Ext.get(this.getEl()),this.tab.applyStyles("visibility:hidden;"),this.dragEl.insertHtml("afterBegin",this.tab.dom.innerHTML,!1),this.dragEl.dom.className=this.tab.dom.className;var i=this.tabpanel.el.getWidth(),n=this.tabpanel.el.getX(),o=this.tab.getX(),a=o-n,o=n+i-o-this.tab.getWidth();this.resetConstraints(),this.setXConstraint(a,o)},onDragOver:function(e,t){e.stopEvent();var i=Ext.get(t[0].id),n=i.getWidth(),o=i.getX(),a=o+n/2,e=this.tab.getX(),t=this.proxyWrapper.getX(),n=this.proxyWrapper.getWidth();t<o&&a<t+n&&i.next()!=this.tab&&(i.applyStyles("visibility:hidden;"),this.tab.insertAfter(i),this.targetProxy=this.createSliderProxy(o,i),this.targetProxy.hasActiveFx()||this.animateSliderProxy(i,this.targetProxy,e)),o<t&&t<a&&this.tab.next()!=i&&(i.applyStyles("visibility:hidden;"),this.tab.insertBefore(i),this.targetProxy=this.createSliderProxy(o,i),this.targetProxy.hasActiveFx()||this.animateSliderProxy(i,this.targetProxy,e))},animateSliderProxy:function(e,t,i){t.shift({x:i,easing:"easeOut",duration:this.slideDuration,callback:function(){t.remove(),e.applyStyles("visibility:visible;")},scope:this})},createSliderProxy:function(e,t){e=Ext.getBody().insertHtml("afterBegin",'<div class="tab-proxy" style="position:absolute;visibility:visible;z-index:999;left:'+e+'px;"></div>',!0);e.stripWrapper=e.insertHtml("afterBegin",'<div class="x-tab-strip x-tab-strip-top"></div>',!0),e.dragEl=e.stripWrapper.insertHtml("afterBegin","<div></div>",!0),e.dragEl.update(t.dom.innerHTML),e.dragEl.dom.className=t.dom.className;t=parseInt(t.getTop(!1));return e.setTop(t),e},onDragDrop:function(e,t){e.stopEvent()},endDrag:function(e){var t=this.tab.getX();this.proxyWrapper.applyStyles("visibility:visible;"),this.proxyWrapper.shift({x:t,easing:"easeOut",duration:this.slideDuration,callback:function(){this.proxyWrapper.applyStyles("visibility:hidden;"),this.tab.applyStyles("visibility:visible;"),this.stripWrap.remove(),this.dragEl.remove(),this.targetProxy&&(this.targetProxy.stripWrapper.remove(),this.targetProxy.dragEl.remove())},scope:this}),Ext.dd.DDM.useCache=!0,this.reorderTab(),this.tabpanel.fireEvent("endDrag",this.tabpanel,this.tabpanel.getActiveTab())},reorderTab:function(){for(var e=this.tabpanel.header.child("ul").dom.children,t=[],i=[],n=0;n<e.length;n++)e[n].id.substr(0,this.tabpanel.id.length)==this.tabpanel.id&&t.push(e[n].id.substr(this.tabpanel.id.length+2,e[n].id.length));for(n=0;n<this.tabpanel.items.items.length;n++)i[this.tabpanel.items.items[n].id]=this.tabpanel.items.items[n];for(n=0;n<t.length;n++)this.tabpanel.items.keys[n]=t[n],this.tabpanel.items.items[n]=i[t[n]]}}),Ext.ux.UserNotes=Ext.extend(Ext.Button,{originalTitle:_("Notes (<b>{0}</b>)"),text:String.format(_("Notes (<b>{0}</b>)"),"-"),initComponent:function(){Ext.ux.UserNotes.superclass.initComponent.apply(this),Ext.apply(this,{iconCls:"iconUserNotes",id:this.fid+"-userNotes",menu:new Ext.menu.Menu({showSeparator:!1,allowOtherMenus:!0,plain:!0,autoHeight:!0,forceLayout:!0,enableScrolling:!1,items:[{xtype:"grid",loadMask:!0,width:500,height:200,contextMenuFrom:!1,contextMenuRowIndex:!1,sm:new Ext.grid.RowSelectionModel({singleSelect:!0}),winNotes:new Ext.Window({scope:this,title:_("Add a new note"),iconCls:"iconUserNotes",closeAction:"hide",width:600,height:300,layout:"form",hideLabel:!0,modal:!0,items:[{xtype:"htmleditor",hideLabel:!0,enableLinks:!1,anchor:"100%"}],listeners:{show:function(e){e.items.items[0].setValue("")}},buttons:[{text:_("Add"),handler:function(){var e=this.ownerCt.ownerCt.scope,t=this.ownerCt.ownerCt;e.menu.show(e.el);var i=this.ownerCt.ownerCt.items.items[0].getValue();XHR({scope:this,params:{task:"addUserNote",file:e.file,note:i},success:function(){t.hide(),e.menu.items.items[0].store.reload(),PhDOE.notify("info",_("Note added"),_("The note was added successfully !"))},failure:function(){PhDOE.winForbidden()}})}},{text:_("Cancel"),handler:function(){var e=this.ownerCt.ownerCt.scope;e.menu.show(e.el),this.ownerCt.ownerCt.hide()}}]}),contextMenu:new Ext.menu.Menu({scope:this,listeners:{show:function(e){var t;"containercontextmenu"===this.scope.menu.items.items[0].contextMenuFrom?this.items.items[2].disable():(t=(t=this.scope.menu.items.items[0]).store.getAt(t.contextMenuRowIndex).data.user,PhDOE.userLogin==t?this.items.items[2].enable():this.items.items[2].disable()),"anonymous"==PhDOE.userLogin&&(this.items.items[0].disable(),this.items.items[2].disable())}},items:[{text:_("Add a new note"),iconCls:"iconUserNotes",handler:function(){this.ownerCt.scope.menu.items.items[0].winNotes.show()}},"-",{text:_("Delete this note"),iconCls:"iconDelete",handler:function(){var t=this.ownerCt.scope.menu.items.items[0];XHR({scope:this,params:{task:"delUserNote",noteID:t.store.getAt(t.contextMenuRowIndex).data.id},success:function(e){e=Ext.util.JSON.decode(e.responseText);t.store.reload(),e.result&&PhDOE.notify("info",_("Note deleted"),_("The note was deleted successfully !"))},failure:function(){PhDOE.winForbidden()}})}},"-",{text:_("Reload data"),iconCls:"iconRefresh",handler:function(){this.ownerCt.scope.menu.items.items[0].store.reload()}}]}),store:new Ext.data.Store({autoLoad:!0,proxy:new Ext.data.HttpProxy({url:"./do/getUserNotes"}),baseParams:{file:this.file},reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",idProperty:"id",fields:[{name:"id"},{name:"user"},{name:"note"},{name:"date",type:"date",dateFormat:"Y-m-d H:i:s"}]}),sortInfo:{field:"date",direction:"DESC"},listeners:{scope:this,datachanged:function(e){e=e.getCount();this.setText(String.format(this.originalTitle,e))}}}),listeners:{scope:this,rowclick:function(e){e.contextMenu.hidden||e.contextMenu.hide()},containercontextmenu:function(e,t){t.stopEvent(),e.getSelectionModel().clearSelections(),e.contextMenuFrom="containercontextmenu",e.contextMenu.showAt(t.getXY()),this.menu.show(this.el);t=this.menu.el.zindex+2e3;e.contextMenu.el.setStyle("z-index",t)},rowcontextmenu:function(e,t,i){i.stopEvent(),e.getSelectionModel().selectRow(t),e.contextMenuFrom="rowcontextmenu",e.contextMenuRowIndex=t,e.contextMenu.showAt(i.getXY()),this.menu.show(this.el);i=this.menu.el.zindex+2e3;e.contextMenu.el.setStyle("z-index",i)}},colModel:new Ext.grid.ColumnModel({defaults:{sortable:!0},columns:[{id:"user",header:_("By"),sortable:!0,dataIndex:"user"},{header:_("Date"),dataIndex:"date",renderer:Ext.util.Format.dateRenderer(_("Y-m-d, H:i"))}]}),autoExpandColumn:"user",viewConfig:{forceFit:!0,deferEmptyText:!1,emptyText:'<div style="text-align: center;">'+_("No user notes")+"<br><br>"+_("Right click to add a new note")+"</div>",enableRowBody:!0,getRowClass:function(e,t,i){return i.body='<p class="x-usernotes-content">'+e.data.note+"</p>","x-grid3-row-expanded"}}}]})})}}),Ext.reg("usernotes",Ext.ux.UserNotes),Ext.namespace("ui","ui.task"),ui.task.ChangeFileOwner=function(e){Ext.apply(this,e);var t=Ext.MessageBox.wait(_("Saving data..."));XHR({scope:this,params:{task:"setFileOwner",fileIdDB:this.fileIdDB,newOwnerID:this.newOwnerID},success:function(e){Ext.util.JSON.decode(e.responseText);ui.cmp.WorkTreeGrid.getInstance().getRootNode().reload(function(){ui.cmp.PatchesTreeGrid.getInstance().getRootNode().reload()}),ui.cmp.PortletInfo.getInstance().store.reload(),t.hide(),Ext.isDefined(this.fromType)&&"tab"===this.fromType&&Ext.getCmp("main-panel").remove(this.from.curTab),this.from.close(),PhDOE.notify("info",_("Owner changed"),_("The owner for this file have been changed successfully !"))},failure:function(e){e=Ext.util.JSON.decode(e.responseText);t.hide(),PhDOE.winForbidden(e.type),Ext.isDefined(this.fromType)&&"tab"===this.fromType&&Ext.getCmp("main-panel").remove(this.from.curTab),this.from.close()}})},Ext.namespace("ui","ui.task","ui.task._CheckBuildTask"),ui.task._CheckBuildTask.display=function(){XHR({params:{task:"getLogFile",file:"project_"+PhDOE.project+"_log_check_build_"+PhDOE.user.lang},success:function(e){e=Ext.util.JSON.decode(e.responseText);Ext.getBody().unmask(),ui.task.PingTask.getInstance().delay(3e4),Ext.getCmp("main-panel").findById("check_build_panel_"+PhDOE.user.lang)&&Ext.getCmp("main-panel").remove("check_build_panel_"+PhDOE.user.lang),Ext.getCmp("main-panel").add({xtype:"panel",id:"check_build_panel_"+PhDOE.user.lang,title:String.format(_("Check build result for {0}"),Ext.util.Format.uppercase(PhDOE.user.lang)),tabTip:String.format(_("Check build result for the documentation {0}"),Ext.util.Format.uppercase(PhDOE.user.lang)),closable:!0,autoScroll:!0,iconCls:"iconCheckBuild",html:'<div class="check-build-content">'+e.mess+"</div>"}),Ext.getCmp("main-panel").setActiveTab("check_build_panel_"+PhDOE.user.lang)}})},ui.task._CheckBuildTask.poll=new Ext.util.DelayedTask(function(){XHR({params:{task:"checkLockFile",lockFile:"project_"+PhDOE.project+"_lock_check_build_"+PhDOE.user.lang},success:function(){ui.task._CheckBuildTask.poll.delay(5e3)},failure:function(e){e=Ext.util.JSON.decode(e.responseText);e&&!1===e.success?new ui.task._CheckBuildTask.display:ui.task._CheckBuildTask.poll.delay(5e3)}})}),ui.task.CheckBuildTask=function(){Ext.getBody().mask('<img src="themes/img/loading.gif" style="vertical-align: middle;" /> '+_("Please, wait until the build is checked...")),ui.task.PingTask.getInstance().cancel(),XHR({params:{task:"checkBuild",xmlDetails:Ext.getCmp("option-xml-details").checked},success:function(){new ui.task._CheckBuildTask.display},failure:function(e){e=Ext.util.JSON.decode(e.responseText);e&&!1===e.success?(ui.task.PingTask.getInstance().delay(3e4),Ext.getBody().unmask(),PhDOE.winForbidden(e.type)):ui.task._CheckBuildTask.poll.delay(5e3)}})},Ext.namespace("ui","ui.task","ui.task._CheckEntitiesTask"),ui.task._CheckEntitiesTask.display=function(){BtnViewResult=Ext.getCmp("btn-check-entities-view-last-result"),Ext.getBody().unmask(),ui.task.PingTask.getInstance().delay(3e4),Ext.getCmp("main-panel").findById("tab-check-entities")&&Ext.getCmp("main-panel").remove("tab-check-entities"),BtnViewResult.handler.call(BtnViewResult.scope||BtnViewResult,BtnViewResult)},ui.task._CheckEntitiesTask.poll=new Ext.util.DelayedTask(function(){XHR({params:{task:"checkLockFile",lockFile:"project_"+PhDOE.project+"_lock_check_entities"},success:function(){ui.task._CheckEntitiesTask.poll.delay(5e3)},failure:function(e){e=Ext.util.JSON.decode(e.responseText);e&&!1===e.success?new ui.task._CheckEntitiesTask.display:ui.task._CheckEntitiesTask.poll.delay(5e3)}})}),ui.task.CheckEntitiesTask=function(){Ext.getBody().mask('<img src="themes/img/loading.gif" style="vertical-align: middle;" /> '+_("Please, wait until entities are checked...")),ui.task.PingTask.getInstance().cancel(),XHR({params:{task:"checkEntities"},success:function(){new ui.task._CheckEntitiesTask.display},failure:function(e){e=Ext.util.JSON.decode(e.responseText);e&&!1===e.success?(ui.task.PingTask.getInstance().delay(3e4),Ext.getBody().unmask(),PhDOE.winForbidden()):ui.task._CheckEntitiesTask.poll.delay(5e3)}})},Ext.namespace("ui","ui.task"),ui.task.CheckFileTask=function(e){Ext.apply(this,e),ui.task.PingTask.getInstance().cancel(),Ext.getBody().mask('<img src="themes/img/loading.gif" style="vertical-align: middle;" /> '+_("Checking for error. Please, wait...")),XHR({scope:this,params:{task:"checkFileError",FilePath:this.fpath,FileName:this.fname,FileLang:this.lang,FileContent:Ext.getCmp(this.prefix+"-"+this.ftype+"-FILE-"+this.fid).getValue()},failure:function(){ui.task.PingTask.getInstance().delay(3e4),Ext.getBody().unmask(),Ext.MessageBox.alert(_("Error"),_("An error occured while checking this file for errors. Please, try again."))},success:function(e){ui.task.PingTask.getInstance().delay(3e4),Ext.getBody().unmask();e=Ext.util.JSON.decode(e.responseText);e.error&&"-No error-"!==e.error_first?(Ext.getCmp("main-panel").add({id:"FE-help-"+this.fid,title:"Error in "+this.fname,iconCls:"iconFilesError",closable:!0,autoScroll:!0,autoLoad:"./error?dir="+this.fpath+"&file="+this.fname}),Ext.getCmp("main-panel").setActiveTab("FE-help-"+this.fid)):Ext.MessageBox.show({title:_("Check for errors"),msg:_("There is no error."),buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO}),new ui.task.SaveFileTask({prefix:this.prefix,ftype:this.ftype,fid:this.fid,fpath:this.fpath,fname:this.fname,lang:this.lang,storeRecord:this.storeRecord}),"FE"===this.prefix&&Ext.getCmp("FE-error-desc-"+this.fid).body.updateManager.refresh(),ui.cmp.ErrorFileGrid.getInstance().store.reload()}})},Ext.namespace("ui","ui.task"),ui.task.CheckXml=function(e){Ext.apply(this,e);this.prefix,this.ftype;var t=Ext.MessageBox.wait(_("XML check. Please, wait..."));XHR({scope:this,params:{task:"checkXml",fileContent:Ext.getCmp(this.idPrefix+"-FILE-"+this.fid).getValue()},success:function(e){e=Ext.util.JSON.decode(e.responseText);t.hide(),"no_error"!==e.errors?new ui.cmp.CheckXmlWin({errors:e.errors}):PhDOE.notify("info",_("XML check"),_("There is no error."))},failure:function(e){Ext.util.JSON.decode(e.responseText);t.hide()}})},Ext.namespace("ui","ui.task"),ui.task.ClearLocalChangeTask=function(e){Ext.apply(this,e);var i=this.ftype,n=this.fpath,o=this.fname;goClear=function(){Ext.getBody().mask('<img src="themes/img/loading.gif" style="vertical-align: middle;" /> '+_("Please, wait..."));for(var e=["FNT","FNU","FE","FNR","FNIEN","AF"],t=0;t<e.length;t++)Ext.getCmp("main-panel").findById(e[t]+"-"+Ext.util.md5(e[t]+"-"+n+o))&&Ext.getCmp("main-panel").remove(e[t]+"-"+Ext.util.md5(e[t]+"-"+n+o));XHR({params:{task:"clearLocalChange",FileType:i,FilePath:n,FileName:o},success:function(e){var t=Ext.util.JSON.decode(e.responseText);if(ui.cmp.WorkTreeGrid.getInstance().delRecord(t.oldIdDB),ui.cmp.PatchesTreeGrid.getInstance().delRecord(t.oldIdDB),e=!1,(e=ui.cmp.RepositoryTree.getInstance().getNodeById("/"+n+o))&&e.getUI().removeClass(["fileModifiedByMe","fileModifiedByAnother"]),"en"===t.lang&&"update"===i)return ui.cmp.StaleFileGrid.getInstance().store.each(function(e){e.data.path==="/"+t.path&&e.data.name===t.name&&(e.set("fileModifiedEN",!1),e.set("en_revision",t.revision),e.commit())},this),ui.cmp.ErrorFileGrid.getInstance().store.each(function(e){PhDOE.user.lang+e.data.path===n&&e.data.name===o&&e.set("fileModifiedEN",!1)},this),void Ext.getBody().unmask();ui.cmp.PendingTranslateGrid.getInstance().store.each(function(e){PhDOE.user.lang+e.data.path===n&&e.data.name===o&&(e.set("fileModified",!1),e.commit())},this),ui.cmp.StaleFileGrid.getInstance().store.each(function(e){PhDOE.user.lang+e.data.path===n&&e.data.name===o&&(e.set("fileModifiedLang",!1),e.set("revision",t.revision),e.set("maintainer",t.maintainer),e.commit())},this),ui.cmp.ErrorFileGrid.getInstance().store.each(function(e){PhDOE.user.lang+e.data.path===n&&e.data.name===o&&(e.set("fileModifiedLang",!1),e.commit())},this),ui.cmp.PendingReviewGrid.getInstance().store.each(function(e){PhDOE.user.lang+e.data.path===n&&e.data.name===o&&(e.set("fileModifiedLang",!1),e.commit())},this),ui.cmp.NotInENGrid.getInstance().store.each(function(e){PhDOE.user.lang+e.data.path===n&&e.data.name===o&&e.set("fileModified",!1)},this),Ext.getBody().unmask()},failure:function(e){Ext.getBody().unmask();e=Ext.util.JSON.decode(e.responseText);e.err&&PhDOE.winForbidden(e.err)}})},Ext.isDefined(this.noConfirm)?goClear():Ext.MessageBox.confirm(_("Confirm"),_("This action will clear your local modification and take back this file from his original stats.<br/>You need confirm."),function(e){"yes"===e&&goClear()},this)},Ext.namespace("ui","ui.task"),ui.task.DeletePatchTask=function(e){Ext.apply(this,e),Ext.getBody().mask('<img src="themes/img/loading.gif" style="vertical-align: middle;" /> '+_("Please, wait...")),XHR({scope:this,params:{task:"deletePatch",patchID:this.patchID},success:function(){Ext.getBody().unmask(),ui.cmp.PatchesTreeGrid.getInstance().deletePatch(this.patchID),PhDOE.notify("info",_("Patch deleted"),_("The patch have been deleted !"))},failure:function(e){e=Ext.util.JSON.decode(e.responseText);Ext.getBody().unmask(),e.err?PhDOE.winForbidden(e.err):PhDOE.winForbidden()}})},Ext.namespace("ui","ui.task"),ui.task.GetBingTranslation=function(e){Ext.apply(this,e),Ext.get("BingTranslate-result").dom.innerHTML="",Ext.getCmp("BingTranslate-btn").disable(),Ext.getCmp("BingTranslate-btn").setText(_("Please, wait...")),XHR({scope:this,params:{task:"getBingTranslation",str:this.str},success:function(e){e=Ext.util.JSON.decode(e.responseText);Ext.get("BingTranslate-result").dom.innerHTML=Ext.util.Format.htmlEncode(e.translation),Ext.getCmp("BingTranslate-btn").setText(_("Translate !")),Ext.getCmp("BingTranslate-btn").enable()}})},Ext.namespace("ui","ui.task"),ui.task.GetFileInfoByXmlID=function(e){Ext.apply(this,e),XHR({scope:this,params:{task:"getFileInfoByXmlID",xmlID:this.xmlID},success:function(e){e=Ext.util.JSON.decode(e.responseText);ui.cmp.RepositoryTree.getInstance().openFile("byPath",e.lang+e.path,e.name)}})},Ext.namespace("ui","ui.task"),ui.task.GetFileTask=function(e){Ext.apply(this,e);var s=this.prefix+"-"+this.ftype,l=!!this.original,t="GGTRANS"===this.ftype,e="NEW"===this.ftype&&this.skeleton;Ext.get(s+"-PANEL-"+this.fid).mask('<img src="themes/img/loading.gif" style="vertical-align: middle;" /> '+_("Loading...")),XHR({scope:this,params:{task:"getFile",FilePath:this.fpath,FileName:this.fname,readOriginal:l,ggTranslate:t,skeleton:e},success:function(e){var t,i=Ext.util.JSON.decode(e.responseText),n='<a href="'+("http://"+window.location.host+":"+window.location.port+window.location.pathname+"?perm=/"+this.fpath.split("/")[0]+"/"+i.xmlid.split("|")[0]+".php&project="+PhDOE.project)+'" target="_blank"><img src="themes/img/anchor.png" alt="permlink" style="vertical-align: middle;" ext:qtip="'+_("Permanent link to this page")+'" /></a>&nbsp;',o=Ext.getCmp(s+"-PANEL-"+this.fid),a=Ext.get(s+"-PANEL-"+this.fid),r=Ext.getCmp(s+"-FILE-"+this.fid),e=!!i.fileModified&&Ext.util.JSON.decode(i.fileModified);a.unmask(),"PP"===this.prefix||"TRANS"===this.ftype||"FNIEN"===this.prefix?o.permlink="":"GGTRANS"===this.ftype?(o.setTitle(o.originTitle),o.setIconClass("iconGoogle")):(o.permlink="NULL"!==i.xmlid?n:"",o.setTitle(o.permlink+o.originTitle)),r.setValue(i.content),"GGTRANS"===this.ftype&&r.reIndentAll(),i.warn_tab&&!this.freadOnly&&(Ext.MessageBox.show({title:_("Warning"),msg:String.format(_("The file <b> {0}</b> contains some tab characters.<br>The editor have replace it with space characters."),this.fpath+this.fname),buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.WARNING}),r.fireEvent("codemodified"),r.documentDurty=!0),i.warn_encoding&&!this.freadOnly&&(Ext.MessageBox.show({title:_("Warning"),msg:String.format(_("The editor have modified automatically the file {0} into UTF-8 encoding."),this.fpath+this.fname),buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.WARNING}),r.setLine(1,'<?xml version="1.0" encoding="utf-8"?>'),Ext.getCmp(s+"-FILE-"+this.fid+"-btn-save").enable()),"FNT"!==this.prefix&&"FNIEN"!==this.prefix||(t="fileModified"),"FNU"===this.prefix&&(t="LANG"===this.ftype?"fileModifiedLang":"fileModifiedEN"),"FE"===this.prefix&&(t="LANG"===this.ftype?"fileModifiedLang":"fileModifiedEN"),"FNR"===this.prefix&&(t="LANG"===this.ftype?"fileModifiedLang":"fileModifiedEN"),i.fileModified&&"AF"!==this.prefix&&!l&&(this.storeRecord.set(t,i.fileModified),this.storeRecord.commit()),"AF"===this.prefix&&(this.storeRecord.data={},this.storeRecord.data.fileModified=!1,i.fileModified&&(this.storeRecord.data.fileModified=i.fileModified)),i.fileModified&&!l&&PhDOE.user.userID!==e.userID?PhDOE.user.haveKarma&&"workInProgress"===e.fromModule?Ext.MessageBox.show({title:_("Information"),msg:String.format(_("File modified by {0} but you are an authenticated user, so you can modify it."),e.user),buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO}):!e.haveKarma&&PhDOE.user.haveKarma&&"PatchesForReview"===e.fromModule?new ui.cmp.AnonymousPatchWin({fidDB:e.fidDB,fid:this.fid,prefix:this.prefix,ftype:e.ftype,fpath:this.fpath,fname:this.fname,curTab:Ext.getCmp(this.prefix+"-"+this.fid)}):(this.freadOnly||(Ext.getCmp(s+"-FILE-"+this.fid+"-grp-save").disable(),Ext.getCmp(s+"-FILE-"+this.fid+"-grp-undoRedo").disable(),Ext.getCmp(s+"-FILE-"+this.fid+"-grp-tools").disable()),(e=Ext.MessageBox.show({title:_("Information"),msg:String.format(_("File modified by {0}."),e.user),buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO})).getDialog().mask.resize(a.getSize().width,a.getSize().height),e.getDialog().mask.alignTo(a.dom,"tl")):"FNT-TRANS"==s&&null==new RegExp("\x3c!-- EN-Revision:").exec(i.content)&&(Ext.isEmpty(r.getLine(1))&&r.removeLine(1),r.setLine(1,"\x3c!-- $Revision: $ --\x3e"),r.insertLine(1,"\x3c!-- EN-Revision: "+i.originalRev+" Maintainer: "+PhDOE.user.login+" Status: ready --\x3e"),r.insertLine(2,"\x3c!-- Reviewed: no --\x3e"),Ext.isEmpty(r.getLine(4))||r.insertLine(3,""),r.manageCodeChange())},callback:function(){var e=Ext.getCmp(this.prefix+"-"+this.fid);"FNT"===this.prefix&&("TRANS"===this.ftype&&(e.panTRANSLoaded=!0),"GGTRANS"!==this.ftype&&"EN"!==this.ftype||(e.panTRANSSecondLoaded=!0)),"FNU"===this.prefix&&("LANG"===this.ftype&&(e.panLANGLoaded=!0),"EN"===this.ftype&&(e.panENLoaded=!0)),"FE"===this.prefix&&("LANG"===this.ftype&&(e.panLANGLoaded=!0),"EN"===this.ftype&&(e.panENLoaded=!0)),"FNR"===this.prefix&&("LANG"===this.ftype&&(e.panLANGLoaded=!0),"EN"===this.ftype&&(e.panENLoaded=!0)),"FNIEN"===this.prefix&&(e.panLANGLoaded=!0),"AF"===this.prefix&&(e.panLoaded=!0),Ext.getCmp("main-panel").fireEvent("tabLoaded",this.prefix,this.fid)}})},Ext.namespace("ui","ui.task"),ui.task.GetGGTranslation=function(e){Ext.apply(this,e),Ext.get("GGTranslate-result").dom.innerHTML="",Ext.getCmp("GGTranslate-btn").disable(),Ext.getCmp("GGTranslate-btn").setText(_("Please, wait...")),XHR({scope:this,params:{task:"getGGTranslation",str:this.str},success:function(e){e=Ext.util.JSON.decode(e.responseText);Ext.get("GGTranslate-result").dom.innerHTML=Ext.util.Format.htmlEncode(e.translation),Ext.getCmp("GGTranslate-btn").setText(_("Translate !")),Ext.getCmp("GGTranslate-btn").enable()}})},Ext.namespace("ui","ui.task"),ui.task.LoadConfigTask=function(e){Ext.apply(this,e),XHR({params:{task:"getConf"},success:function(e){e=Ext.decode(e.responseText);PhDOE.user.login=e.mess.userLogin,PhDOE.user.userID=e.mess.userID,PhDOE.user.lang=e.mess.userLang,PhDOE.user.authService=e.mess.authService,PhDOE.user.authServiceID=e.mess.authServiceID,PhDOE.user.isAnonymous=e.mess.userIsAnonymous,PhDOE.user.haveKarma=e.mess.userHaveKarma,PhDOE.user.isGlobalAdmin=e.mess.userIsGlobalAdmin,PhDOE.user.isLangAdmin=e.mess.userIsLangAdmin,PhDOE.user.conf=e.mess.userConf,PhDOE.user.anonymousIdent=e.mess.userAnonymousIdent,PhDOE.project=e.mess.project,PhDOE.app.conf=e.mess.appConf,e.mess.topicInfo&&e.mess.topicInfo.lang&&(PhDOE.topic.lang.author=e.mess.topicInfo.lang.author,PhDOE.topic.lang.content=e.mess.topicInfo.lang.content,PhDOE.topic.lang.topicDate=Date.parseDate(e.mess.topicInfo.lang.topicDate,"Y-m-d H:i:s"),PhDOE.topic.lang.topicDate=PhDOE.topic.lang.topicDate.format(_("Y-m-d, H:i"))),e.mess.topicInfo&&e.mess.topicInfo.global&&(PhDOE.topic.global.author=e.mess.topicInfo.global.author,PhDOE.topic.global.content=e.mess.topicInfo.global.content,PhDOE.topic.global.topicDate=Date.parseDate(e.mess.topicInfo.global.topicDate,"Y-m-d H:i:s"),PhDOE.topic.global.topicDate=PhDOE.topic.global.topicDate.format(_("Y-m-d, H:i"))),Ext.get("appTheme").dom.href=PhDOE.user.conf.main.theme,PhDOE.user.conf.diff||(PhDOE.user.conf.diff={},PhDOE.user.conf.diff.displayPreviewPanel=!0),PhDOE.drawInterface()}})},Ext.namespace("ui","ui.task"),ui.task.MarkDeleteTask=function(e){Ext.apply(this,e),Ext.MessageBox.confirm(_("Confirm"),_("This action will mark this file as need deleted.<br/><br/>You need commit this change to take it effect.<br/><br/>Please, confirm this action."),function(e){"yes"===e&&(Ext.getBody().mask('<img src="themes/img/loading.gif" style="vertical-align: middle;" /> '+_("Please, wait...")),XHR({scope:this,params:{task:"markAsNeedDelete",FilePath:PhDOE.user.lang+this.fpath,FileName:this.fname},success:function(e){e=Ext.util.JSON.decode(e.responseText);Ext.getBody().unmask(),ui.cmp.WorkTreeGrid.getInstance().addRecord(e.id,PhDOE.user.lang+this.fpath,this.fname,"delete"),this.storeRecord.set("fileModified",'{"user":"'+PhDOE.user.login+'", "anonymousIdent":"'+PhDOE.user.anonymousIdent+'"}')}}))},this)},Ext.namespace("ui","ui.task"),ui.task.MoveToPatch=function(e){Ext.apply(this,e);var t=[];Ext.each(this.nodesToAdd,function(e){t.push(e.attributes.idDB)}),Ext.getBody().mask('<img src="themes/img/loading.gif" style="vertical-align: middle;" /> '+_("Please, wait...")),XHR({scope:this,params:{task:"moveToPatch",patchID:this.patchID,filesID:t.join(",")},success:function(){Ext.getBody().unmask(),ui.cmp.PatchesTreeGrid.getInstance().addToPatch(this.patchID,this.patchName,this.nodesToAdd,this.patchDescription,this.patchEmail),this.nodesToAdd&&Ext.each(this.nodesToAdd,function(e){ui.cmp.WorkTreeGrid.getInstance().delRecord(e.attributes.idDB)})},failure:function(e){e=Ext.util.JSON.decode(e.responseText);Ext.getBody().unmask(),Ext.MessageBox.alert(_("Error"),_(e.err))}})},Ext.namespace("ui","ui.task"),ui.task.MoveToWork=function(e){Ext.apply(this,e);var t=[];Ext.each(this.nodesToAdd,function(e){t.push(e.attributes.idDB)}),Ext.getBody().mask('<img src="themes/img/loading.gif" style="vertical-align: middle;" /> '+_("Please, wait...")),XHR({scope:this,params:{task:"moveToWork",filesID:t.join(",")},success:function(){Ext.getBody().unmask(),ui.cmp.WorkTreeGrid.getInstance().addToWork(this.nodesToAdd),this.nodesToAdd&&Ext.each(this.nodesToAdd,function(e){ui.cmp.PatchesTreeGrid.getInstance().delRecord(e.attributes.idDB)})},failure:function(e){e=Ext.util.JSON.decode(e.responseText);Ext.getBody().unmask(),Ext.MessageBox.alert("Error",e.err)}})},Ext.namespace("ui","ui.task","ui.task._PingTask"),ui.task.PingTask=function(){this.task=new Ext.util.DelayedTask(function(){XHR({scope:this,params:{task:"ping"},success:function(e){var t=Ext.util.JSON.decode(e.responseText);"pong"!==t.ping?this.onPingFailed():("en"!==PhDOE.user.lang&&(e=!1,ui.cmp.PendingTranslateGrid.getInstance().store.getTotalCount()!==t.totalData.NbPendingTranslate&&(ui.cmp.PendingTranslateGrid.getInstance().store.reload(),e=!0),ui.cmp.StaleFileGrid.getInstance().store.getTotalCount()!==t.totalData.NbPendingUpdate&&(ui.cmp.StaleFileGrid.getInstance().store.reload(),e=!0),ui.cmp.ErrorFileGrid.getInstance().store.getTotalCount()!==t.totalData.NbFilesError&&(ui.cmp.ErrorFileGrid.getInstance().store.reload(),e=!0),ui.cmp.PendingReviewGrid.getInstance().store.getTotalCount()!==t.totalData.NbPendingReview&&(ui.cmp.PendingReviewGrid.getInstance().store.reload(),e=!0),ui.cmp.NotInENGrid.getInstance().store.getTotalCount()!==t.totalData.NbNotInEn&&(ui.cmp.NotInENGrid.getInstance().store.reload(),e=!0),e&&ui.cmp.PortletSummary.getInstance().store.reload()),t.totalData.lastInfoDate!==PhDOE.lastInfoDate&&ui.cmp.PortletInfo.getInstance().store.reload(),t.totalData.topicInfo&&(t.totalData.topicInfo.topicDate=Date.parseDate(t.totalData.topicInfo.topicDate,"Y-m-d H:i:s"),t.totalData.topicInfo.topicDate=t.totalData.topicInfo.topicDate.format(_("Y-m-d, H:i")),t.totalData.topicInfo.topicDate!=PhDOE.topic.topicDate&&(PhDOE.topic.author=t.totalData.topicInfo.author,PhDOE.topic.content=t.totalData.topicInfo.content,PhDOE.topic.topicDate=t.totalData.topicInfo.topicDate,PhDOE.setTopic())),this.onUpdateData(t.updateData))},failure:function(){this.onPingFailed()}}),this.task.delay(3e4)},this)},ui.task.PingTask.prototype.delay=function(e,t,i,n){this.task.delay(e,t,i,n)},ui.task.PingTask.prototype.cancel=function(){this.task.cancel()},ui.task.PingTask.prototype.onPingFailed=function(){this.cancel();var e=new Ext.ux.Notification({iconCls:"iconError",title:_("Connection lost"),html:String.format(_("Retrying in {0} second(s)."),"30"),autoDestroy:!1});e.show(document),this.delay(3e4);var t=29,i=new Ext.util.DelayedTask(function(){0<t?(e.setMessage(String.format(_("Retrying in {0} second(s)."),t)),--t,i.delay(1e3)):0==t&&e.animHide()});i.delay(1e3)},ui.task.PingTask.prototype.onUpdateData=function(e){var t;if(e){switch(e){case"vcs_update":t=_("1/8 - VCS update");break;case"cleanUp_DB":t=_("2/8 - Cleaning the database");break;case"revcheck":t=_("3/8 - Apply the revcheck");break;case"checkErrors":t=_("4/8 - Check for errors");break;case"notInEN":t=_("5/8 - Searching for files that are not in EN");break;case"updateTranslatorInfo":t=_("6/8 - Update translators info");break;case"ComputeAllStatistics":t=_("7/8 - Compute all statistics");break;case"StaticRevcheck":t=_("8/8 - Generate statics revcheck's pages")}PhDOE.updateDataProgress||(PhDOE.updateDataProgress=new Ext.Window({title:_("Update in progress"),iconCls:"iconLoading",layout:"border",width:400,height:130,closable:!1,plain:!0,border:!1,modal:!0,resizable:!1,draggable:!1,items:[{region:"center",xtype:"container",height:90,id:"win-global-update-info",html:_("There is a global update in progress.<br/>Please, wait...<br/><br/><em>This window will close automatically at the end of the process</em>"),margins:"10 10 10 10"},{region:"south",xtype:"panel",plain:!0,height:22,items:[{xtype:"progress",width:386,text:t}]}]}),PhDOE.updateDataProgress.items.items[1].items.items[0].wait({interval:200,increment:15,animate:!0})),PhDOE.updateDataProgress.show(),PhDOE.updateDataProgress.items.items[1].items.items[0].updateText(t)}else PhDOE.updateDataProgress&&PhDOE.updateDataProgress.hide()},ui.task._PingTask.instance=null,ui.task.PingTask.getInstance=function(){return ui.task._PingTask.instance||(ui.task._PingTask.instance=new ui.task.PingTask),ui.task._PingTask.instance},Ext.namespace("ui","ui.task"),ui.task.SaveFileTask=function(e){Ext.apply(this,e);var t=this.prefix+"-"+this.ftype,i=Ext.MessageBox.wait(_("Saving data...")),n=Ext.getCmp(this.prefix+"-"+this.ftype+"-FILE-"+this.fid).getValue();XHR({scope:this,params:{task:"saveFile",filePath:this.fpath,fileName:this.fname,fileLang:this.lang,fileContent:n},success:function(e){e=Ext.util.JSON.decode(e.responseText);"FNU"===this.prefix&&("EN"===this.ftype?(this.storeRecord.set("en_revision",e.revision),this.storeRecord.set("fileModified",'{"user":"'+PhDOE.user.login+'", "anonymousIdent":"'+PhDOE.user.anonymousIdent+'"}')):(this.storeRecord.set("revision",e.en_revision),this.storeRecord.set("fileModified",'{"user":"'+PhDOE.user.login+'", "anonymousIdent":"'+PhDOE.user.anonymousIdent+'"}'),this.storeRecord.set("maintainer",e.maintainer)),this.storeRecord.commit()),"FE"===this.prefix&&("EN"===this.ftype||this.storeRecord.set("maintainer",e.maintainer),this.storeRecord.set("fileModified",'{"user":"'+PhDOE.user.login+'", "anonymousIdent":"'+PhDOE.user.anonymousIdent+'"}'),this.storeRecord.commit()),"FNR"===this.prefix&&("EN"===this.ftype?this.storeRecord.set("reviewed",e.reviewed):(this.storeRecord.set("reviewed",e.reviewed),this.storeRecord.set("maintainer",e.reviewed_maintainer)),this.storeRecord.set("fileModified",'{"user":"'+PhDOE.user.login+'", "anonymousIdent":"'+PhDOE.user.anonymousIdent+'"}'),this.storeRecord.commit()),"AF"===this.prefix&&this.storeRecord.getUI().addClass("fileModifiedByMe"),Ext.getCmp(this.prefix+"-"+this.ftype+"-FILE-"+this.fid).setOriginalContent(n),ui.cmp.WorkTreeGrid.getInstance().delRecord(e.id),ui.cmp.PatchesTreeGrid.getInstance().delRecord(e.id),ui.cmp.WorkTreeGrid.getInstance().addRecord(e.id,this.lang+this.fpath,this.fname,"update"),Ext.getCmp(t+"-FILE-"+this.fid+"-btn-save").disable(),Ext.getCmp(t+"-FILE-"+this.fid).isModified=!1,Ext.getCmp(this.prefix+"-"+this.fid).isModified=!1,Ext.getCmp(t+"-PANEL-"+this.fid).setTitle(Ext.getCmp(t+"-PANEL-"+this.fid).permlink+Ext.getCmp(t+"-PANEL-"+this.fid).originTitle),e="en"===this.lang?Ext.getCmp(this.prefix+"-LANG-FILE-"+this.fid):Ext.getCmp(this.prefix+"-EN-FILE-"+this.fid),"ALL"!==this.ftype&&e.isModified||Ext.getCmp(this.prefix+"-"+this.fid).setTitle(Ext.getCmp(this.prefix+"-"+this.fid).originTitle),i.hide(),PhDOE.notify("info",_("Document saved"),String.format(_("Document <br><br><b>{0}</b><br><br> was saved successfully !"),this.lang+this.fpath+this.fname))},failure:function(e){var t=Ext.util.JSON.decode(e.responseText);i.hide(),t.XmlError&&"no_error"!=t.XmlError&&Ext.MessageBox.alert(_("XML Errors"),_("There is somes XML's errors.<br /><br />You must fix it before saving this file.<br /><br />Valid this window to show this errors."),function(){new ui.cmp.CheckXmlWin({errors:t.XmlError})}),t.type&&PhDOE.winForbidden(t.type)}})},Ext.namespace("ui","ui.task"),ui.task.SaveTransFileTask=function(e){Ext.apply(this,e);var t=this.prefix+"-"+this.ftype,i=Ext.MessageBox.wait(_("Saving data...")),n=Ext.getCmp(this.prefix+"-"+this.ftype+"-FILE-"+this.fid).getValue();XHR({scope:this,params:{task:"saveFile",type:"trans",filePath:this.fpath,fileName:this.fname,fileLang:this.lang,fileContent:n},success:function(e){e=Ext.util.JSON.decode(e.responseText);"NEW"!=this.ftype?(this.storeRecord.set("fileModified",'{"user":"'+PhDOE.user.login+'", "anonymousIdent":"'+PhDOE.user.anonymousIdent+'"}'),this.storeRecord.commit()):this.storeRecord.data.node.reload(),Ext.getCmp(this.prefix+"-"+this.ftype+"-FILE-"+this.fid).setOriginalContent(n),ui.cmp.WorkTreeGrid.getInstance().addRecord(e.id,this.lang+this.fpath,this.fname,"new"),Ext.getCmp(t+"-FILE-"+this.fid+"-btn-save").disable(),Ext.getCmp(t+"-FILE-"+this.fid).isModified=!1,Ext.getCmp(this.prefix+"-"+this.fid).isModified=!1,Ext.getCmp(t+"-PANEL-"+this.fid).setTitle(Ext.getCmp(t+"-PANEL-"+this.fid).originTitle),Ext.getCmp(this.prefix+"-"+this.fid).setTitle(Ext.getCmp(this.prefix+"-"+this.fid).originTitle),i.hide(),PhDOE.notify("info",_("Document saved"),String.format(_("Document <br><br><b>{0}</b><br><br> was saved successfully !"),this.lang+this.fpath+this.fname))},failure:function(e){var t=Ext.util.JSON.decode(e.responseText);i.hide(),t.XmlError&&"no_error"!=t.XmlError&&Ext.MessageBox.alert(_("XML Errors"),_("There is somes XML's errors.<br /><br />You must fix it before saving this file.<br /><br />Valid this window to show this errors."),function(){new ui.cmp.CheckXmlWin({errors:t.XmlError})}),t.type&&PhDOE.winForbidden(t.type)}})},Ext.namespace("ui","ui.task"),ui.task.SetFileProgressTask=function(e){Ext.apply(this,e),XHR({scope:this,params:{task:"SetFileProgress",idDB:this.idDB,progress:this.progress},failure:function(e){var t,e=Ext.util.JSON.decode(e.responseText);e.err&&("file_dont_exist_in_workInProgress"==e.err&&(t=_("The file you want to change the estimated progress don't exist into the database.")),"file_isnt_owned_by_current_user"==e.err&&(t=_("The file you want to change the estimated progress isn't own by you.<br>You only can modify this information for yours files."))),t&&PhDOE.notify("error",_("Error"),t)}})},Ext.namespace("ui","ui.task"),ui.task.setTopicTask=function(e){Ext.apply(this,e);var i=this.isLang;XHR({scope:this,params:{task:"setTopic",content:this.content,lang:i?"lang":"global"},success:function(e){var t=Ext.util.JSON.decode(e.responseText),e=PhDOE.topic[i?"lang":"global"];e.author=t.author,e.content=t.content,e.topicDate=Date.parseDate(t.topicDate,"Y-m-d H:i:s"),e.topicDate=e.topicDate.format(_("Y-m-d, H:i")),PhDOE.setTopic(i)}})},Ext.namespace("ui","ui.task","ui.task._SystemUpdateTask"),ui.task._SystemUpdateTask.refresh_ui=function(){Ext.get("wizard-step-3").replaceClass("wizard-step-before","wizard-step-working"),PhDOE.reloadAllStore(),Ext.get("wizard-step-3").replaceClass("wizard-step-working","wizard-step-done"),Ext.getCmp("btn-start-refresh").setIconClass("iconFinishRefresh"),Ext.getCmp("btn-start-refresh").setText(_("Finish !")),Ext.getCmp("btn-start-refresh").setHandler(function(){Ext.getCmp("sys-update-win").close()}),Ext.getCmp("btn-start-refresh").enable(),ui.task.PingTask.getInstance().delay(3e4),Ext.getCmp("sys-update-win").tools.close.setVisible(!0)},ui.task._SystemUpdateTask.poll_apply_tool=new Ext.util.DelayedTask(function(){XHR({params:{task:"checkLockFile",lockFile:"project_"+PhDOE.project+"_lock_apply_tools"},success:function(){ui.task._SystemUpdateTask.poll_apply_tool.delay(5e3)},failure:function(e){e=Ext.util.JSON.decode(e.responseText);e&&!1===e.success?(Ext.get("wizard-step-2").replaceClass("wizard-step-working","wizard-step-done"),new ui.task._SystemUpdateTask.refresh_ui):ui.task._SystemUpdateTask.poll_apply_tool.delay(5e3)}})}),ui.task._SystemUpdateTask.apply_tool=function(){Ext.get("wizard-step-2").replaceClass("wizard-step-before","wizard-step-working"),XHR({params:{task:"applyTools"},success:function(){Ext.get("wizard-step-2").replaceClass("wizard-step-working","wizard-step-done"),new ui.task._SystemUpdateTask.refresh_ui},failure:function(){ui.task._SystemUpdateTask.poll_apply_tool.delay(5e3)}})},ui.task._SystemUpdateTask.vcs_poll=new Ext.util.DelayedTask(function(){XHR({params:{task:"checkLockFile",lockFile:"project_"+PhDOE.project+"_lock_update_repository"},success:function(){ui.task._SystemUpdateTask.vcs_poll.delay(5e3)},failure:function(e){e=Ext.util.JSON.decode(e.responseText);e&&!1===e.success?(Ext.get("wizard-step-1").replaceClass("wizard-step-working","wizard-step-done"),Ext.get("wizard-step-1.1").replaceClass("wizard-show","wizard-wait"),new ui.task._SystemUpdateTask.apply_tool):ui.task._SystemUpdateTask.vcs_poll.delay(5e3)}})}),ui.task.SystemUpdateTask=function(){ui.task.PingTask.getInstance().cancel(),Ext.get("wizard-step-1").replaceClass("wizard-step-before","wizard-step-working"),Ext.get("wizard-step-1.1").replaceClass("wizard-wait","wizard-show"),XHR({params:{task:"updateRepository"},success:function(){Ext.get("wizard-step-1").replaceClass("wizard-step-working","wizard-step-done"),Ext.get("wizard-step-1.1").replaceClass("wizard-show","wizard-wait"),new ui.task._SystemUpdateTask.apply_tool},failure:function(e){e=Ext.util.JSON.decode(e.responseText);e&&!1===e.success?(Ext.getCmp("sys-update-win").close(),PhDOE.winForbidden(e.type)):ui.task._SystemUpdateTask.vcs_poll.delay(5e3)}})},Ext.namespace("ui","ui.task"),ui.task.UpdateConfTask=function(e){Ext.apply(this,e),XHR({scope:this,params:{task:"confUpdate",module:this.module,itemName:this.itemName,value:this.value},success:function(){PhDOE.user.conf[this.module][this.itemName]=this.value,"newFile"==this.module&&"nbDisplay"==this.itemName&&ui.cmp.PendingTranslateGrid.getInstance().store.reload(),"needUpdate"==this.module&&"nbDisplay"==this.itemName&&ui.cmp.StaleFileGrid.getInstance().store.reload(),"error"!=this.module||"skipNbLiteralTag"!=this.itemName&&"nbDisplay"!=this.itemName||ui.cmp.ErrorFileGrid.getInstance().store.reload(),"reviewed"==this.module&&"nbDisplay"==this.itemName&&ui.cmp.PendingReviewGrid.getInstance().store.reload(),"main"==this.module&&"displayENWork"==this.itemName&&ui.cmp.WorkTreeGrid.getInstance().getRootNode().reload(function(){ui.cmp.PatchesTreeGrid.getInstance().getRootNode().reload()}),!1!==this.notify&&PhDOE.notify("info",_("Option saved"),_("Option has been saved successfully !"))}})},Ext.namespace("ui","ui.task","ui.task._UpdateSingleFolderTask"),ui.task._UpdateSingleFolderTask.getUpdateFolderResponse=function(t){XHR({params:{task:"getUpdateFolderResponse"},success:function(e){e=Ext.util.JSON.decode(e.responseText);ui.task._UpdateSingleFolderTask.afterUpdate(e,t)}})},ui.task._UpdateSingleFolderTask.poll=new Ext.util.DelayedTask(function(){var t=arguments[0],e=t.attributes.id.split("/"),i=new Array;e.shift(),e=e[0],i.push(t),XHR({params:{task:"checkLockFile",lockFile:"project_"+PhDOE.project+"_"+e+"_lock_update_folder"},success:function(){ui.task._UpdateSingleFolderTask.poll.delay(5e3,null,this,i)},failure:function(e){e=Ext.util.JSON.decode(e.responseText);e&&!1===e.success?new ui.task._UpdateSingleFolderTask.getUpdateFolderResponse(t):ui.task._UpdateSingleFolderTask.poll.delay(5e3,null,this,i)}})}),ui.task._UpdateSingleFolderTask.afterUpdate=function(e,i){Ext.getBody().unmask(),ui.task.PingTask.getInstance().delay(3e4);var t=Ext.util.JSON.decode(e.result);i.reload(function(){Ext.iterate(t.newFiles,function(e,t){i.findChild("text",e).getUI().addClass("treeFileUpdated")})},this),PhDOE.reloadAllStore()},ui.task._UpdateSingleFolderTask.update=function(t){var i=new Array;i.push(t),Ext.getBody().mask('<img src="themes/img/loading.gif" style="vertical-align: middle;" /> '+_("Please, wait until update this folder...")),ui.task.PingTask.getInstance().cancel(),XHR({params:{task:"updateFolder",path:t.id},success:function(e){e=Ext.util.JSON.decode(e.responseText);ui.task._UpdateSingleFolderTask.afterUpdate(e,t)},failure:function(e){e=Ext.util.JSON.decode(e.responseText);e&&!1===e.success?(ui.task.PingTask.getInstance().delay(3e4),Ext.getBody().unmask(),PhDOE.winForbidden()):ui.task._UpdateSingleFolderTask.poll.delay(5e3,null,this,i)}})},ui.task.UpdateSingleFolderTask=function(e){if(!PhDOE.user.haveKarma)return Ext.getCmp("winVCSCommit").close(),void PhDOE.winForbidden();ui.task._UpdateSingleFolderTask.update(e)},Ext.namespace("ui","ui.task","ui.task._VCSCommitTask"),ui.task._VCSCommitTask.getCommitResponse=function(){XHR({params:{task:"getCommitResponse"},success:function(e){e=Ext.util.JSON.decode(e.responseText);ui.task._VCSCommitTask.afterCommit(e.mess)}})},ui.task._VCSCommitTask.poll=new Ext.util.DelayedTask(function(){XHR({params:{task:"checkLockFile",lockFile:"project_"+PhDOE.project+"_lock_"+PhDOE.user.login+"_commit"},success:function(){ui.task._VCSCommitTask.poll.delay(5e3)},failure:function(e){e=Ext.util.JSON.decode(e.responseText);e&&!1===e.success?new ui.task._VCSCommitTask.getCommitResponse:ui.task._VCSCommitTask.poll.delay(5e3)}})}),ui.task._VCSCommitTask.afterCommit=function(e){Ext.getBody().unmask(),ui.task.PingTask.getInstance().delay(3e4),new Ext.Window({title:_("Status"),width:450,height:350,resizable:!1,modal:!0,autoScroll:!0,bodyStyle:"background-color: white; padding: 5px;",html:e.join("<br/>"),buttons:[{text:_("Close"),handler:function(){this.ownerCt.ownerCt.close()}}]}).show(),PhDOE.reloadAllStore()},ui.task._VCSCommitTask.commit=function(e,t){Ext.getBody().mask('<img src="themes/img/loading.gif" style="vertical-align: middle;" /> '+_("Please, wait until commit..."));for(var i,n,o=[],a=0;a<e.length;a+=1)i=Ext.getCmp("commit-grid-panel").store.getById(e[a].id),o.push(parseInt(i.data.FileDBID,10));return 0==o.length?(Ext.getBody().unmask(),void Ext.MessageBox.show({title:_("Error"),msg:_("You must choose at least one file."),buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})):(n=Ext.getCmp("form-commit-message-log").getValue(),n=Ext.util.Format.trim(n),Ext.isEmpty(n)?(Ext.getBody().unmask(),Ext.getCmp("form-commit-message-log").markInvalid(_("The log message is required.")),void Ext.MessageBox.show({title:_("Error"),msg:_("The log message is required."),buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})):(Ext.getCmp("winVCSCommit").close(),ui.task.PingTask.getInstance().cancel(),void XHR({params:{task:"vcsCommit",nodes:Ext.util.JSON.encode(o),logMessage:n,patchID:t},success:function(e){e=Ext.util.JSON.decode(e.responseText);ui.task._VCSCommitTask.afterCommit(e.mess)},failure:function(e){e=Ext.util.JSON.decode(e.responseText);e&&!1===e.success?(ui.task.PingTask.getInstance().delay(3e4),Ext.getBody().unmask(),PhDOE.winForbidden()):ui.task._VCSCommitTask.poll.delay(5e3)}})))},ui.task.VCSCommitTask=function(e){if(!PhDOE.user.haveKarma)return Ext.getCmp("winVCSCommit").close(),void PhDOE.winForbidden();for(var t,i,n,o,a,r,s,l,d,c=Ext.getCmp("commit-grid-panel").selModel.getSelections(),u=[],h="",p=0;p<c.length;++p)t=c[p].data,i="AF-"+Ext.util.md5("AF-"+t.path+t.name),n="FE-"+Ext.util.md5("FE-"+t.path+t.name),o="FNU-"+Ext.util.md5("FNU-"+t.path+t.name),a="FNIEN-"+Ext.util.md5("FNIEN-"+t.path+t.name),r="FNR-"+Ext.util.md5("FNR-"+t.path+t.name),s="FNT-"+Ext.util.md5("FNT-"+t.path+t.name),(Ext.getCmp("main-panel").findById(i)||Ext.getCmp("main-panel").findById(n)||Ext.getCmp("main-panel").findById(a)||Ext.getCmp("main-panel").findById(o)||Ext.getCmp("main-panel").findById(r)||Ext.getCmp("main-panel").findById(s))&&(Ext.getCmp("main-panel").findById(i)&&(l=i),Ext.getCmp("main-panel").findById(n)&&(l=n),Ext.getCmp("main-panel").findById(o)&&(l=o),Ext.getCmp("main-panel").findById(a)&&(l=a),Ext.getCmp("main-panel").findById(r)&&(l=r),Ext.getCmp("main-panel").findById(s)&&(l=s),u.push([l,t.name]));if(0<u.length){for(d=0;d<u.length;++d)h+=u[d][1]+"<br/>";Ext.MessageBox.show({title:_("Warning"),icon:Ext.MessageBox.INFO,buttons:Ext.MessageBox.YESNOCANCEL,msg:1<u.length?String.format(_("There are {0} files to close before commit.<br><br>{1}<br/><br/>Would you like me to close them for you ?"),u.length,h):String.format(_("There is {0} file to close before commit.<br><br>{1}<br/><br/>Would you like me to close it for you ?"),u.length,h),fn:function(e){if("yes"===e){for(var t=0;t<u.length;++t)Ext.getCmp("main-panel").remove(u[t][0]);ui.task._VCSCommitTask.commit(c)}}})}else ui.task._VCSCommitTask.commit(c,e.patchID)},Ext.namespace("ui","ui.cmp"),ui.cmp.About=Ext.extend(Ext.Window,{id:"win-about",iconCls:"iconHelp",layout:"fit",width:515,height:320,modal:!0,plain:!0,bodyStyle:"color:#000",buttons:[{text:_("Close"),handler:function(){Ext.getCmp("win-about").close()}}],initComponent:function(){Ext.apply(this,{title:String.format(_("About {0}"),PhDOE.app.name),items:{xtype:"tabpanel",activeTab:0,autoTabs:!0,border:!1,defaults:{autoScroll:!0},items:[{title:_("About"),html:'<div id="phd-oe-about"><img src="themes/img/php.png" class="loading-php-logo" alt="PHP" />'+PhDOE.app.name+'</div><div id="phd-oe-about-info">'+PhDOE.app.name+" Copyright &copy; 2008-"+(new Date).format("Y")+" The PHP Group<br/>"+_("Author:")+' <a href="mailto:yannick@php.net">Yannick Torr&egrave;s</a> '+_('and <a href="http://git.php.net/?p=web/doc-editor.git;a=summary" target="_blank">others</a>')+"</div>"},{title:_("Help and support"),bodyStyle:"padding:15px",html:'<div id="phd-oe-support"><ul><li>'+_("Getting started with this editor:")+'<a href="https://wiki.php.net/doc/editor/" target="_blank">https://wiki.php.net/doc/editor/</a></li><li>'+_("Mailing list:")+'<a href="mailto:phpdoc@lists.php.net">phpdoc@lists.php.net</a></li><li>'+_("IRC:")+'<a href="irc://irc.efnet.org/#php.doc">EFnet: #php.doc</a></li></ul></div>'},{title:_("Credits"),bodyStyle:"padding:15px",html:'<div id="phd-oe-credit"><ul><li><a href="http://extjs.com" target="_blank">ExtJs Team</a><div class="phd-oe-credit-info">'+_("Javascript FrameWork")+" - ExtJs v"+PhDOE.app.extJsVersion+'</div></li><li><a href="http://marijn.haverbeke.nl/codemirror/" target="_blank">CodeMirror</a><div class="phd-oe-credit-info">'+_("Code editor")+" - CodeMirror v"+PhDOE.app.codeMirror+" - "+_("Mode Xmlpure by Dror Ben-Gai")+' </div></li><li><a href="http://www.oxygen-icons.org/" target="_blank">Oxygen project from KDE</a><div class="phd-oe-credit-info">'+_("Icon pack")+'</div></li><li><a href="http://www.mibbit.com/" target="_blank">'+_("Mibbit for donating their Premium IRC widget")+'</a><div class="phd-oe-credit-info">'+_("Web IRC Chat")+"</div></li></ul></div>"},{title:_("License"),autoLoad:{url:"./LICENSE"}}]}}),ui.cmp.About.superclass.initComponent.call(this)}}),Ext.namespace("ui","ui.cmp","ui.cmp._AnonymousPatchWin"),ui.cmp._AnonymousPatchWin.form=Ext.extend(Ext.FormPanel,{frame:!0,labelWidth:5,bodyStyle:"padding:5px 5px 0",defaultType:"radio",initComponent:function(e){Ext.apply(this,{items:[{xtype:"displayfield",value:_("File: ")+this.fpath+this.fname+"<br><br>"+_('You have opened a modified file from the "Patch for review" module.<br>This file has been modified by an anonymous user.<br><br>Please choose one of the following actions:')},{boxLabel:_("Continue to modify this file"),name:"choice",inputValue:"continue",checked:!0,listeners:{afterrender:function(){new Ext.ToolTip({title:_("Continue to modify this file"),target:"x-form-el-"+this.id,anchor:"right",html:"<br>"+_("This action will open this file for modification. Once your modification finish, just save it and this file will be own by you."),width:250,autoHide:!0})}}},{boxLabel:_("Reject this patch"),name:"choice",inputValue:"reject",listeners:{afterrender:function(){new Ext.ToolTip({title:_("Reject this patch"),target:"x-form-el-"+this.id,anchor:"right",html:"<br>"+_("This action will close this file, and clear the local change. This file will return into his original version, as it is on VCS server."),width:250,autoHide:!0})}}},{boxLabel:_("Validate this patch"),name:"choice",inputValue:"validate",listeners:{afterrender:function(){new Ext.ToolTip({title:_("Validate this patch"),target:"x-form-el-"+this.id,anchor:"right",html:"<br>"+_("This action changes the owner of the modification and register it under your name. The file will appear under your name and you can then commit it."),width:250,autoHide:!0})}}}]}),ui.cmp._AnonymousPatchWin.form.superclass.initComponent.call(this)}}),ui.cmp.AnonymousPatchWin=Ext.extend(Ext.Window,{id:"anonymous-patch-win",title:_("Anonymous patch manager"),iconCls:"iconPatch",width:450,height:260,layout:"fit",resizable:!1,modal:!0,autoScroll:!0,closable:!1,closeAction:"close",buttons:[{text:_("Next"),iconCls:"iconArrowRight",handler:function(){var t=this.ownerCt.ownerCt;switch(t.items.items[0].getForm().getValues().choice){case"continue":t.close();break;case"reject":Ext.MessageBox.confirm(_("Confirm"),_("Rejecting this patch, you are about to delete this change.<br>Are you sure you want to do that?"),function(e){"yes"===e&&(ui.task.ClearLocalChangeTask({ftype:t.ftype,fpath:t.fpath,fname:t.fname,noConfirm:!0}),t.close())});break;case"validate":ui.task.ChangeFileOwner({fileIdDB:t.fidDB,newOwnerID:PhDOE.user.userID,from:t,fromType:"tab"})}}}],initComponent:function(){Ext.apply(this,{items:[new ui.cmp._AnonymousPatchWin.form({fpath:this.fpath,fname:this.fname})]}),ui.cmp.AnonymousPatchWin.superclass.initComponent.call(this),this.show()}}),Ext.namespace("ui","ui.cmp"),ui.cmp.BingTranslationPanel=Ext.extend(Ext.FormPanel,{border:!1,labelAlign:"top",bodyStyle:"padding:5px",autoScroll:!0,getTranslation:function(e){new ui.task.GetBingTranslation({str:e})},initComponent:function(){Ext.apply(this,{items:[{xtype:"textarea",anchor:"90%",fieldLabel:String.format(_("String to translate (en => {0})"),PhDOE.user.lang),name:"BingTranslate-string",id:"BingTranslate-string",allowBlank:!1},{scope:this,xtype:"button",text:_("Translate !"),id:"BingTranslate-btn",handler:function(){this.getTranslation(Ext.getCmp("BingTranslate-string").getValue())}},{xtype:"panel",anchor:"100%",border:!1,bodyStyle:"padding:5px",html:'<div id="BingTranslate-result" style="width: 90%; font: 12px tahoma,arial,sans-serif"></div>'}]}),ui.cmp.BingTranslationPanel.superclass.initComponent.call(this)}}),Ext.namespace("ui","ui.cmp","ui.cmp._BuildStatus"),ui.cmp._BuildStatus.display=function(e){Ext.apply(this,e),Ext.getCmp("main-panel").findById("last_failed_build_"+this.lang)&&Ext.getCmp("main-panel").remove("last_failed_build_"+this.lang),Ext.getCmp("main-panel").add({xtype:"panel",id:"last_failed_build_"+this.lang,title:String.format(_("Last failed build for {0}"),Ext.util.Format.uppercase(this.lang)),tabTip:String.format(_("Last failed build for the documentation {0}"),Ext.util.Format.uppercase(this.lang)),closable:!0,autoScroll:!0,iconCls:"iconCheckBuild",html:'<div class="check-build-content" id="check-build-content"></div>'}),Ext.getCmp("main-panel").setActiveTab("last_failed_build_"+this.lang),Ext.getCmp("main-panel").el.mask(_("Please, wait...")),XHR({scope:this,params:{task:"getFailedBuildData",idFailedBuild:this.idFailedBuild},success:function(e){var t=Ext.decode(e.responseText),e=t.mess.join("<br/>");"truncate"===t.state?(Ext.get("check-build-content").dom.innerHTML=e+'<div style="text-align: center; margin: 20px 0 20px 0" class="x-toolbar">'+_("This log is too large and have been truncated. Use the following button to download the full content of it.")+'<div id="check-build-content-download-btn"></div></div>',new Ext.Button({scope:this,text:_("Download the full content of this log"),renderTo:"check-build-content-download-btn",style:{margin:"auto"},handler:function(){window.location.href="./do/downloadFailedBuildLog?idFailedBuild="+this.idFailedBuild+"&csrfToken="+csrfToken}})):Ext.get("check-build-content").dom.innerHTML=e,Ext.getCmp("main-panel").el.unmask()}})},ui.cmp._BuildStatus.ds=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:"./do/getFailedBuild"}),reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",idProperty:"id",fields:[{name:"id"},{name:"lang"},{name:"date",type:"date",dateFormat:"Y-m-d H:i:s"}]})}),ui.cmp._BuildStatus.ds.setDefaultSort("date","desc"),ui.cmp._BuildStatus.rendererLanguage=function(e){return'<div><div class="flags flag-'+({cs:"cz",sr:"rs",sv:"se"}[e]||e)+'" style="float: left;"></div><div style="padding-left: 24px">'+e+"</div></div>"},ui.cmp._BuildStatus.columns=[{id:"date",header:_("Date"),sortable:!0,dataIndex:"date",renderer:Ext.util.Format.dateRenderer(_("Y-m-d, H:i"))},{header:_("Language"),width:45,sortable:!0,dataIndex:"lang",renderer:ui.cmp._BuildStatus.rendererLanguage}],ui.cmp._BuildStatus.menu=Ext.extend(Ext.menu.Menu,{setRowIndex:function(e){this.rowIndex=e},initComponent:function(){Ext.apply(this,{items:[{scope:this,text:"<b>"+_("View in a new Tab")+"</b>",iconCls:"iconOpenInTab",handler:function(){this.grid.fireEvent("rowdblclick",this.grid,this.rowIndex,this.event)}}]}),ui.cmp._BuildStatus.menu.superclass.initComponent.call(this)}}),ui.cmp.BuildStatus=Ext.extend(Ext.grid.GridPanel,{loadMask:!0,bodyBorder:!1,autoExpandColumn:"date",store:ui.cmp._BuildStatus.ds,columns:ui.cmp._BuildStatus.columns,view:new Ext.grid.GridView({forceFit:!0}),listeners:{render:function(){this.store.load.defer(20,this.store)}},onRowdblclick:function(e,t,i){t=this.store.getAt(t);new ui.cmp._BuildStatus.display({idFailedBuild:t.id,lang:t.data.lang})},onRowContextMenu:function(e,t,i){this.menu||(this.menu=new ui.cmp._BuildStatus.menu({grid:e,rowIdx:"",event:i})),i.stopEvent(),this.getSelectionModel().selectRow(t),this.menu.setRowIndex(t),this.menu.showAt(i.getXY())},initComponent:function(e){ui.cmp.BuildStatus.superclass.initComponent.call(this),Ext.apply(this,e),this.on("rowdblclick",this.onRowdblclick,this),this.on("rowcontextmenu",this.onRowContextMenu,this)}}),Ext.namespace("ui","ui.cmp","ui.cmp._ChangeFileOwner"),ui.cmp._ChangeFileOwner.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:"./do/getVCSUsers"}),reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",fields:[{name:"userID"},{name:"authService"},{name:"userName"}]}),sortInfo:{field:"authService",direction:"ASC"}}),ui.cmp.ChangeFileOwner=Ext.extend(Ext.Window,{title:_("Change file's owner"),iconCls:"iconSwitchLang",width:550,height:255,layout:"form",resizable:!1,modal:!0,autoScroll:!0,closeAction:"close",padding:10,buttons:[{text:_("Save"),handler:function(){var e=this.ownerCt.ownerCt,t=e.items.items[1].items.items[0].getValue();new ui.task.ChangeFileOwner({fileIdDB:e.fileIdDB,newOwnerID:t,from:e})}},{text:_("Close"),handler:function(){this.ownerCt.ownerCt.close()}}],initComponent:function(){Ext.apply(this,{defaults:{labelWidth:120},items:[{xtype:"fieldset",title:_("Information"),iconCls:"iconInfo",width:515,items:[{xtype:"displayfield",fieldLabel:_("File"),value:this.fileFolder+this.fileName},{xtype:"displayfield",fieldLabel:_("Current owner"),value:this.currentOwner}]},{xtype:"fieldset",title:_("Action"),iconCls:"iconSwitchLang",width:515,items:[{xtype:"combo",name:"newOwner",fieldLabel:_("New owner"),editable:!1,store:ui.cmp._ChangeFileOwner.store,triggerAction:"all",valueField:"userID",tpl:new Ext.XTemplate('<tpl for="."><div class="x-combo-list-item">',"{authService} - {userName}","</div></tpl>"),displayField:"userName",listeners:{afterrender:function(e){e.store.load({callback:function(){e.setValue(PhDOE.user.userID)}})}}}]}]}),ui.cmp.ChangeFileOwner.superclass.initComponent.call(this),this.show()}}),Ext.namespace("ui","ui.cmp"),ui.cmp.Chat=Ext.extend(Ext.Window,{id:"win-chat",iconCls:"iconChat",layout:"fit",width:800,height:600,modal:!0,plain:!0,bodyStyle:"color:#000",closeAction:"hide",initComponent:function(){var e=PhDOE.user.login;PhDOE.user.isAnonymous&&(e="an%3F%3F%3F"),Ext.apply(this,{title:_("Chat with us on IRC !"),items:[new Ext.ux.IFrameComponent({id:"frame-win-chat",url:"https://widget.mibbit.com/?settings=8eec4034df2eb666b0600bdfe151529a&server=irc.umich.edu&channel=%23php.doc&nick=poe_"+e})]}),ui.cmp.Chat.superclass.initComponent.call(this)}}),Ext.namespace("ui","ui.cmp"),ui.cmp.CheckBuildPrompt=Ext.extend(Ext.Window,{title:_("Check build"),iconCls:"iconCheckBuild",layout:"form",width:350,height:200,resizable:!1,modal:!0,bodyStyle:"padding:5px 5px 0",labelAlign:"top",buttons:[{id:"win-check-build-btn-submit",text:_("Go !"),handler:function(){new ui.task.CheckBuildTask,this.ownerCt.ownerCt.close()}}],initComponent:function(){Ext.apply(this,{items:[{xtype:"panel",modal:!1,baseCls:"x-plain",bodyStyle:"padding:5px 5px 0",html:_("You're about to check the build via this command:")+"<br/><br/>/usr/bin/php configure.php --with-lang="+PhDOE.user.lang+'<span id="option-xml-details-span" style="color: red; visibility: hidden;"> --enable-xml-details</span><br/><div id="option-xml-details-div" style="text-align: center; color: red; visibility: hidden;">'+_("<b>WARNING !</b><br/> This option use a lot of server ressource. If you don't know what are the consequence, please, don't use it.")+"</div>"},{xtype:"checkbox",id:"option-xml-details",name:"option-xml-details",checked:!1,hideLabel:!0,boxLabel:_("Enable detailed XML error messages"),listeners:{check:function(e,t){Ext.get("option-xml-details-span").dom.style.visibility=t?"visible":"hidden",Ext.get("option-xml-details-div").dom.style.visibility=t?"visible":"hidden"}}}]}),ui.cmp.CheckBuildPrompt.superclass.initComponent.call(this)}}),Ext.namespace("ui","ui.cmp","ui.cmp._CheckDoc"),ui.cmp._CheckDoc.ds=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:"./do/getCheckDocData"}),reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",idProperty:"id",fields:[{name:"id"},{name:"path"},{name:"extension"},{name:"check_oldstyle",type:"int"},{name:"check_undoc",type:"int"},{name:"check_roleerror",type:"int"},{name:"check_badorder",type:"int"},{name:"check_noseealso",type:"int"},{name:"check_noreturnvalues",type:"int"},{name:"check_noparameters",type:"int"},{name:"check_noexamples",type:"int"},{name:"check_noerrors",type:"int"}]})}),ui.cmp._CheckDoc.ds.setDefaultSort("extension","asc"),ui.cmp._CheckDoc.renderer=function(e,t){if(0<e)return t.css="check_doc_cell",t.attr="ext:qtip=\"<img src='themes/img/help.png' style='vertical-align: middle;' /> "+_("Double-click the cell to open the file selection")+'"',e},ui.cmp._CheckDoc.columns=[new Ext.grid.RowNumberer,{id:"extension",header:_("Extension"),sortable:!0,dataIndex:"extension"},{header:_("Not documented"),width:45,sortable:!0,dataIndex:"check_undoc",renderer:ui.cmp._CheckDoc.renderer},{header:_("Old style"),width:45,sortable:!0,dataIndex:"check_oldstyle",renderer:ui.cmp._CheckDoc.renderer},{header:_("Bad refsect1 order"),width:45,sortable:!0,dataIndex:"check_badorder",renderer:ui.cmp._CheckDoc.renderer},{header:_("No parameters"),width:45,sortable:!0,dataIndex:"check_noparameters",renderer:ui.cmp._CheckDoc.renderer},{header:_("No return values"),width:45,sortable:!0,dataIndex:"check_noreturnvalues",renderer:ui.cmp._CheckDoc.renderer},{header:_("No examples"),width:45,sortable:!0,dataIndex:"check_noexamples",renderer:ui.cmp._CheckDoc.renderer},{header:_("No errors section"),width:45,sortable:!0,dataIndex:"check_noerrors",renderer:ui.cmp._CheckDoc.renderer},{header:_("No see also"),width:45,sortable:!0,dataIndex:"check_noseealso",renderer:ui.cmp._CheckDoc.renderer},{header:_("Refsect1 role error"),width:45,sortable:!0,dataIndex:"check_roleerror",renderer:ui.cmp._CheckDoc.renderer}],ui.cmp._CheckDoc.fs=new Ext.data.SimpleStore({fields:[{name:"id"},{name:"file"}]}),ui.cmp._CheckDoc.FileGrid=Ext.extend(Ext.grid.GridPanel,{id:"check-doc-file-grid",store:ui.cmp._CheckDoc.fs,loadMask:!0,bodyBorder:!1,autoExpandColumn:"file",sm:new Ext.grid.RowSelectionModel({}),columns:[new Ext.grid.RowNumberer,{id:"file",header:_("Files"),sortable:!0,dataIndex:"file"}],onRowClick:function(){Ext.getCmp("check-doc-btn-open-selected-files").enable()},onRowContextMenu:function(e,t,i){i.stopEvent(),e.getSelectionModel().selectRow(t)},onRowDblClick:function(e,t){ui.cmp.RepositoryTree.getInstance().openFile("byPath","en"+e.fpath,e.store.getAt(t).data.file),Ext.getCmp("check-doc-file-win").close()},initComponent:function(e){ui.cmp._CheckDoc.FileGrid.superclass.initComponent.call(this),Ext.apply(this,e),this.on("rowcontextmenu",this.onRowContextMenu,this),this.on("rowdblclick",this.onRowDblClick,this),this.on("rowclick",this.onRowClick,this)}}),ui.cmp._CheckDoc.FileWin=Ext.extend(Ext.Window,{id:"check-doc-file-win",title:_("Files"),width:450,height:350,labelWidth:50,resizable:!1,modal:!0,autoScroll:!0,layout:"fit",iconCls:"iconFiles",buttons:[{text:_("Open all files"),handler:function(){var e,t=Ext.getCmp("check-doc-file-win"),i=ui.cmp._CheckDoc.fs;for(PhDOE.AFfilePendingOpen=[],e=0;e<i.getCount();++e)PhDOE.AFfilePendingOpen[e]={fpath:"en"+t.fpath,fname:i.getAt(e).data.file};ui.cmp.RepositoryTree.getInstance().openFile("byPath",PhDOE.AFfilePendingOpen[0].fpath,PhDOE.AFfilePendingOpen[0].fname),PhDOE.AFfilePendingOpen.shift(),t.close()}},{text:_("Open selected files"),id:"check-doc-btn-open-selected-files",disabled:!0,handler:function(){var e,t=Ext.getCmp("check-doc-file-win"),i=Ext.getCmp("check-doc-file-grid").getSelectionModel().getSelections();for(PhDOE.AFfilePendingOpen=[],e=0;e<i.length;++e)PhDOE.AFfilePendingOpen[e]={fpath:"en"+t.fpath,fname:i[e].data.file};ui.cmp.RepositoryTree.getInstance().openFile("byPath",PhDOE.AFfilePendingOpen[0].fpath,PhDOE.AFfilePendingOpen[0].fname),PhDOE.AFfilePendingOpen.shift(),t.close()}}]}),ui.cmp.CheckDoc=Ext.extend(Ext.grid.GridPanel,{loadMask:!0,bodyBorder:!1,store:ui.cmp._CheckDoc.ds,columns:ui.cmp._CheckDoc.columns,autoExpandColumn:"extension",sm:new Ext.grid.CellSelectionModel({singleSelect:!0}),view:new Ext.grid.GridView({forceFit:!0}),listeners:{render:function(e){this.store.load.defer(20,e.store)}},onCellContextMenu:function(e,t,i,n){n.stopEvent(),this.sm.select(t,i)},onCellDblClick:function(n,e,t,i){var o=this.store.getAt(e),e=this.getColumnModel().getDataIndex(t),t=o.get(e),a=o.data.path;Ext.num(t,!1)&&0!==t&&(this.el.mask(_("Please, wait...")),XHR({params:{task:"getCheckDocFiles",path:a,errorType:e},success:function(e){var t,i=Ext.decode(e.responseText);for(ui.cmp._CheckDoc.fs.removeAll(),t=0;t<i.files.length;++t)ui.cmp._CheckDoc.fs.insert(0,new ui.cmp._CheckDoc.fs.recordType({id:t,file:i.files[t].name}));ui.cmp._CheckDoc.fs.sort("file","asc"),n.el.unmask(),new ui.cmp._CheckDoc.FileWin({fpath:a,items:[new ui.cmp._CheckDoc.FileGrid({fpath:a})]}).show()}}))},initComponent:function(e){ui.cmp.CheckDoc.superclass.initComponent.call(this),Ext.apply(this,e),this.on("celldblclick",this.onCellDblClick,this),this.on("cellcontextmenu",this.onCellContextMenu,this)}}),Ext.namespace("ui","ui.cmp","ui.cmp._CheckEntities"),ui.cmp._CheckEntities.ds=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:"./do/getCheckEntitiesData"}),reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",idProperty:"id",fields:[{name:"id"},{name:"entities"},{name:"url"},{name:"result"},{name:"date",type:"date",dateFormat:"Y-m-d H:i:s"}]})}),ui.cmp._CheckEntities.ds.setDefaultSort("entities","asc"),ui.cmp._CheckEntities.rendererEntities=function(e,t){return"&"+e+";"},ui.cmp._CheckEntities.columns=[new Ext.grid.RowNumberer,{id:"entities",header:_("Entities"),sortable:!0,dataIndex:"entities",width:30,renderer:ui.cmp._CheckEntities.rendererEntities},{header:_("Url"),sortable:!0,dataIndex:"url"},{header:_("Result"),width:30,sortable:!0,dataIndex:"result"},{header:_("Date"),width:30,sortable:!0,dataIndex:"date",renderer:Ext.util.Format.dateRenderer(_("Y-m-d, H:i"))}],ui.cmp.CheckEntities=Ext.extend(Ext.grid.GridPanel,{id:"check-entities-grid",loadMask:!0,bodyBorder:!1,store:ui.cmp._CheckEntities.ds,columns:ui.cmp._CheckEntities.columns,autoExpandColumn:"url",sm:new Ext.grid.RowSelectionModel({singleSelect:!0}),view:new Ext.grid.GridView({forceFit:!0}),onRender:function(e,t){ui.cmp.CheckEntities.superclass.onRender.call(this,e,t),this.store.load.defer(20,this.store)},openTab:function(e){var t=this.store.getAt(e).data.url,e="tab-check-entities-"+Ext.util.md5(t);Ext.getCmp(e)||Ext.getCmp("main-panel").add({id:e,xtype:"panel",title:Ext.util.Format.ellipsis(t,20),tabTip:t,iconCls:"iconCheckEntities",closable:!0,layout:"fit",items:[new Ext.ux.IFrameComponent({id:"frame-"+e,url:t})]}),Ext.getCmp("main-panel").setActiveTab(e)},onRowdblclick:function(e,t){this.openTab(t)},onContextClick:function(e,t,i){this.menu||(this.menu=new Ext.menu.Menu({id:"submenu-checkentities",items:[{scope:this,text:"<b>"+_("Open in a new Tab")+"</b>",iconCls:"iconOpenInTab",handler:function(){this.openTab(this.ctxRowIndex),this.menu.hide()}}]})),this.getSelectionModel().selectRow(t),i.stopEvent(),this.ctxRowIndex&&(this.ctxRowIndex=null),this.ctxRowIndex=t,this.menu.showAt(i.getXY())},initComponent:function(e){this.tbar=[{xtype:"label",text:_("Status: ")},{xtype:"combo",typeAhead:!0,triggerAction:"all",lazyRender:!0,mode:"local",store:new Ext.data.ArrayStore({id:0,fields:["myId","displayText"],data:[["all",_("All status")],["FTP_CONNECT","FTP_CONNECT"],["FTP_LOGIN","FTP_LOGIN"],["FTP_NO_FILE","FTP_NO_FILE"],["HTTP_CONNECT","HTTP_CONNECT"],["HTTP_INTERNAL_ERROR","HTTP_INTERNAL_ERROR"],["HTTP_NOT_FOUND","HTTP_NOT_FOUND"],["HTTP_MOVED","HTTP_MOVED"],["HTTP_WRONG_HEADER","HTTP_WRONG_HEADER"],["SUCCESS","SUCCESS"],["UNKNOWN_HOST","UNKNOWN_HOST"]]}),value:"all",valueField:"myId",displayField:"displayText",editable:!1,listeners:{select:function(e,t){"all"===t.id?Ext.getCmp("check-entities-grid").store.clearFilter():Ext.getCmp("check-entities-grid").store.filter("result",t.id)}}}],ui.cmp.CheckEntities.superclass.initComponent.call(this),Ext.apply(this,e),this.on("rowcontextmenu",this.onContextClick,this),this.on("rowdblclick",this.onRowdblclick,this)}}),Ext.namespace("ui","ui.cmp"),ui.cmp.CheckEntitiesPrompt=Ext.extend(Ext.Window,{title:_("Check entities"),iconCls:"iconRun",id:"win-check-entities",layout:"fit",width:250,height:140,resizable:!1,modal:!0,bodyStyle:"padding:5px 5px 0; text-align: center;",labelAlign:"top",closeAction:"hide",buttons:[{id:"win-check-entities-btn",text:_("Go !"),handler:function(){new ui.task.CheckEntitiesTask,Ext.getCmp("win-check-entities").hide()}}],initComponent:function(){Ext.apply(this,{items:[{xtype:"panel",modal:!1,baseCls:"x-plain",bodyStyle:"padding:5px 5px 0",html:_("You're about to check all entities.<br><br>This action takes time.")}]}),ui.cmp.CheckEntitiesPrompt.superclass.initComponent.call(this)}}),Ext.namespace("ui","ui.cmp"),ui.cmp.CheckXmlWin=Ext.extend(Ext.Window,{title:_("XML Errors"),iconCls:"iconXml",width:650,height:350,layout:"fit",resizable:!1,modal:!0,autoScroll:!0,closeAction:"close",buttons:[{text:_("Close"),handler:function(){this.ownerCt.ownerCt.close()}}],store:new Ext.data.JsonStore({root:"Items",totalProperty:"nbItems",fields:[{name:"line"},{name:"libel"}]}),addErrorsInStore:function(){var e=Ext.data.Record.create({name:"line"},{name:"libel"});for(this.store.removeAll(),i=0;i<this.errors.length;i++)this.store.add(new e({line:this.errors[i].line,libel:this.errors[i].libel+"<br>"+Ext.util.Format.htmlEncode(this.errors[i].ctx1)}));this.store.sort("line","desc")},initComponent:function(){Ext.apply(this,{items:[{xtype:"grid",store:this.store,loadMask:!0,autoExpandColumn:"libel_id",colModel:new Ext.grid.ColumnModel([{header:_("Line"),dataIndex:"line",sortable:!0},{id:"libel_id",header:_("Libel"),dataIndex:"libel"}]),sm:new Ext.grid.RowSelectionModel({singleSelect:!0})}]}),ui.cmp.CheckXmlWin.superclass.initComponent.call(this),this.addErrorsInStore(),this.show()}}),Ext.namespace("ui","ui.cmp","ui.cmp._CommitLogManager"),ui.cmp._CommitLogManager.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:"./do/getCommitLogMessage"}),reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",idProperty:"id",fields:[{name:"id"},{name:"text"}]})}),ui.cmp._CommitLogManager.editor=new Ext.ux.grid.RowEditor({saveText:_("Update"),cancelText:_("Cancel"),listeners:{afteredit:function(e,t,i){XHR({params:{task:"saveLogMessage",messID:i.data.id,mess:i.data.text},success:function(){i.commit(),PhDOE.notify("info",_("Message updated"),_("Log Message was updated successfully !"))},failure:function(){PhDOE.winForbidden()}})}}}),ui.cmp._CommitLogManager.cm=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer,{id:"log_msg",header:_("Log message"),dataIndex:"text",editor:{xtype:"textarea"},renderer:function(e){return e.split("\n").join("<br/>")}}]),ui.cmp._CommitLogManager.sm=new Ext.grid.RowSelectionModel({singleSelect:!0}),ui.cmp._CommitLogManager.menu=Ext.extend(Ext.menu.Menu,{setRowIdx:function(e){this.rowIdx=e},initComponent:function(){Ext.apply(this,{items:[{scope:this,text:_("Delete this Log Message"),iconCls:"iconTrash",handler:function(){XHR({scope:this,params:{task:"deleteLogMessage",messID:ui.cmp._CommitLogManager.store.getAt(this.rowIdx).data.id},success:function(){ui.cmp._CommitLogManager.store.remove(ui.cmp._CommitLogManager.store.getAt(this.rowIdx)),PhDOE.notify("info",_("Message deleted"),_("Log Message was deleted successfully !"))},failure:function(){PhDOE.winForbidden()}})}}]}),ui.cmp._CommitLogManager.menu.superclass.initComponent.call(this)}}),ui.cmp._CommitLogManager.grid=Ext.extend(Ext.grid.GridPanel,{loadMask:!0,autoExpandColumn:"log_msg",cm:ui.cmp._CommitLogManager.cm,sm:ui.cmp._CommitLogManager.sm,store:ui.cmp._CommitLogManager.store,plugins:[ui.cmp._CommitLogManager.editor],viewConfig:{emptyText:'<div class="x-grid-empty" style="text-align:center;">'+_("No log message currently")+"</div>"},listeners:{render:function(e){e.store.load()}},onRowContextMenu:function(e,t,i){i.stopEvent(),this.getSelectionModel().selectRow(t),this.menu||(this.menu=new ui.cmp._CommitLogManager.menu),this.menu.setRowIdx(t),this.menu.showAt(i.getXY())},initComponent:function(e){ui.cmp._CommitLogManager.grid.superclass.initComponent.call(this),Ext.apply(this,e),this.on("rowcontextmenu",this.onRowContextMenu,this)}}),ui.cmp.CommitLogManager=Ext.extend(Ext.Window,{id:"commit-log-win",title:_("Manage Log Message"),iconCls:"iconWinManageLog",width:650,height:350,layout:"fit",resizable:!1,modal:!0,autoScroll:!0,closeAction:"hide",store:ui.cmp._CommitLogManager.store,buttons:[{text:_("Close"),handler:function(){Ext.getCmp("commit-log-win").hide()}}],initComponent:function(){Ext.apply(this,{items:[new ui.cmp._CommitLogManager.grid]}),ui.cmp.CommitLogManager.superclass.initComponent.call(this)}}),Ext.namespace("ui","ui.cmp","ui.cmp._CommitPrompt"),ui.cmp._CommitPrompt.store=new Ext.data.GroupingStore({reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",idProperty:"id",fields:[{name:"id"},{name:"path"},{name:"name"},{name:"by"},{name:"date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"type"}]}),sortInfo:{field:"name",direction:"ASC"},groupField:"path"}),ui.cmp._CommitPrompt.CheckboxSelectionModel=new Ext.grid.CheckboxSelectionModel,ui.cmp._CommitPrompt.columns=[ui.cmp._CommitPrompt.CheckboxSelectionModel,{id:"name",header:_("Files"),sortable:!0,dataIndex:"name"},{header:_("Modified by"),width:45,sortable:!0,dataIndex:"by"},{header:_("Date"),width:45,sortable:!0,dataIndex:"date",renderer:Ext.util.Format.dateRenderer(_("Y-m-d, H:i"))},{header:_("Path"),dataIndex:"path",hidden:!0}],ui.cmp._CommitPrompt.view=new Ext.grid.GroupingView({forceFit:!0,groupTextTpl:'{[values.rs[0].data["path"]]} ({[values.rs.length]} {[values.rs.length > 1 ? "'+_("Files")+'" : "'+_("File")+'"]})'}),ui.cmp._CommitPrompt.grid=Ext.extend(Ext.grid.GridPanel,{id:"commit-grid-panel",loadMask:!0,autoExpandColumn:"name",height:180,columns:ui.cmp._CommitPrompt.columns,view:ui.cmp._CommitPrompt.view,sm:ui.cmp._CommitPrompt.CheckboxSelectionModel,listeners:{viewready:function(){this.selModel.selectAll()}},initComponent:function(){Ext.apply(this,{store:ui.cmp._CommitPrompt.store}),ui.cmp._CommitPrompt.grid.superclass.initComponent.call(this)}}),ui.cmp.CommitPrompt=Ext.extend(Ext.Window,{id:"winVCSCommit",layout:"form",title:_("VCS commit"),iconCls:"iconPendingCommit",closable:!1,width:600,height:480,resizable:!1,modal:!0,bodyStyle:"padding:5px 5px 0",labelAlign:"top",patchID:!1,defaultMessage:!1,tools:[{id:"gear",qtip:_("Configure this tools"),handler:function(){Ext.getCmp("commit-log-win")||new ui.cmp.CommitLogManager,Ext.getCmp("commit-log-win").show(this.id)}}],listeners:{show:function(){new Ext.util.DelayedTask(function(){Ext.getCmp("form-commit-message-log").focus()}).delay(200)}},initComponent:function(){var e;for(ui.cmp._CommitPrompt.store.removeAll(),e=0;e<this.files.length;++e)ui.cmp._CommitPrompt.store.insert(0,new ui.cmp._CommitPrompt.store.recordType({id:"need-commit-"+this.files[e].fid,path:this.files[e].fpath,name:this.files[e].fname,by:this.files[e].fby,date:this.files[e].fdate,type:this.files[e].ftype,FileDBID:this.files[e].fdbid}));ui.cmp._CommitPrompt.store.groupBy("path",!0),Ext.apply(this,{buttons:[{scope:this,id:"win-commit-btn-submit",text:_("Submit"),handler:function(){new ui.task.VCSCommitTask({patchID:this.patchID})}},{id:"win-commit-btn-close",text:_("Close"),handler:function(){Ext.getCmp("winVCSCommit").close()}}],items:[new ui.cmp._CommitPrompt.grid,{xtype:"combo",name:"first2",fieldLabel:_("Older messages"),editable:!1,anchor:"100%",store:ui.cmp._CommitLogManager.store,triggerAction:"all",tpl:'<tpl for="."><div class="x-combo-list-item">{[values.text.split("\n").join("<br/>")]}</div></tpl>',valueField:"id",displayField:"text",listEmptyText:'<div class="x-grid-empty" style="text-align:center;">'+_("No log message currently")+"</div>",listeners:{select:function(e,t){Ext.getCmp("form-commit-message-log").setValue(t.data.text)}}},{xtype:"textarea",id:"form-commit-message-log",name:"first3",fieldLabel:_("Log message"),anchor:"100%",height:150,value:this.defaultMessage||""}]}),ui.cmp.CommitPrompt.superclass.initComponent.call(this)}}),Ext.namespace("ui","ui.cmp","ui.cmp._DictionaryGrid"),ui.cmp._DictionaryGrid.store=Ext.extend(Ext.data.Store,{proxy:new Ext.data.HttpProxy({url:"./do/getDictionaryWords"}),reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",idProperty:"id",fields:[{name:"id"},{name:"valueEn"},{name:"valueLang"},{name:"lastUser",hideField:!0},{name:"lastDate",type:"date",dateFormat:"Y-m-d H:i:s",hideField:!0}]}),sortInfo:{field:"valueEn",direction:"ASC"},listeners:{load:function(){PhDOE.user.isAnonymous||Ext.getCmp(this.fid+"-btn-new-word").enable()}},initComponent:function(e){Ext.apply(this,e),ui.cmp._DictionaryGrid.store.superclass.initComponent.call(this)}}),ui.cmp._DictionaryGrid.editor=Ext.extend(Ext.ux.grid.RowEditor,{saveText:_("Update"),cancelText:_("Cancel"),listeners:{afteredit:function(e,t,i,n){XHR({params:{task:"manageDictionaryWord",wordId:i.data.id,valueEn:i.data.valueEn,valueLang:i.data.valueLang},success:function(e){e=Ext.util.JSON.decode(e.responseText);i.set("lastUser",PhDOE.user.login),i.set("lastDate",Date.parseDate(e.dateUpdate,"Y-m-d H:i:s")),i.commit(),PhDOE.notify("info",_("Word in dictionary added/updated"),_("The word have been added/updated successfully !"))},failure:function(){PhDOE.winForbidden()}})},canceledit:function(e){"new"===e.record.data.id&&e.record.store.remove(e.record)}}}),ui.cmp._DictionaryGrid.sm=Ext.extend(Ext.grid.RowSelectionModel,{singleSelect:!0}),ui.cmp._DictionaryGrid.viewConfig={forceFit:!0,emptyText:'<div style="text-align: center">'+_("You must manually load this data.<br>Use the refresh button !")+"</div>",deferEmptyText:!1},ui.cmp._DictionaryGrid.menu=Ext.extend(Ext.menu.Menu,{setRowIdx:function(e){this.rowIdx=e},initComponent:function(){Ext.apply(this,{items:[{scope:this,text:_("Delete this word"),iconCls:"iconTrash",disabled:PhDOE.user.isAnonymous,handler:function(){XHR({scope:this,params:{task:"delDictionaryWord",wordId:this.grid.store.getAt(this.rowIdx).data.id},success:function(){this.grid.store.remove(this.grid.store.getAt(this.rowIdx)),PhDOE.notify("info",_("Word deleted"),_("The word was deleted successfully !"))},failure:function(){PhDOE.winForbidden()}})}}]}),ui.cmp._DictionaryGrid.menu.superclass.initComponent.call(this)}}),ui.cmp._DictionaryGrid.grid=Ext.extend(Ext.grid.GridPanel,{onRowContextMenu:function(e,t,i){i.stopEvent(),this.getSelectionModel().selectRow(t),this.menu||(this.menu=new ui.cmp._DictionaryGrid.menu({grid:e})),this.menu.setRowIdx(t),this.menu.showAt(i.getXY())},initComponent:function(){Ext.apply(this,{region:"center",split:!0,loadMask:!0,autoScroll:!0,bodyBorder:!1,border:!1,autoExpandColumn:this.dataType,columns:[{id:"id",header:_("En word"),sortable:!0,dataIndex:"valueEn",editor:{xtype:"textfield"}},{header:String.format(_("{0} word"),PhDOE.user.lang.ucFirst()),sortable:!0,dataIndex:"valueLang",editor:{xtype:"textfield"}},{header:_("Last User Update"),sortable:!0,dataIndex:"lastUser",editor:{xtype:"displayfield",hideField:!0}},{header:_("Last Date Update"),sortable:!0,dataIndex:"lastDate",editor:{xtype:"displayfield",hideField:!0},renderer:Ext.util.Format.dateRenderer(_("Y-m-d, H:i"))}],viewConfig:ui.cmp._DictionaryGrid.viewConfig,sm:new ui.cmp._DictionaryGrid.sm,store:new ui.cmp._DictionaryGrid.store({fid:this.fid}),plugins:[new ui.cmp._DictionaryGrid.editor],tbar:[{scope:this,tooltip:_("<b>Load/Refresh</b>"),iconCls:"iconRefresh",handler:function(){this.store.reload()}},"->",{scope:this,id:this.fid+"-btn-new-word",disabled:!0,text:_("Add a new word"),iconCls:"iconNewWord",handler:function(){var e=Ext.data.Record.create([{name:"id"},{name:"valueEn"},{name:"valueLang"},{name:"lastUser"},{name:"lastDate"}]),t=new Date,t=new e({id:"new",valueEn:"",valueLang:"",lastUser:PhDOE.user.login,lastDate:t});this.plugins[0].stopEditing(),this.store.insert(0,t),this.getView().refresh(),this.getSelectionModel().selectRow(0),this.plugins[0].startEditing(0)}}]}),ui.cmp._DictionaryGrid.grid.superclass.initComponent.call(this),this.on("rowcontextmenu",this.onRowContextMenu,this)}}),ui.cmp.DictionaryGrid=Ext.extend(Ext.Panel,{initComponent:function(){Ext.apply(this,{layout:"border",border:!1,items:[new ui.cmp._DictionaryGrid.grid({dataType:this.dataType,prefix:this.prefix,fid:this.fid,ftype:this.ftype,loadStore:this.loadStore})]}),ui.cmp.DictionaryGrid.superclass.initComponent.call(this)}}),Ext.namespace("ui","ui.cmp"),ui.cmp.DirectActionWin=Ext.extend(Ext.Window,{title:_("Live action"),layout:"form",iconCls:"iconDirectAction",width:850,height:450,resizable:!1,modal:!0,autoScroll:!0,closeAction:"close",padding:10,tools:[{id:"restore",hidden:!0,handler:function(e,t,i,n){i.toggleMaximize(),i.tools.maximize.show(),i.tools.restore.hide()}},{id:"maximize",handler:function(e,t,i,n){i.toggleMaximize(),i.tools.maximize.hide(),i.tools.restore.show()}}],buttonAlign:"center",buttons:[{text:_("Save"),handler:function(){var t=this.ownerCt.ownerCt,e=t.items.items[1].items.items[0].getValue(),i=t.items.items[1].items.items[1].getValue(),n=t.idDB;if("putIntoMyPatches"==e&&""==i)return t.items.items[1].items.items[1].markInvalid(),void t.items.items[1].items.items[1].focus();XHR({scope:this,params:{task:"setDirectAction",action:e,patchID:i,idDB:n},success:function(e){Ext.util.JSON.decode(e.responseText);ui.cmp.WorkTreeGrid.getInstance().getRootNode().reload(),ui.cmp.PatchesTreeGrid.getInstance().getRootNode().reload(),t.close()}})}},"->",{text:_("Close"),handler:function(){this.ownerCt.ownerCt.close()}}],displayData:function(e){this.items.items[0].setText(e.fileInfo.lang+e.fileInfo.path+e.fileInfo.name+" "+_("by")+" <b>"+e.userInfo.vcs_login+"</b> "+_("on")+" "+e.fileInfo.date,!1),this.items.items[2].update(e.vcsDiff),this.items.items[1].items.items[0].setValue(this.action),"deleteThisChange"==this.action&&(this.items.items[1].items.items[1].hide(),Ext.getCmp("Action-win-btn-add-new-patch").hide()),"putIntoMyPatches"==this.action&&(this.items.items[1].items.items[1].show(),Ext.getCmp("Action-win-btn-add-new-patch").show())},initComponent:function(){Ext.apply(this,{items:[{xtype:"label",fieldLabel:_("Modified file"),text:"-"},{xtype:"compositefield",fieldLabel:_("Action"),items:[{xtype:"combo",allowBlank:!1,editable:!1,triggerAction:"all",lazyRender:!0,mode:"local",store:new Ext.data.ArrayStore({id:"putIntoMyPatches",fields:["actionID","actionText"],data:[["putIntoMyPatches",_("Put into this patch:")],["deleteThisChange",_("Delete this change")]]}),valueField:"actionID",displayField:"actionText",listeners:{select:function(e,t,i){"deleteThisChange"==t.data.actionID&&(e.ownerCt.items.items[1].hide(),e.ownerCt.items.items[2].hide()),"putIntoMyPatches"==t.data.actionID&&(e.ownerCt.items.items[1].show(),e.ownerCt.items.items[2].show())}}},{xtype:"combo",allowBlank:!1,editable:!1,triggerAction:"all",lazyRender:!0,mode:"local",store:PhDOE.user.patchList,valueField:"id",displayField:"name"},{xtype:"button",iconCls:"iconAdd",id:"Action-win-btn-add-new-patch",tooltip:_("Create a new patch"),handler:function(){new ui.cmp.ManagePatchPrompt({title:_("Create a new patch")}).show(this.el)}}]},{xtype:"label",fieldLabel:_("Diff"),cls:"diff-content"}],listeners:{afterrender:function(){XHR({scope:this,params:{task:"getDirectActionData",action:this.action,idDB:this.idDB},success:function(e){e=Ext.util.JSON.decode(e.responseText);if(!e.fileInfo)return this.close(),void PhDOE.notify("error",_("Live action"),_("This live action didn't exist"));this.displayData(e)}})}}}),ui.cmp.DirectActionWin.superclass.initComponent.call(this),this.show()}}),Ext.namespace("ui","ui.cmp","ui.cmp._EditorConf","ui.cmp._EditorCmd2Conf"),ui.cmp._EditorConf.tplMenu=new Ext.XTemplate('<tpl for=".">','<div class="menu-wrap" id="tplMenu-{id}">','<div class="menu {card}"></div>',"<span>{label}</span>","</div>","</tpl>"),ui.cmp._EditorConf.tplMenu.compile(),ui.cmp._EditorConf.menuDefEn=[["1","card1",_("Main")],["4","card4",_('Module "Files with error"')],["6","card6",_('Module "All files"')]],ui.cmp._EditorConf.menuDefNonEn=[["1","card1",_("Main")],["2","card2",_('Module "Files need translate"')],["3","card3",_('Module "Files need update"')],["4","card4",_('Module "Files with error"')],["5","card5",_('Module "Files need reviewed"')],["6","card6",_('Module "All files"')]],ui.cmp._EditorConf.menuStore=new Ext.data.SimpleStore({id:0,fields:[{name:"id"},{name:"card"},{name:"label"}]}),ui.cmp._EditorConf.viewMenu=Ext.extend(Ext.DataView,{id:"conf-menu-view",tpl:ui.cmp._EditorConf.tplMenu,singleSelect:!0,overClass:"x-view-over",itemSelector:"div.menu-wrap",store:ui.cmp._EditorConf.menuStore,listeners:{selectionchange:function(e){e=e.getSelectedRecords();Ext.getCmp("confCard").layout.setActiveItem("conf-card-"+e[0].data.id)}}}),ui.cmp._EditorCmd2Conf.themeStore=new Ext.data.SimpleStore({fields:["themeFile",{name:"themeName",type:"string"}],data:[[!1,_("No theme")],["default",_("Default theme")],["cobalt",_("Cobalt")],["eclipse",_("Eclipse")],["elegant",_("Elegant")],["monokai",_("Monokai")],["neat",_("Neat")],["night",_("Night")],["rubyblue",_("RubyBlue")]]}),ui.cmp._EditorConf.themeStore=new Ext.data.SimpleStore({fields:["themeFile",{name:"themeName",type:"string"}],data:[["themes/ExtJsThemes/black/css/xtheme-black.css",_("Black")],["themes/empty.css",_("Default")],["themes/ExtJsThemes/darkgray/css/xtheme-darkgray.css",_("DarkGray")],["js/ExtJs/resources/css/xtheme-gray.css",_("Gray")],["themes/ExtJsThemes/gray-extend/css/xtheme-gray-extend.css",_("Gray Extend")],["themes/ExtJsThemes/indigo/css/xtheme-indigo.css",_("Indigo")],["themes/ExtJsThemes/midnight/css/xtheme-midnight.css",_("Midnight")],["themes/ExtJsThemes/olive/css/xtheme-olive.css",_("Olive")],["themes/ExtJsThemes/purple/css/xtheme-purple.css",_("Purple")],["themes/ExtJsThemes/silverCherry/css/xtheme-silverCherry.css",_("SilverCherry")],["themes/ExtJsThemes/ubuntu_human/css/xtheme-human.css",_("Ubuntu Human")]]}),ui.cmp._EditorConf.uiLangStore=new Ext.data.SimpleStore({fields:["uiLang",{name:"uiLangName",type:"string"}],data:[["default",_("Default language, if available")],["en",_("English")],["fr",_("French")],["ru",_("Russian")],["es",_("Spanish")],["ar",_("Arabic")],["uk",_("Ukrainian")]]}),ui.cmp._EditorConf.CommitChange=new Ext.util.DelayedTask(function(){new ui.task.UpdateConfTask({module:this.module,itemName:this.itemName,value:this.getValue()})}),ui.cmp._EditorConf.card1=Ext.extend(Ext.TabPanel,{id:"conf-card-1",autoScroll:!0,activeTab:0,defaults:{bodyStyle:"padding: 5px;",autoHeight:!0,autoScroll:!0},initComponent:function(){Ext.apply(this,{items:[{title:_("User Interface"),iconCls:"iconUI",labelAlign:"top",layout:"form",items:[{xtype:"fieldset",title:_("Main menu"),iconCls:"iconMenu",items:[{xtype:"spinnerfield",width:60,name:"PhDOE.user.conf.main.mainMenuWidth",module:"main",itemName:"mainMenuWidth",value:PhDOE.user.conf.main.mainMenuWidth||300,fieldLabel:_("Main menu width"),minValue:0,maxValue:1e4,accelerate:!0,enableKeyEvents:!0,listeners:{keyup:function(){var e=Ext.getCmp("main-menu-panel"),t=this.getValue();PhDOE.user.conf.main.mainMenuWidth=t,e.setWidth(t),e.ownerCt.doLayout(),ui.cmp._EditorConf.CommitChange.delay(1e3,null,this)},spin:function(){var e=Ext.getCmp("main-menu-panel"),t=this.getValue();PhDOE.user.conf.main.mainMenuWidth=t,e.setWidth(t),e.ownerCt.doLayout(),ui.cmp._EditorConf.CommitChange.delay(1e3,null,this)}}}]},{xtype:"fieldset",iconCls:"iconThemes",title:_("Appearance"),items:[{xtype:"combo",fieldLabel:_("Choose a theme"),id:"conf-combo-theme",valueField:"themeFile",displayField:"themeName",triggerAction:"all",mode:"local",forceSelection:!0,editable:!1,value:PhDOE.user.conf.main.theme,store:ui.cmp._EditorConf.themeStore,listeners:{render:function(){Ext.getCmp("conf-combo-theme").store.sort("themeName")},select:function(e){e=e.getValue();Ext.get("appTheme").dom.href=e,new ui.task.UpdateConfTask({module:"main",itemName:"theme",value:e})}}},{xtype:"combo",fieldLabel:_("Force an UI language"),id:"conf-combo-ui-lang",valueField:"uiLang",displayField:"uiLangName",triggerAction:"all",mode:"local",forceSelection:!0,editable:!1,value:PhDOE.user.conf.main.uiLang||"default",store:ui.cmp._EditorConf.uiLangStore,listeners:{select:function(e){e=e.getValue();new ui.task.UpdateConfTask({module:"main",itemName:"uiLang",value:e})}}}]},{xtype:"fieldset",title:_("On save file"),iconCls:"iconSaveFile",autoHeight:!0,defaults:{hideLabel:!0},defaultType:"radio",items:[{autoHeight:!0,name:"PhDOE.user.conf.main.onSaveFile",module:"main",itemName:"onSaveFile",checked:"ask-me"===PhDOE.user.conf.main.onSaveFile,boxLabel:_("Ask me if I want to check for error before saving the file"),inputValue:"ask-me",listeners:{check:function(e){e.checked&&new ui.task.UpdateConfTask({module:"main",itemName:"onSaveFile",value:e.getRawValue()})}}},{autoHeight:!0,name:"PhDOE.user.conf.main.onSaveFile",module:"main",itemName:"onSaveFile",checked:"always"===PhDOE.user.conf.main.onSaveFile,boxLabel:_("Always check for error before saving the file"),inputValue:"always",listeners:{check:function(e){e.checked&&new ui.task.UpdateConfTask({module:"main",itemName:"onSaveFile",value:e.getRawValue()})}}},{autoHeight:!0,name:"PhDOE.user.conf.main.onSaveFile",module:"main",itemName:"onSaveFile",checked:"never"===PhDOE.user.conf.main.onSaveFile,boxLabel:_("Never check for error before saving the file"),inputValue:"never",listeners:{check:function(e){e.checked&&new ui.task.UpdateConfTask({module:"main",itemName:"onSaveFile",value:e.getRawValue()})}}}]},{xtype:"checkbox",name:"PhDOE.user.conf.main.displayENWork",checked:PhDOE.user.conf.main.displayENWork,boxLabel:_('Display EN work in "Work in progress" & "Patches for review" modules'),listeners:{check:function(e){new ui.task.UpdateConfTask({module:"main",itemName:"displayENWork",value:e.getValue()})}}}]},{title:_("External Data"),iconCls:"iconExternalData",items:[{xtype:"fieldset",title:_("About mails"),iconCls:"iconMailing",defaults:{hideLabel:!0},defaultType:"checkbox",items:[{autoHeight:!0,name:"PhDOE.user.conf.main.loadMailsAtStartUp",checked:PhDOE.user.conf.main.loadMailsAtStartUp,boxLabel:_("Load mail at startUp"),listeners:{check:function(e){new ui.task.UpdateConfTask({module:"main",itemName:"loadMailsAtStartUp",value:e.getValue()})}}}]},{xtype:"fieldset",title:_("About bugs"),iconCls:"iconBugs",defaults:{hideLabel:!0},defaultType:"checkbox",items:[{autoHeight:!0,name:"PhDOE.user.conf.main.loadBugsAtStartUp",checked:PhDOE.user.conf.main.loadBugsAtStartUp,boxLabel:_("Load bugs at startUp"),listeners:{check:function(e){new ui.task.UpdateConfTask({module:"main",itemName:"loadBugsAtStartUp",value:e.getValue()})}}}]}]},{title:_("Editor"),iconCls:"iconEditor",items:[{xtype:"fieldset",title:_("Editor theme"),iconCls:"iconThemes",items:[{xtype:"combo",fieldLabel:_("Choose a theme"),id:"conf-combo-cm2-theme",valueField:"themeFile",displayField:"themeName",triggerAction:"all",mode:"local",forceSelection:!0,editable:!1,value:PhDOE.user.conf.main.editorTheme||"default",store:ui.cmp._EditorCmd2Conf.themeStore,listeners:{select:function(e){e=e.getValue();new ui.task.UpdateConfTask({module:"main",itemName:"editorTheme",value:e})}}}]}]}]}),ui.cmp._EditorConf.card1.superclass.initComponent.call(this)}}),ui.cmp._EditorConf.card2=Ext.extend(Ext.TabPanel,{id:"conf-card-2",autoScroll:!0,activeTab:0,defaults:{bodyStyle:"padding: 5px;",autoHeight:!0,autoScroll:!0},initComponent:function(){Ext.apply(this,{items:[{title:_("Menu"),iconCls:"iconMenu",items:[{xtype:"fieldset",title:_("Nb files to display"),iconCls:"iconFilesToDisplay",defaults:{hideLabel:!0},items:[{xtype:"spinnerfield",width:60,name:"PhDOE.user.conf.newFile.nbDisplay",module:"newFile",itemName:"nbDisplay",value:PhDOE.user.conf.newFile.nbDisplay||0,boxLabel:_("files to display"),minValue:0,maxValue:1e4,accelerate:!0,enableKeyEvents:!0,listeners:{keyup:function(){ui.cmp._EditorConf.CommitChange.delay(1e3,null,this)},spin:function(){ui.cmp._EditorConf.CommitChange.delay(1e3,null,this)}}},{xtype:"displayfield",value:_("0 means no limit"),style:{fontStyle:"italic"}}]}]},{title:_("User Interface"),iconCls:"iconUI",items:[{xtype:"fieldset",title:_("ScrollBars"),iconCls:"iconScrollBar",defaults:{hideLabel:!0},defaultType:"checkbox",items:[{name:"PhDOE.user.conf.newFile.syncScrollbars",checked:PhDOE.user.conf.newFile.syncScrollbars,boxLabel:_("Synchronize scroll bars"),listeners:{check:function(e){new ui.task.UpdateConfTask({module:"newFile",itemName:"syncScrollbars",value:e.getValue()})}}}]},{xtype:"fieldset",title:_("Tools"),iconCls:"iconConf",defaults:{hideLabel:!0},defaultType:"checkbox",items:[{xtype:"fieldset",checkboxToggle:!0,collapsed:!PhDOE.user.conf.newFile.toolsPanelDisplay,title:_("Start with the panel open"),listeners:{collapse:function(){new ui.task.UpdateConfTask({module:"newFile",itemName:"toolsPanelDisplay",value:!1})},expand:function(){new ui.task.UpdateConfTask({module:"newFile",itemName:"toolsPanelDisplay",value:!0})}},items:[{xtype:"spinnerfield",width:60,name:"newFile.toolsPanelWidth",module:"newFile",itemName:"toolsPanelWidth",value:PhDOE.user.conf.newFile.toolsPanelWidth||375,fieldLabel:_("Panel width"),minValue:0,maxValue:1e4,accelerate:!0,enableKeyEvents:!0,listeners:{keyup:function(){ui.cmp._EditorConf.CommitChange.delay(1e3,null,this)},spin:function(){ui.cmp._EditorConf.CommitChange.delay(1e3,null,this)}}}]}]},{xtype:"fieldset",title:_("Right panel"),iconCls:"iconUI",defaults:{hideLabel:!0},defaultType:"radio",items:[{name:"PhDOE.user.conf.newFile.secondPanel",boxLabel:_("Display the original file"),inputValue:"originalFile",checked:"originalFile"===PhDOE.user.conf.newFile.secondPanel,listeners:{check:function(e){e.checked&&new ui.task.UpdateConfTask({module:"newFile",itemName:"secondPanel",value:e.getRawValue()})}}},{name:"PhDOE.user.conf.newFile.secondPanel",boxLabel:_("Do not display a right panel"),inputValue:"none",checked:!Ext.isDefined(PhDOE.user.conf.newFile.secondPanel)||"none"===PhDOE.user.conf.newFile.secondPanel,listeners:{check:function(e){e.checked&&new ui.task.UpdateConfTask({module:"newFile",itemName:"secondPanel",value:e.getRawValue()})}}}]}]}]}),ui.cmp._EditorConf.card2.superclass.initComponent.call(this)}}),ui.cmp._EditorConf.card3=Ext.extend(Ext.TabPanel,{id:"conf-card-3",autoScroll:!0,activeTab:0,defaults:{bodyStyle:"padding: 5px;",autoHeight:!0,autoScroll:!0},initComponent:function(){Ext.apply(this,{items:[{title:_("Menu"),iconCls:"iconMenu",items:[{xtype:"fieldset",title:_("Nb files to display"),iconCls:"iconFilesToDisplay",defaults:{hideLabel:!0},defaultType:"spinnerfield",items:[{width:60,name:"PhDOE.user.conf.needUpdate.nbDisplay",module:"needUpdate",itemName:"nbDisplay",value:PhDOE.user.conf.needUpdate.nbDisplay||0,boxLabel:_("files to display"),minValue:0,maxValue:1e4,accelerate:!0,enableKeyEvents:!0,listeners:{keyup:function(){ui.cmp._EditorConf.CommitChange.delay(1e3,null,this)},spin:function(){ui.cmp._EditorConf.CommitChange.delay(1e3,null,this)}}},{xtype:"displayfield",value:_("0 means no limit"),style:{fontStyle:"italic"}}]}]},{title:_("User Interface"),iconCls:"iconUI",items:[{xtype:"fieldset",title:_("ScrollBars"),iconCls:"iconScrollBar",defaults:{hideLabel:!0},defaultType:"checkbox",items:[{name:"needUpdate.syncScrollbars",checked:PhDOE.user.conf.needUpdate.syncScrollbars,boxLabel:_("Synchronize scroll bars"),listeners:{check:function(e){new ui.task.UpdateConfTask({module:"needUpdate",itemName:"syncScrollbars",value:e.getValue()})}}}]},{xtype:"fieldset",title:_("Tools"),iconCls:"iconConf",defaults:{hideLabel:!0},defaultType:"checkbox",items:[{name:"needUpdate.toolsPanelLogLoad",checked:PhDOE.user.conf.needUpdate.toolsPanelLogLoad,boxLabel:_("Automatically load the log when displaying the file"),listeners:{check:function(e){new ui.task.UpdateConfTask({module:"needUpdate",itemName:"toolsPanelLogLoad",value:e.getValue()})}}},{xtype:"fieldset",checkboxToggle:!0,collapsed:!PhDOE.user.conf.needUpdate.toolsPanelDisplay,title:_("Start with the panel open"),listeners:{collapse:function(){new ui.task.UpdateConfTask({module:"needUpdate",itemName:"toolsPanelDisplay",value:!1})},expand:function(){new ui.task.UpdateConfTask({module:"needUpdate",itemName:"toolsPanelDisplay",value:!0})}},items:[{xtype:"spinnerfield",width:60,name:"needUpdate.toolsPanelWidth",module:"needUpdate",itemName:"toolsPanelWidth",value:PhDOE.user.conf.needUpdate.toolsPanelWidth||375,fieldLabel:_("Panel width"),minValue:0,maxValue:1e4,accelerate:!0,enableKeyEvents:!0,listeners:{keyup:function(){ui.cmp._EditorConf.CommitChange.delay(1e3,null,this)},spin:function(){ui.cmp._EditorConf.CommitChange.delay(1e3,null,this)}}}]}]},{xtype:"fieldset",title:_("Diff view"),iconCls:"iconDiffView",defaults:{hideLabel:!0},defaultType:"radio",items:[{xtype:"fieldset",checkboxToggle:!0,collapsed:!PhDOE.user.conf.needUpdate.diffPanelDisplay,title:_("Start with the panel open"),listeners:{collapse:function(){new ui.task.UpdateConfTask({module:"needUpdate",itemName:"diffPanelDisplay",value:!1})},expand:function(){new ui.task.UpdateConfTask({module:"needUpdate",itemName:"diffPanelDisplay",value:!0})}},items:[{xtype:"spinnerfield",width:60,name:"needUpdate.diffPanelHeight",module:"needUpdate",itemName:"diffPanelHeight",value:PhDOE.user.conf.needUpdate.diffPanelHeight||150,fieldLabel:_("Panel height"),minValue:0,maxValue:1e4,accelerate:!0,enableKeyEvents:!0,listeners:{keyup:function(){ui.cmp._EditorConf.CommitChange.delay(1e3,null,this)},spin:function(){ui.cmp._EditorConf.CommitChange.delay(1e3,null,this)}}}]},{name:"needUpdate.diffMethod",checked:"using-viewvc"===PhDOE.user.conf.needUpdate.diffMethod,boxLabel:_("Using ViewVc from php web site"),inputValue:"using-viewvc",listeners:{check:function(e){e.checked&&new ui.task.UpdateConfTask({module:"needUpdate",itemName:"diffMethod",value:e.getRawValue()})}}},{name:"needUpdate.diffMethod",checked:"using-exec"===PhDOE.user.conf.needUpdate.diffMethod,boxLabel:_("Using diff -u command line"),inputValue:"using-exec",listeners:{check:function(e){e.checked&&new ui.task.UpdateConfTask({module:"needUpdate",itemName:"diffMethod",value:e.getRawValue()})}}}]}]}]}),ui.cmp._EditorConf.card3.superclass.initComponent.call(this)}}),ui.cmp._EditorConf.card4=Ext.extend(Ext.TabPanel,{id:"conf-card-4",autoScroll:!0,activeTab:0,defaults:{bodyStyle:"padding: 5px;",autoHeight:!0,autoScroll:!0},initComponent:function(){Ext.apply(this,{items:[{title:_("Menu"),iconCls:"iconMenu",items:[{xtype:"fieldset",title:_("Nb files to display"),iconCls:"iconFilesToDisplay",defaults:{hideLabel:!0},defaultType:"spinnerfield",items:[{width:60,name:"PhDOE.user.conf.error.nbDisplay",module:"error",itemName:"nbDisplay",value:PhDOE.user.conf.error.nbDisplay||0,boxLabel:_("files to display"),minValue:0,maxValue:1e4,accelerate:!0,enableKeyEvents:!0,listeners:{keyup:function(){ui.cmp._EditorConf.CommitChange.delay(1e3,null,this)},spin:function(){ui.cmp._EditorConf.CommitChange.delay(1e3,null,this)}}},{xtype:"displayfield",value:_("0 means no limit"),style:{fontStyle:"italic"}}]},{hidden:"en"===PhDOE.user.lang,xtype:"fieldset",title:_("Error type"),iconCls:"iconFilesError",defaults:{hideLabel:!0},defaultType:"checkbox",items:[{name:"error.skipNbLiteralTag",checked:PhDOE.user.conf.error.skipNbLiteralTag,boxLabel:_("Skip nbLiteralTag error"),listeners:{check:function(e){new ui.task.UpdateConfTask({module:"error",itemName:"skipNbLiteralTag",value:e.getValue()})}}}]}]},{title:_("User Interface"),iconCls:"iconUI",items:[{xtype:"fieldset",title:_("ScrollBars"),iconCls:"iconScrollBar",defaults:{hideLabel:!0},defaultType:"checkbox",items:[{name:"error.syncScrollbars",checked:PhDOE.user.conf.error.syncScrollbars,boxLabel:_("Synchronize scroll bars"),listeners:{check:function(e){new ui.task.UpdateConfTask({module:"error",itemName:"syncScrollbars",value:e.getValue()})}}}]},{xtype:"fieldset",title:_("Tools"),iconCls:"iconConf",defaults:{hideLabel:!0},defaultType:"checkbox",items:[{name:"error.toolsPanelLogLoad",checked:PhDOE.user.conf.error.toolsPanelLogLoad,boxLabel:_("Automatically load the log when displaying the file"),listeners:{check:function(e){new ui.task.UpdateConfTask({module:"error",itemName:"toolsPanelLogLoad",value:e.getValue()})}}},{name:"error.toolsPanelEntitiesLoad",checked:PhDOE.user.conf.error.toolsPanelEntitiesLoad,boxLabel:_("Automatically load entities data when displaying the file"),listeners:{check:function(e){new ui.task.UpdateConfTask({module:"error",itemName:"toolsPanelEntitiesLoad",value:e.getValue()})}}},{name:"error.toolsPanelAcronymsLoad",checked:PhDOE.user.conf.error.toolsPanelAcronymsLoad,boxLabel:_("Automatically load acronyms data when displaying the file"),listeners:{check:function(e){new ui.task.UpdateConfTask({module:"error",itemName:"toolsPanelAcronymsLoad",value:e.getValue()})}}},{xtype:"fieldset",checkboxToggle:!0,collapsed:!PhDOE.user.conf.error.toolsPanelDisplay,title:_("Start with the panel open"),listeners:{collapse:function(){new ui.task.UpdateConfTask({module:"error",itemName:"toolsPanelDisplay",value:!1})},expand:function(){new ui.task.UpdateConfTask({module:"error",itemName:"toolsPanelDisplay",value:!0})}},items:[{xtype:"spinnerfield",width:60,name:"error.toolsPanelWidth",module:"error",itemName:"toolsPanelWidth",value:PhDOE.user.conf.error.toolsPanelWidth||375,fieldLabel:_("Panel width"),minValue:0,maxValue:1e4,accelerate:!0,enableKeyEvents:!0,listeners:{keyup:function(){ui.cmp._EditorConf.CommitChange.delay(1e3,null,this)},spin:function(){ui.cmp._EditorConf.CommitChange.delay(1e3,null,this)}}}]}]},{xtype:"fieldset",title:_("Error description"),iconCls:"iconFilesError",defaults:{hideLabel:!0},defaultType:"radio",items:[{xtype:"fieldset",checkboxToggle:!0,collapsed:!PhDOE.user.conf.error.descPanelDisplay,title:_("Start with the panel open"),listeners:{collapse:function(){new ui.task.UpdateConfTask({module:"error",itemName:"descPanelDisplay",value:!1})},expand:function(){new ui.task.UpdateConfTask({module:"error",itemName:"descPanelDisplay",value:!0})}},items:[{xtype:"spinnerfield",width:60,name:"error.descPanelHeight",module:"error",itemName:"descPanelHeight",value:PhDOE.user.conf.error.descPanelHeight||150,fieldLabel:_("Panel height"),minValue:0,maxValue:1e4,accelerate:!0,enableKeyEvents:!0,listeners:{keyup:function(){ui.cmp._EditorConf.CommitChange.delay(1e3,null,this)},spin:function(){ui.cmp._EditorConf.CommitChange.delay(1e3,null,this)}}}]}]}]}]}),ui.cmp._EditorConf.card4.superclass.initComponent.call(this)}}),ui.cmp._EditorConf.card5=Ext.extend(Ext.TabPanel,{id:"conf-card-5",autoScroll:!0,activeTab:0,defaults:{bodyStyle:"padding: 5px;",autoHeight:!0,autoScroll:!0},initComponent:function(){Ext.apply(this,{items:[{title:_("Menu"),iconCls:"iconMenu",items:[{xtype:"fieldset",title:_("Nb files to display"),iconCls:"iconFilesToDisplay",defaults:{hideLabel:!0},defaultType:"spinnerfield",items:[{width:60,name:"reviewed.nbDisplay",module:"reviewed",itemName:"nbDisplay",value:PhDOE.user.conf.reviewed.nbDisplay||0,boxLabel:_("files to display"),minValue:0,maxValue:1e4,accelerate:!0,enableKeyEvents:!0,listeners:{keyup:function(){ui.cmp._EditorConf.CommitChange.delay(1e3,null,this)},spin:function(){ui.cmp._EditorConf.CommitChange.delay(1e3,null,this)}}},{xtype:"displayfield",value:_("0 means no limit"),style:{fontStyle:"italic"}}]}]},{title:_("User Interface"),iconCls:"iconUI",items:[{xtype:"fieldset",title:_("ScrollBars"),iconCls:"iconScrollBar",defaults:{hideLabel:!0},defaultType:"checkbox",items:[{name:"reviewed.syncScrollbars",checked:PhDOE.user.conf.reviewed.syncScrollbars,boxLabel:_("Synchronize scroll bars"),listeners:{check:function(e){new ui.task.UpdateConfTask({module:"reviewed",itemName:"syncScrollbars",value:e.getValue()})}}}]},{xtype:"fieldset",title:_("Tools"),iconCls:"iconConf",defaults:{hideLabel:!0},defaultType:"checkbox",items:[{name:"reviewed.toolsPanelLogLoad",checked:PhDOE.user.conf.reviewed.toolsPanelLogLoad,boxLabel:_("Automatically load the log when displaying the file"),listeners:{check:function(e){new ui.task.UpdateConfTask({module:"reviewed",itemName:"toolsPanelLogLoad",value:e.getValue()})}}},{xtype:"fieldset",checkboxToggle:!0,collapsed:!PhDOE.user.conf.reviewed.toolsPanelDisplay,title:_("Start with the panel open"),listeners:{collapse:function(){new ui.task.UpdateConfTask({module:"reviewed",itemName:"toolsPanelDisplay",value:!1})},expand:function(){new ui.task.UpdateConfTask({module:"reviewed",itemName:"toolsPanelDisplay",value:!0})}},items:[{xtype:"spinnerfield",width:60,name:"reviewed.toolsPanelWidth",module:"reviewed",itemName:"toolsPanelWidth",value:PhDOE.user.conf.reviewed.toolsPanelWidth||375,fieldLabel:_("Panel width"),minValue:0,maxValue:1e4,accelerate:!0,enableKeyEvents:!0,listeners:{keyup:function(){ui.cmp._EditorConf.CommitChange.delay(1e3,null,this)},spin:function(){ui.cmp._EditorConf.CommitChange.delay(1e3,null,this)}}}]}]}]}]}),ui.cmp._EditorConf.card5.superclass.initComponent.call(this)}}),ui.cmp._EditorConf.card6=Ext.extend(Ext.TabPanel,{id:"conf-card-6",autoScroll:!0,activeTab:0,defaults:{bodyStyle:"padding: 5px;",autoHeight:!0,autoScroll:!0},initComponent:function(){Ext.apply(this,{items:[{title:_("User Interface"),iconCls:"iconUI",items:[{xtype:"fieldset",title:_("Tools"),iconCls:"iconConf",defaults:{hideLabel:!0},defaultType:"checkbox",items:[{name:"allFiles.toolsPanelLogLoad",checked:PhDOE.user.conf.allFiles.toolsPanelLogLoad,boxLabel:_("Automatically load the log when displaying the file"),listeners:{check:function(e){new ui.task.UpdateConfTask({module:"allFiles",itemName:"toolsPanelLogLoad",value:e.getValue()})}}},{name:"allFiles.toolsPanelEntitiesLoad",checked:PhDOE.user.conf.allFiles.toolsPanelEntitiesLoad,boxLabel:_("Automatically load entities data when displaying the file"),listeners:{check:function(e){new ui.task.UpdateConfTask({module:"allFiles",itemName:"toolsPanelEntitiesLoad",value:e.getValue()})}}},{name:"allFiles.toolsPanelAcronymsLoad",checked:PhDOE.user.conf.allFiles.toolsPanelAcronymsLoad,boxLabel:_("Automatically load acronyms data when displaying the file"),listeners:{check:function(e){new ui.task.UpdateConfTask({module:"allFiles",itemName:"toolsPanelAcronymsLoad",value:e.getValue()})}}},{xtype:"fieldset",checkboxToggle:!0,collapsed:!PhDOE.user.conf.allFiles.toolsPanelDisplay,title:_("Start with the panel open"),listeners:{collapse:function(){new ui.task.UpdateConfTask({module:"allFiles",itemName:"toolsPanelDisplay",value:!1})},expand:function(){new ui.task.UpdateConfTask({module:"allFiles",itemName:"toolsPanelDisplay",value:!0})}},items:[{xtype:"spinnerfield",width:60,name:"allFiles.toolsPanelWidth",module:"allFiles",itemName:"toolsPanelWidth",value:PhDOE.user.conf.allFiles.toolsPanelWidth||375,fieldLabel:_("Panel width"),minValue:0,maxValue:1e4,accelerate:!0,enableKeyEvents:!0,listeners:{keyup:function(){ui.cmp._EditorConf.CommitChange.delay(1e3,null,this)},spin:function(){ui.cmp._EditorConf.CommitChange.delay(1e3,null,this)}}}]}]}]}]}),ui.cmp._EditorConf.card6.superclass.initComponent.call(this)}}),ui.cmp.EditorConf=Ext.extend(Ext.Window,{id:"win-conf",layout:"border",width:700,height:470,iconCls:"iconConf",title:_("Configuration"),modal:!0,plain:!0,bodyBorder:!1,closeAction:"hide",buttons:[{text:_("Close"),handler:function(){Ext.getCmp("win-conf").hide()}}],listeners:{show:function(){var e=Ext.getCmp("conf-menu-view");e.select(e.getNode(0))}},initComponent:function(){"en"===PhDOE.user.lang?ui.cmp._EditorConf.menuStore.loadData(ui.cmp._EditorConf.menuDefEn):ui.cmp._EditorConf.menuStore.loadData(ui.cmp._EditorConf.menuDefNonEn),Ext.apply(this,{items:[{id:"confMenu",region:"west",border:!1,width:190,autoScroll:!0,items:[new ui.cmp._EditorConf.viewMenu]},{id:"confCard",region:"center",border:!1,layout:"card",width:375,frame:!0,activeItem:0,bbar:new Ext.ux.StatusBar({defaultText:_("All changes take effect immediately"),defaultIconCls:"confStatusBar"}),items:[new ui.cmp._EditorConf.card1,new ui.cmp._EditorConf.card2,new ui.cmp._EditorConf.card3,new ui.cmp._EditorConf.card4,new ui.cmp._EditorConf.card5,new ui.cmp._EditorConf.card6]}]}),ui.cmp.EditorConf.superclass.initComponent.call(this)}}),Ext.namespace("ui","ui.cmp","ui.cmp._EmailPrompt"),ui.cmp.EmailPrompt=Ext.extend(Ext.Window,{title:_("Send an email"),width:500,height:300,minWidth:300,minHeight:200,layout:"fit",plain:!0,bodyStyle:"padding:5px;",buttonAlign:"center",iconCls:"iconSendEmail",closeAction:"hide",buttons:[{text:_("Send"),handler:function(){var e=this.ownerCt.ownerCt,t=e.findByType("form").shift().getForm().getValues();XHR({params:{task:"sendEmail",to:t.to,subject:t.subject,msg:t.msg},success:function(){e.hide(),Ext.Msg.alert(_("Status"),String.format(_("Email sent to {0} with success!"),e.name.ucFirst()),Ext.emptyFn)},failure:function(){PhDOE.winForbidden()}})}},{text:_("Cancel"),handler:function(){this.ownerCt.ownerCt.hide()}}],setData:function(e,t){this.name=e,this.email=t,this.items.items[0].items.items[0].setValue('"'+this.name.ucFirst()+'" <'+this.email+">"),this.items.items[0].items.items[1].setValue(""),this.items.items[0].items.items[2].setValue("")},initComponent:function(){Ext.apply(this,{items:new Ext.form.FormPanel({baseCls:"x-plain",labelWidth:55,defaultType:"textfield",items:[{name:"to",fieldLabel:_("Send To"),readOnly:!0,anchor:"100%",value:""},{name:"subject",fieldLabel:_("Subject"),anchor:"100%"},{name:"msg",xtype:"textarea",hideLabel:!0,anchor:"100% -53"}]})}),ui.cmp.EmailPrompt.superclass.initComponent.call(this)}}),Ext.namespace("ui","ui.cmp","ui.cmp._EntitiesAcronymsPanel"),ui.cmp._EntitiesAcronymsPanel.grid=Ext.extend(Ext.grid.GridPanel,{onRowClick:function(e){e=e.getSelectionModel().getSelected().data;Ext.getCmp(this.dataType+"-details-"+this.fid).update(e.value)},onRowDblClick:function(e){var t=e.getSelectionModel().getSelected().data,i=Ext.getCmp(this.prefix+"-"+this.ftype+"-FILE-"+this.fid),e=Ext.util.JSON.decode(i.getCursorPosition()),t="entities"===this.dataType?"&"+t.items+";":"<acronym>"+t.items+"</acronym>";i.insertIntoLine(e.line,e.caracter,t)},initComponent:function(){var e;"entities"===this.dataType?e="./do/getEntities":"acronyms"===this.dataType&&(e="./do/getAcronyms"),Ext.apply(this,{region:"center",split:!0,loadMask:!0,autoScroll:!0,bodyBorder:!1,border:!1,autoExpandColumn:this.dataType,columns:[{id:"items",header:_("Items"),sortable:!0,dataIndex:"items"},{header:_("From"),sortable:!0,dataIndex:"from",width:50}],viewConfig:{forceFit:!0,emptyText:'<div style="text-align: center">'+_("You must manually load this data.<br>Use the refresh button !")+"<br><br>"+_("(You can change this behavior by setting an option in the configuration window)")+"</div>",deferEmptyText:!1},sm:new Ext.grid.RowSelectionModel({singleSelect:!0}),store:new Ext.data.Store({autoLoad:this.loadStore,proxy:new Ext.data.HttpProxy({url:e}),listeners:{scope:this,load:function(){"entities"===this.dataType?Ext.getCmp(this.prefix+"-"+this.fid).panEntities=!0:"acronyms"===this.dataType&&(Ext.getCmp(this.prefix+"-"+this.fid).panAcronyms=!0),Ext.getCmp("main-panel").fireEvent("tabLoaded",this.prefix,this.fid)}},reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",idProperty:"id",fields:[{name:"id"},{name:"from"},{name:"items"},{name:"value"}]})}),tbar:[{scope:this,tooltip:_("<b>Load/Refresh</b>"),iconCls:"iconRefresh",handler:function(){this.store.reload()}},_("Filter: ")," ",new Ext.form.TwinTriggerField({width:180,hideTrigger1:!0,enableKeyEvents:!0,validateOnBlur:!1,validationEvent:!1,trigger1Class:"x-form-clear-trigger",trigger2Class:"x-form-search-trigger",listeners:{specialkey:function(e,t){t.getKey()===t.ENTER&&this.onTrigger2Click()}},onTrigger1Click:function(){this.setValue(""),this.triggers[0].hide(),this.setSize(180,10),this.ownerCt.ownerCt.store.clearFilter()},onTrigger2Click:function(){var t,e=this.getValue();""===e||e.length<3?this.markInvalid(_("Your filter must contain at least 3 characters")):(this.clearInvalid(),this.triggers[0].show(),this.setSize(180,10),t=new RegExp(e,"i"),this.ownerCt.ownerCt.store.filterBy(function(e){return!!(t.test(e.data.from)||t.test(e.data.items)||t.test(e.data.value))},this))}})]}),ui.cmp._EntitiesAcronymsPanel.grid.superclass.initComponent.call(this),this.on("rowclick",this.onRowClick,this),this.on("rowdblclick",this.onRowDblClick,this)}}),ui.cmp.EntitiesAcronymsPanel=Ext.extend(Ext.Panel,{initComponent:function(){var e;"entities"===this.dataType?e=_("Click on a row to display the content of the entitie.<br>Double-click on it to insert it at the cursor position."):"acronyms"===this.dataType&&(e=_("Click on a row to display the content of the acronym.<br>Double-click on it to insert it at the cursor position.")),Ext.apply(this,{layout:"border",border:!1,items:[new ui.cmp._EntitiesAcronymsPanel.grid({dataType:this.dataType,prefix:this.prefix,fid:this.fid,ftype:this.ftype,loadStore:this.loadStore}),{xtype:"panel",id:this.dataType+"-details-"+this.fid,region:"south",split:!0,height:100,autoScroll:!0,bodyBorder:!1,bodyCssClass:this.dataType+"-details",html:e}]}),ui.cmp.EntitiesAcronymsPanel.superclass.initComponent.call(this)}}),Ext.namespace("ui","ui.cmp","ui.cmp._ErrorFileGrid"),ui.cmp._ErrorFileGrid.store=new Ext.data.GroupingStore({proxy:new Ext.data.HttpProxy({url:"./do/getFilesError"}),reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",idProperty:"id",fields:[{name:"id"},{name:"path"},{name:"name"},{name:"maintainer"},{name:"type"},{name:"value_en"},{name:"value_lang"},{name:"fileModified"}]}),sortInfo:{field:"path",direction:"ASC"},groupField:"path",listeners:{datachanged:function(e){var t=e.getCount(),i=!1;PhDOE.user.haveKarma&&e.each(function(e){e.data.maintainer==PhDOE.user.login&&i++},this),Ext.getDom("acc-error-nb").innerHTML=t+(i?" - "+String.format(_("{0} mine"),i):"")}}}),ui.cmp._ErrorFileGrid.columns=[{id:"name",header:_("Files"),sortable:!0,dataIndex:"name",renderer:function(e,t,i){var n="",o=PhDOE.user.isAnonymous?"anonymous":PhDOE.user.login;return i.data.fileModified&&((i=Ext.util.JSON.decode(i.data.fileModified)).user===o&&i.anonymousIdent===PhDOE.user.anonymousIdent?n+=String.format(_("File {0} modified by me"),PhDOE.user.lang.ucFirst()):n+=String.format(_("File {0} modified by {1}"),PhDOE.user.lang.ucFirst(),i.user)),""!==n?"<span ext:qtip='"+n+"'>"+e+"</span>":e}},{header:_("Type"),width:45,sortable:!0,dataIndex:"type"},{header:_("Maintainer"),width:45,sortable:!0,dataIndex:"maintainer"},{header:_("Path"),dataIndex:"path",hidden:!0}],ui.cmp._ErrorFileGrid.view=new Ext.grid.GroupingView({emptyText:'<div style="text-align: center;">'+_("No Files")+"</div>",deferEmptyText:!1,forceFit:!0,startCollapsed:!0,groupTextTpl:'{[values.rs[0].data.path]} ({[values.rs.length]} {[values.rs.length > 1 ? "'+_("Files")+'" : "'+_("File")+'"]})',getRowClass:function(e){if(e.data.fileModified){var t=Ext.util.JSON.decode(e.data.fileModified),e=PhDOE.user.isAnonymous?"anonymous":PhDOE.user.login;return t.user===e&&t.anonymousIdent===PhDOE.user.anonymousIdent?"fileModifiedByMe":"fileModifiedByAnother"}return!1}}),ui.cmp._ErrorFileGrid.menu=function(e){Ext.apply(this,e),this.init(),ui.cmp._ErrorFileGrid.menu.superclass.constructor.call(this)},Ext.extend(ui.cmp._ErrorFileGrid.menu,Ext.menu.Menu,{init:function(){Ext.apply(this,{items:[{scope:this,text:"<b>"+_("Edit in a new tab")+"</b>",iconCls:"iconFilesError",handler:function(){this.grid.fireEvent("rowdblclick",this.grid,this.rowIdx,this.event)}},{scope:this,hidden:this.hideDiffMenu,text:_("View diff"),iconCls:"iconViewDiff",handler:function(){Ext.getCmp("main-panel").openDiffTab({DiffType:"file",FileName:this.fname,FilePath:PhDOE.user.lang+this.fpath})}},"-",{text:_("About error type"),iconCls:"iconHelp",handler:function(){Ext.getCmp("main-panel").findById("FE-help")||Ext.getCmp("main-panel").add({id:"FE-help",title:_("About error type"),iconCls:"iconHelp",closable:!0,autoScroll:!0,autoLoad:"./error"}),Ext.getCmp("main-panel").setActiveTab("FE-help")}}]})}}),ui.cmp.ErrorFileGrid=Ext.extend(Ext.grid.GridPanel,{loadMask:!0,border:!1,autoExpandColumn:"name",enableDragDrop:!0,ddGroup:"mainPanelDDGroup",view:ui.cmp._ErrorFileGrid.view,columns:ui.cmp._ErrorFileGrid.columns,listeners:{render:function(e){e.view.refresh()}},onRowContextMenu:function(e,t,i){i.stopEvent();var n=e.store.getAt(t).data,o=n.path,a=n.name;e.getSelectionModel().selectRow(t),new ui.cmp._ErrorFileGrid.menu({hideDiffMenu:!1===n.fileModified,grid:e,event:i,rowIdx:t,lang:PhDOE.user.lang,fpath:o,fname:a}).showAt(i.getXY())},onRowDblClick:function(e,t,i){this.openFile(e.store.getAt(t).data.id)},openFile:function(e){var t=this.store.getById(e),i=t.data.path,n=t.data.name,o=Ext.util.md5("FE-"+PhDOE.user.lang+i+n),a=[];Ext.getCmp("main-panel").findById("FE-"+o)||(a=[],this.store.each(function(e){e.data.path!==i||e.data.name!==n||a[e.data.type]||a.push(e.data.type)}),e="en"===PhDOE.user.lang?[new ui.cmp.VCSLogGrid({layout:"fit",title:String.format(_("{0} Log"),PhDOE.user.lang.ucFirst()),prefix:"FE-LANG",fid:o,fpath:PhDOE.user.lang+i,fname:n,loadStore:PhDOE.user.conf.error.toolsPanelLogLoad})]:[new ui.cmp.VCSLogGrid({layout:"fit",title:String.format(_("{0} Log"),PhDOE.user.lang.ucFirst()),prefix:"FE-LANG",fid:o,fpath:PhDOE.user.lang+i,fname:n,loadStore:PhDOE.user.conf.error.toolsPanelLogLoad}),new ui.cmp.VCSLogGrid({layout:"fit",title:String.format(_("{0} Log"),"En"),prefix:"FE-EN",fid:o,fpath:"en"+i,fname:n,loadStore:PhDOE.user.conf.error.toolsPanelLogLoad})],t="en"===PhDOE.user.lang?[new ui.cmp.FilePanel({id:"FE-LANG-PANEL-"+o,region:"center",title:String.format(_("{0} File: "),PhDOE.user.lang)+i+n,prefix:"FE",ftype:"LANG",spellCheck:PhDOE.user.conf.error.enableSpellCheckLang,spellCheckConf:{module:"error",itemName:"enableSpellCheckLang"},fid:o,fpath:i,fname:n,lang:PhDOE.user.lang,parser:"xml",storeRecord:t,syncScrollCB:!1,syncScroll:!1})]:[new ui.cmp.FilePanel({id:"FE-LANG-PANEL-"+o,region:"center",title:String.format(_("{0} File: "),PhDOE.user.lang.ucFirst())+i+n,prefix:"FE",ftype:"LANG",spellCheck:PhDOE.user.conf.error.enableSpellCheckLang,spellCheckConf:{module:"error",itemName:"enableSpellCheckLang"},fid:o,fpath:i,fname:n,lang:PhDOE.user.lang,parser:"xml",storeRecord:t,syncScrollCB:!0,syncScroll:!0,syncScrollConf:{module:"error",itemName:"syncScrollbars"}}),new ui.cmp.FilePanel({id:"FE-EN-PANEL-"+o,region:"east",title:_("en File: ")+i+n,prefix:"FE",ftype:"EN",original:!0,readOnly:!0,openInNewTabBtn:!0,fid:o,fpath:i,fname:n,lang:"en",parser:"xml",storeRecord:t,syncScroll:!0,syncScrollConf:{module:"error",itemName:"syncScrollbars"}})],Ext.getCmp("main-panel").add({id:"FE-"+o,title:n,layout:"border",iconCls:"iconTabError",closable:!0,tabLoaded:!1,panVCSLang:!PhDOE.user.conf.errorDisplayLog,panVCSEn:"en"===PhDOE.user.lang||!PhDOE.user.conf.errorDisplayLog,panLANGLoaded:!1,panENLoaded:"en"===PhDOE.user.lang,originTitle:n,defaults:{split:!0},tabTip:String.format(_("File with error : in {0}"),i),listeners:{resize:function(e){"en"!==PhDOE.user.lang&&Ext.getCmp("FE-EN-PANEL-"+o).setWidth(e.getWidth()/2)}},items:[{xtype:"panel",id:"FE-error-desc-"+o,region:"north",layout:"fit",title:_("Error description"),iconCls:"iconFilesError",collapsedIconCls:"iconFilesError",plugins:[Ext.ux.PanelCollapsedTitle],height:PhDOE.user.conf.error.descPanelHeight||150,collapsible:!0,collapsed:!PhDOE.user.conf.error.descPanelDisplay,autoScroll:!0,autoLoad:"./error?dir="+i+"&file="+n,listeners:{collapse:function(){this.ownerCt.tabLoaded&&new ui.task.UpdateConfTask({module:"error",itemName:"descPanelDisplay",value:!1})},expand:function(){this.ownerCt.tabLoaded&&new ui.task.UpdateConfTask({module:"error",itemName:"descPanelDisplay",value:!0})},resize:function(e,t,i){this.ownerCt.tabLoaded&&i&&50<i&&i!=PhDOE.user.conf.error.descPanelHeight&&new ui.task.UpdateConfTask({module:"error",itemName:"descPanelHeight",value:i})}}},{region:"west",xtype:"panel",title:_("Tools"),iconCls:"iconConf",collapsedIconCls:"iconConf",plugins:[Ext.ux.PanelCollapsedTitle],collapsible:!0,collapsed:!PhDOE.user.conf.error.toolsPanelDisplay,layout:"fit",bodyBorder:!1,width:PhDOE.user.conf.error.toolsPanelWidth||375,listeners:{collapse:function(){this.ownerCt.tabLoaded&&new ui.task.UpdateConfTask({module:"error",itemName:"toolsPanelDisplay",value:!1})},expand:function(){this.ownerCt.tabLoaded&&new ui.task.UpdateConfTask({module:"error",itemName:"toolsPanelDisplay",value:!0})},resize:function(e,t){this.ownerCt.tabLoaded&&t&&t!=PhDOE.user.conf.error.toolsPanelWidth&&new ui.task.UpdateConfTask({module:"error",itemName:"toolsPanelWidth",value:t})}},items:{xtype:"tabpanel",activeTab:0,tabPosition:"bottom",enableTabScroll:!0,defaults:{autoScroll:!0},items:[e,new ui.cmp.DictionaryGrid({layout:"fit",title:_("Dictionary"),prefix:"FE",fid:o}),{title:_("Entities"),layout:"fit",items:[new ui.cmp.EntitiesAcronymsPanel({dataType:"entities",prefix:"FE",ftype:"LANG",fid:o,loadStore:PhDOE.user.conf.error.toolsPanelEntitiesLoad})]},{title:_("Acronyms"),layout:"fit",items:[new ui.cmp.EntitiesAcronymsPanel({dataType:"acronyms",prefix:"FE",ftype:"LANG",fid:o,loadStore:PhDOE.user.conf.error.toolsPanelAcronymsLoad})]}]}},t]})),Ext.getCmp("main-panel").setActiveTab("FE-"+o)},initComponent:function(){Ext.apply(this,{store:ui.cmp._ErrorFileGrid.store,tbar:[_("Filter: ")," ",new Ext.form.TwinTriggerField({id:"FE-filter",width:180,hideTrigger1:!0,enableKeyEvents:!0,validateOnBlur:!1,validationEvent:!1,trigger1Class:"x-form-clear-trigger",trigger2Class:"x-form-search-trigger",listeners:{keypress:function(e,t){t.getKey()===t.ENTER&&this.onTrigger2Click()}},onTrigger1Click:function(){this.setValue(""),this.triggers[0].hide(),this.setSize(180,10),ui.cmp._ErrorFileGrid.instance.store.clearFilter()},onTrigger2Click:function(){var t,e=this.getValue();""===e||e.length<3?this.markInvalid(_("Your filter must contain at least 3 characters")):(this.clearInvalid(),this.triggers[0].show(),this.setSize(180,10),t=new RegExp(e,"i"),ui.cmp._ErrorFileGrid.instance.store.filterBy(function(e){return!!(t.test(e.data.path)||t.test(e.data.name)||t.test(e.data.maintainer)||t.test(e.data.type))},this))}})]}),ui.cmp.ErrorFileGrid.superclass.initComponent.call(this),this.on("rowcontextmenu",this.onRowContextMenu,this),this.on("rowdblclick",this.onRowDblClick,this),"en"===PhDOE.user.lang&&this.getColumnModel().setHidden(2,!0)}}),ui.cmp._ErrorFileGrid.instance=null,ui.cmp.ErrorFileGrid.getInstance=function(e){return ui.cmp._ErrorFileGrid.instance||(e=e||{},ui.cmp._ErrorFileGrid.instance=new ui.cmp.ErrorFileGrid(e)),ui.cmp._ErrorFileGrid.instance},Ext.namespace("ui","ui.cmp"),ui.cmp.ExecDiff=Ext.extend(Ext.Panel,{layout:"fit",title:_("Diff From VCS"),iconCls:"iconDiffView",collapsedIconCls:"iconDiffView",autoScroll:!0,plugins:[Ext.ux.PanelCollapsedTitle],onRender:function(e,t){ui.cmp.ExecDiff.superclass.onRender.call(this,e,t),this.el.mask('<img src="themes/img/loading.gif" style="vertical-align: middle;" /> '+_("Loading...")),XHR({scope:this,params:{task:"getDiff",DiffType:"vcs",FilePath:"en"+this.fpath,FileName:this.fname,Rev1:this.rev1,Rev2:this.rev2},success:function(e){e=Ext.util.JSON.decode(e.responseText);Ext.get(this.prefix+"-diff-"+this.fid).dom.innerHTML=e.content,this.el.unmask()},callback:function(){Ext.getCmp(this.prefix+"-"+this.fid).panDiffLoaded=!0,Ext.getCmp("main-panel").fireEvent("tabLoaded",this.prefix,this.fid)}})},initComponent:function(){Ext.apply(this,{html:'<div id="'+this.prefix+"-diff-"+this.fid+'" class="diff-content"></div>'}),ui.cmp.ExecDiff.superclass.initComponent.call(this)}}),Ext.namespace("ui","ui.cmp","ui.cmp._FilePanel"),Ext.namespace("ui.cmp._FilePanel.tbar.menu"),Ext.namespace("ui.cmp._FilePanel.tbar.items"),ui.cmp._FilePanel.tbar.items.undoRedo=function(e){Ext.apply(this,e),this.init(),ui.cmp._FilePanel.tbar.items.undoRedo.superclass.constructor.call(this)},Ext.extend(ui.cmp._FilePanel.tbar.items.undoRedo,Ext.ButtonGroup,{init:function(){Ext.apply(this,{id:this.id_prefix+"-FILE-"+this.fid+"-grp-undoRedo",items:[{id:this.id_prefix+"-FILE-"+this.fid+"-btn-undo",scope:this,tooltip:_("<b>Undo</b>"),disabled:!0,iconCls:"iconUndo",handler:function(){Ext.getCmp(this.id_prefix+"-FILE-"+this.fid).undo()}},{id:this.id_prefix+"-FILE-"+this.fid+"-btn-redo",scope:this,tooltip:_("<b>Redo</b>"),disabled:!0,iconCls:"iconRedo",handler:function(){Ext.getCmp(this.id_prefix+"-FILE-"+this.fid).redo()}}]})}}),ui.cmp._FilePanel.tbar.items.usernotes=function(e){Ext.apply(this,e),this.init(),ui.cmp._FilePanel.tbar.items.usernotes.superclass.constructor.call(this)},Ext.extend(ui.cmp._FilePanel.tbar.items.usernotes,Ext.ButtonGroup,{init:function(){Ext.apply(this,{items:[{xtype:"usernotes",file:this.file,fid:Ext.id()}]})}}),ui.cmp._FilePanel.tbar.items.common=function(e){Ext.apply(this,e),this.init(),ui.cmp._FilePanel.tbar.items.common.superclass.constructor.call(this)},Ext.extend(ui.cmp._FilePanel.tbar.items.common,Ext.ButtonGroup,{init:function(){Ext.apply(this,{items:[{scope:this,tooltip:_("Close Tab"),iconCls:"iconClose",handler:function(){Ext.getCmp("main-panel").remove(this.prefix+"-"+this.fid)}},{id:this.prefix+"-"+this.fid+"-btn-tabLeft-"+this.ftype,scope:this,tooltip:_("Go to previous tab"),iconCls:"iconArrowLeft",handler:this.goToPreviousTab},{id:this.prefix+"-"+this.fid+"-btn-tabRight-"+this.ftype,scope:this,tooltip:_("Go to next tab"),disabled:!0,iconCls:"iconArrowRight",handler:this.goToNextTab}]})}}),ui.cmp._FilePanel.tbar.menu.lang=function(e){Ext.apply(this,e),this.init(),ui.cmp._FilePanel.tbar.menu.lang.superclass.constructor.call(this)},Ext.extend(ui.cmp._FilePanel.tbar.menu.lang,Ext.Toolbar.Button,{text:_("MarkUp"),iconCls:"iconInsertCode",init:function(){Ext.apply(this,{menu:new Ext.menu.Menu({items:[{scope:this,text:_("Reviewed tag"),handler:function(){Ext.getCmp(this.comp_id).insertLine(2,"\x3c!-- Reviewed: no Maintainer: "+PhDOE.user.login+" --\x3e"),Ext.getCmp(this.comp_id).focus()}},{scope:this,text:_("Revcheck tag"),handler:function(){Ext.getCmp(this.comp_id).insertLine(1,"\x3c!-- EN-Revision: XX Maintainer: "+PhDOE.user.login+" Status: ready --\x3e"),Ext.getCmp(this.comp_id).focus()}}]})})}}),ui.cmp._FilePanel.tbar.menu.en=function(e){Ext.apply(this,e),this.init(),ui.cmp._FilePanel.tbar.menu.en.superclass.constructor.call(this)},Ext.extend(ui.cmp._FilePanel.tbar.menu.en,Ext.Toolbar.Button,{text:_("MarkUp"),iconCls:"iconInsertCode",init:function(){Ext.apply(this,{menu:new Ext.menu.Menu({items:[{scope:this,text:_("Description section"),handler:function(){var e=Ext.getCmp(this.comp_id).getCursor();Ext.getCmp(this.comp_id).insertLine(e.line,[' <refsect1 role="description">\x3c!-- {{{ --\x3e\r\n  ',"&reftitle.description;\r\n  ","<methodsynopsis>\r\n   ","\x3c!-- Example: All functions have this --\x3e\r\n   ","<type>thereturned type</type><methodname>func_name</methodname>\r\n   ","\x3c!-- Example: Required parameter --\x3e\r\n   ","<methodparam><type>param1type</type><parameter>firstparameter</parameter></methodparam>\r\n   ","\x3c!-- Example: Optional parameter, also by reference --\x3e\r\n   ",'<methodparam choice="opt"><type>int</type><parameter role="reference">secondparameter</parameter></methodparam>\r\n   ',"\x3c!-- Example: If no methodparams exist (void), use this --\x3e\r\n   ","<void />\r\n  ","</methodsynopsis>\r\n  ","<para>\r\n   ","The function description goes here.\r\n  ","</para>\r\n ","</refsect1>\x3c!-- }}} --\x3e"].join("")),Ext.getCmp(this.comp_id).focus()}},{scope:this,text:_("Parameters section"),handler:function(){var e=Ext.getCmp(this.comp_id).getCursor();Ext.getCmp(this.comp_id).insertLine(e.line,['\r\n<refsect1 role="parameters">\x3c!-- {{{ --\x3e\r\n',"&reftitle.parameters;\r\n","<para>\r\n","<variablelist>\r\n","<varlistentry>\r\n","<term><parameter>firstparameter</parameter></term>\r\n","<listitem>\r\n","<para>\r\n","Its description\r\n","</para>\r\n","</listitem>\r\n","</varlistentry>\r\n","<varlistentry>\r\n","<term>\r\n","<parameter>secondparameter</parameter>\r\n","</term>\r\n","<listitem>\r\n","<para>\r\n","Its description\r\n","</para>\r\n","</listitem>\r\n","</varlistentry>\r\n","</variablelist>\r\n","</para>\r\n","</refsect1>\x3c!-- }}} --\x3e"].join("")),Ext.getCmp(this.comp_id).focus()}},{scope:this,text:_("Return section"),handler:function(){var e=Ext.getCmp(this.comp_id).getCursor();Ext.getCmp(this.comp_id).insertLine(e.line,['\r\n<refsect1 role="returnvalues">\x3c!-- {{{ --\x3e\r\n',"&reftitle.returnvalues;\r\n","<para>\r\n","What this function returns, first on success, then failure.\r\n","If simply true on success and false on failure, just use &return.success; here.\r\n","</para>\r\n","</refsect1>\x3c!-- }}} --\x3e"].join("")),Ext.getCmp(this.comp_id).focus()}},{scope:this,text:_("Error section"),handler:function(){var e=Ext.getCmp(this.comp_id).getCursor();Ext.getCmp(this.comp_id).insertLine(e.line,['\r\n<refsect1 role="errors">\x3c!-- {{{ --\x3e\r\n',"&reftitle.errors;\r\n","<para>\r\n","When does this function issue E_* level errors, and/or throw exceptions.\r\n","</para>\r\n","</refsect1>\x3c!-- }}} --\x3e\r\n"].join("")),Ext.getCmp(this.comp_id).focus()}},{scope:this,text:_("Unicode section"),handler:function(){var e=Ext.getCmp(this.comp_id).getCursor();Ext.getCmp(this.comp_id).insertLine(e.line,['\r\n<refsect1 role="unicode">\x3c!-- {{{ --\x3e\r\n',"&reftitle.unicode;\r\n","<para>\r\n","Information specific to unicode, from the PHP 6 changes.\r\n","</para>\r\n","</refsect1>\x3c!-- }}} --\x3e"].join("")),Ext.getCmp(this.comp_id).focus()}},{scope:this,text:_("Changelog section"),handler:function(){var e=Ext.getCmp(this.comp_id).getCursor();Ext.getCmp(this.comp_id).insertLine(e.line,['\r\n<refsect1 role="changelog">\x3c!-- {{{ --\x3e\r\n',"&reftitle.changelog;\r\n","<para>\r\n","<informaltable>\r\n",'<tgroup cols="2">\r\n',"<thead>\r\n","<row>\r\n","<entry>&Version;</entry>\r\n","<entry>&Description;</entry>\r\n","</row>\r\n","</thead>\r\n","<tbody>\r\n","<row>\r\n","<entry>Enter the version of change here</entry>\r\n","<entry>\r\n","Describe the change\r\n","</entry>\r\n","</row>\r\n","</tbody>\r\n","</tgroup>\r\n","</informaltable>\r\n","</para>\r\n","</refsect1>\x3c!-- }}} --\x3e"].join("")),Ext.getCmp(this.comp_id).focus()}},{scope:this,text:_("Examples section"),handler:function(){var e=Ext.getCmp(this.comp_id).getCursor();Ext.getCmp(this.comp_id).insertLine(e.line,['\r\n<refsect1 role="examples">\x3c!-- {{{ --\x3e\r\n',"&reftitle.examples;\r\n","<para>\r\n",'<example xml:id="function-name.example.basic">\x3c!-- {{{ --\x3e\r\n',"<title><function>function-name</function> example</title>\r\n","<para>\r\n","Any text that describes the purpose of the example, or what\r\n","goes on in the example should be here. (Inside the <example> tag, not out).\r\n","</para>\r\n",'<programlisting role="php">\r\n',"<![CDATA[\r\n","<?php\r\n","if ($anexample === true) {\r\n","echo 'Use the PEAR Coding standards';\r\n","}\r\n","if ($thereisoutput === 'and it is multiple lines') {\r\n","echo 'Use a screen like we did below';\r\n","}\r\n","?>\r\n","]]>\r\n","</programlisting>\r\n","&example.outputs.similar;\r\n","<screen>\r\n","<![CDATA[\r\n","Use the PEAR Coding standards\r\n","Use a screen like we did below\r\n","]]>\r\n","</screen>\r\n","</example>\x3c!-- }}} --\x3e\r\n","</para>\r\n","</refsect1>\x3c!-- }}} --\x3e"].join("")),Ext.getCmp(this.comp_id).focus()}},{scope:this,text:_("Notes section"),handler:function(){var e=Ext.getCmp(this.comp_id).getCursor();Ext.getCmp(this.comp_id).insertLine(e.line,['\r\n<refsect1 role="notes">\x3c!-- {{{ --\x3e\r\n',"&reftitle.notes;\r\n","<caution>\r\n","<para>\r\n","Any notes that don't fit anywhere else should go here.\r\n","90% of the time, notes, warnings or cautions are better placed in the\r\n","parameters section. Consider that before using this section!\r\n","</para>\r\n","</caution>\r\n","&note.language-construct;\r\n","&note.not-bin-safe;\r\n","&note.registerglobals;\r\n","</refsect1>\x3c!-- }}} --\x3e"].join("")),Ext.getCmp(this.comp_id).focus()}},{scope:this,text:_("SeeAlso section"),handler:function(){var e=Ext.getCmp(this.comp_id).getCursor();Ext.getCmp(this.comp_id).insertLine(e.line,['\r\n<refsect1 role="seealso">\x3c!-- {{{ --\x3e\r\n',"&reftitle.seealso;\r\n","<para>\r\n","<simplelist>\r\n","<member><function>somefunc</function></member>\r\n","<member><function>another_func</function></member>\r\n",'<member>The <link linkend="something">something appendix</link></member>\r\n',"</simplelist>\r\n","</para>\r\n","</refsect1>\x3c!-- }}} --\x3e"].join("")),Ext.getCmp(this.comp_id).focus()}}]})})}}),ui.cmp._FilePanel.tbar.items.reindentTags=function(e){Ext.apply(this,e),this.init(),ui.cmp._FilePanel.tbar.items.reindentTags.superclass.constructor.call(this)},Ext.extend(ui.cmp._FilePanel.tbar.items.reindentTags,Ext.ButtonGroup,{init:function(){Ext.apply(this,{id:this.id_prefix+"-FILE-"+this.fid+"-grp-tools",items:[{scope:this,tooltip:_("<b>Check</b> XML with XmlLint"),iconCls:"iconXml",handler:function(e){new ui.task.CheckXml({idPrefix:this.id_prefix,fid:this.fid})}},new("en"===this.lang?ui.cmp._FilePanel.tbar.menu.en:ui.cmp._FilePanel.tbar.menu.lang)({comp_id:this.id_prefix+"-FILE-"+this.fid}),{scope:this,text:_("Editor option"),iconCls:"iconConf",menu:[{scope:this,text:_("Re-indent all this file"),iconCls:"iconIndent",handler:function(){Ext.getCmp(this.id_prefix+"-FILE-"+this.fid).reIndentAll()}},{scope:this,text:_("Enable line wrapping"),checked:!0===PhDOE.user.conf.main.lineWrapping,checkHandler:function(e,t){var i=!!t;Ext.getCmp(this.id_prefix+"-FILE-"+this.fid).setOption("lineWrapping",i),new ui.task.UpdateConfTask({module:"main",itemName:"lineWrapping",value:t,notify:!1})}},{scope:this,text:_("Choose a Theme"),iconCls:"iconThemes",onThemeChange:function(){var t=Ext.getCmp(this.ownerCt.ownerCt.ownerCt.id_prefix+"-FILE-"+this.ownerCt.ownerCt.ownerCt.fid);Ext.each(this.menu.items.items,function(e){!0===e.checked&&(t.switchTheme(e.themeName),new ui.task.UpdateConfTask({module:"main",itemName:"editorTheme",value:e.themeName,notify:!1}))})},menu:{items:[{text:_("No theme"),themeName:!1,checked:!1===PhDOE.user.conf.main.editorTheme,group:"cmd2-theme",checkHandler:function(){this.ownerCt.ownerCt.onThemeChange()}},{text:_("Default theme"),themeName:"default",checked:"default"===PhDOE.user.conf.main.editorTheme||"undefined"===PhDOE.user.conf.main.editorTheme,group:"cmd2-theme",checkHandler:function(){this.ownerCt.ownerCt.onThemeChange()}},{text:_("Cobalt"),themeName:"cobalt",checked:"cobalt"===PhDOE.user.conf.main.editorTheme,group:"cmd2-theme",checkHandler:function(){this.ownerCt.ownerCt.onThemeChange()}},{text:_("Eclipse"),themeName:"eclipse",checked:"eclipse"===PhDOE.user.conf.main.editorTheme,group:"cmd2-theme",checkHandler:function(){this.ownerCt.ownerCt.onThemeChange()}},{text:_("Elegant"),themeName:"elegant",checked:"elegant"===PhDOE.user.conf.main.editorTheme,group:"cmd2-theme",checkHandler:function(){this.ownerCt.ownerCt.onThemeChange()}},{text:_("Monokai"),themeName:"monokai",checked:"monokai"===PhDOE.user.conf.main.editorTheme,group:"cmd2-theme",checkHandler:function(){this.ownerCt.ownerCt.onThemeChange()}},{text:_("Neat"),themeName:"neat",checked:"neat"===PhDOE.user.conf.main.editorTheme,group:"cmd2-theme",checkHandler:function(){this.ownerCt.ownerCt.onThemeChange()}},{text:_("Night"),themeName:"night",checked:"night"===PhDOE.user.conf.main.editorTheme,group:"cmd2-theme",checkHandler:function(){this.ownerCt.ownerCt.onThemeChange()}},{text:_("RubyBlue"),themeName:"rubyblue",checked:"rubyblue"===PhDOE.user.conf.main.editorTheme,group:"cmd2-theme",checkHandler:function(){this.ownerCt.ownerCt.onThemeChange()}}]}}]}]})}}),ui.cmp.FilePanel=Ext.extend(Ext.form.FormPanel,{activeScroll:!1,goToPreviousTab:function(){for(var e,t,i=this.prefix+"-"+this.fid,n=Ext.getCmp("main-panel").layout.container.items.items,o=0;o<n.length;o++)n[o].id===i&&(t=o);e=1===t?"MainInfoTabPanel":n[t-1].id,Ext.getCmp("main-panel").setActiveTab(e)},goToNextTab:function(){for(var e,t,i=this.prefix+"-"+this.fid,n=Ext.getCmp("main-panel").layout.container.items.items,o=0;o<n.length;o++)n[o].id===i&&(t=o);n[t+1]&&(e=n[t+1].id,Ext.getCmp("main-panel").setActiveTab(e))},initComponent:function(){var o=this.prefix+"-"+this.ftype;this.bbar=this.syncScrollCB?[{height:22,xtype:"checkbox",name:"syncScrollConf.module",hideLabel:!0,checked:PhDOE.user.conf[this.syncScrollConf.module][this.syncScrollConf.itemName],boxLabel:_("Synchronize scroll bars"),listeners:{scope:this,check:function(e){new ui.task.UpdateConfTask({module:this.syncScrollConf.module,itemName:this.syncScrollConf.itemName,value:e.getValue(),notify:!1})},render:function(e){Ext.DomHelper.insertHtml("beforeBegin",e.el.dom,['<div style="display: inline;" class="x-statusbar">','<span class="x-status-text-panel">',_("Line: "),'<span id="',o,"-status-line-",this.fid,'">-</span></span>','&nbsp;&nbsp;<span class="x-status-text-panel">',_("Col: "),'<span id="',o,"-status-col-",this.fid,'">-</span></span>',"</div>&nbsp;&nbsp;"].join(""))}}}]:[{xtype:"panel",height:22,baseCls:"",bodyStyle:"padding-top:5px;",html:['<div style="display: inline;" class="x-statusbar">','<span class="x-status-text-panel">',_("Line: "),'<span id="',o,"-status-line-",this.fid,'">-</span></span>','&nbsp;&nbsp;<span class="x-status-text-panel">',_("Col: "),'<span id="',o,"-status-col-",this.fid,'">-</span></span>',"</div>&nbsp;&nbsp;"].join("")}],this.readOnly?this.tbar=[new ui.cmp._FilePanel.tbar.items.common({prefix:this.prefix,fid:this.fid,ftype:this.ftype,goToPreviousTab:this.goToPreviousTab,goToNextTab:this.goToNextTab}),{xtype:"buttongroup",hidden:!0!==this.openInNewTabBtn,scope:this,items:[{tooltip:_("Open for editing in a new Tab"),iconCls:"iconEditInNewTab",scope:this,handler:function(){ui.cmp.RepositoryTree.getInstance().openFile("byPath",this.lang+this.fpath,this.fname)}},{tooltip:_("Copy English Git revision"),iconCls:"iconEditInNewTab",scope:this,handler:function(){window.prompt("Copy to clipboard: Ctrl+C, Enter",this.form.storeRecord.data.en_revision)}}]},"->","GGTRANS"!==this.ftype?new ui.cmp._FilePanel.tbar.items.usernotes({fid:this.fid,file:this.lang+this.fpath+this.fname}):""]:this.tbar=[new ui.cmp._FilePanel.tbar.items.common({prefix:this.prefix,fid:this.fid,ftype:this.ftype,goToPreviousTab:this.goToPreviousTab,goToNextTab:this.goToNextTab}),{xtype:"buttongroup",id:o+"-FILE-"+this.fid+"-grp-save",items:[{id:o+"-FILE-"+this.fid+"-btn-save",scope:this,tooltip:_("<b>Save</b> this file (CTRL+s)"),iconCls:"iconSaveFile",disabled:!0,handler:function(){if("AF"!==this.prefix)if("FNT"!==this.prefix)switch(PhDOE.user.conf.main.onSaveFile||(PhDOE.user.conf.main.onSaveFile="ask-me"),PhDOE.user.conf.main.onSaveFile){case"always":new ui.task.CheckFileTask({prefix:this.prefix,ftype:this.ftype,fid:this.fid,fpath:this.fpath,fname:this.fname,lang:this.lang,storeRecord:this.storeRecord});break;case"never":new ui.task.SaveFileTask({prefix:this.prefix,ftype:this.ftype,fid:this.fid,fpath:this.fpath,fname:this.fname,lang:this.lang,storeRecord:this.storeRecord});break;case"ask-me":Ext.MessageBox.show({title:_("Confirm"),msg:_("Do you want to check for errors before saving?"),icon:Ext.MessageBox.INFO,buttons:Ext.MessageBox.YESNOCANCEL,scope:this,fn:function(e){"no"===e?new ui.task.SaveFileTask({prefix:this.prefix,ftype:this.ftype,fid:this.fid,fpath:this.fpath,fname:this.fname,lang:this.lang,storeRecord:this.storeRecord}):"yes"===e&&new ui.task.CheckFileTask({prefix:this.prefix,ftype:this.ftype,fid:this.fid,fpath:this.fpath,fname:this.fname,lang:this.lang,storeRecord:this.storeRecord})}})}else new ui.task.SaveTransFileTask({prefix:this.prefix,ftype:this.ftype,fid:this.fid,fpath:this.fpath,fname:this.fname,lang:this.lang,storeRecord:this.storeRecord});else new ui.task.SaveFileTask({prefix:this.prefix,ftype:this.ftype,fid:this.fid,fpath:this.fpath,fname:this.fname,lang:this.lang,storeRecord:this.storeRecord})}}]},new ui.cmp._FilePanel.tbar.items.undoRedo({id_prefix:o,fid:this.fid}),new ui.cmp._FilePanel.tbar.items.reindentTags({id_prefix:o,fid:this.fid,lang:this.lang}),{scope:this,iconCls:"iconZoom",tooltip:_("<b>Expand</b> in a popup"),handler:function(e){var n=new Ext.Window({title:this.originTitle,bodyStyle:"background-color:white",maximized:!0,animateTarget:e.el,items:[{xtype:"codemirror",id:o+"-FILE-"+this.fid+"maximized",readOnly:!1,lineWrapping:PhDOE.user.conf.main.lineWrapping,theme:PhDOE.user.conf.main.editorTheme,parser:this.parser,isModified:!1,listeners:{scope:this,initialize:function(){var e=Ext.getCmp(o+"-FILE-"+this.fid+"maximized"),t=Ext.getCmp(o+"-FILE-"+this.fid).getValue();e.setValue(t);var i=new Ext.util.DelayedTask(function(){n.rendered?e.resize(!1,n.getInnerHeight()+89):i.delay(500)});i.delay(500)}}}],listeners:{scope:this,beforeclose:function(e){e=e.items.items[0].getValue();Ext.getCmp(o+"-FILE-"+this.fid).setValue(e)}}});n.show()}},{scope:this,iconCls:"iconView",hidden:!("en"===this.lang&&"xml"===this.fname.substr(-3)),tooltip:_("<b>Preview</b> in a popup"),handler:function(){Ext.getCmp(o+"-FILE-"+this.fid).isModified?Ext.Msg.alert(_("Information"),_("You must save your file in order to preview the result."),function(e){"ok"==e&&new ui.cmp.PreviewFile({path:this.lang+this.fpath+this.fname})},this):new ui.cmp.PreviewFile({path:this.lang+this.fpath+this.fname})}},"->",new ui.cmp._FilePanel.tbar.items.usernotes({fid:this.fid,file:this.lang+this.fpath+this.fname})],Ext.apply(this,{title:this.title,cls:"code-mirror-panel",originTitle:this.title,items:[{xtype:"codemirror",id:o+"-FILE-"+this.fid,readOnly:this.readOnly,lineWrapping:PhDOE.user.conf.main.lineWrapping,theme:PhDOE.user.conf.main.editorTheme,parser:this.parser,isModified:!1,listeners:{scope:this,initialize:function(){var e,t=(e=!this.isTrans||this.storeRecord.data.fileModified?this.lang+this.fpath:"en"+this.fpath,this.fname);new ui.task.GetFileTask({prefix:this.prefix,ftype:this.ftype,original:this.original,fid:this.fid,fpath:e,freadOnly:this.readOnly,fname:t,skeleton:this.skeleton,storeRecord:this.storeRecord})},coderestored:function(){this.readOnly||Ext.getCmp(o+"-FILE-"+this.fid).isModified&&(Ext.getCmp(o+"-PANEL-"+this.fid).setTitle(Ext.getCmp(o+"-PANEL-"+this.fid).permlink+Ext.getCmp(o+"-PANEL-"+this.fid).originTitle),(("LANG"!==this.ftype||"en"===PhDOE.user.lang)&&"EN"!==this.ftype||"EN"===this.ftype&&!Ext.getCmp(this.prefix+"-LANG-FILE-"+this.fid).isModified||"LANG"===this.ftype&&!Ext.getCmp(this.prefix+"-EN-FILE-"+this.fid).isModified)&&Ext.getCmp(this.prefix+"-"+this.fid).setTitle(Ext.getCmp(this.prefix+"-"+this.fid).originTitle),Ext.getCmp(o+"-FILE-"+this.fid+"-btn-save").disable(),Ext.getCmp(o+"-FILE-"+this.fid).isModified=!1,Ext.getCmp(this.prefix+"-"+this.fid).isModified=!1)},codemodified:function(){var e,t;this.readOnly||Ext.getCmp(o+"-FILE-"+this.fid+"-grp-save").disabled||(e=Ext.getCmp(o+"-FILE-"+this.fid),t=Ext.getCmp(o+"-PANEL-"+this.fid),e.isModified||(t.setTitle(t.permlink+t.originTitle+' <span style="color:#ff0000; font-weight: bold;">['+_("modified")+"]</span>"),Ext.getCmp(this.prefix+"-"+this.fid).setTitle(Ext.getCmp(this.prefix+"-"+this.fid).originTitle+' <t style="color:#ff0000; font-weight: bold;">*</t>'),Ext.getCmp(this.prefix+"-"+this.fid).isModified=!0,Ext.getCmp(o+"-FILE-"+this.fid+"-btn-save").enable(),Ext.getCmp(o+"-FILE-"+this.fid+"-btn-undo").enable(),e.isModified=!0))},cursormove:function(e,t){Ext.get(o+"-status-line-"+this.fid).dom.innerHTML=e,Ext.get(o+"-status-col-"+this.fid).dom.innerHTML=t},scroll:function(e){var t,i,n;if(this.syncScroll&&PhDOE.user.conf[this.syncScrollConf.module][this.syncScrollConf.itemName]){switch(this.ftype){case"EN":t="FNT"==this.prefix?this.prefix+"-TRANS":this.prefix+"-LANG";break;case"LANG":t=this.prefix+"-EN";break;case"TRANS":"google"==PhDOE.user.conf.newFile.secondPanel&&(t=this.prefix+"-GGTRANS"),"originalFile"==PhDOE.user.conf.newFile.secondPanel&&(t=this.prefix+"-EN");break;case"GGTRANS":t=this.prefix+"-TRANS"}i=Ext.getCmp(t+"-PANEL-"+this.fid),n=Ext.getCmp(t+"-FILE-"+this.fid),!1===i.activeScroll?(this.activeScroll=!0,n.scrollTo(e)):i.activeScroll=!1}}}}]}),ui.cmp.FilePanel.superclass.initComponent.call(this)}}),Ext.namespace("ui","ui.cmp"),ui.cmp.GoogleTranslationPanel=Ext.extend(Ext.FormPanel,{border:!1,labelAlign:"top",bodyStyle:"padding:5px",autoScroll:!0,getTranslation:function(e){new ui.task.GetGGTranslation({str:e})},initComponent:function(){Ext.apply(this,{items:[{xtype:"textarea",anchor:"90%",fieldLabel:String.format(_("String to translate (en => {0})"),PhDOE.user.lang),name:"GGTranslate-string",id:"GGTranslate-string",allowBlank:!1},{scope:this,xtype:"button",text:_("Translate !"),id:"GGTranslate-btn",handler:function(){this.getTranslation(Ext.getCmp("GGTranslate-string").getValue())}},{xtype:"panel",anchor:"100%",border:!1,bodyStyle:"padding:5px",html:'<div id="GGTranslate-result" style="width: 90%; font: 12px tahoma,arial,sans-serif"></div>'}]}),ui.cmp.GoogleTranslationPanel.superclass.initComponent.call(this)}}),Ext.namespace("ui","ui.cmp","ui.cmp._MainMenu"),ui.cmp.MainMenu=function(e){Ext.apply(this,e),this.init(),ui.cmp.MainMenu.superclass.constructor.call(this)},ui.cmp._MainMenu.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:"./do/getAvailableLanguage"}),reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",idProperty:"code",fields:[{name:"code"},{name:"iconCls"},{name:"name"}]})}),ui.cmp._MainMenu.store.on("load",function(e){Ext.getDom("Info-Language").innerHTML=_(e.getById(PhDOE.user.lang).data.name),Ext.getDom("Topic-Language").innerHTML=String.format(_("{0} Topic:"),_(e.getById(PhDOE.user.lang).data.name)),e.each(function(e){var t=new Ext.menu.Item({text:e.data.name+" ("+e.data.code+")",iconCls:"mainMenuLang flags "+e.data.iconCls,disabled:e.data.code===PhDOE.user.lang,handler:function(){XHR({params:{task:"switchLang",lang:e.data.code},success:function(){window.location.reload()}})}});Ext.getCmp("MenuLang-ct").add(t)})},this),Ext.extend(ui.cmp.MainMenu,Ext.menu.Menu,{id:"mainMenu",init:function(){var e=new Ext.menu.Menu({id:"MenuLang-ct"});Ext.apply(this,{items:[{text:_("Refresh all data"),disabled:!0,iconCls:"iconRefresh",handler:function(){Ext.getBody().mask('<img src="themes/img/loading.gif" style="vertical-align: middle;" /> '+_("Verify if there is an update in progress. Please, wait...")),XHR({params:{task:"checkLockFile",lockFiles:"project_"+PhDOE.project+"_lock_update_repository|project_"+PhDOE.project+"_lock_apply_tools"},success:function(){Ext.getBody().unmask(),Ext.MessageBox.show({title:_("Status"),msg:_("There is currently an update in progress.<br/>You can't perform an update now."),buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO})},failure:function(){Ext.getBody().unmask(),(new ui.cmp.SystemUpdatePrompt).show(Ext.get("acc-need-update"))}})}},{text:_("Build tools"),handler:function(){return!1},menu:new Ext.menu.Menu({items:[{text:_("Check build"),disabled:!PhDOE.user.isGlobalAdmin&&!PhDOE.user.isLangAdmin,iconCls:"iconCheckBuild",handler:function(){Ext.getBody().mask('<img src="themes/img/loading.gif" style="vertical-align: middle;" /> '+_("Verify if there is a check in progress. Please, wait...")),XHR({params:{task:"checkLockFile",lockFile:"project_"+PhDOE.project+"_lock_check_build_"+PhDOE.user.lang},success:function(){Ext.getBody().unmask(),Ext.MessageBox.show({title:_("Status"),msg:_("There is currently a check in progress for this language.<br/>You can't perform a new check now."),buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO})},failure:function(){Ext.getBody().unmask(),(new ui.cmp.CheckBuildPrompt).show(Ext.get("acc-need-update"))}})}},{text:_("Show last failed build"),iconCls:"iconBuildStatus",handler:function(){Ext.getCmp("tab-build-status")||Ext.getCmp("main-panel").add({id:"tab-build-status",title:_("Last failed build"),iconCls:"iconBuildStatus",layout:"fit",closable:!0,items:[new ui.cmp.BuildStatus]}),Ext.getCmp("main-panel").setActiveTab("tab-build-status")}}]})},{text:_("EN tools"),handler:function(){return!1},menu:new Ext.menu.Menu({items:[{text:_("Script check entities"),iconCls:"iconCheckEntities",handler:function(){return!1},menu:new Ext.menu.Menu({items:[{text:_("View the last result"),id:"btn-check-entities-view-last-result",iconCls:"iconTabView",handler:function(){Ext.getCmp("tab-check-entities")||Ext.getCmp("main-panel").add({id:"tab-check-entities",title:_("Check entities"),iconCls:"iconCheckEntities",layout:"fit",closable:!0,items:[new ui.cmp.CheckEntities]}),Ext.getCmp("main-panel").setActiveTab("tab-check-entities")}},{text:_("Run this script"),iconCls:"iconRun",disabled:!PhDOE.user.haveKarma,handler:function(){Ext.getBody().mask('<img src="themes/img/loading.gif" style="vertical-align: middle;" /> '+_("Verify if there is an entities check in progress. Please, wait...")),XHR({params:{task:"checkLockFile",lockFile:"project_"+PhDOE.project+"_lock_check_entities"},success:function(){Ext.getBody().unmask(),Ext.MessageBox.show({title:_("Status"),msg:_("There is currently a check in progress for the entities.<br/>You can't perform a new check now."),buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO})},failure:function(){Ext.getBody().unmask(),Ext.getCmp("win-check-entities")||new ui.cmp.CheckEntitiesPrompt,Ext.getCmp("win-check-entities").show(Ext.get("mainMenu"))}})}}]})},{text:_("Script check document"),iconCls:"iconCheckDoc",handler:function(){Ext.getCmp("tab-check-doc")||Ext.getCmp("main-panel").add({id:"tab-check-doc",title:"Check Doc",iconCls:"iconCheckDoc",layout:"fit",closable:!0,items:[new ui.cmp.CheckDoc]}),Ext.getCmp("main-panel").setActiveTab("tab-check-doc")}}]})},"-",{text:_("Configure"),iconCls:"iconConf",tooltip:"<b>Configure</b> this tool",id:"winconf-btn",handler:function(){Ext.getCmp("win-conf")||new ui.cmp.EditorConf,Ext.getCmp("win-conf").show(Ext.get("mainMenu"))}},"-",{id:"menuLang",iconCls:"iconSwitchLang",text:_("Switch to language..."),handler:function(){return!1},menu:e},{text:_("Erase my personal data"),iconCls:"iconErasePersonalData",disabled:!PhDOE.user.haveKarma,handler:function(){Ext.MessageBox.confirm(_("Confirm"),_("This action will erase your personal data. All content about this account will be deleted definitively. Are you sure you want to do that ?"),function(e){"yes"===e&&(Ext.getBody().mask('<img src="themes/img/loading.gif" style="vertical-align: middle;" /> '+_("Please, wait...")),XHR({params:{task:"erasePersonalData"},success:function(){Ext.getBody().unmask(),Ext.MessageBox.show({title:_("Thanks !"),msg:_("Thank you for using this application !"),icon:Ext.MessageBox.INFO,buttons:Ext.MessageBox.OK,fn:function(){window.location.href="./do/logout?csrfToken="+csrfToken}})},failure:function(){Ext.getBody().unmask(),PhDOE.winForbidden()}}))})}},{text:_("Log out"),iconCls:"iconLogOut",handler:function(){Ext.MessageBox.confirm(_("Confirm"),_("Are you sure you want to logout?"),function(e){"yes"===e&&(window.location.href="./do/logout?csrfToken="+csrfToken)})}},"-",{id:"tab-report-bug-btn",text:_("Report bugs"),iconCls:"iconBugs",handler:function(){Ext.getCmp("main-panel").findById("tab-report-bug")||Ext.getCmp("main-panel").add({id:"tab-report-bug",xtype:"panel",title:_("Report bugs"),iconCls:"iconBugs",closable:!0,layout:"fit",items:[new Ext.ux.IFrameComponent({id:"frame-tab-report-bug",url:"https://bugs.php.net/"})]}),Ext.getCmp("main-panel").setActiveTab("tab-report-bug")}},{id:"tab-documentation-btn",text:_("Help"),iconCls:"iconInfo",handler:function(){Ext.getCmp("main-panel").findById("tab-documentation")||Ext.getCmp("main-panel").add({id:"tab-documentation",xtype:"panel",title:_("Help"),iconCls:"iconInfo",closable:!0,layout:"fit",items:[new Ext.ux.IFrameComponent({id:"frame-tab-documentation",url:"https://wiki.php.net/doc/editor/"})]}),Ext.getCmp("main-panel").setActiveTab("tab-documentation")}},{id:"tab-chat-btn",text:_("Chat with us on IRC !"),iconCls:"iconChat",handler:function(){var e;Ext.getCmp("main-panel").findById("tab-chat")||(e=PhDOE.user.login,PhDOE.user.isAnonymous&&(e="an%3F%3F%3F"),Ext.getCmp("main-panel").add({id:"tab-chat",xtype:"panel",title:_("Chat"),iconCls:"iconChat",closable:!0,layout:"fit",items:[new Ext.ux.IFrameComponent({id:"frame-tab-chat",url:"https://widget.mibbit.com/?settings=8eec4034df2eb666b0600bdfe151529a&server=irc.umich.edu&channel=%23php.doc&nick=poe_"+e})]})),Ext.getCmp("main-panel").setActiveTab("tab-chat")}},"-",{id:"winabout-btn",text:_("About"),iconCls:"iconHelp",handler:function(){(new ui.cmp.About).show(Ext.get("winabout-btn"))}}]})}}),Ext.namespace("ui","ui.cmp","ui.cmp.MainPanel"),ui.cmp.MainPanel=Ext.extend(Ext.ux.SlidingTabPanel,{activeTab:0,enableTabScroll:!0,plugins:["tabclosemenu","dblclickclosetabs"],initComponent:function(e){Ext.apply(this,e),ui.cmp.MainPanel.superclass.initComponent.call(this),this.addEvents({tabLoaded:!0}),this.on("beforeremove",this.onBeforeRemove,this),this.on("tabchange",this.onTabChange,this),this.on("endDrag",this.onTabChange,this),this.on("tabLoaded",this.onTabLoaded,this)},onTabLoaded:function(e,t){t=Ext.getCmp(e+"-"+t);"FNT"===e&&t.panTRANSLoaded&&t.panTRANSSecondLoaded&&(t.tabLoaded=!0,t.panTRANSLoaded=t.panTRANSSecondLoaded=!1,PhDOE.FNTfilePendingOpen[0]&&(ui.cmp.PendingTranslateGrid.getInstance().openFile(PhDOE.FNTfilePendingOpen[0].id),PhDOE.FNTfilePendingOpen.shift())),"FNU"===e&&t.panLANGLoaded&&t.panENLoaded&&t.panDiffLoaded&&t.panVCSLang&&t.panVCSEn&&(t.tabLoaded=!0,t.panLANGLoaded=t.panENLoaded=t.panDiffLoaded=t.panVCSLang=t.panVCSEn=!1,PhDOE.FNUfilePendingOpen[0]&&(ui.cmp.StaleFileGrid.getInstance().openFile(PhDOE.FNUfilePendingOpen[0].id),PhDOE.FNUfilePendingOpen.shift())),"FE"===e&&t.panLANGLoaded&&t.panENLoaded&&t.panVCSLang&&t.panVCSEn&&(t.tabLoaded=!0,t.panLANGLoaded=t.panENLoaded=t.panVCSLang=t.panVCSEn=!1,PhDOE.FEfilePendingOpen[0]&&(ui.cmp.ErrorFileGrid.getInstance().openFile(PhDOE.FEfilePendingOpen[0].id),PhDOE.FEfilePendingOpen.shift())),"FNR"===e&&t.panLANGLoaded&&t.panENLoaded&&t.panVCSLang&&t.panVCSEn&&(t.tabLoaded=!0,t.panLANGLoaded=t.panENLoaded=t.panVCSLang=t.panVCSEn=!1,PhDOE.FNRfilePendingOpen[0]&&(ui.cmp.PendingReviewGrid.getInstance().openFile(PhDOE.FNRfilePendingOpen[0].id),PhDOE.FNRfilePendingOpen.shift())),"FNIEN"===e&&t.panLANGLoaded&&(t.tabLoaded=!0,t.panLANGLoaded=!1,PhDOE.FNIENfilePendingOpen[0]&&(ui.cmp.NotInENGrid.getInstance().openFile(PhDOE.FNIENfilePendingOpen[0].id),PhDOE.FNIENfilePendingOpen.shift())),"AF"===e&&t.panLoaded&&t.panVCS&&t.panEntities&&t.panAcronyms&&(t.tabLoaded=!0,t.panLoaded=t.panVCS=!1,PhDOE.AFfilePendingOpen[0]&&(ui.cmp.RepositoryTree.getInstance().openFile(PhDOE.AFfilePendingOpen[0].nodeID?"byId":"byPath",PhDOE.AFfilePendingOpen[0].nodeID||PhDOE.AFfilePendingOpen[0].fpath,!PhDOE.AFfilePendingOpen[0].nodeID&&PhDOE.AFfilePendingOpen[0].fname),PhDOE.AFfilePendingOpen.shift())),"PP"===e&&t.panPatchLoaded&&t.panOriginLoaded&&t.panVCS&&t.panPatchContent&&(t.tabLoaded=!0,t.panPatchLoaded=t.panOriginLoaded=t.panVCS=t.panPatchContent=!1,PhDOE.PPfilePendingOpen[0]&&(ui.cmp.PendingPatchGrid.getInstance().openFile(PhDOE.PPfilePendingOpen[0].id),PhDOE.PPfilePendingOpen.shift()))},onTabChange:function(e,t){if(Ext.getCmp(t.id+"-btn-tabRight-LANG")||Ext.getCmp(t.id+"-btn-tabRight-EN")||Ext.getCmp(t.id+"-btn-tabRight-ALL")||Ext.getCmp(t.id+"-btn-tabRight-NotInEN")||Ext.getCmp(t.id+"-btn-tabRight-PATCH")||Ext.getCmp(t.id+"-btn-tabRight-TRANS")||Ext.getCmp(t.id+"-btn-tabRight-NEW")){for(var i,n=t.id,o=Ext.getCmp("main-panel").layout.container.items.items,a=0;a<o.length;a++)o[a].id===n&&(i=a);o[i+1]&&(Ext.getCmp(t.id+"-btn-tabRight-LANG")&&Ext.getCmp(t.id+"-btn-tabRight-LANG").enable(),Ext.getCmp(t.id+"-btn-tabRight-EN")&&Ext.getCmp(t.id+"-btn-tabRight-EN").enable(),Ext.getCmp(t.id+"-btn-tabRight-ALL")&&Ext.getCmp(t.id+"-btn-tabRight-ALL").enable(),Ext.getCmp(t.id+"-btn-tabRight-NotInEN")&&Ext.getCmp(t.id+"-btn-tabRight-NotInEN").enable(),Ext.getCmp(t.id+"-btn-tabRight-PATCH")&&Ext.getCmp(t.id+"-btn-tabRight-PATCH").enable(),Ext.getCmp(t.id+"-btn-tabRight-TRANS")&&Ext.getCmp(t.id+"-btn-tabRight-TRANS").enable(),Ext.getCmp(t.id+"-btn-tabRight-NEW")&&Ext.getCmp(t.id+"-btn-tabRight-NEW").enable())}},openDirectAction:function(e){new ui.cmp.DirectActionWin(e)},onBeforeRemove:function(i,n){var e,t,o,a=n.id.split("-");return"FE"!==a[0]&&"FNU"!==a[0]&&"FNR"!==a[0]&&"PP"!==a[0]&&"AF"!==a[0]&&"FNT"!==a[0]||"help"===a[1]||("FE"===a[0]&&(e=Ext.getCmp("FE-LANG-FILE-"+a[1]).isModified,t="en"!==PhDOE.user.lang&&Ext.getCmp("FE-EN-FILE-"+a[1]).isModified),"FNU"===a[0]&&(e=Ext.getCmp("FNU-LANG-FILE-"+a[1]).isModified,t=Ext.getCmp("FNU-EN-FILE-"+a[1]).isModified),"FNR"===a[0]&&(e=Ext.getCmp("FNR-LANG-FILE-"+a[1]).isModified,t=Ext.getCmp("FNR-EN-FILE-"+a[1]).isModified),"PP"===a[0]&&(o=Ext.getCmp("PP-PATCH-FILE-"+a[1]).isModified),"AF"===a[0]&&(o=Ext.getCmp("AF-ALL-FILE-"+a[1]).isModified),"FNT"===a[0]&&(o=(Ext.getCmp("FNT-TRANS-FILE-"+a[1])?Ext.getCmp("FNT-TRANS-FILE-"+a[1]):Ext.getCmp("FNT-NEW-FILE-"+a[1])).isModified),!(t||e||o)||(Ext.Msg.show({scope:this,title:_("Confirm"),msg:_("This file has been modified without being saved.<br/>Do you really want to close?"),buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(e,t){"yes"===e&&(i.un("beforeremove",this.onBeforeRemove,this),i.remove(n),i.addListener("beforeremove",this.onBeforeRemove,this))}}),!1))},openDiffTab:function(e){var t,i,n,o,a,r=e.DiffType,s=e.currentOwner||"",l=e.fileIdDB||"",d=e.FileName||"",c=e.FilePath||"",u=e.patchID||"",h=e.patchName||"",p=Ext.util.md5(h+u+c+d),m=Ext.util.Cookies.get("optNbLine")||3,f=!(!Ext.util.Cookies.get("optB")||"true"!=Ext.util.Cookies.get("optB")),g=!(!Ext.util.Cookies.get("optW")||"true"!=Ext.util.Cookies.get("optW")),e=""!=u?(i=String.format(_("Diff for patch: {0}"),h),t="./do/downloadPatch?patchID="+u+"&csrfToken="+csrfToken,_("Download the unified diff as a patch")):(i=String.format(_("Diff for file: {0}"),c+d),t="./do/downloadPatch?FilePath="+c+"&FileName="+d+"&csrfToken="+csrfToken,_("Download the diff as a patch"));Ext.getCmp("main-panel").findById("diff_panel_"+p)?Ext.getCmp("main-panel").setActiveTab("diff_panel_"+p):(e=[{xtype:"buttongroup",items:[{xtype:"button",iconCls:"iconEdit",tooltip:_("Edit in a new tab"),handler:function(){ui.cmp.RepositoryTree.getInstance().openFile("byPath",c,d)}},{xtype:"button",iconCls:"iconDownloadDiff",tooltip:e,handler:function(){window.location.href=t}}]},PhDOE.user.isGlobalAdmin||PhDOE.user.isLangAdmin?{xtype:"buttongroup",items:[{xtype:"button",iconCls:"iconPageDelete",tooltip:_("Clear this change"),handler:function(){new ui.task.ClearLocalChangeTask({ftype:"update",fpath:c,fname:d}),Ext.getCmp("main-panel").remove("diff_panel_"+p)}},{xtype:"button",iconCls:"iconSwitchLang",tooltip:_("Change file's owner"),handler:function(){new ui.cmp.ChangeFileOwner({fileIdDB:l,fileFolder:c,fileName:d,currentOwner:s})}}]}:"","->",{xtype:"buttongroup",items:[{iconCls:"iconTabView",tooltip:_("Display the preview panel"),enableToggle:!0,pressed:PhDOE.user.conf.diff.displayPreviewPanel,toggleHandler:function(e,t){t?Ext.getCmp("diff_panel_"+p).items.items[1].expand(!0):Ext.getCmp("diff_panel_"+p).items.items[1].collapse(!0),new ui.task.UpdateConfTask({module:"diff",itemName:"displayPreviewPanel",value:t})}}]},{xtype:"buttongroup",items:[{iconCls:"iconRefresh",tooltip:_("Reload data"),handler:function(){var e;m=this.ownerCt.items.items[2].getValue(),f=this.ownerCt.items.items[4].getValue(),g=this.ownerCt.items.items[7].getValue(),e=(new Date).add(Date.YEAR,1),Ext.util.Cookies.set("optNbLine",m,e),Ext.util.Cookies.set("optB",f,e),Ext.util.Cookies.set("optW",g,e),a()}},{xtype:"tbtext",text:_("Nb lines of contexte: ")},{xtype:"spinnerfield",width:60,hideLabel:!0,minValue:3,value:m},{xtype:"tbseparator"},{xtype:"checkbox",checked:f},{xtype:"tbtext",text:": "+_("Ignore changes in the amount of white space"),listeners:{afterrender:function(e){new Ext.ToolTip({anchor:"right",target:e.el,html:_("Option <b>b</b> for the diff command")})}}},{xtype:"tbseparator"},{xtype:"checkbox",checked:g},{xtype:"tbtext",text:": "+_("Ignore all white space"),listeners:{afterrender:function(e){new Ext.ToolTip({anchor:"right",target:e.el,html:_("Option <b>w</b> for the diff command")})}}}]}],n=Ext.getCmp("main-panel").getHeight()-200,""!==c&&""!==d?(o="https://"+window.location.host+":"+window.location.port+"/diffPreview.php",XHR({params:{task:"getURLToOriginalManualPage",fileFullPath:c+d},success:function(e){var t,e=Ext.util.JSON.decode(e.responseText);"404"===e.url?(t="https://"+window.location.host+":"+window.location.port+"/diffPreview.php?"+Ext.urlEncode({msg:_("Documentation page not available")}),n=60,Ext.getCmp("diff_panel_"+p).items.items[1]&&(Ext.getCmp("diff_panel_"+p).items.items[1].setHeight(n),Ext.getCmp("diff_panel_"+p).doLayout())):t=e.url,Ext.getCmp("diff_panel_"+p).items.items[1].items.items[0].setUrl(t)}})):(o="https://"+window.location.host+":"+window.location.port+"/diffPreview.php?"+Ext.urlEncode({msg:_("Documentation page not available")}),n=60),Ext.getCmp("main-panel").add({layout:"border",id:"diff_panel_"+p,title:_("Diff"),closable:!0,iconCls:"iconTabLink",tabTip:i,border:!1,defaults:{split:!0},items:[{xtype:"panel",region:"center",autoScroll:!0,html:'<div id="diff_content_'+p+'" class="diff-content"></div>',tbar:e},{xtype:"panel",collapsed:!PhDOE.user.conf.diff.displayPreviewPanel,region:"south",height:n,layout:"fit",items:[new Ext.ux.IFrameComponent({id:Ext.id(),url:o})]}]}),Ext.getCmp("main-panel").setActiveTab("diff_panel_"+p),(a=function(){Ext.get("diff_panel_"+p).mask('<img src="themes/img/loading.gif" style="vertical-align: middle;" />'+_("Please, wait...")),XHR({params:{task:"getDiff",DiffType:r,FilePath:c,FileName:d,patchID:u,optNbLine:m,optB:f,optW:g},success:function(e){var t=Ext.util.JSON.decode(e.responseText),e="",e=""==u?'<a href="https://'+window.location.host+":"+window.location.port+window.location.pathname+"?patch="+c+d+"&project="+PhDOE.project+'"><h2>'+_("Direct link to this patch")+" ; "+_("File: ")+c+d+"</h2></a>":'<a href="https://'+window.location.host+":"+window.location.port+window.location.pathname+"?patchID="+u+"&project="+PhDOE.project+'"><h2>'+_("Direct link to this patch")+" ; "+_("Patch Name: ")+h+"</h2></a>";t.content=e+t.content,Ext.get("diff_content_"+p).dom.innerHTML=t.content,Ext.get("diff_panel_"+p).unmask()}})})())}}),Ext.reg("mainpanel",ui.cmp.MainPanel),Ext.namespace("ui","ui.cmp"),ui.cmp.ManagePatchPrompt=Ext.extend(Ext.Window,{title:"",width:450,height:260,minWidth:450,minHeight:300,layout:"fit",plain:!0,bodyStyle:"padding:5px;",buttonAlign:"center",iconCls:"iconPatch",closeAction:"hide",nodesToAdd:!1,patchName:"",patchDescription:"",patchEmail:"",patchID:!1,initComponent:function(){Ext.apply(this,{buttons:[{text:this.patchID?_("Save"):_("Create"),handler:function(){var t=this.ownerCt.ownerCt,i=t.findByType("form").shift().getForm().getValues();XHR({params:{task:"managePatch",name:i.name,description:i.description,email:i.email,patchID:t.patchID},success:function(e){e=Ext.util.JSON.decode(e.responseText);t.hide(),t.patchID&&ui.cmp.PatchesTreeGrid.getInstance().modPatchName({newPatchName:i.name,newPatchDescription:i.description,newPatchEmail:i.email,patchID:t.patchID}),t.nodesToAdd&&ui.task.MoveToPatch({patchID:e.patchID,patchName:i.name,patchDescription:i.description,patchEmail:i.email,nodesToAdd:t.nodesToAdd}),PhDOE.user.patchList.reload()}})}},{text:_("Cancel"),handler:function(){this.ownerCt.ownerCt.hide()}}],items:[{xtype:"form",baseCls:"x-plain",labelWidth:110,defaultType:"textfield",labelAlign:"top",items:[{name:"name",fieldLabel:_("Patch name"),anchor:"100%",value:this.patchName},{name:"description",xtype:"textarea",fieldLabel:_("Patch description"),tooltipText:_("This description will be the default during the validation of the patch by a valid user."),anchor:"100%",value:this.patchDescription},{name:"email",fieldLabel:_("Email"),tooltipText:_("If provided, an email will be send to you to inform that the patch is commited."),anchor:"100%",value:this.patchEmail}]}]}),ui.cmp.ManagePatchPrompt.superclass.initComponent.call(this)}}),Ext.namespace("ui","ui.cmp","ui.cmp._NotInENGrid"),ui.cmp._NotInENGrid.store=new Ext.data.GroupingStore({proxy:new Ext.data.HttpProxy({url:"./do/getFilesNotInEn"}),reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",idProperty:"id",fields:[{name:"id"},{name:"path"},{name:"name"},{name:"fileModified"}]}),sortInfo:{field:"path",direction:"ASC"},groupField:"path",listeners:{datachanged:function(e){Ext.getDom("acc-notInEn-nb").innerHTML=e.getCount()}}}),ui.cmp._NotInENGrid.columns=[{id:"name",header:_("Files"),sortable:!0,dataIndex:"name",renderer:function(e,t,i){if(i.data.fileModified){i=Ext.util.JSON.decode(i.data.fileModified);return i.user===PhDOE.user.login&&i.anonymousIdent===PhDOE.user.anonymousIdent?"<span ext:qtip='"+_("File removed by me")+"'>"+e+"</span>":"<span ext:qtip='"+String.format(_("File removed by {0}"),i.user)+"'>"+e+"</span>"}return e}},{header:_("Path"),dataIndex:"path",hidden:!0}],ui.cmp._NotInENGrid.view=new Ext.grid.GroupingView({forceFit:!0,startCollapsed:!0,groupTextTpl:'{[values.rs[0].data["path"]]} ({[values.rs.length]} {[values.rs.length > 1 ? "'+_("Files")+'" : "'+_("File")+'"]})',deferEmptyText:!1,emptyText:'<div style="text-align: center;">'+_("No Files")+"</div>",getRowClass:function(e){if(e.data.fileModified){e=Ext.util.JSON.decode(e.data.fileModified);return e.user===PhDOE.user.login&&e.anonymousIdent===PhDOE.user.anonymousIdent?"fileModifiedByMe":"fileModifiedByAnother"}return!1}}),ui.cmp._NotInENGrid.menu=function(e){Ext.apply(this,e),this.init(),ui.cmp._NotInENGrid.menu.superclass.constructor.call(this)},Ext.extend(ui.cmp._NotInENGrid.menu,Ext.menu.Menu,{init:function(){Ext.apply(this,{items:[{scope:this,text:"<b>"+_("View in a new tab")+"</b>",iconCls:"iconView",handler:function(){this.grid.fireEvent("rowdblclick",this.grid,this.rowIdx,this.event)}},{scope:this,text:_("Remove this file"),hidden:this.grid.store.getAt(this.rowIdx).data.fileModified,iconCls:"iconTrash",handler:function(){var e=this.grid.store.getAt(this.rowIdx),t=e.data.path,i=e.data.name;new ui.task.MarkDeleteTask({fpath:t,fname:i,storeRecord:e})}}]})}}),ui.cmp.NotInENGrid=Ext.extend(Ext.grid.GridPanel,{loadMask:!0,border:!1,autoExpandColumn:"name",enableDragDrop:!0,ddGroup:"mainPanelDDGroup",view:ui.cmp._NotInENGrid.view,columns:ui.cmp._NotInENGrid.columns,onRowContextMenu:function(e,t,i){i.stopEvent(),e.getSelectionModel().selectRow(t),new ui.cmp._NotInENGrid.menu({grid:e,rowIdx:t,event:i}).showAt(i.getXY())},onRowDblClick:function(e,t,i){this.openFile(e.store.getAt(t).data.id)},openFile:function(e){var t=this.store.getById(e),i=t.data.path,n=t.data.name,e=Ext.util.md5("FNIEN-"+PhDOE.user.lang+i+n);Ext.getCmp("main-panel").findById("FNIEN-"+e)||Ext.getCmp("main-panel").add({id:"FNIEN-"+e,layout:"border",title:n,originTitle:n,iconCls:"iconTabView",closable:!0,tabLoaded:!1,panLANGLoaded:!1,defaults:{split:!0},tabTip:String.format(_("Not In EN: in {0}"),i),items:[new ui.cmp.FilePanel({id:"FNIEN-NotInEN-PANEL-"+e,region:"center",title:_("File: ")+i+n,prefix:"FNIEN",ftype:"NotInEN",fid:e,fpath:i,fname:n,original:!0,readOnly:!0,lang:PhDOE.user.lang,parser:"xml",storeRecord:t,syncScroll:!1})]}),Ext.getCmp("main-panel").setActiveTab("FNIEN-"+e)},initComponent:function(){Ext.apply(this,{store:ui.cmp._NotInENGrid.store}),ui.cmp.NotInENGrid.superclass.initComponent.call(this),this.on("rowcontextmenu",this.onRowContextMenu,this),this.on("rowdblclick",this.onRowDblClick,this)}}),ui.cmp._NotInENGrid.instance=null,ui.cmp.NotInENGrid.getInstance=function(e){return ui.cmp._NotInENGrid.instance||(e=e||{},ui.cmp._NotInENGrid.instance=new ui.cmp.NotInENGrid(e)),ui.cmp._NotInENGrid.instance},Ext.namespace("ui","ui.cmp","ui.cmp._PatchesTreeGrid","ui.cmp._PatchesTreeGrid.menu"),ui.cmp._PatchesTreeGrid.menu.users=function(e){Ext.apply(this,e),this.init(),ui.cmp._PatchesTreeGrid.menu.users.superclass.constructor.call(this)},Ext.extend(ui.cmp._PatchesTreeGrid.menu.users,Ext.menu.Menu,{init:function(){var t=[];this.node.cascade(function(e){"folder"!==e.attributes.type&&"patch"!==e.attributes.type&&"user"!==e.attributes.type&&t.push(e)},this),Ext.apply(this,{items:[{scope:this,text:String.format(_("Send an email to {0}"),"<b>"+this.node.attributes.task+"</b>"),iconCls:"iconSendEmail",hidden:this.node.attributes.task===PhDOE.user.login||!this.node.attributes.email,handler:function(){var e=new ui.cmp.EmailPrompt;e.setData(this.node.attributes.task,this.node.attributes.email),e.show(this.node.el)}},{text:_("Back all files to work in progress module"),hidden:this.node.attributes.task!==PhDOE.user.login,disabled:Ext.isEmpty(t),iconCls:"iconWorkInProgress",handler:function(){ui.task.MoveToWork({nodesToAdd:t})}},{xtype:"menuseparator",hidden:!(PhDOE.user.haveKarma&&this.node.attributes.task==PhDOE.user.login)},new ui.cmp._WorkTreeGrid.menu.commit({hidden:!(PhDOE.user.haveKarma&&this.node.attributes.task==PhDOE.user.login),module:"patches",from:"user",node:!1,folderNode:!1,patchNode:!1,userNode:this.node})]})}}),ui.cmp._PatchesTreeGrid.menu.patches=function(e){Ext.apply(this,e),this.init(),ui.cmp._PatchesTreeGrid.menu.patches.superclass.constructor.call(this)},Ext.extend(ui.cmp._PatchesTreeGrid.menu.patches,Ext.menu.Menu,{init:function(){var e=this.node,t=[],i=e.parentNode.attributes.task,n=e.parentNode.attributes.isAnonymous,o=e.parentNode.attributes.haveKarma;this.node.cascade(function(e){"folder"!==e.attributes.type&&"patch"!==e.attributes.type&&"user"!==e.attributes.type&&t.push(e)},this),Ext.apply(this,{items:[{text:_("Edit the description of this patch"),iconCls:"iconPendingPatch",hidden:i!==PhDOE.user.login,handler:function(){new ui.cmp.ManagePatchPrompt({title:_("Modify this patch description"),patchName:e.attributes.task,patchDescription:e.attributes.patchDescription,patchEmail:e.attributes.patchEmail,patchID:e.attributes.idDB}).show(this.el)}},{text:_("Delete this patch"),iconCls:"iconTrash",hidden:i!==PhDOE.user.login,handler:function(){ui.task.DeletePatchTask({patchID:e.attributes.idDB})}},{xtype:"menuseparator",hidden:!(i==PhDOE.user.login)},{text:_("Back all this patch to work in progress module"),iconCls:"iconWorkInProgress",hidden:!(i==PhDOE.user.login),disabled:Ext.isEmpty(t),handler:function(){ui.task.MoveToWork({nodesToAdd:t})}},{xtype:"menuseparator"},{text:_("View unified diff"),iconCls:"iconViewDiff",handler:function(){Ext.getCmp("main-panel").openDiffTab({DiffType:"file",patchID:e.attributes.idDB,patchName:e.attributes.task})}},{text:_("Download the unified diff as a patch"),iconCls:"iconDownloadDiff",handler:function(){window.location.href="./do/downloadPatch?patchID="+e.attributes.idDB+"&csrfToken="+csrfToken}},{xtype:"menuseparator",hidden:!(PhDOE.user.haveKarma&&(i===PhDOE.user.login||!o))},new ui.cmp._WorkTreeGrid.menu.commit({hidden:!(PhDOE.user.haveKarma&&(i===PhDOE.user.login||!o)),module:"patches",from:n?"anonymousPatch":"patch",node:!1,folderNode:!1,patchNode:this.node,userNode:this.node.parentNode}),{xtype:"menuseparator",hidden:!(PhDOE.user.isGlobalAdmin||PhDOE.user.isLangAdmin)},new ui.cmp._WorkTreeGrid.menu.admin({hidden:!(PhDOE.user.isGlobalAdmin||PhDOE.user.isLangAdmin),from:"patch",node:this.node})]})}}),ui.cmp._PatchesTreeGrid.menu.folders=function(e){Ext.apply(this,e),this.init(),ui.cmp._PatchesTreeGrid.menu.folders.superclass.constructor.call(this)},Ext.extend(ui.cmp._PatchesTreeGrid.menu.folders,Ext.menu.Menu,{init:function(){var t=[];if(this.node.parentNode.parentNode.attributes.task!==PhDOE.user.login)return!1;this.node.cascade(function(e){"folder"!==e.attributes.type&&"patch"!==e.attributes.type&&"user"!==e.attributes.type&&t.push(e)},this),Ext.apply(this,{items:[{text:_("Back all this folder to work in progress module"),iconCls:"iconWorkInProgress",handler:function(){ui.task.MoveToWork({nodesToAdd:t})}},{xtype:"menuseparator",hidden:!PhDOE.user.haveKarma},new ui.cmp._WorkTreeGrid.menu.commit({hidden:!PhDOE.user.haveKarma,module:"patches",from:"folder",node:!1,folderNode:this.node,patchNode:this.node.parentNode,userNode:this.node.parentNode.parentNode})]})}}),ui.cmp._PatchesTreeGrid.menu.files=function(e){Ext.apply(this,e),this.init(),ui.cmp._PatchesTreeGrid.menu.files.superclass.constructor.call(this)},Ext.extend(ui.cmp._PatchesTreeGrid.menu.files,Ext.menu.Menu,{init:function(){var e=this.node,t=e.attributes.type,i=e.parentNode.attributes.task,n=e.attributes.task,o=(e.ownerTree,e.attributes.idDB,[]),a=this.node.parentNode.parentNode.parentNode.attributes.task,r=this.node.parentNode.parentNode.parentNode.attributes.haveKarma,s=e.parentNode.attributes.task.split("/")[0];this.node.cascade(function(e){"folder"!==e.attributes.type&&"patch"!==e.attributes.type&&"user"!==e.attributes.type&&o.push(e)},this),Ext.apply(this,{items:[{text:"<b>"+_("delete"===t?"View in a new tab":"Edit in a new tab")+"</b>",iconCls:"iconEdit",handler:function(){ui.cmp.WorkTreeGrid.getInstance().openFile(e)}},{text:_("Back this file to work in progress module"),hidden:a!==PhDOE.user.login,iconCls:"iconWorkInProgress",handler:function(){ui.task.MoveToWork({nodesToAdd:o})}},"-",{text:_("View diff"),iconCls:"iconViewDiff",handler:function(){Ext.getCmp("main-panel").openDiffTab({DiffType:"file",FileName:n,FilePath:i,currentOwner:a,fileIdDB:e.attributes.idDB})}},{text:_("Download the diff as a patch"),iconCls:"iconDownloadDiff",handler:function(){window.location.href="./do/downloadPatch?FilePath="+i+"&FileName="+n+"&csrfToken="+csrfToken}},{xtype:"menuseparator",hidden:!(a==PhDOE.user.login)},{text:_("delete"===t?"Cancel this deletion":"Clear this change"),hidden:!(a==PhDOE.user.login),iconCls:"iconPageDelete",handler:function(){new ui.task.ClearLocalChangeTask({ftype:t,fpath:i,fname:n})}},{xtype:"menuseparator",hidden:!(PhDOE.user.haveKarma&&(a===PhDOE.user.login||!r))},new ui.cmp._WorkTreeGrid.menu.commit({module:"patches",hidden:!(PhDOE.user.haveKarma&&(a===PhDOE.user.login||!r)),from:"file",node:this.node,folderNode:this.node.parentNode,patchNode:this.node.parentNode.parentNode,userNode:this.node.parentNode.parentNode.parentNode}),{xtype:"menuseparator",hidden:!(PhDOE.user.isGlobalAdmin||PhDOE.user.isLangAdmin)},new ui.cmp._WorkTreeGrid.menu.admin({hidden:!(PhDOE.user.isGlobalAdmin||PhDOE.user.isLangAdmin),fileLang:s,from:"file",node:this.node,folderNode:this.node.parentNode,userNode:this.node.parentNode.parentNode.parentNode})]})}}),ui.cmp.PatchesTreeGrid=Ext.extend(Ext.ux.tree.TreeGrid,{onContextMenu:function(e,t){var i;switch(t.stopEvent(),e.attributes.type){case"user":e.select(),i=new ui.cmp._PatchesTreeGrid.menu.users({node:e});break;case"folder":e.select(),i=new ui.cmp._PatchesTreeGrid.menu.folders({node:e});break;case"patch":e.select(),i=new ui.cmp._PatchesTreeGrid.menu.patches({node:e});break;default:e.select(),i=new ui.cmp._PatchesTreeGrid.menu.files({node:e})}i.showAt(t.getXY())},modPatchName:function(e){var t=this.getRootNode().findChild("idDB",e.patchID,!0);t.setText(e.newPatchName),t.attributes.patchDescription=e.newPatchDescription,t.attributes.patchEmail=e.newPatchEmail,t.attributes.task=e.newPatchName},initComponent:function(){Ext.apply(this,{animate:!0,useArrows:!0,autoScroll:!0,border:!1,containerScroll:!0,selModel:new Ext.tree.MultiSelectionModel,columns:[{header:_("Users"),dataIndex:"task",uiProvider:{editable:!0,qtip:"help"},tpl:new Ext.XTemplate("{task:this.formatUserName}",{formatUserName:function(e,t){return"user"===t.type?t.userID&&(t.qtip=_("userID: ")+t.userID):"patch"===t.type&&t.creationDate&&(t.qtip=_("Creation date: ")+Date.parseDate(t.creationDate,"Y-m-d H:i:s").format(_("Y-m-d, H:i"))),e}})},{header:_("Last modified"),width:120,dataIndex:"last_modified",align:"center",tpl:new Ext.XTemplate("{last_modified:this.formatDate}",{formatDate:function(e,t){return"user"!==t.type&&"folder"!==t.type&&"patch"!==t.type?Date.parseDate(e,"Y-m-d H:i:s").format(_("Y-m-d, H:i")):""}})}],loader:{dataUrl:"./do/getWork",baseParams:{module:"PatchesForReview"},listeners:{beforeload:function(){Ext.getCmp("acc-patches").setIconClass("iconLoading")},load:function(){Ext.getCmp("acc-patches").setIconClass("iconPatch")}}}}),ui.cmp.PatchesTreeGrid.superclass.initComponent.call(this),this.on("contextmenu",this.onContextMenu,this),this.on("resize",this.resizeCmp,this),this.on("dblclick",ui.cmp.WorkTreeGrid.getInstance().openFile,this),this.getRootNode().on("beforechildrenrendered",function(){this.updateFilesCounter.defer(200,this)},this)},resizeCmp:function(e,t,i,n){this.columns[0].width=n-(this.columns[1].width+5),this.updateColumnWidths()},deletePatch:function(e){for(var t,i,n,o,a,r,s,l=this.getRootNode(),d=[],c=0;c<l.childNodes.length;c++)for(t=l.childNodes[c],a=0;a<t.childNodes.length;a++)if((i=t.childNodes[a]).attributes.idDB===e){if(!Ext.isEmpty(i.childNodes)){for(r=0;r<i.childNodes.length;r++)for(n=i.childNodes[r],s=0;s<n.childNodes.length;s++)o=n.childNodes[r],d.push(o);ui.cmp.WorkTreeGrid.getInstance().addToWork(d)}return i.remove(!0),Ext.isEmpty(t.childNodes)&&t.remove(!0),void this.updateFilesCounter()}},delRecord:function(e){for(var t,i,n,o,a,r,s,l=this.getRootNode(),d=0;d<l.childNodes.length;d++)for(t=l.childNodes[d],a=0;a<t.childNodes.length;a++)for(i=t.childNodes[a],r=0;r<i.childNodes.length;r++)for(n=i.childNodes[r],s=0;s<n.childNodes.length;s++)if((o=n.childNodes[s]).attributes.idDB==e)return o.remove(!0),Ext.isEmpty(n.childNodes)?(n.remove(!0),Ext.isEmpty(t.childNodes)&&t.remove(!0),void this.updateFilesCounter()):void this.updateFilesCounter();this.updateFilesCounter()},getUserPatchesList:function(){var e=this.getRootNode().findChild("task",PhDOE.user.login),t=[];return!!e&&(!!e.hasChildNodes()&&(e.eachChild(function(e){t.push(e)},this),t))},addToPatch:function(e,t,i,n,o){var a,r,s,l,d,c,u=this.getRootNode(),h=u.findChild("task",PhDOE.user.login);if(h||(h=new Ext.tree.TreeNode({task:PhDOE.user.login,type:"user",email:PhDOE.user.email,iconCls:"iconUser",expanded:!0}),u.appendChild(h),u.expand()),(a=h.findChild("task",t))||(a=new Ext.tree.TreeNode({task:t,patchDescription:n,patchEmail:o,type:"patch",iconCls:"iconPatch",expanded:!0,idDB:e}),h.appendChild(a),h.expand()),i)for(c=0;c<i.length;c++)(r=a.findChild("task",i[c].parentNode.attributes.task))||(r=new Ext.tree.TreeNode({task:i[c].parentNode.attributes.task,type:"folder",iconCls:"iconFolderOpen",expanded:!0}),a.appendChild(r),a.expand()),"update"===(s=i[c].attributes.type)&&(l="iconRefresh"),"new"===s&&(l="iconNewFiles"),"delete"===s&&(l="iconTrash"),d=new Date,d=new Ext.tree.TreeNode({task:i[c].attributes.task,type:s,iconCls:l,expanded:!0,last_modified:d.format("Y-m-d H:i:s"),progress:i[c].attributes.progress,idDB:i[c].attributes.idDB}),r.appendChild(d),r.expand();this.updateFilesCounter()},addRecord:function(e,t,i,n){var o,a=this.getRootNode(),r=a.findChild("task",PhDOE.user.login);r||(r=new Ext.tree.TreeNode({task:PhDOE.user.login,type:"user",email:PhDOE.user.email,iconCls:"iconUser",expanded:!0,nbFiles:1}),a.appendChild(r),a.expand()),(a=r.findChild("task",t))||(a=new Ext.tree.TreeNode({task:t,type:"folder",iconCls:"iconFolderOpen",expanded:!0}),r.appendChild(a),r.expand()),(t=a.findChild("task",i))||("update"===n&&(o="iconRefresh"),"new"===n&&(o="iconNewFiles"),"delete"===n&&(o="iconTrash"),r=new Date,t=new Ext.tree.TreeNode({task:i,type:n,iconCls:o,expanded:!0,last_modified:r.format("Y-m-d H:i:s"),progress:100,idDB:e}),a.appendChild(t),a.expand()),this.updateFilesCounter()},countFiles:function(){var e=this.getRootNode(),t=0;return e.cascade(function(e){e.isRoot||"user"===e.attributes.type||"folder"===e.attributes.type||"patch"===e.attributes.type||e.parentNode.parentNode.parentNode.attributes.task===PhDOE.user.login&&t++},this),t},updateFilesCounter:function(){var e=this.countFiles();Ext.getDom("acc-patches-nb").innerHTML=e}}),ui.cmp._PatchesTreeGrid.instance=null,ui.cmp.PatchesTreeGrid.getInstance=function(e){return ui.cmp._PatchesTreeGrid.instance||(e=e||{},ui.cmp._PatchesTreeGrid.instance=new ui.cmp.PatchesTreeGrid(e)),ui.cmp._PatchesTreeGrid.instance},Ext.namespace("ui","ui.cmp","ui.cmp._PendingReviewGrid"),ui.cmp._PendingReviewGrid.store=new Ext.data.GroupingStore({proxy:new Ext.data.HttpProxy({url:"./do/getFilesNeedReviewed"}),reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",idProperty:"id",fields:[{name:"id"},{name:"path"},{name:"name"},{name:"reviewed"},{name:"maintainer"},{name:"fileModified"}]}),sortInfo:{field:"name",direction:"ASC"},groupField:"path",listeners:{datachanged:function(e){Ext.getDom("acc-need-reviewed-nb").innerHTML=e.getCount()}}}),ui.cmp._PendingReviewGrid.columns=[{id:"name",header:_("Files"),sortable:!0,dataIndex:"name",renderer:function(e,t,i){var n="",o=PhDOE.user.isAnonymous?"anonymous":PhDOE.user.login;return i.data.fileModified&&((i=Ext.util.JSON.decode(i.data.fileModified)).user===o&&i.anonymousIdent===PhDOE.user.anonymousIdent?n+=String.format(_("File {0} modified by me"),PhDOE.user.lang.ucFirst()):n+=String.format(_("File {0} modified by {1}"),PhDOE.user.lang.ucFirst(),i.user)),""!==n?"<span ext:qtip='"+n+"'>"+e+"</span>":e}},{header:_("Reviewed"),width:45,sortable:!0,dataIndex:"reviewed"},{header:_("Reviewer"),width:45,sortable:!0,dataIndex:"maintainer"},{header:_("Path"),dataIndex:"path",hidden:!0}],ui.cmp._PendingReviewGrid.view=new Ext.grid.GroupingView({forceFit:!0,startCollapsed:!0,groupTextTpl:'{[values.rs[0].data["path"]]} ({[values.rs.length]} {[values.rs.length > 1 ? "'+_("Files")+'" : "'+_("File")+'"]})',getRowClass:function(e){if(e.data.fileModified){var t=Ext.util.JSON.decode(e.data.fileModified),e=PhDOE.user.isAnonymous?"anonymous":PhDOE.user.login;return t.user===e&&t.anonymousIdent===PhDOE.user.anonymousIdent?"fileModifiedByMe":"fileModifiedByAnother"}return!1},deferEmptyText:!1,emptyText:'<div style="text-align: center;">'+_("No Files")+"</div>"}),Ext.namespace("ui.cmp._PendingReviewGrid.menu"),ui.cmp._PendingReviewGrid.menu.group=function(e){Ext.apply(this,e),this.init(),ui.cmp._PendingReviewGrid.menu.group.superclass.constructor.call(this)},Ext.extend(ui.cmp._PendingReviewGrid.menu.group,Ext.menu.Item,{iconCls:"iconViewDiff",init:function(){Ext.apply(this,{text:String.format(_("Open all files about {0} extension"),this.gname.ucFirst()),handler:function(){Ext.getBody().mask('<img src="themes/img/loading.gif" style="vertical-align: middle;" /> '+String.format(_("Open all files about {0} extension"),this.gname.ucFirst())+". "+_("Please, wait...")),XHR({params:{task:"getAllFilesAboutExtension",ExtName:this.gname},success:function(e){var t,i=Ext.util.JSON.decode(e.responseText);for(PhDOE.AFfilePendingOpen=[],t=0;t<i.files.length;t+=1)PhDOE.AFfilePendingOpen[t]={fpath:PhDOE.user.lang+i.files[t].path,fname:i.files[t].name};ui.cmp.RepositoryTree.getInstance().openFile("byPath",PhDOE.AFfilePendingOpen[0].fpath,PhDOE.AFfilePendingOpen[0].fname),PhDOE.AFfilePendingOpen.shift(),Ext.getBody().unmask()}})}})}}),ui.cmp._PendingReviewGrid.menu.main=function(e){Ext.apply(this,e),this.init(),ui.cmp._PendingReviewGrid.menu.main.superclass.constructor.call(this)},Ext.extend(ui.cmp._PendingReviewGrid.menu.main,Ext.menu.Menu,{init:function(){Ext.apply(this,{items:[{text:"<b>"+_("Edit in a new tab")+"</b>",iconCls:"iconFilesNeedReviewed",scope:this,handler:function(){this.grid.fireEvent("rowdblclick",this.grid,this.rowIdx,this.event)}},{scope:this,hidden:this.hideDiffMenu,text:_("View diff"),iconCls:"iconViewDiff",handler:function(){Ext.getCmp("main-panel").openDiffTab({DiffType:"file",FileName:this.fname,FilePath:PhDOE.user.lang+this.fpath})}},new Ext.menu.Separator({hidden:this.hideGroup}),new ui.cmp._PendingReviewGrid.menu.group({gname:this.gname,hidden:this.hideGroup})]})}}),ui.cmp.PendingReviewGrid=Ext.extend(Ext.grid.GridPanel,{loadMask:!0,border:!1,autoExpandColumn:"name",enableDragDrop:!0,ddGroup:"mainPanelDDGroup",columns:ui.cmp._PendingReviewGrid.columns,view:ui.cmp._PendingReviewGrid.view,onRowContextMenu:function(e,t,i){i.stopEvent();var n=e.store.getAt(t),o=n.data.path,a=n.data.name,r=o.split("/");e.getSelectionModel().selectRow(t),new ui.cmp._PendingReviewGrid.menu.main({grid:e,rowIdx:t,event:i,fpath:o,fname:a,hideDiffMenu:!1===n.data.fileModified,hideGroup:"reference"!==r[1],gname:r[2]||""}).showAt(i.getXY())},onRowDblClick:function(e,t,i){this.openFile(e.store.getAt(t).data.id)},openFile:function(e){var t=this.store.getById(e),i=t.data.path,e=t.data.name,n=Ext.util.md5("FNR-"+PhDOE.user.lang+i+e);Ext.getCmp("main-panel").findById("FNR-"+n)||Ext.getCmp("main-panel").add({id:"FNR-"+n,title:e,layout:"border",iconCls:"iconTabNeedReviewed",closable:!0,tabLoaded:!1,panVCSLang:!PhDOE.user.conf.reviewed.toolsPanelLogLoad,panVCSEn:!PhDOE.user.conf.reviewed.toolsPanelLogLoad,panLANGLoaded:!1,panENLoaded:!1,originTitle:e,defaults:{split:!0},tabTip:String.format(_("Need Reviewed in: {0}"),i),listeners:{resize:function(e){Ext.getCmp("FNR-EN-PANEL-"+n).setWidth(e.getWidth()/2)}},items:[{region:"west",xtype:"panel",title:_("Tools"),iconCls:"iconConf",collapsedIconCls:"iconConf",plugins:[Ext.ux.PanelCollapsedTitle],collapsible:!0,collapsed:!PhDOE.user.conf.reviewed.toolsPanelDisplay,layout:"fit",bodyBorder:!1,width:PhDOE.user.conf.reviewed.toolsPanelWidth||375,listeners:{collapse:function(){this.ownerCt.tabLoaded&&new ui.task.UpdateConfTask({module:"reviewed",itemName:"toolsPanelDisplay",value:!1,notify:!1})},expand:function(){this.ownerCt.tabLoaded&&new ui.task.UpdateConfTask({module:"reviewed",itemName:"toolsPanelDisplay",value:!0,notify:!1})},resize:function(e,t){this.ownerCt.tabLoaded&&t&&t!=PhDOE.user.conf.reviewed.toolsPanelWidth&&new ui.task.UpdateConfTask({module:"reviewed",itemName:"toolsPanelWidth",value:t,notify:!1})}},items:{xtype:"tabpanel",activeTab:0,tabPosition:"bottom",enableTabScroll:!0,defaults:{autoScroll:!0},items:[new ui.cmp.VCSLogGrid({layout:"fit",title:String.format(_("{0} Log"),PhDOE.user.lang.ucFirst()),prefix:"FNR-LANG",fid:n,fpath:PhDOE.user.lang+i,fname:e,loadStore:PhDOE.user.conf.reviewed.toolsPanelLogLoad}),new ui.cmp.VCSLogGrid({layout:"fit",title:String.format(_("{0} Log"),"En"),prefix:"FNR-EN",fid:n,fpath:"en"+i,fname:e,loadStore:PhDOE.user.conf.reviewed.toolsPanelLogLoad}),new ui.cmp.DictionaryGrid({layout:"fit",title:_("Dictionary"),prefix:"FNR",fid:n})]}},new ui.cmp.FilePanel({id:"FNR-LANG-PANEL-"+n,region:"center",title:String.format(_("{0} File: "),PhDOE.user.lang.ucFirst())+i+e,prefix:"FNR",ftype:"LANG",spellCheck:PhDOE.user.conf.reviewed.enableSpellCheckLang,spellCheckConf:{module:"reviewed",itemName:"enableSpellCheckLang"},fid:n,fpath:i,fname:e,lang:PhDOE.user.lang,parser:"xml",storeRecord:t,syncScrollCB:!0,syncScroll:!0,syncScrollConf:{module:"reviewed",itemName:"syncScrollbars"}}),new ui.cmp.FilePanel({id:"FNR-EN-PANEL-"+n,region:"east",title:_("en File: ")+i+e,prefix:"FNR",ftype:"EN",original:!0,readOnly:!0,openInNewTabBtn:!0,fid:n,fpath:i,fname:e,lang:"en",parser:"xml",storeRecord:t,syncScroll:!0,syncScrollConf:{module:"reviewed",itemName:"syncScrollbars"}})]}),Ext.getCmp("main-panel").setActiveTab("FNR-"+n)},initComponent:function(){Ext.apply(this,{store:ui.cmp._PendingReviewGrid.store,tbar:[_("Filter: ")," ",new Ext.form.TwinTriggerField({id:"FNR-filter",width:180,hideTrigger1:!0,enableKeyEvents:!0,validateOnBlur:!1,validationEvent:!1,trigger1Class:"x-form-clear-trigger",trigger2Class:"x-form-search-trigger",listeners:{keypress:function(e,t){t.getKey()===t.ENTER&&this.onTrigger2Click()}},onTrigger1Click:function(){this.setValue(""),this.triggers[0].hide(),this.setSize(180,10),ui.cmp._PendingReviewGrid.instance.store.clearFilter()},onTrigger2Click:function(){var t,e=this.getValue();""===e||e.length<3?this.markInvalid(_("Your filter must contain at least 3 characters")):(this.clearInvalid(),this.triggers[0].show(),this.setSize(180,10),t=new RegExp(e,"i"),ui.cmp._PendingReviewGrid.instance.store.filterBy(function(e){return!!(t.test(e.data.path)||t.test(e.data.name)||t.test(e.data.reviewed)||t.test(e.data.maintainer))},this))}})]}),ui.cmp.PendingReviewGrid.superclass.initComponent.call(this),this.on("rowcontextmenu",this.onRowContextMenu,this),this.on("rowdblclick",this.onRowDblClick,this)}}),ui.cmp._PendingReviewGrid.instance=null,ui.cmp.PendingReviewGrid.getInstance=function(e){return ui.cmp._PendingReviewGrid.instance||(e=e||{},ui.cmp._PendingReviewGrid.instance=new ui.cmp.PendingReviewGrid(e)),ui.cmp._PendingReviewGrid.instance},Ext.namespace("ui","ui.cmp","ui.cmp._PendingTranslateGrid"),ui.cmp._PendingTranslateGrid.store=new Ext.data.GroupingStore({proxy:new Ext.data.HttpProxy({url:"./do/getFilesNeedTranslate"}),reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",idProperty:"id",fields:[{name:"id"},{name:"path"},{name:"name"},{name:"fileModified"}]}),sortInfo:{field:"name",direction:"ASC"},groupField:"path",listeners:{datachanged:function(e){Ext.getDom("acc-need-translate-nb").innerHTML=e.getCount()}}}),ui.cmp._PendingTranslateGrid.view=new Ext.grid.GroupingView({forceFit:!0,startCollapsed:!0,groupTextTpl:'{[values.rs[0].data["path"]]} ({[values.rs.length]} {[values.rs.length > 1 ? "'+_("Files")+'" : "'+_("File")+'"]})',deferEmptyText:!1,getRowClass:function(e){if(e.data.fileModified){var t=Ext.util.JSON.decode(e.data.fileModified),e=PhDOE.user.isAnonymous?"anonymous":PhDOE.user.login;return t.user===e&&t.anonymousIdent===PhDOE.user.anonymousIdent?"fileModifiedByMe":"fileModifiedByAnother"}return!1},emptyText:'<div style="text-align: center;">'+_("No Files")+"</div>"}),ui.cmp._PendingTranslateGrid.columns=[{id:"name",header:_("Files"),sortable:!0,dataIndex:"name",renderer:function(e,t,i){if(i.data.fileModified){var n=Ext.util.JSON.decode(i.data.fileModified),i=PhDOE.user.isAnonymous?"anonymous":PhDOE.user.login;return n.user===i&&n.anonymousIdent===PhDOE.user.anonymousIdent?"<span ext:qtip='"+_("File modified by me")+"'>"+e+"</span>":"<span ext:qtip='"+String.format(_("File modified by {0}"),n.user)+"'>"+e+"</span>"}return e}},{header:_("Path"),dataIndex:"path",hidden:!0}],ui.cmp._PendingTranslateGrid.menu=function(e){Ext.apply(this,e),this.init(),ui.cmp._StaleFileGrid.menu.superclass.constructor.call(this)},Ext.extend(ui.cmp._PendingTranslateGrid.menu,Ext.menu.Menu,{init:function(){Ext.apply(this,{items:[{scope:this,text:"<b>"+_("Edit in a new tab")+"</b>",iconCls:"iconTabNeedTranslate",handler:function(){this.grid.fireEvent("rowdblclick",this.grid,this.rowIdx,this.event)}}]})}}),ui.cmp.PendingTranslateGrid=Ext.extend(Ext.grid.GridPanel,{view:ui.cmp._PendingTranslateGrid.view,loadMask:!0,autoExpandColumn:"name",enableDragDrop:!0,ddGroup:"mainPanelDDGroup",border:!1,onRowContextMenu:function(e,t,i){i.stopEvent(),e.getSelectionModel().selectRow(t),new ui.cmp._PendingTranslateGrid.menu({grid:e,event:i,rowIdx:t}).showAt(i.getXY())},onRowDblClick:function(e,t){this.openFile(e.store.getAt(t).data.id)},openFile:function(e){var t=this.store.getById(e),i=t.data.path,n=t.data.name,o=Ext.util.md5("FNT-"+PhDOE.user.lang+i+n);Ext.getCmp("main-panel").findById("FNT-"+o)||(e="google"==PhDOE.user.conf.newFile.secondPanel||"originalFile"==PhDOE.user.conf.newFile.secondPanel,Ext.getCmp("main-panel").add({id:"FNT-"+o,layout:"border",title:n,originTitle:n,iconCls:"iconTabNeedTranslate",closable:!0,tabLoaded:!1,panTRANSLoaded:!1,panTRANSSecondLoaded:!e,defaults:{split:!0},tabTip:String.format(_("Need translate: in {0}"),i),listeners:{resize:function(e){"google"==PhDOE.user.conf.newFile.secondPanel&&Ext.getCmp("FNT-GGTRANS-PANEL-"+o).setWidth(e.getWidth()/2),"originalFile"==PhDOE.user.conf.newFile.secondPanel&&Ext.getCmp("FNT-EN-PANEL-"+o).setWidth(e.getWidth()/2)}},items:[{region:"west",xtype:"panel",title:_("Tools"),iconCls:"iconConf",collapsedIconCls:"iconConf",plugins:[Ext.ux.PanelCollapsedTitle],collapsible:!0,collapsed:!PhDOE.user.conf.newFile.toolsPanelDisplay,layout:"fit",bodyBorder:!1,width:PhDOE.user.conf.newFile.toolsPanelWidth||375,listeners:{collapse:function(){this.ownerCt.tabLoaded&&new ui.task.UpdateConfTask({module:"newFile",itemName:"toolsPanelDisplay",value:!1,notify:!1})},expand:function(){this.ownerCt.tabLoaded&&new ui.task.UpdateConfTask({module:"newFile",itemName:"toolsPanelDisplay",value:!0,notify:!1})},resize:function(e,t){this.ownerCt.tabLoaded&&t&&t!=PhDOE.user.conf.newFile.toolsPanelWidth&&new ui.task.UpdateConfTask({module:"newFile",itemName:"toolsPanelWidth",value:t,notify:!1})}},items:{xtype:"tabpanel",activeTab:0,tabPosition:"bottom",defaults:{autoScroll:!0},items:[new ui.cmp.DictionaryGrid({layout:"fit",title:_("Dictionary"),prefix:"FNT",fid:o})]}},new ui.cmp.FilePanel({id:"FNT-TRANS-PANEL-"+o,region:"center",title:_("New file: ")+PhDOE.user.lang+i+n,isTrans:!0,prefix:"FNT",ftype:"TRANS",spellCheck:PhDOE.user.conf.newFile.enableSpellCheck,spellCheckConf:{module:"newFile",itemName:"enableSpellCheck"},fid:o,fpath:i,fname:n,lang:PhDOE.user.lang,parser:"xml",storeRecord:t,syncScrollCB:e,syncScroll:e,syncScrollConf:{module:"newFile",itemName:"syncScrollbars"}}),"google"==PhDOE.user.conf.newFile.secondPanel&&new ui.cmp.FilePanel({id:"FNT-GGTRANS-PANEL-"+o,region:"east",title:_("Automatic translation: ")+PhDOE.user.lang+i+n,isTrans:!0,prefix:"FNT",ftype:"GGTRANS",fid:o,fpath:i,fname:n,readOnly:!0,lang:PhDOE.user.lang,parser:"xml",storeRecord:t,syncScroll:!0,syncScrollConf:{module:"newFile",itemName:"syncScrollbars"}}),"originalFile"==PhDOE.user.conf.newFile.secondPanel&&new ui.cmp.FilePanel({id:"FNT-EN-PANEL-"+o,region:"east",title:_("File: ")+"en"+i+n,prefix:"FNT",ftype:"EN",fid:o,fpath:i,fname:n,original:!0,readOnly:!0,lang:"en",parser:"xml",storeRecord:t,syncScroll:!0,syncScrollConf:{module:"newFile",itemName:"syncScrollbars"}})]})),Ext.getCmp("main-panel").setActiveTab("FNT-"+o)},initComponent:function(){Ext.apply(this,{columns:ui.cmp._PendingTranslateGrid.columns,store:ui.cmp._PendingTranslateGrid.store,tbar:[_("Filter: ")," ",new Ext.form.TwinTriggerField({id:"FNT-filter",width:180,hideTrigger1:!0,enableKeyEvents:!0,validateOnBlur:!1,validationEvent:!1,trigger1Class:"x-form-clear-trigger",trigger2Class:"x-form-search-trigger",listeners:{keypress:function(e,t){t.getKey()===t.ENTER&&this.onTrigger2Click()}},onTrigger1Click:function(){this.setValue(""),this.triggers[0].hide(),this.setSize(180,10),ui.cmp._PendingTranslateGrid.instance.store.clearFilter()},onTrigger2Click:function(){var t,e=this.getValue();""===e||e.length<3?this.markInvalid(_("Your filter must contain at least 3 characters")):(this.clearInvalid(),this.triggers[0].show(),this.setSize(180,10),t=new RegExp(e,"i"),ui.cmp._PendingTranslateGrid.instance.store.filterBy(function(e){return!(!t.test(e.data.path)&&!t.test(e.data.name))},this))}})]}),ui.cmp.PendingTranslateGrid.superclass.initComponent.call(this),this.on("rowcontextmenu",this.onRowContextMenu,this),this.on("rowdblclick",this.onRowDblClick,this)}}),ui.cmp._PendingTranslateGrid.instance=null,ui.cmp.PendingTranslateGrid.getInstance=function(e){return ui.cmp._PendingTranslateGrid.instance||(e=e||{},ui.cmp._PendingTranslateGrid.instance=new ui.cmp.PendingTranslateGrid(e)),ui.cmp._PendingTranslateGrid.instance},Ext.namespace("ui","ui.cmp","ui.cmp._PortletBugs"),ui.cmp._PortletBugs.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:"./do/getOpenBugs"}),reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",idProperty:"id",fields:[{name:"id"},{name:"title"},{name:"link"},{name:"description"},{name:"xmlID"}]})}),ui.cmp._PortletBugs.gridFormatTitle=function(e){return String.format('<div class="topic"><b>{0}</b></div>',e)},ui.cmp._PortletBugs.gridColumns=[{id:"GridBugTitle",header:_("Title"),sortable:!0,dataIndex:"title",renderer:ui.cmp._PortletBugs.gridFormatTitle}],ui.cmp._PortletBugs.gridView=new Ext.grid.GridView({forceFit:!0,emptyText:'<div style="text-align: center">'+_("You must manually load this data.<br>Use the refresh button !")+"</div>",deferEmptyText:!1,enableRowBody:!0,showPreview:!1,getRowClass:function(e,t,i){return this.showPreview?(i.body="<p>"+e.data.description+"</p>","x-grid3-row-expanded"):"x-grid3-row-collapsed"}}),ui.cmp._PortletBugs.grid=Ext.extend(Ext.grid.GridPanel,{loadMask:!0,autoScroll:!0,height:250,autoExpandColumn:"GridBugTitle",id:"PortletBugs-grid-id",store:ui.cmp._PortletBugs.store,columns:ui.cmp._PortletBugs.gridColumns,view:ui.cmp._PortletBugs.gridView,sm:new Ext.grid.RowSelectionModel({singleSelect:!0}),onRowDblClick:function(e,t){var i=e.store.getAt(t).data.id,n=e.store.getAt(t).data.link,t=e.store.getAt(t).data.title;Ext.getCmp("main-panel").findById("bugs-"+i)||Ext.getCmp("main-panel").add({id:"bugs-"+i,xtype:"panel",title:Ext.util.Format.substr(t,0,20)+"...",tabTip:t,iconCls:"iconBugs",closable:!0,layout:"fit",items:[new Ext.ux.IFrameComponent({id:"frame-bugs-"+i,url:n})]}),Ext.getCmp("main-panel").setActiveTab("bugs-"+i)},openRelatedFile:function(e){new ui.task.GetFileInfoByXmlID({xmlID:e})},onContextClick:function(e,t,i){this.menu||(this.menu=new Ext.menu.Menu({id:"submenu-bugs",items:[{scope:this,text:"<b>"+_("Open in a new Tab")+"</b>",iconCls:"iconOpenInTab",handler:function(){this.fireEvent("rowdblclick",e,this.ctxIndex,i),this.menu.hide()}},"-",{scope:this,text:_("Refresh this grid"),iconCls:"iconRefresh",handler:function(){this.ctxIndex=null,ui.cmp._PortletBugs.reloadData()}},{scope:this,text:_("Open the related file"),iconCls:"iconAllFiles",id:"bugs-open-related-file",handler:function(){this.openRelatedFile(this.ctxXmlID)}}]})),this.getSelectionModel().selectRow(t),i.stopEvent(),this.ctxIndex&&(this.ctxIndex=null),this.ctxXmlID&&(this.ctxXmlID=null),this.ctxIndex=t,this.ctxXmlID=e.store.getAt(this.ctxIndex).data.xmlID,this.menu.showAt(i.getXY()),this.ctxXmlID?Ext.getCmp("bugs-open-related-file").enable():Ext.getCmp("bugs-open-related-file").disable()},togglePreview:function(e){this.view.showPreview=e,this.view.refresh()},initComponent:function(e){this.tbar=[{text:_("Summary"),pressed:!1,enableToggle:!0,iconCls:"iconSummary",scope:this,toggleHandler:function(e,t){this.togglePreview(t)}}],ui.cmp._PortletBugs.grid.superclass.initComponent.call(this),Ext.apply(this,e),this.on("rowcontextmenu",this.onContextClick,this),this.on("rowdblclick",this.onRowDblClick,this)}}),ui.cmp._PortletBugs.reloadData=function(){ui.cmp._PortletBugs.store.reload({callback:function(e,t,i){i?0===ui.cmp._PortletBugs.store.getTotalCount()&&(Ext.getCmp("PortletBugs-grid-id").getView().mainBody.update('<div id="PortletBugs-grid-defaultMess-id" style="text-align: center" class="x-grid-empty">'+_("No open bugs")+"</div>"),Ext.get("PortletBugs-grid-defaultMess-id").highlight()):(Ext.getCmp("PortletBugs-grid-id").getView().mainBody.update('<div id="PortletBugs-grid-defaultMess-id" style="text-align: center" class="x-grid-empty">'+_("Error when loading open bugs from Php.net !")+"</div>"),Ext.get("PortletBugs-grid-defaultMess-id").highlight())}})},ui.cmp.PortletBugs=Ext.extend(Ext.ux.Portlet,{title:"",iconCls:"iconBugs",layout:"fit",store:ui.cmp._PortletBugs.store,reloadData:ui.cmp._PortletBugs.reloadData,tools:[{id:"refresh",qtip:_("Refresh this grid"),handler:function(){ui.cmp._PortletBugs.reloadData()}}],listeners:{expand:function(){PhDOE.app.loaded&&new ui.task.UpdateConfTask({item:"portletBugsCollapsed",value:!1,notify:!1})},collapse:function(){PhDOE.app.loaded&&new ui.task.UpdateConfTask({item:"portletBugsCollapsed",value:!0,notify:!1})},afterrender:function(e){PhDOE.user.conf.portletBugsCollapsed?e.collapse():e.expand()}},initComponent:function(e){this.id="portletBugs",this.title=String.format(_("Open bugs for {0}"),"doc-"+this.lang),Ext.apply(this,e),ui.cmp.PortletBugs.superclass.initComponent.apply(this),this.add(new ui.cmp._PortletBugs.grid)}}),ui.cmp._PortletBugs.instance=null,ui.cmp.PortletBugs.getInstance=function(e){return ui.cmp._PortletBugs.instance||(e=e||{},ui.cmp._PortletBugs.instance=new ui.cmp.PortletBugs(e)),ui.cmp._PortletBugs.instance},Ext.namespace("ui","ui.cmp","ui.cmp._PortletInfo"),ui.cmp._PortletInfo.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:"./do/getInfos"}),baseParams:{start:0,limit:10},reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",idProperty:"id",fields:[{name:"id"},{name:"field"},{name:"value"},{name:"date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"elapsedTime"}]}),listeners:{load:function(e){e=e.data.items[0].data.date;PhDOE.lastInfoDate=e.format("Y-m-d H:i:s")}}}),ui.cmp._PortletInfo.store.setDefaultSort("date","desc"),ui.cmp._PortletInfo.storeUsage=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:"./do/getUsageInfos"}),baseParams:{year:(new Date).format("Y")},reader:new Ext.data.JsonReader({root:"Items",idProperty:"id",fields:[{name:"id"},{name:"month"},{name:"nbConTotal",type:"int"},{name:"nbCommitTotal",type:"int"}]})}),ui.cmp._PortletInfo.typeRenderer=function(e,t,i){var n,o,a,r,s,l;switch(e){case"updateData":return n=i.data.value.user,String.format(_("{0} updated app's data"),n);case"changeFilesOwner":return n=i.data.value.user,String.format(_("{0} changed file's owner"),n);case"checkEntities":return n=i.data.value.user,String.format(_("{0} check all entitites"),n);case"computeUsageStatistics":return _("Usage statistics were calculated");case"logout":return n=i.data.value.user,String.format(_("{0} logged out"),n);case"login":return n=i.data.value.user,o=i.data.value.lang,authService=i.data.value.authService,l="","google"==authService?l='<img src="themes/img/auth_google.png" style="vertical-align: middle;"> ':"facebook"==authService?l='<img src="themes/img/auth_facebook.png" style="vertical-align: middle;"> ':"github"==authService?l='<img src="themes/img/auth_github.png" style="vertical-align: middle;"> ':"stackoverflow"==authService?l='<img src="themes/img/auth_stackoverflow.png" style="vertical-align: middle;"> ':"linkedin"==authService?l='<img src="themes/img/auth_linkedin.png" style="vertical-align: middle;"> ':"instagram"==authService?l='<img src="themes/img/auth_instagram.png" style="vertical-align: middle;"> ':"twitter"==authService&&(l='<img src="themes/img/auth_twitter.png" style="vertical-align: middle;"> '),l+String.format(_("{0} is logged in using the {1} language"),n,o.ucFirst());case"commitFolders":return n=i.data.value.user,o=i.data.value.lang,s=i.data.value.nbFolders,String.format(_("{0} committed {1} new folder(s) in the {2} language"),n,s,o.ucFirst());case"commitFiles":return n=i.data.value.user,o=i.data.value.lang,s=(a=i.data.value.nbFilesCreate)+(r=i.data.value.nbFilesDelete)+(l=i.data.value.nbFilesUpdate),String.format(_("{0} committed {1} file(s) ({2} new, {3} update, {4} delete) in the language {5}"),n,s,a,l,r,o.ucFirst())}},ui.cmp._PortletInfo.gridColumns=[new Ext.grid.RowNumberer,{id:"Type",header:_("Type"),width:180,sortable:!0,dataIndex:"field",renderer:ui.cmp._PortletInfo.typeRenderer},{header:_("Since"),width:110,sortable:!1,dataIndex:"elapsedTime",renderer:function(e,t,i){return e=e?String.format(_("{0} "+e.units),e.value):_("Less than one second"),"<span ext:qtip='"+i.data.date.format(_("Y-m-d, H:i"))+"'>"+e+"</span>"}},{header:_("Date"),width:110,sortable:!0,dataIndex:"date",hidden:!0,renderer:Ext.util.Format.dateRenderer(_("Y-m-d, H:i"))}],ui.cmp._PortletInfo.grid=Ext.extend(Ext.grid.GridPanel,{autoExpandColumn:"Type",title:_("General"),loadMask:!0,autoScroll:!0,autoHeight:!0,store:ui.cmp._PortletInfo.store,columns:ui.cmp._PortletInfo.gridColumns,listeners:{afterrender:function(e){e.ownerCt.setHeight(e.height+60),e.ownerCt.doLayout()}},initComponent:function(){Ext.apply(this,{bbar:new Ext.PagingToolbar({pageSize:10,store:this.store,displayInfo:!0})}),ui.cmp._PortletInfo.grid.superclass.initComponent.call(this)}}),ui.cmp.PortletInfo=Ext.extend(Ext.ux.Portlet,{title:_("Information"),iconCls:"iconInfo",layout:"fit",store:ui.cmp._PortletInfo.store,storeUsage:ui.cmp._PortletInfo.storeUsage,tools:[{id:"refresh",qtip:_("Refresh this grid"),handler:function(){ui.cmp._PortletInfo.store.reload({callback:function(){ui.cmp._PortletInfo.storeUsage.reload()}})}}],listeners:{expand:function(){PhDOE.app.loaded&&new ui.task.UpdateConfTask({item:"portletInfoCollapsed",value:!1,notify:!1})},collapse:function(){PhDOE.app.loaded&&new ui.task.UpdateConfTask({item:"portletInfoCollapsed",value:!0,notify:!1})},afterrender:function(e){PhDOE.user.conf.portletInfoCollapsed?e.collapse():e.expand()}},initComponent:function(e){this.id="portletInfo",Ext.apply(this,e),ui.cmp.PortletInfo.superclass.initComponent.apply(this),this.Year=parseInt((new Date).format("Y")),this.buildButton=function(e){var t=this.Year+1,i=this.Year-1,n=this.items.items[0].items.items[1].toolbars[0].items.items[2],o=this.items.items[0].items.items[1].toolbars[0].items.items[0];this.items.items[0].items.items[1].items.items[0];"Backward"==e?(ui.cmp._PortletInfo.storeUsage.setBaseParam("year",i),this.Year=i):"Forward"==e&&(ui.cmp._PortletInfo.storeUsage.setBaseParam("year",t),this.Year=t),ui.cmp._PortletInfo.storeUsage.load(),n.setText(this.Year+1),o.setText(this.Year-1),this.Year+1>(new Date).format("Y")?n.disable():n.enable(),this.Year-1<2010?o.disable():o.enable()},this.add({xtype:"tabpanel",border:!1,activeTab:0,tabPosition:"bottom",autoScroll:!0,height:288,items:[new ui.cmp._PortletInfo.grid,{xtype:"panel",border:!1,title:_("Usage information"),tbar:[{scope:this,text:this.Year-1,iconCls:"iconBackward",handler:function(){this.buildButton("Backward")}},"->",{scope:this,text:this.Year+1,iconCls:"iconForward",disabled:!0,iconAlign:"right",handler:function(){this.buildButton("Forward")}}],items:[{scope:this,xtype:"columnchart",url:"js/ExtJs/resources/charts.swf",store:ui.cmp._PortletInfo.storeUsage,xField:"month",series:[{type:"column",yField:"nbCommitTotal",style:{mode:"stretch",color:10075112}},{type:"line",yField:"nbConTotal",style:{color:1393291}}],chartStyle:{padding:5,animationEnabled:!0,font:{name:"verdana",color:4473924,size:11},dataTip:{border:{color:10075112,size:1},background:{color:14346230,alpha:.9},font:{name:"verdana",size:11,color:1393291}},xAxis:{color:6925256,majorTicks:{color:6925256,length:4},minorTicks:{color:6925256,length:2},majorGridLines:{size:1,color:15658734}},yAxis:{color:6925256,majorTicks:{color:6925256,length:4},minorTicks:{color:6925256,length:2},majorGridLines:{size:1,color:14674166}}},tipRenderer:function(e,t,i,n){return"nbConTotal"==n.yField?_("Month:")+" "+Date.monthNames[t.data.month-1]+"\r"+_("Nb. connexion:")+" "+t.data.nbConTotal:"nbCommitTotal"==n.yField?_("Month:")+" "+Date.monthNames[t.data.month-1]+"\r"+_("Nb. commit:")+" "+t.data.nbCommitTotal:void 0}}]}]})}}),ui.cmp._PortletInfo.instance=null,ui.cmp.PortletInfo.getInstance=function(e){return ui.cmp._PortletInfo.instance||(e=e||{},ui.cmp._PortletInfo.instance=new ui.cmp.PortletInfo(e)),ui.cmp._PortletInfo.instance},Ext.namespace("ui","ui.cmp","ui.cmp._PortletLocalMail"),ui.cmp._PortletLocalMail.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:"./do/getLastNews"}),reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",idProperty:"id",fields:[{name:"id"},{name:"title"},{name:"link"},{name:"description"},{name:"pubDate",type:"date",dateFormat:"Y/m/d H:i:s"}]})}),ui.cmp._PortletLocalMail.store.setDefaultSort("pubDate","desc"),ui.cmp._PortletLocalMail.columns=[new Ext.grid.RowNumberer,{id:"GridMailingTitle",header:_("Title"),sortable:!0,dataIndex:"title"},{header:_("By"),width:100,sortable:!0,dataIndex:"description"},{header:_("Date"),width:100,sortable:!0,dataIndex:"pubDate",renderer:Ext.util.Format.dateRenderer(_("Y-m-d, H:i"))}],ui.cmp._PortletLocalMail.grid=Ext.extend(Ext.grid.GridPanel,{loadMask:!0,autoScroll:!0,height:250,autoExpandColumn:"GridMailingTitle",id:"PortletLocalMail-grid-id",store:ui.cmp._PortletLocalMail.store,columns:ui.cmp._PortletLocalMail.columns,sm:new Ext.grid.RowSelectionModel({singleSelect:!0}),view:new Ext.grid.GridView({forceFit:!0,enableRowBody:!0,ignoreAdd:!0,emptyText:'<div style="text-align: center">'+_("You must manually load this data.<br>Use the refresh button !")+"</div>",deferEmptyText:!1}),onRowDblClick:function(e,t){var i=e.store.getAt(t).data.pubDate,n=e.store.getAt(t).data.link,t=e.store.getAt(t).data.title;Ext.getCmp("main-panel").findById("mail-"+i)||Ext.getCmp("main-panel").add({xtype:"panel",id:"mail-"+i,title:Ext.util.Format.substr(t,0,20)+"...",tabTip:t,iconCls:"iconMailing",closable:!0,layout:"fit",items:[new Ext.ux.IFrameComponent({id:"frame-mail-"+i,url:n})]}),Ext.getCmp("main-panel").setActiveTab("mail-"+i)},onContextClick:function(e,t,i){this.menu||(this.menu=new Ext.menu.Menu({id:"submenu-mail",items:[{scope:this,text:"<b>"+_("Open in a new Tab")+"</b>",iconCls:"iconOpenInTab",handler:function(){this.fireEvent("rowdblclick",e,this.ctxIndex,i),this.menu.hide()}},"-",{scope:this,text:_("Refresh this grid"),iconCls:"iconRefresh",handler:function(){this.ctxIndex=null,ui.cmp._PortletLocalMail.reloadData()}}]})),this.getSelectionModel().selectRow(t),i.stopEvent(),this.ctxIndex&&(this.ctxIndex=null),this.ctxIndex=t,this.menu.showAt(i.getXY())},initComponent:function(e){ui.cmp._PortletLocalMail.grid.superclass.initComponent.call(this),Ext.apply(this,e),this.on("rowcontextmenu",this.onContextClick,this),this.on("rowdblclick",this.onRowDblClick,this)}}),ui.cmp._PortletLocalMail.reloadData=function(){ui.cmp._PortletLocalMail.store.reload({callback:function(e,t,i){i||(Ext.getCmp("PortletLocalMail-grid-id").getView().mainBody.update('<div id="PortletLocalMail-grid-defaultMess-id" style="text-align: center" class="x-grid-empty">'+_("Error when loading mails from this mailing list !")+"</div>"),Ext.get("PortletLocalMail-grid-defaultMess-id").highlight())}})},ui.cmp.PortletLocalMail=Ext.extend(Ext.ux.Portlet,{title:"",iconCls:"iconMailing",layout:"fit",store:ui.cmp._PortletLocalMail.store,reloadData:ui.cmp._PortletLocalMail.reloadData,tools:[{id:"refresh",qtip:_("Refresh this grid"),handler:function(){ui.cmp._PortletLocalMail.reloadData()}}],listeners:{expand:function(){PhDOE.app.loaded&&new ui.task.UpdateConfTask({item:"portletLocalMailCollapsed",value:!1,notify:!1})},collapse:function(){PhDOE.app.loaded&&new ui.task.UpdateConfTask({item:"portletLocalMailCollapsed",value:!0,notify:!1})},afterrender:function(e){PhDOE.user.conf.portletLocalMailCollapsed?e.collapse():e.expand()}},initComponent:function(e){this.id="portletLocalMail",Ext.apply(this,e),ui.cmp.PortletLocalMail.superclass.initComponent.apply(this),this.title=String.format(_("Mail from {0}"),"doc-"+this.lang),this.add(new ui.cmp._PortletLocalMail.grid)}}),ui.cmp._PortletLocalMail.instance=null,ui.cmp.PortletLocalMail.getInstance=function(e){return ui.cmp._PortletLocalMail.instance||(e=e||{},ui.cmp._PortletLocalMail.instance=new ui.cmp.PortletLocalMail(e)),ui.cmp._PortletLocalMail.instance},Ext.namespace("ui","ui.cmp","ui.cmp._PortletSummary"),ui.cmp._PortletSummary.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:"./do/getSummaryInfo"}),reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",idProperty:"id",fields:[{name:"id"},{name:"libel"},{name:"nbFiles"},{name:"percentFiles"},{name:"sizeFiles"},{name:"percentSize"}]}),listeners:{load:function(){this.each(function(e){switch(e.id){case 1:e.set("libel",_("Up to date files"));break;case 2:e.set("libel",_("Stale files"));break;case 3:e.set("libel",_("Files available for translation"));break;case 4:e.set("libel",_("Total"));break;default:e.set("libel","")}e.commit()})}}}),ui.cmp._PortletSummary.gridColumns=[new Ext.grid.RowNumberer,{id:"StatusType",header:_("File status type"),width:180,sortable:!0,dataIndex:"libel"},{header:_("Number of files"),width:110,sortable:!0,dataIndex:"nbFiles"},{header:_("Percent of files"),width:110,sortable:!0,dataIndex:"percentFiles"},{header:_("Size of files (kB)"),width:110,sortable:!0,dataIndex:"sizeFiles"},{header:_("Percent of size"),width:110,sortable:!0,dataIndex:"percentSize"}],ui.cmp._PortletSummary.gridView=new Ext.grid.GridView({getRowClass:function(e){switch(e.data.id){case 1:return"summary_1";case 2:return"summary_2";case 3:return"summary_3";case 4:return"summary_4";default:return""}}}),ui.cmp._PortletSummary.grid=Ext.extend(Ext.grid.GridPanel,{loadMask:!0,autoScroll:!0,autoHeight:!0,store:ui.cmp._PortletSummary.store,columns:ui.cmp._PortletSummary.gridColumns,view:ui.cmp._PortletSummary.gridView,onRowdblclick:function(e,t){t=e.store.getAt(t).data.id;2===t&&Ext.getCmp("acc-need-update").expand(),3===t&&Ext.getCmp("acc-need-translate").expand()},initComponent:function(e){ui.cmp._PortletSummary.grid.superclass.initComponent.call(this),Ext.apply(this,e),this.on("rowdblclick",this.onRowdblclick,this)}}),ui.cmp.PortletSummary=Ext.extend(Ext.ux.Portlet,{title:_("Summary"),iconCls:"",layout:"fit",store:ui.cmp._PortletSummary.store,tools:[{id:"refresh",qtip:_("Refresh this grid"),handler:function(){ui.cmp._PortletSummary.store.reload()}}],listeners:{expand:function(){PhDOE.app.loaded&&new ui.task.UpdateConfTask({item:"portletSummaryCollapsed",value:!1,notify:!1})},collapse:function(){PhDOE.app.loaded&&new ui.task.UpdateConfTask({item:"portletSummaryCollapsed",value:!0,notify:!1})}},initComponent:function(e){this.id="portletSummary",Ext.apply(this,e),ui.cmp.PortletSummary.superclass.initComponent.apply(this),this.add(new ui.cmp._PortletSummary.grid)},afterRender:function(){ui.cmp.PortletSummary.superclass.afterRender.call(this);this.header.insertFirst({tag:"div",id:Ext.id(),style:"float: left; margin-right: 2px;",cls:"flags flag-"+({cs:"cz",sr:"rs",sv:"se"}[this.lang]||this.lang)},"first"),PhDOE.user.conf.portletSummaryCollapsed?this.collapse():this.expand()}}),ui.cmp._PortletSummary.instance=null,ui.cmp.PortletSummary.getInstance=function(e){return ui.cmp._PortletSummary.instance||(e=e||{},ui.cmp._PortletSummary.instance=new ui.cmp.PortletSummary(e)),ui.cmp._PortletSummary.instance},Ext.namespace("ui","ui.cmp","ui.cmp._PortletTranslationGraph"),ui.cmp._PortletTranslationGraph.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:"./do/getGraphLang"}),reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",idProperty:"id",fields:[{name:"id"},{name:"libel",convert:renderLibel},{name:"total"}]})}),ui.cmp._PortletTranslationGraph.chart=Ext.extend(Ext.chart.PieChart,{height:400,url:"js/ExtJs/resources/charts.swf",dataField:"total",categoryField:"libel",store:ui.cmp._PortletTranslationGraph.store,series:[{style:{colors:["#68D888","#FF6347","#EEE8AA"]}}],chartStyle:{font:{name:"verdana",color:4473924,size:11},dataTip:{border:{color:10075112,size:1},background:{color:14346230,alpha:.9},font:{name:"verdana",size:11,color:1393291}}},extraStyle:{legend:{display:"bottom",padding:5,font:{family:"Tahoma",size:13}}},initComponent:function(e){ui.cmp._PortletTranslationGraph.chart.superclass.initComponent.call(this),Ext.apply(this,e)}}),ui.cmp.PortletTranslationGraph=Ext.extend(Ext.ux.Portlet,{title:_("Graphics"),iconCls:"iconGraphic",layout:"fit",store:ui.cmp._PortletTranslationGraph.store,tools:[{id:"refresh",qtip:_("Refresh this graph"),handler:function(){ui.cmp._PortletTranslationGraph.store.reload()}}],initComponent:function(e){this.id="portletTranslationGraph",Ext.apply(this,e),ui.cmp.PortletTranslationGraph.superclass.initComponent.apply(this),this.add(new ui.cmp._PortletTranslationGraph.chart)}}),ui.cmp._PortletTranslationGraph.instance=null,ui.cmp.PortletTranslationGraph.getInstance=function(e){return ui.cmp._PortletTranslationGraph.instance||(e=e||{},ui.cmp._PortletTranslationGraph.instance=new ui.cmp.PortletTranslationGraph(e)),ui.cmp._PortletTranslationGraph.instance},Ext.namespace("ui","ui.cmp","ui.cmp._PortletTranslationsGraph"),ui.cmp._PortletTranslationsGraph.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:"./do/getGraphLangs"}),reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",idProperty:"id",fields:[{name:"id"},{name:"libel",type:"string"},{name:"fullLibel",type:"string"},{name:"total",type:"int"},{name:"percent",type:"float"}]})}),ui.cmp._PortletTranslationsGraph.chart=Ext.extend(Ext.chart.ColumnChart,{height:400,url:"js/ExtJs/resources/charts.swf",xField:"libel",chartStyle:{padding:5,animationEnabled:!0,font:{name:"verdana",color:4473924,size:11},dataTip:{border:{color:10075112,size:1},background:{color:14346230,alpha:.9},font:{name:"verdana",size:11,color:1393291}}},tipRenderer:function(e,t){return _("Lang:")+" "+_(t.data.fullLibel)+"\r"+_("Total:")+" "+t.data.total+" "+_("files")+" ("+t.data.percent+"%)"},series:[{type:"column",displayName:"Total",yField:"total",style:{image:"themes/img/bar.gif",mode:"stretch",color:10075112}}],store:ui.cmp._PortletTranslationsGraph.store,initComponent:function(e){ui.cmp._PortletTranslationsGraph.chart.superclass.initComponent.call(this),Ext.apply(this,e)}}),ui.cmp.PortletTranslationsGraph=Ext.extend(Ext.ux.Portlet,{title:_("Graphics for all languages"),iconCls:"iconGraphic",layout:"fit",store:ui.cmp._PortletTranslationsGraph.store,tools:[{id:"refresh",qtip:_("Refresh this graph"),handler:function(){ui.cmp._PortletTranslationsGraph.store.reload()}}],initComponent:function(e){this.id="portletTranslationsGraph",Ext.apply(this,e),ui.cmp.PortletTranslationsGraph.superclass.initComponent.apply(this),this.add(new ui.cmp._PortletTranslationsGraph.chart)}}),ui.cmp._PortletTranslationsGraph.instance=null,ui.cmp.PortletTranslationsGraph.getInstance=function(e){return ui.cmp._PortletTranslationsGraph.instance||(e=e||{},ui.cmp._PortletTranslationsGraph.instance=new ui.cmp.PortletTranslationsGraph(e)),ui.cmp._PortletTranslationsGraph.instance},Ext.namespace("ui","ui.cmp","ui.cmp._PortletTranslator","ui.cmp._PortletReviewer"),ui.cmp._PortletTranslator.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:"./do/getTranslatorInfo"}),reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",idProperty:"id",fields:[{name:"id"},{name:"name"},{name:"email",mapping:"mail"},{name:"nick"},{name:"vcs"},{name:"uptodate",type:"int"},{name:"stale",type:"int"},{name:"sum",type:"int"}]}),listeners:{load:function(){var e=20*this.getCount();ui.cmp.PortletTranslator.getInstance().setHeight(124+e),ui.cmp.PortletTranslator.getInstance().doLayout()}}}),ui.cmp._PortletTranslator.store.setDefaultSort("nick","asc"),ui.cmp._PortletReviewer.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:"./do/getReviewerInfo"}),reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",idProperty:"id",fields:[{name:"id"},{name:"name"},{name:"email",mapping:"mail"},{name:"nick"},{name:"vcs"},{name:"reviewedUptodate",type:"int"},{name:"reviewedStale",type:"int"},{name:"reviewedSum",type:"int"}]})}),ui.cmp._PortletReviewer.store.setDefaultSort("nick","asc"),ui.cmp._PortletTranslator.translatorSumRenderer=function(e){return!!e&&(e=0===e||1<e?e:1,String.format("("+_("{0} Translators")+")",e))},ui.cmp._PortletReviewer.translatorSumRenderer=function(e){return e?(e=0===e||1<e?e:1,String.format("("+_("{0} Reviewers")+")",e)):_("No reviewer")},ui.cmp._PortletTranslator.uptodateRenderer=function(e){return"0"!==e&&'<span style="color:green; font-weight: bold;">'+e+"</span>"},ui.cmp._PortletReviewer.uptodateRenderer=function(e){return"0"!==e&&'<span style="color:green; font-weight: bold;">'+e+"</span>"},ui.cmp._PortletTranslator.staleRenderer=function(e){return"0"!==e&&'<span style="color:red; font-weight: bold;">'+e+"</span>"},ui.cmp._PortletReviewer.staleRenderer=function(e){return"0"!==e&&'<span style="color:red; font-weight: bold;">'+e+"</span>"},ui.cmp._PortletTranslator.sumRenderer=function(e){return"0"===e?"":e},ui.cmp._PortletReviewer.sumRenderer=function(e){return"0"===e?"":e},ui.cmp._PortletTranslator.gridColumns=[new Ext.grid.RowNumberer,{id:"GridTransName",header:_("Name"),sortable:!0,dataIndex:"name",summaryType:"count",summaryRenderer:ui.cmp._PortletTranslator.translatorSumRenderer},{header:_("Email"),width:110,sortable:!0,dataIndex:"email"},{header:_("Nick"),width:70,sortable:!0,dataIndex:"nick"},{header:_("VCS"),width:45,sortable:!0,dataIndex:"vcs"},{header:_("UptoDate"),width:60,sortable:!0,renderer:ui.cmp._PortletTranslator.uptodateRenderer,dataIndex:"uptodate",summaryType:"sum"},{header:_("Stale"),width:90,sortable:!0,renderer:ui.cmp._PortletTranslator.staleRenderer,dataIndex:"stale",summaryType:"sum"},{header:_("Sum"),width:50,sortable:!0,renderer:ui.cmp._PortletTranslator.sumRenderer,dataIndex:"sum",summaryType:"sum"}],ui.cmp._PortletReviewer.gridColumns=[new Ext.grid.RowNumberer,{id:"GridTransName",header:_("Name"),sortable:!0,dataIndex:"name",summaryType:"count",summaryRenderer:ui.cmp._PortletReviewer.translatorSumRenderer},{header:_("Email"),width:110,sortable:!0,dataIndex:"email"},{header:_("Nick"),width:70,sortable:!0,dataIndex:"nick"},{header:_("VCS"),width:45,sortable:!0,dataIndex:"vcs"},{header:_("Reviewed"),width:60,sortable:!0,renderer:ui.cmp._PortletReviewer.uptodateRenderer,dataIndex:"reviewedUptodate",summaryType:"sum"},{header:_("Must be reviewed"),width:90,sortable:!0,renderer:ui.cmp._PortletReviewer.staleRenderer,dataIndex:"reviewedStale",summaryType:"sum"},{header:_("Sum"),width:50,sortable:!0,renderer:ui.cmp._PortletReviewer.sumRenderer,dataIndex:"reviewedSum",summaryType:"sum"}],ui.cmp._PortletTranslator.grid=Ext.extend(Ext.grid.GridPanel,{title:_("Translators"),loadMask:!0,autoScroll:!0,autoHeight:!0,plugins:[new Ext.ux.grid.GridSummary],store:ui.cmp._PortletTranslator.store,columns:ui.cmp._PortletTranslator.gridColumns,autoExpandColumn:"GridTransName",sm:new Ext.grid.RowSelectionModel({singleSelect:!0}),lang:this.lang,EmailPrompt:new ui.cmp.EmailPrompt,listeners:{afterrender:function(e){e.ownerCt.setHeight(e.height+200),e.ownerCt.doLayout()}},onRowDblClick:function(e,t){this.getSelectionModel().selectRow(t),this.ctxTranslatorName&&(this.ctxTranslatorEmail=null,this.ctxTranslatorName=null),this.ctxTranslatorEmail=this.store.getAt(t).data.email,this.ctxTranslatorName=this.store.getAt(t).data.name,"nobody"!==this.store.getAt(t).data.nick&&(this.EmailPrompt.setData(this.ctxTranslatorName,this.ctxTranslatorEmail),this.EmailPrompt.show("lastUpdateTime"))},onContextClick:function(e,t,i){this.menu||(this.menu=new Ext.menu.Menu({id:"submenu-translators",items:[{scope:this,text:"",iconCls:"iconSendEmail",handler:function(){this.EmailPrompt.setData(this.ctxTranslatorName,this.ctxTranslatorEmail),this.EmailPrompt.show("lastUpdateTime")}},"-",{scope:this,text:String.format(_("Send an email to the {0}"),String.format(PhDOE.app.conf.projectMailList,this.lang)),iconCls:"iconSendEmail",handler:function(){this.EmailPrompt.setData("Php Doc Team "+this.lang,String.format(PhDOE.app.conf.projectMailList,this.lang)),this.EmailPrompt.show("lastUpdateTime")}}]})),this.getSelectionModel().selectRow(t),i.stopEvent(),this.ctxTranslatorName&&(this.ctxTranslatorName=null,this.ctxTranslatorEmail=null),this.ctxTranslatorName=this.store.getAt(t).data.name,this.ctxTranslatorEmail=this.store.getAt(t).data.email,"nobody"!==this.store.getAt(t).data.nick&&(this.menu.items.items[0].setText("<b>"+String.format(_("Send an email to {0}"),this.ctxTranslatorName)+"</b>"),this.menu.showAt(i.getXY()))},initComponent:function(e){ui.cmp._PortletTranslator.grid.superclass.initComponent.call(this),Ext.apply(this,e),this.on("rowcontextmenu",this.onContextClick,this),this.on("rowdblclick",this.onRowDblClick,this)}}),ui.cmp._PortletReviewer.grid=Ext.extend(Ext.grid.GridPanel,{title:_("Reviewers"),loadMask:!0,autoScroll:!0,autoHeight:!0,plugins:[new Ext.ux.grid.GridSummary],store:ui.cmp._PortletReviewer.store,columns:ui.cmp._PortletReviewer.gridColumns,autoExpandColumn:"GridTransName",sm:new Ext.grid.RowSelectionModel({singleSelect:!0}),lang:this.lang,EmailPrompt:new ui.cmp.EmailPrompt,onRowDblClick:function(e,t){this.getSelectionModel().selectRow(t),this.ctxTranslatorName&&(this.ctxTranslatorEmail=null,this.ctxTranslatorName=null),this.ctxTranslatorEmail=this.store.getAt(t).data.email,this.ctxTranslatorName=this.store.getAt(t).data.name,"nobody"!==this.store.getAt(t).data.nick&&(this.EmailPrompt.setData(this.ctxTranslatorName,this.ctxTranslatorEmail),this.EmailPrompt.show("lastUpdateTime"))},onContextClick:function(e,t,i){this.menu||(this.menu=new Ext.menu.Menu({id:"submenu-translators",items:[{scope:this,text:"",iconCls:"iconSendEmail",handler:function(){this.EmailPrompt.setData(this.ctxTranslatorName,this.ctxTranslatorEmail),this.EmailPrompt.show("lastUpdateTime")}},"-",{scope:this,text:String.format(_("Send an email to the {0}"),String.format(PhDOE.app.conf.projectMailList,this.lang)),iconCls:"iconSendEmail",handler:function(){this.EmailPrompt.setData("Php Doc Team "+this.lang,String.format(PhDOE.app.conf.projectMailList,this.lang)),this.EmailPrompt.show("lastUpdateTime")}}]})),this.getSelectionModel().selectRow(t),i.stopEvent(),this.ctxTranslatorName&&(this.ctxTranslatorName=null,this.ctxTranslatorEmail=null),this.ctxTranslatorName=this.store.getAt(t).data.name,this.ctxTranslatorEmail=this.store.getAt(t).data.email,"nobody"!==this.store.getAt(t).data.nick&&(this.menu.items.items[0].setText("<b>"+String.format(_("Send an email to {0}"),this.ctxTranslatorName)+"</b>"),this.menu.showAt(i.getXY()))},initComponent:function(e){ui.cmp._PortletReviewer.grid.superclass.initComponent.call(this),Ext.apply(this,e),this.on("rowcontextmenu",this.onContextClick,this),this.on("rowdblclick",this.onRowDblClick,this)}}),ui.cmp.PortletTranslator=Ext.extend(Ext.ux.Portlet,{title:_("Translators & Reviewer"),iconCls:"iconTranslator",layout:"fit",storeTranslator:ui.cmp._PortletTranslator.store,storeReviewer:ui.cmp._PortletReviewer.store,tools:[{id:"refresh",qtip:_("Refresh this grid"),handler:function(){ui.cmp._PortletTranslator.store.reload({callback:function(){ui.cmp._PortletReviewer.store.reload()}})}}],listeners:{expand:function(){PhDOE.app.loaded&&new ui.task.UpdateConfTask({item:"portletTranslatorCollapsed",value:!1,notify:!1})},collapse:function(){PhDOE.app.loaded&&new ui.task.UpdateConfTask({item:"portletTranslatorCollapsed",value:!0,notify:!1})},afterrender:function(e){PhDOE.user.conf.portletTranslatorCollapsed?e.collapse():e.expand()}},initComponent:function(e){this.id="portletTranslator",Ext.apply(this,e),ui.cmp.PortletTranslator.superclass.initComponent.apply(this),this.add({xtype:"tabpanel",activeTab:0,border:!1,height:200,tabPosition:"bottom",autoScroll:!0,items:[new ui.cmp._PortletTranslator.grid({lang:this.lang}),new ui.cmp._PortletReviewer.grid({lang:this.lang})]})}}),ui.cmp._PortletTranslator.instance=null,ui.cmp.PortletTranslator.getInstance=function(e){return ui.cmp._PortletTranslator.instance||(e=e||{},ui.cmp._PortletTranslator.instance=new ui.cmp.PortletTranslator(e)),ui.cmp._PortletTranslator.instance},Ext.namespace("ui","ui.cmp"),ui.cmp.PreviewFile=Ext.extend(Ext.Window,{id:"winPreviewFile",layout:"fit",title:_("Preview"),iconCls:"iconView",closable:!0,closeAction:"close",maximized:!0,modal:!0,buttons:[{text:_("Close"),handler:function(){this.ownerCt.ownerCt.close()}}],initComponent:function(){var t=this;ui.cmp.PreviewFile.superclass.initComponent.call(this),XHR({params:{task:"previewFile",path:this.path},success:function(e){e=Ext.util.JSON.decode(e.responseText);e.url=e.url+"?"+Math.random(),e=new Ext.ux.IFrameComponent({id:"frame-previewFile",url:e.url}),t.add(e),t.show()},failure:function(){}})}}),Ext.namespace("ui","ui.cmp","ui.cmp._RepositoryTree"),ui.cmp._RepositoryTree.root={nodeType:"async",id:"/",text:_("Repository"),draggable:!1},ui.cmp._RepositoryTree.loader=new Ext.tree.TreeLoader({dataUrl:"./do/getAllFiles"}),ui.cmp._RepositoryTree.winAddNewFile=Ext.extend(Ext.Window,{title:_("Add a new file"),iconCls:"iconFilesNeedTranslate",id:"win-add-new-file",layout:"form",width:350,height:170,resizable:!1,modal:!0,bodyStyle:"padding:5px 5px 0",labelWidth:150,buttons:[{id:"win-add-new-file-btn",text:_("Open the editor"),disabled:!0,handler:function(){var e=Ext.getCmp("win-add-new-file"),t=e.node.id,i=e.items.items[1].getValue(),n=e.items.items[2].getValue();return e.node.findChild("id",t+"/"+i)?PhDOE.winForbidden("file_already_exist"):(e.openFile(t+"/",i,n),e.close()),!0}}],openFile:function(e,t,i){var n,o=Ext.util.md5("FNT-"+e+t),a={data:{fileModified:!1,node:this.node}},r=e.split("/");r.shift(),n=r[0],r.shift(),r.pop(),"//"===(e="/"+r.join("/")+"/")&&(e="/"),o=Ext.util.md5("FNT-"+e+t),Ext.getCmp("main-panel").findById("FNT-"+o)||Ext.getCmp("main-panel").add({id:"FNT-"+o,layout:"border",title:t,originTitle:t,iconCls:"iconTabNeedTranslate",closable:!0,tabLoaded:!1,panTRANSLoaded:!1,panGGTRANSLoaded:!0,defaults:{split:!0},tabTip:String.format(_("New file: in {0}"),n+e),items:[new ui.cmp.FilePanel({id:"FNT-NEW-PANEL-"+o,region:"center",title:_("New file: ")+n+e+t,isTrans:!0,prefix:"FNT",ftype:"NEW",fid:o,fpath:e,fname:t,lang:n,parser:"xml",storeRecord:a,syncScrollCB:!1,syncScroll:!1,skeleton:i})]}),Ext.getCmp("main-panel").setActiveTab("FNT-"+o)},initComponent:function(){Ext.apply(this,{items:[{xtype:"displayfield",fieldLabel:_("Parent Folder"),value:this.node.id},{xtype:"textfield",fieldLabel:_("Name for the new file"),name:"newFolderName",listeners:{valid:function(){Ext.getCmp("win-add-new-file-btn").enable()},invalid:function(){Ext.getCmp("win-add-new-file-btn").disable()}}},{xtype:"combo",triggerAction:"all",width:160,editable:!1,store:new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:"./do/getSkeletonsNames"}),reader:new Ext.data.JsonReader({root:"Items",idProperty:"name",fields:[{name:"name"},{name:"path"}]})}),listeners:{select:function(e,t,i){""===e.ownerCt.items.items[1].getValue()&&e.ownerCt.items.items[1].setValue(t.data.name)}},valueField:"path",displayField:"name",fieldLabel:_("Chose a skeleton")}]}),ui.cmp._RepositoryTree.winAddNewFile.superclass.initComponent.call(this)}}),ui.cmp._RepositoryTree.winAddNewFolder=Ext.extend(Ext.Window,{title:_("Add a new folder"),iconCls:"iconFolderNew",id:"win-add-new-folder",layout:"form",width:350,height:200,resizable:!1,modal:!0,bodyStyle:"padding:5px 5px 0",labelWidth:150,buttons:[{id:"win-add-new-folder-btn",text:"Add",disabled:!0,handler:function(){var e=Ext.getCmp("win-add-new-folder"),t=e.node.id,i=e.items.items[1].getValue();XHR({params:{task:"addNewFolder",parentFolder:t,newFolderName:i},success:function(){Ext.getCmp("win-add-new-folder").close(),e.node.reload(),PhDOE.notify("info",_("Folder created"),String.format(_("Folder <br><br><b>{0}</b><br><br> was created sucessfully under {1} !"),i,t))},failure:function(e){e=Ext.util.JSON.decode(e.responseText);e.type?PhDOE.winForbidden(e.type):PhDOE.winForbidden()}})}}],initComponent:function(){Ext.apply(this,{items:[{xtype:"displayfield",fieldLabel:_("Parent Folder"),value:this.node.id},{xtype:"textfield",fieldLabel:_("Name for the new folder"),name:"newFolderName",vtype:"alphanum",listeners:{valid:function(){Ext.getCmp("win-add-new-folder-btn").enable()},invalid:function(){Ext.getCmp("win-add-new-folder-btn").disable()}}},{xtype:"box",html:_("Info: This new folder won't be commited until a new file will be commited into it. If you don't commit any new file into it until 8 days, it will be automatically deleted.")}]}),ui.cmp._RepositoryTree.winAddNewFolder.superclass.initComponent.call(this)}}),Ext.namespace("ui.cmp._RepositoryTree.menu"),ui.cmp._RepositoryTree.menu.folder=function(e){Ext.apply(this,e),this.init(),ui.cmp._RepositoryTree.menu.folder.superclass.constructor.call(this)},Ext.extend(ui.cmp._RepositoryTree.menu.folder,Ext.menu.Menu,{init:function(){Ext.apply(this,{items:[{text:this.node.isExpanded()?"<b>"+_("Collapse")+"</b>":"<b>"+_("Expand")+"</b>",iconCls:"iconFolderClose",scope:this,handler:function(){this.node.isExpanded()?this.node.collapse():this.node.expand()}},"-",{text:_("Update this folder"),disabled:!0,iconCls:"iconFilesNeedUpdate",scope:this,handler:function(){this.node.expand(),new ui.task.UpdateSingleFolderTask(this.node)}},{text:_("Add a new folder"),iconCls:"iconFolderNew",hidden:"/"===this.node.id||"/en"!==Ext.util.Format.substr(this.node.id,0,3)&&"/doc-base"!==Ext.util.Format.substr(this.node.id,0,9),scope:this,handler:function(){this.node.expand(),new ui.cmp._RepositoryTree.winAddNewFolder({node:this.node}).show(this.node.ui.getEl())}},{text:_("Add a new file"),iconCls:"iconFilesNeedTranslate",hidden:"/"===this.node.id||"/en"!==Ext.util.Format.substr(this.node.id,0,3)&&"/doc-base"!==Ext.util.Format.substr(this.node.id,0,9),scope:this,handler:function(){this.node.expand(),new ui.cmp._RepositoryTree.winAddNewFile({node:this.node}).show(this.node.ui.getEl())}}]})}}),ui.cmp._RepositoryTree.menu.file=function(e){Ext.apply(this,e),this.init(),ui.cmp._RepositoryTree.menu.file.superclass.constructor.call(this)},Ext.extend(ui.cmp._RepositoryTree.menu.file,Ext.menu.Menu,{init:function(){var e,t,i=this.node.attributes.text,n=this.node.attributes.id.split("/");n.shift(),e=n[0],n.shift(),n.pop(),t=n.join("/")+"/",Ext.apply(this,{items:[{text:"<b>"+_("Edit in a new tab")+"</b>",iconCls:"iconTabNeedReviewed",scope:this,handler:function(){ui.cmp._RepositoryTree.instance.fireEvent("dblclick",this.node)}},{hidden:"search"===this.node.attributes.from||"en"===PhDOE.user.lang,text:"en"===e?String.format(_("Open the same file in <b>{0}</b>"),Ext.util.Format.uppercase(PhDOE.user.lang)):String.format(_("Open the same file in <b>{0}</b>"),"EN"),iconCls:"iconTabNeedReviewed",scope:this,handler:function(){"en"===e?ui.cmp._RepositoryTree.instance.openFile("byPath",PhDOE.user.lang+"/"+t,i):ui.cmp._RepositoryTree.instance.openFile("byPath","en/"+t,i)}}]})}}),ui.cmp.RepositoryTree=Ext.extend(Ext.ux.MultiSelectTreePanel,{animate:!0,enableDD:!0,ddGroup:"mainPanelDDGroup",useArrows:!0,autoScroll:!0,border:!1,containerScroll:!0,root:ui.cmp._RepositoryTree.root,loader:ui.cmp._RepositoryTree.loader,onContextMenu:function(e,t){t.stopEvent(),e.select(),"folder"===e.attributes.type||e.isRoot?new ui.cmp._RepositoryTree.menu.folder({node:e}).showAt(t.getXY()):"file"===e.attributes.type&&new ui.cmp._RepositoryTree.menu.file({node:e}).showAt(t.getXY())},onDblClick:function(e){"file"===e.attributes.type&&this.openFile("byId",e.attributes.id,!1)},openFile:function(e,t,i){var n,o,a,r,s,l,d,c;"byPath"===e&&(Ext.getCmp("acc-all-files").expand(),n=i,s=t.split("/"),o=function(e){if(e.ensureVisible(),s[0]&&""!==s[0])for(var t=0;t<e.childNodes.length;++t)e.childNodes[t].text===s[0]&&(s.shift(),e.childNodes[t].expand(!1,!0,o.createDelegate(this)));else for(var i=0;i<e.childNodes.length;++i)e.childNodes[i].text===n&&(e.childNodes[i].ensureVisible(),e.childNodes[i].ui.highlight(),this.openFile("byId",e.childNodes[i].id,!1))},this.root.expand(!1,!0,o.createDelegate(this))),"byId"===e&&(a=(c=this.getNodeById(t)).attributes.id,r=c.attributes.extension,(s=a.split("/")).shift(),l=s.pop(),i=s.shift(),a=0<s.length?"/"+s.join("/")+"/":"/",e=Ext.util.md5("AF-"+i+a+l),Ext.getCmp("main-panel").findById("AF-"+e)||(t="html"!==r?r:"xml",c="gif"===r||"png"===r||"jpg"===r?(d={},{id:"AF-ALL-FILE-"+e,xtype:"panel",region:"center",layout:"fit",bodyStyle:"padding:5px 5px 0",html:'<img src="./do/getImageContent?FileLang='+i+"&FilePath="+a+"&FileName="+l+"&csrfToken="+csrfToken+'" />'}):(d={xtype:"panel",region:"west",title:_("Tools"),iconCls:"iconConf",collapsedIconCls:"iconConf",plugins:[Ext.ux.PanelCollapsedTitle],layout:"fit",bodyBorder:!1,split:!0,collapsible:!0,collapsed:!PhDOE.user.conf.allFiles.toolsPanelDisplay,width:PhDOE.user.conf.allFiles.toolsPanelWidth||375,listeners:{collapse:function(){this.ownerCt.tabLoaded&&new ui.task.UpdateConfTask({module:"allFiles",itemName:"toolsPanelDisplay",value:!1,notify:!1})},expand:function(){this.ownerCt.tabLoaded&&new ui.task.UpdateConfTask({module:"allFiles",itemName:"toolsPanelDisplay",value:!0,notify:!1})},resize:function(e,t){this.ownerCt.tabLoaded&&t&&t!=PhDOE.user.conf.allFiles.toolsPanelWidth&&new ui.task.UpdateConfTask({module:"allFiles",itemName:"toolsPanelWidth",value:t,notify:!1})}},items:{xtype:"tabpanel",activeTab:0,defaults:{autoScroll:!0},items:[{title:_("Log"),layout:"fit",items:[new ui.cmp.VCSLogGrid({prefix:"AF",fid:e,fpath:i+a,fname:l,loadStore:PhDOE.user.conf.allFiles.toolsPanelLogLoad})]},{title:_("Entities"),layout:"fit",items:[new ui.cmp.EntitiesAcronymsPanel({dataType:"entities",prefix:"AF",ftype:"ALL",fid:e,loadStore:PhDOE.user.conf.allFiles.toolsPanelEntitiesLoad})]},{title:_("Acronyms"),layout:"fit",items:[new ui.cmp.EntitiesAcronymsPanel({dataType:"acronyms",prefix:"AF",ftype:"ALL",fid:e,loadStore:PhDOE.user.conf.allFiles.toolsPanelAcronymsLoad})]}]}},new ui.cmp.FilePanel({id:"AF-ALL-PANEL-"+e,region:"center",title:_("File: ")+i+a+l,prefix:"AF",ftype:"ALL",spellCheck:PhDOE.user.conf.allFiles.enableSpellCheck,spellCheckConf:{module:"allFiles",itemName:"enableSpellCheck"},fid:e,fpath:a,fname:l,lang:i,parser:t,storeRecord:c,syncScrollCB:!1,syncScroll:!1})),Ext.getCmp("main-panel").add({id:"AF-"+e,layout:"border",title:l,originTitle:l,closable:!0,tabLoaded:!1,panEntities:!PhDOE.user.conf.allFiles.toolsPanelEntitiesLoad,panAcronyms:!PhDOE.user.conf.allFiles.toolsPanelAcronymsLoad,panVCS:!PhDOE.user.conf.allFiles.toolsPanelLogLoad,panLoaded:!1,tabTip:String.format(_("in {0}"),a),iconCls:"iconAllFiles",items:[c,d]})),Ext.getCmp("main-panel").setActiveTab("AF-"+e))},initComponent:function(){Ext.apply(this,{tbar:[_("Search: ")," ",new Ext.form.TwinTriggerField({id:"AF-search",validationEvent:!1,validateOnBlur:!1,trigger1Class:"x-form-clear-trigger",trigger2Class:"x-form-search-trigger",hideTrigger1:!0,width:180,enableKeyEvents:!0,listeners:{keypress:function(e,t){t.getKey()===t.ENTER&&this.onTrigger2Click()}},onTrigger1Click:function(){var e=ui.cmp._RepositoryTree.instance;this.setValue(""),this.triggers[0].hide(),this.setSize(180,10),e.root.setText(_("Repository")),delete e.loader.baseParams.search,e.root.reload()},onTrigger2Click:function(){var e=ui.cmp._RepositoryTree.instance,t=this.getValue();""===t||t.length<3?this.markInvalid(_("Your search must contain at least 3 characters")):(this.clearInvalid(),this.triggers[0].show(),this.setSize(180,10),e.loader.baseParams.search=t,e.root.reload(function(){e.root.setText(String.format(_("Search result: {0}"),e.root.childNodes.length))}))}})]}),ui.cmp.RepositoryTree.superclass.initComponent.call(this),this.on("contextmenu",this.onContextMenu,this),this.on("dblclick",this.onDblClick,this),new Ext.tree.TreeSorter(this,{folderSort:!0})}}),ui.cmp._RepositoryTree.instance=null,ui.cmp.RepositoryTree.getInstance=function(e){return ui.cmp._RepositoryTree.instance||(e=e||{},ui.cmp._RepositoryTree.instance=new ui.cmp.RepositoryTree(e)),ui.cmp._RepositoryTree.instance},Ext.namespace("ui","ui.cmp","ui.cmp._StaleFileGrid"),ui.cmp._StaleFileGrid.store=new Ext.data.GroupingStore({proxy:new Ext.data.HttpProxy({url:"./do/getFilesNeedUpdate"}),reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",idProperty:"id",fields:[{name:"id"},{name:"path"},{name:"name"},{name:"revision"},{name:"original_revision"},{name:"en_revision"},{name:"maintainer"},{name:"fileModified"}]}),sortInfo:{field:"name",direction:"ASC"},groupField:"path",listeners:{datachanged:function(e){var t=e.getCount(),i=!1;PhDOE.user.haveKarma&&e.each(function(e){e.data.maintainer==PhDOE.user.login&&i++},this),Ext.getDom("acc-need-update-nb").innerHTML=i?t+" - "+String.format(_("{0} mine"),i):t}}}),ui.cmp._StaleFileGrid.view=new Ext.grid.GroupingView({forceFit:!0,startCollapsed:!0,groupTextTpl:'{[values.rs[0].data["path"]]} ({[values.rs.length]} {[values.rs.length > 1 ? "'+_("Files")+'" : "'+_("File")+'"]})',deferEmptyText:!1,getRowClass:function(e){if(e.data.fileModified){var t=Ext.util.JSON.decode(e.data.fileModified),e=PhDOE.user.isAnonymous?"anonymous":PhDOE.user.login;return t.user===e&&t.anonymousIdent===PhDOE.user.anonymousIdent?"fileModifiedByMe":"fileModifiedByAnother"}return!1},emptyText:'<div style="text-align: center;">'+_("No Files")+"</div>"}),ui.cmp._StaleFileGrid.columns=[{id:"name",header:_("Files"),sortable:!0,dataIndex:"name",renderer:function(e,t,i){var n="",o=PhDOE.user.isAnonymous?"anonymous":PhDOE.user.login;return i.data.fileModified&&((i=Ext.util.JSON.decode(i.data.fileModified)).user===o&&i.anonymousIdent===PhDOE.user.anonymousIdent?n+=String.format(_("File {0} modified by me"),PhDOE.user.lang.ucFirst()):n+=String.format(_("File {0} modified by {1}"),PhDOE.user.lang.ucFirst(),i.user)),""!==n?"<span ext:qtip='"+n+"'>"+e+"</span>":e}},{header:_("EN revision"),width:45,sortable:!0,dataIndex:"en_revision"},{header:"",width:45,sortable:!0,dataIndex:"revision"},{header:_("Maintainer"),width:45,sortable:!0,dataIndex:"maintainer"},{header:_("Path"),dataIndex:"path",hidden:!0}],ui.cmp._StaleFileGrid.menu=function(e){Ext.apply(this,e),this.init(),ui.cmp._StaleFileGrid.menu.superclass.constructor.call(this)},Ext.extend(ui.cmp._StaleFileGrid.menu,Ext.menu.Menu,{init:function(){Ext.apply(this,{items:[{scope:this,text:"<b>"+_("Edit in a new tab")+"</b>",iconCls:"iconTabNeedUpdate",handler:function(){this.grid.fireEvent("rowdblclick",this.grid,this.rowIdx,this.event)}},{scope:this,hidden:this.hideDiffMenu,text:_("View diff"),iconCls:"iconViewDiff",handler:function(){Ext.getCmp("main-panel").openDiffTab({DiffType:"file",FileName:this.fname,FilePath:PhDOE.user.lang+this.fpath})}}]})}}),ui.cmp.StaleFileGrid=Ext.extend(Ext.grid.GridPanel,{view:ui.cmp._StaleFileGrid.view,loadMask:!0,autoExpandColumn:"name",border:!1,enableDragDrop:!0,ddGroup:"mainPanelDDGroup",onRowContextMenu:function(e,t,i){i.stopEvent();var n=this.store.getAt(t).data,o=n.path,a=n.name;this.getSelectionModel().selectRow(t),new ui.cmp._StaleFileGrid.menu({hideDiffMenu:!1===n.fileModified,grid:this,event:i,rowIdx:t,lang:PhDOE.user.lang,fpath:o,fname:a}).showAt(i.getXY())},onRowDblClick:function(e,t){this.openFile(this.store.getAt(t).data.id)},openFile:function(e){var t=this.store.getById(e),i=t.data.path,n=t.data.name,o=t.data.en_revision,a=t.data.revision,r=t.data.original_revision,s=Ext.util.md5("FNU-"+PhDOE.user.lang+i+n),e="";Ext.getCmp("main-panel").findById("FNU-"+s)||("using-viewvc"===PhDOE.user.conf.needUpdate.diffMethod?e=ui.cmp.ViewVCDiff:"using-exec"===PhDOE.user.conf.needUpdate.diffMethod&&(e=ui.cmp.ExecDiff),Ext.getCmp("main-panel").add({id:"FNU-"+s,layout:"border",title:n,originTitle:n,iconCls:"iconTabNeedUpdate",closable:!0,tabLoaded:!1,panVCSLang:!PhDOE.user.conf.needUpdate.toolsPanelLogLoad,panVCSEn:!PhDOE.user.conf.needUpdate.toolsPanelLogLoad,panDiffLoaded:"using-viewvc"===PhDOE.user.conf.needUpdate.diffMethod,panLANGLoaded:!1,panENLoaded:!1,defaults:{split:!0},tabTip:String.format(_("Need Update: in {0}"),i),listeners:{resize:function(e){Ext.getCmp("FNU-EN-PANEL-"+s).setWidth(e.getWidth()/2)}},items:[new e({region:"north",collapsible:!0,height:PhDOE.user.conf.needUpdate.diffPanelHeight||150,prefix:"FNU",collapsed:!PhDOE.user.conf.needUpdate.diffPanelDisplay,fid:s,fpath:i,fname:n,rev1:r||a,rev2:o,listeners:{collapse:function(){this.ownerCt.tabLoaded&&new ui.task.UpdateConfTask({module:"needUpdate",itemName:"diffPanelDisplay",value:!1,notify:!1})},expand:function(){this.ownerCt.tabLoaded&&new ui.task.UpdateConfTask({module:"needUpdate",itemName:"diffPanelDisplay",value:!0,notify:!1})},resize:function(e,t,i){this.ownerCt.tabLoaded&&i&&50<i&&i!=PhDOE.user.conf.needUpdate.diffPanelHeight&&new ui.task.UpdateConfTask({module:"needUpdate",itemName:"diffPanelHeight",value:i,notify:!1})}}}),{region:"west",xtype:"panel",title:_("Tools"),iconCls:"iconConf",collapsedIconCls:"iconConf",collapsible:!0,collapsed:!PhDOE.user.conf.needUpdate.toolsPanelDisplay,layout:"fit",bodyBorder:!1,plugins:[Ext.ux.PanelCollapsedTitle],width:PhDOE.user.conf.needUpdate.toolsPanelWidth||375,listeners:{collapse:function(){this.ownerCt.tabLoaded&&new ui.task.UpdateConfTask({module:"needUpdate",itemName:"toolsPanelDisplay",value:!1,notify:!1})},expand:function(){this.ownerCt.tabLoaded&&new ui.task.UpdateConfTask({module:"needUpdate",itemName:"toolsPanelDisplay",value:!0,notify:!1})},resize:function(e,t){this.ownerCt.tabLoaded&&t&&t!=PhDOE.user.conf.needUpdate.toolsPanelWidth&&new ui.task.UpdateConfTask({module:"needUpdate",itemName:"toolsPanelWidth",value:t,notify:!1})}},items:{xtype:"tabpanel",activeTab:0,tabPosition:"bottom",enableTabScroll:!0,defaults:{autoScroll:!0},items:[new ui.cmp.VCSLogGrid({layout:"fit",title:String.format(_("{0} Log"),PhDOE.user.lang.ucFirst()),prefix:"FNU-LANG",fid:s,fpath:PhDOE.user.lang+i,fname:n,loadStore:PhDOE.user.conf.needUpdate.toolsPanelLogLoad}),new ui.cmp.VCSLogGrid({layout:"fit",title:String.format(_("{0} Log"),"En"),prefix:"FNU-EN",fid:s,fpath:"en"+i,fname:n,loadStore:PhDOE.user.conf.needUpdate.toolsPanelLogLoad}),new ui.cmp.DictionaryGrid({layout:"fit",title:_("Dictionary"),prefix:"FNU",fid:s})]}},new ui.cmp.FilePanel({id:"FNU-LANG-PANEL-"+s,region:"center",title:String.format(_("{0} File: "),PhDOE.user.lang)+i+n,prefix:"FNU",ftype:"LANG",spellCheck:PhDOE.user.conf.needUpdate.enableSpellCheckLang,spellCheckConf:{module:"needUpdate",itemName:"enableSpellCheckLang"},fid:s,fpath:i,fname:n,lang:PhDOE.user.lang,parser:"xml",storeRecord:t,syncScrollCB:!0,syncScroll:!0,syncScrollConf:{module:"needUpdate",itemName:"syncScrollbars"}}),new ui.cmp.FilePanel({id:"FNU-EN-PANEL-"+s,region:"east",title:_("en File: ")+i+n,prefix:"FNU",ftype:"EN",original:!0,readOnly:!0,openInNewTabBtn:!0,fid:s,fpath:i,fname:n,lang:"en",parser:"xml",storeRecord:t,syncScroll:!0,syncScrollConf:{module:"needUpdate",itemName:"syncScrollbars"}})]})),Ext.getCmp("main-panel").setActiveTab("FNU-"+s)},initComponent:function(){ui.cmp._StaleFileGrid.columns[2].header=String.format(_("{0} revision"),Ext.util.Format.uppercase(PhDOE.user.lang)),Ext.apply(this,{columns:ui.cmp._StaleFileGrid.columns,store:ui.cmp._StaleFileGrid.store,tbar:[_("Filter: ")," ",new Ext.form.TwinTriggerField({id:"FNU-filter",width:180,hideTrigger1:!0,enableKeyEvents:!0,validateOnBlur:!1,validationEvent:!1,trigger1Class:"x-form-clear-trigger",trigger2Class:"x-form-search-trigger",listeners:{specialkey:function(e,t){t.getKey()===t.ENTER&&this.onTrigger2Click()}},onTrigger1Click:function(){this.setValue(""),this.triggers[0].hide(),this.setSize(180,10),ui.cmp._StaleFileGrid.instance.store.clearFilter()},onTrigger2Click:function(){var t,e=this.getValue();""===e||e.length<3?this.markInvalid(_("Your filter must contain at least 3 characters")):(this.clearInvalid(),this.triggers[0].show(),this.setSize(180,10),t=new RegExp(e,"i"),ui.cmp._StaleFileGrid.instance.store.filterBy(function(e){return!!(t.test(e.data.path)||t.test(e.data.name)||t.test(e.data.revision)||t.test(e.data.en_revision)||t.test(e.data.maintainer))},this))}})]}),ui.cmp.StaleFileGrid.superclass.initComponent.call(this),this.on("rowcontextmenu",this.onRowContextMenu,this),this.on("rowdblclick",this.onRowDblClick,this)}}),ui.cmp._StaleFileGrid.instance=null,ui.cmp.StaleFileGrid.getInstance=function(e){return ui.cmp._StaleFileGrid.instance||(e=e||{},ui.cmp._StaleFileGrid.instance=new ui.cmp.StaleFileGrid(e)),ui.cmp._StaleFileGrid.instance},Ext.namespace("ui","ui.cmp"),ui.cmp.SystemUpdatePrompt=Ext.extend(Ext.Window,{id:"sys-update-win",title:_("Refresh all data"),layout:"form",width:300,height:200,resizable:!1,modal:!0,bodyStyle:"padding:15px 15px 0",iconCls:"iconRefresh",html:['<div id="wizard-step-1" class="wizard-step-before">',_("Update all files from VCS"),"</div>",'<div id="wizard-step-1.1" class="wizard-wait">',_("This may take time. Thank you for your patience..."),"</div>",'<div id="wizard-step-2" class="wizard-step-before">',_("Apply all tools"),"</div>",'<div id="wizard-step-3" class="wizard-step-before">',_("Reload data"),"</div>"].join(""),buttons:[{id:"btn-start-refresh",text:_("Start"),iconCls:"iconStartRefresh",handler:function(){Ext.getCmp("btn-start-refresh").disable(),this.ownerCt.ownerCt.tools.close.setVisible(!1),new ui.task.SystemUpdateTask}}]}),Ext.namespace("ui","ui.cmp","ui.cmp._VCSLogGrid"),ui.cmp._VCSLogGrid.store=Ext.extend(Ext.data.Store,{reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",idProperty:"id",fields:[{name:"id"},{name:"revision"},{name:"date",type:"date",dateFormat:"Y/m/d H:i:s"},{name:"author"},{name:"content"}]})}),ui.cmp._VCSLogGrid.sm=Ext.extend(Ext.grid.CheckboxSelectionModel,{singleSelect:!1,header:"",width:22,listeners:{beforerowselect:function(e){return 2!==e.getCount()},rowselect:function(e){2===e.getCount()?(Ext.getCmp(e.prefix+"-PANEL-btn-log-"+e.fid).enable(),Ext.get(e.prefix+"-PANEL-btn-log-"+e.fid).frame("3F8538")):Ext.getCmp(e.prefix+"-PANEL-btn-log-"+e.fid).disable()},rowdeselect:function(e){2===e.getCount()?(Ext.getCmp(e.prefix+"-PANEL-btn-log-"+e.fid).enable(),Ext.get(e.prefix+"-PANEL-btn-log-"+e.fid).frame("3F8538")):Ext.getCmp(e.prefix+"-PANEL-btn-log-"+e.fid).disable()}}}),ui.cmp._VCSLogGrid.columns=[{id:"id",header:_("Rev."),width:40,sortable:!1,dataIndex:"revision"},{header:_("Content"),width:130,sortable:!0,dataIndex:"content"},{header:_("By"),width:50,sortable:!0,dataIndex:"author"},{header:_("Date"),width:85,sortable:!0,dataIndex:"date",renderer:Ext.util.Format.dateRenderer(_("Y-m-d, H:i"))}],ui.cmp.VCSLogGrid=Ext.extend(Ext.grid.GridPanel,{loadMask:!0,autoScroll:!0,bodyBorder:!1,border:!1,autoExpandColumn:"content",initComponent:function(){var e,t=new ui.cmp._VCSLogGrid.sm({fid:this.fid,prefix:this.prefix}),i=new ui.cmp._VCSLogGrid.store({autoLoad:this.loadStore,proxy:new Ext.data.HttpProxy({url:"./do/getLog"}),baseParams:{Path:this.fpath,File:this.fname},listeners:{scope:this,load:function(e,t){"FNU-EN"===this.prefix&&(Ext.getCmp("FNU-"+this.fid).panVCSEn=!0,Ext.getCmp("main-panel").fireEvent("tabLoaded","FNU",this.fid)),"FNU-LANG"===this.prefix&&(Ext.getCmp("FNU-"+this.fid).panVCSLang=!0,Ext.getCmp("main-panel").fireEvent("tabLoaded","FNU",this.fid)),"FE-EN"===this.prefix&&(Ext.getCmp("FE-"+this.fid).panVCSEn=!0,Ext.getCmp("main-panel").fireEvent("tabLoaded","FE",this.fid)),"FE-LANG"===this.prefix&&(Ext.getCmp("FE-"+this.fid).panVCSLang=!0,Ext.getCmp("main-panel").fireEvent("tabLoaded","FE",this.fid)),"FNR-EN"===this.prefix&&(Ext.getCmp("FNR-"+this.fid).panVCSEn=!0,Ext.getCmp("main-panel").fireEvent("tabLoaded","FNR",this.fid)),"FNR-LANG"===this.prefix&&(Ext.getCmp("FNR-"+this.fid).panVCSLang=!0,Ext.getCmp("main-panel").fireEvent("tabLoaded","FNR",this.fid)),"AF"===this.prefix&&(Ext.getCmp("AF-"+this.fid).panVCS=!0,Ext.getCmp("main-panel").fireEvent("tabLoaded","AF",this.fid)),"PP"===this.prefix&&(Ext.getCmp("PP-"+this.fid).panVCS=!0,Ext.getCmp("main-panel").fireEvent("tabLoaded","PP",this.fid))}}}),n=[];for(n.push(t),e=0;e<ui.cmp._VCSLogGrid.columns.length;++e)n.push(ui.cmp._VCSLogGrid.columns[e]);i.setDefaultSort("date","desc"),Ext.apply(this,{sm:t,store:i,columns:n,view:new Ext.grid.GridView({forceFit:!0,emptyText:'<div style="text-align: center">'+_("You must manually load this data.<br>Use the refresh button !")+"<br><br>"+_("(You can change this behavior by setting an option in the configuration window)")+"</div>",deferEmptyText:!1}),tbar:[{scope:this,id:this.prefix+"-PANEL-btn-refreshlog-"+this.fid,tooltip:_("<b>Load/Refresh</b> revisions"),iconCls:"iconRefresh",handler:function(){this.store.reload()}},{scope:this,id:this.prefix+"-PANEL-btn-log-"+this.fid,tooltip:_("<b>View</b> the diff"),iconCls:"iconViewDiff",disabled:!0,handler:function(){var e=this.getSelectionModel().getSelections(),i=e[0].data.revision,n=e[1].data.revision;Ext.getBody().mask('<img src="themes/img/loading.gif" style="vertical-align: middle;" /> '+_("Finding the diff. Please, wait...")),XHR({params:{task:"getDiff",DiffType:"vcs",FilePath:this.fpath,FileName:this.fname,Rev1:i,Rev2:n},success:function(e){var t,e=Ext.util.JSON.decode(e.responseText);Ext.getBody().unmask(),(t=new Ext.Window({title:String.format(_("Diff between {0} & {1}"),i,n),width:650,height:350,resizable:!1,modal:!0,autoScroll:!0,bodyStyle:"background-color: white; padding: 5px;",html:'<div class="diff-content">'+e.content+"</div>",buttons:[{text:_("Close"),handler:function(){t.close()}}]})).show()}})}}]}),ui.cmp.VCSLogGrid.superclass.initComponent.call(this)}}),Ext.namespace("ui","ui.cmp"),ui.cmp.ViewVCDiff=Ext.extend(Ext.Panel,{layout:"fit",title:_("Diff From VCS"),iconCls:"iconDiffView",collapsedIconCls:"iconDiffView",plugins:[Ext.ux.PanelCollapsedTitle],initComponent:function(){Ext.apply(this,{items:{id:this.prefix+"-diff-"+this.fid,xtype:"panel",layout:"fit",items:[new Ext.ux.IFrameComponent({id:"frame-"+this.prefix+"-diff-"+this.fid,url:String.format(PhDOE.app.conf.viewVcUrl,this.fpath+this.fname,this.rev1,this.rev2)})]}}),ui.cmp.ViewVCDiff.superclass.initComponent.call(this)}}),Ext.namespace("ui","ui.cmp","ui.cmp._WorkTreeGrid","ui.cmp._WorkTreeGrid.menu"),ui.cmp._WorkTreeGrid.SetProgress=new Ext.util.DelayedTask(function(){new ui.task.SetFileProgressTask({idDB:this.node.attributes.idDB,progress:this.node.attributes.progress})}),ui.cmp._WorkTreeGrid.isNotSavedFile=function(e){var t=!1;Ext.each(Ext.getCmp("main-panel").items.items,function(e){if(!0===e.isModified)return t=!0,Ext.MessageBox.show({title:_("Warning"),icon:Ext.MessageBox.INFO,buttons:Ext.MessageBox.OK,msg:_("There is some file unsaved. Please, save it before start a commit."),fn:function(){Ext.getCmp("main-panel").setActiveTab(e.id)}}),!1},this),t||e.commitWindow.show()},ui.cmp._WorkTreeGrid.menu.admin=function(e){Ext.apply(this,e),this.init(),ui.cmp._WorkTreeGrid.menu.admin.superclass.constructor.call(this)},Ext.extend(ui.cmp._WorkTreeGrid.menu.admin,Ext.menu.Item,{listeners:{afterrender:function(){ui.cmp._WorkTreeGrid.menu.usersPatch({menuID:"AdminPatchesMenu"})}},init:function(){var e,t=[];switch(t.push(this.node),this.from){case"file":e=[{text:_("Submit all files for review in patch:"),iconCls:"iconPendingPatch",handler:function(){return!1},menu:new Ext.menu.Menu({id:"AdminPatchesMenu",itemRendered:!1,nodesToAdd:t})},{scope:this,iconCls:"iconSwitchLang",text:_("Change file's owner"),handler:function(){new ui.cmp.ChangeFileOwner({fileIdDB:this.node.attributes.idDB,fileFolder:this.folderNode.attributes.task,fileName:this.node.attributes.task,currentOwner:this.userNode.attributes.task})}},{scope:this,iconCls:"iconPageDelete",text:"delete"===this.node.attributes.type?_("Cancel this deletion"):_("Clear this change"),handler:function(){new ui.task.ClearLocalChangeTask({ftype:this.node.attributes.type,fpath:this.folderNode.attributes.task,fname:this.node.attributes.task})}}];break;case"patch":e=[{scope:this,iconCls:"iconTrash",text:_("Delete this patch"),handler:function(){ui.task.DeletePatchTask({patchID:this.node.attributes.idDB})}}]}Ext.apply(this,{text:_("Administrator menu"),iconCls:"iconAdmin",handler:function(){return!1},menu:new Ext.menu.Menu({items:e})})}}),ui.cmp._WorkTreeGrid.menu.commit=function(e){Ext.apply(this,e),this.init(),ui.cmp._WorkTreeGrid.menu.commit.superclass.constructor.call(this)},Ext.extend(ui.cmp._WorkTreeGrid.menu.commit,Ext.menu.Item,{init:function(){Ext.apply(this,{text:_("Commit..."),iconCls:"iconCommitFileVcs",disabled:!PhDOE.user.haveKarma,handler:function(){return!1},menu:new Ext.menu.Menu({items:[{scope:this,text:_("...this file"),hidden:"user"===this.from||"folder"===this.from||"patch"===this.from||"anonymousPatch"===this.from,iconCls:"iconCommitFileVcs",handler:function(){var e=[{fid:Ext.util.md5(this.folderNode.attributes.task+this.node.attributes.task),fpath:this.folderNode.attributes.task,fname:this.node.attributes.task,fdbid:this.node.attributes.idDB,ftype:this.node.attributes.type,fdate:Date.parseDate(this.node.attributes.last_modified,"Y-m-d H:i:s"),fby:this.userNode.attributes.task}];ui.cmp._WorkTreeGrid.isNotSavedFile({commitWindow:new ui.cmp.CommitPrompt({files:e})})}},{scope:this,text:_("...all files from this folder"),hidden:"user"===this.from||"patch"===this.from||"anonymousPatch"===this.from,iconCls:"iconCommitFileVcs",handler:function(){var t=[];this.folderNode.cascade(function(e){"folder"!==e.attributes.type&&"user"!==e.attributes.type&&t.push({fid:Ext.util.md5(this.folderNode.attributes.task+e.attributes.task),fpath:this.folderNode.attributes.task,fname:e.attributes.task,fdbid:e.attributes.idDB,ftype:e.attributes.type,fdate:Date.parseDate(e.attributes.last_modified,"Y-m-d H:i:s"),fby:this.userNode.attributes.task})},this),ui.cmp._WorkTreeGrid.isNotSavedFile({commitWindow:new ui.cmp.CommitPrompt({files:t})})}},{scope:this,text:_("...all files from this patch"),hidden:"patches"!==this.module||"user"===this.from,iconCls:"iconCommitFileVcs",handler:function(){var e,t=[],i="",n=!1;"anonymousPatch"===this.from&&(e=this.patchNode.parentNode.attributes.task,this.patchNode.parentNode.attributes.isAnonymous&&(e="anonymous "+this.patchNode.parentNode.attributes.userID),i=this.patchNode.attributes.patchDescription+"\n\n-- \nProvided by "+e+" ("+this.patchNode.attributes.patchEmail+")",n=this.patchNode.attributes.idDB),this.patchNode.cascade(function(e){"folder"!==e.attributes.type&&"user"!==e.attributes.type&&"patch"!==e.attributes.type&&t.push({fid:Ext.util.md5(e.parentNode.attributes.task+e.attributes.task),fpath:e.parentNode.attributes.task,fname:e.attributes.task,fdbid:e.attributes.idDB,ftype:e.attributes.type,fdate:Date.parseDate(e.attributes.last_modified,"Y-m-d H:i:s"),fby:this.userNode.attributes.task})},this),ui.cmp._WorkTreeGrid.isNotSavedFile({commitWindow:new ui.cmp.CommitPrompt({files:t,defaultMessage:i,patchID:n})})}},{scope:this,text:_("...all files modified by me"),hidden:"anonymousPatch"===this.from,iconCls:"iconCommitFileVcs",handler:function(){var t=[];this.userNode.cascade(function(e){"folder"!==e.attributes.type&&"user"!==e.attributes.type&&"patch"!==e.attributes.type&&t.push({fid:Ext.util.md5(e.parentNode.attributes.task+e.attributes.task),fpath:e.parentNode.attributes.task,fname:e.attributes.task,fdbid:e.attributes.idDB,ftype:e.attributes.type,fdate:Date.parseDate(e.attributes.last_modified,"Y-m-d H:i:s"),fby:this.userNode.attributes.task})},this),ui.cmp._WorkTreeGrid.isNotSavedFile({commitWindow:new ui.cmp.CommitPrompt({files:t})})}}]})})}}),ui.cmp._WorkTreeGrid.menu.usersPatch=function(e){Ext.apply(this,e);var t,i=Ext.getCmp(this.menuID);i.removeAll(),i.doLayout(),(e=ui.cmp.PatchesTreeGrid.getInstance().getUserPatchesList())?Ext.each(e,function(e){t=new Ext.menu.Item({id:Ext.id(),text:e.attributes.task,handler:function(){ui.task.MoveToPatch({patchID:e.attributes.idDB,patchName:e.attributes.task,nodesToAdd:i.nodesToAdd})}}),i.add(t)},this):(t=new Ext.menu.Item({disabled:!0,text:_("You have no patch currently. You must create one.")}),i.add(t)),t=new Ext.menu.Item({text:_("Create a new patch"),iconCls:"iconAdd",handler:function(){new ui.cmp.ManagePatchPrompt({title:_("Create a new patch"),nodesToAdd:i.nodesToAdd}).show(this.el)}}),i.add("-",t),i.doLayout(),i.itemRendered=!0},ui.cmp._WorkTreeGrid.menu.users=function(e){Ext.apply(this,e),this.init(),ui.cmp._WorkTreeGrid.menu.users.superclass.constructor.call(this)},Ext.extend(ui.cmp._WorkTreeGrid.menu.users,Ext.menu.Menu,{listeners:{show:function(){this.node.attributes.task===PhDOE.user.login&&ui.cmp._WorkTreeGrid.menu.usersPatch({menuID:"usersPatchesMenu"})}},init:function(){var e,t=[];this.node.cascade(function(e){"user"!==e.attributes.type&&"folder"!==e.attributes.type&&t.push(e)},this),e=this.node.attributes.task===PhDOE.user.login?[{text:_("Submit all files for review in patch:"),iconCls:"iconPendingPatch",handler:function(){return!1},menu:new Ext.menu.Menu({id:"usersPatchesMenu",itemRendered:!1,nodesToAdd:t})},{xtype:"menuseparator",hidden:!PhDOE.user.haveKarma},new ui.cmp._WorkTreeGrid.menu.commit({hidden:!PhDOE.user.haveKarma,from:"user",node:!1,folderNode:!1,userNode:this.node})]:[{scope:this,text:String.format(_("Send an email to {0}"),"<b>"+this.node.attributes.task+"</b>"),iconCls:"iconSendEmail",hidden:!this.node.attributes.email,handler:function(){var e=new ui.cmp.EmailPrompt;e.setData(this.node.attributes.task,this.node.attributes.email),e.show(this.node.el)}}],Ext.apply(this,{items:e})}}),ui.cmp._WorkTreeGrid.menu.folders=function(e){Ext.apply(this,e),this.init(),ui.cmp._WorkTreeGrid.menu.folders.superclass.constructor.call(this)},Ext.extend(ui.cmp._WorkTreeGrid.menu.folders,Ext.menu.Menu,{listeners:{show:function(){this.node.parentNode.attributes.task===PhDOE.user.login&&ui.cmp._WorkTreeGrid.menu.usersPatch({menuID:"foldersPatchesMenu"})}},init:function(){var t=[];if(this.node.parentNode.attributes.task!==PhDOE.user.login)return!1;this.node.cascade(function(e){"folder"!==e.attributes.type&&t.push(e)},this),Ext.apply(this,{items:[{text:_("Submit all files in this directory in patch:"),iconCls:"iconPendingPatch",handler:function(){return!1},menu:new Ext.menu.Menu({id:"foldersPatchesMenu",itemRendered:!1,nodesToAdd:t})},{xtype:"menuseparator",hidden:!PhDOE.user.haveKarma},new ui.cmp._WorkTreeGrid.menu.commit({hidden:!PhDOE.user.haveKarma,from:"folder",node:!1,folderNode:this.node,userNode:this.node.parentNode})]})}}),ui.cmp._WorkTreeGrid.menu.files=function(e){Ext.apply(this,e),this.init(),ui.cmp._WorkTreeGrid.menu.files.superclass.constructor.call(this)},Ext.extend(ui.cmp._WorkTreeGrid.menu.files,Ext.menu.Menu,{listeners:{show:function(){ui.cmp._WorkTreeGrid.menu.usersPatch({menuID:"filePatchesMenu"})}},init:function(){var e=this.node,t=e.attributes.type,i=e.parentNode.attributes.task,n=e.attributes.task,o=e.ownerTree,a=e.parentNode.parentNode.attributes.task,r=[],s=e.parentNode.attributes.task.split("/")[0];r.push(this.node),Ext.apply(this,{items:[{text:"<b>"+_("delete"===t?"View in a new tab":"Edit in a new tab")+"</b>",iconCls:"iconEdit",handler:function(){o.openFile(e)}},{text:_("Submit as patch for review in:"),iconCls:"iconPendingPatch",hidden:!(a===PhDOE.user.login||!PhDOE.user.isAnonymous),handler:function(){return!1},menu:new Ext.menu.Menu({id:"filePatchesMenu",itemRendered:!1,nodesToAdd:r})},{text:_("Set the progress..."),iconCls:"iconProgress",hidden:"delete"===t||a!==PhDOE.user.login,menu:{xtype:"menu",showSeparator:!1,items:[{xtype:"slider",width:200,value:this.node.attributes.progress,increment:10,minValue:0,maxValue:100,plugins:new Ext.slider.Tip({getText:function(e){return String.format("<b>"+_("{0}% complete")+"</b>",e.value)}}),refreshNodeColumns:function(e){for(var t,i=e.getOwnerTree(),n=e.attributes,o=i.columns,a=e.ui.getEl().firstChild.childNodes,r=1,s=o.length;r<s;r++)t=null!==n[t=o[r].dataIndex]?n[t]:"",o[r].tpl&&"{progress:this.formatProgress}"===o[r].tpl.html&&(a[r].firstChild.innerHTML=o[r].tpl.apply("out:"+t))},listeners:{scope:this,change:function(e,t){this.node.attributes.progress=t,e.refreshNodeColumns(this.node),ui.cmp._WorkTreeGrid.SetProgress.delay(1e3,null,this)}}}]}},"-",{scope:this,text:_("View diff"),iconCls:"iconViewDiff",handler:function(){Ext.getCmp("main-panel").openDiffTab({DiffType:"file",FileName:n,FilePath:i,currentOwner:a,fileIdDB:e.attributes.idDB})}},{text:_("Download the diff as a patch"),iconCls:"iconDownloadDiff",handler:function(){window.location.href="./do/downloadPatch?FilePath="+i+"&FileName="+n+"&csrfToken="+csrfToken}},{xtype:"menuseparator",hidden:a!==PhDOE.user.login},{text:_("delete"===t?"Cancel this deletion":"Clear this change"),iconCls:"iconPageDelete",hidden:a!==PhDOE.user.login,handler:function(){new ui.task.ClearLocalChangeTask({ftype:t,fpath:i,fname:n})}},{xtype:"menuseparator",hidden:!(PhDOE.user.haveKarma&&a===PhDOE.user.login)},new ui.cmp._WorkTreeGrid.menu.commit({from:"file",hidden:!(PhDOE.user.haveKarma&&a===PhDOE.user.login),node:this.node,folderNode:this.node.parentNode,userNode:this.node.parentNode.parentNode}),{xtype:"menuseparator",hidden:!(PhDOE.user.isGlobalAdmin||PhDOE.user.isLangAdmin)},new ui.cmp._WorkTreeGrid.menu.admin({fileLang:s,from:"file",hidden:!(PhDOE.user.isGlobalAdmin||PhDOE.user.isLangAdmin),node:this.node,folderNode:this.node.parentNode,userNode:this.node.parentNode.parentNode})]})}}),ui.cmp.WorkTreeGrid=Ext.extend(Ext.ux.tree.TreeGrid,{onContextMenu:function(e,t){var i,n,o;if(t.stopEvent(),1<(n=(i=this.getSelectionModel().getSelectedNodes()).length)){for(var a=0;a<n;a++)"folder"!=i[a].attributes.type&&"user"!=i[a].attributes.type||i[a].unselect(!0),"folder"!=i[a].attributes.type&&"user"!=i[a].attributes.type&&i[a].parentNode.parentNode.attributes.task!=PhDOE.user.login&&i[a].unselect(!0);n=(i=this.getSelectionModel().getSelectedNodes()).length}if(1<n)(o=new Ext.menu.Menu({listeners:{show:function(){ui.cmp._WorkTreeGrid.menu.usersPatch({menuID:"globalPatchesMenu"})}},items:[{text:_("Submit all this files for review in patch:"),iconCls:"iconPendingPatch",handler:function(){return!1},menu:new Ext.menu.Menu({id:"globalPatchesMenu",itemRendered:!1,nodesToAdd:i})}]})).showAt(t.getXY());else{switch(e.attributes.type){case"user":e.select(),o=new ui.cmp._WorkTreeGrid.menu.users({node:e});break;case"folder":e.select(),o=new ui.cmp._WorkTreeGrid.menu.folders({node:e});break;default:e.select(),o=new ui.cmp._WorkTreeGrid.menu.files({node:e})}o.showAt(t.getXY())}},initComponent:function(){Ext.apply(this,{animate:!0,useArrows:!0,autoScroll:!0,border:!1,containerScroll:!0,defaults:{autoScroll:!0},selModel:new Ext.tree.MultiSelectionModel,columns:[{header:_("Users"),dataIndex:"task",tpl:new Ext.XTemplate("{task:this.formatUserName}",{formatUserName:function(e,t){return t.userID&&(t.qtip=_("userID: ")+t.userID),e}})},{header:_("Last modified"),width:120,dataIndex:"last_modified",align:"center",tpl:new Ext.XTemplate("{last_modified:this.formatDate}",{formatDate:function(e,t){return"user"!==t.type&&"folder"!==t.type?Date.parseDate(e,"Y-m-d H:i:s").format(_("Y-m-d, H:i")):""}})},{header:_("Estimated progress"),dataIndex:"progress",width:100,align:"center",tpl:new Ext.XTemplate("{progress:this.formatProgress}",{formatProgress:function(e,t){var i,n,o;return"out:"===Ext.util.Format.substr(t,0,4)&&(e=t.split(":")[1]),e||0===e?String.format('<div class="x-progress-wrap"><div class="x-progress-inner"><div class="x-progress-bar{0}" style="width:{1}%;">{2}</div></div>',(o=e)<=100&&67<o?"-green":o<67&&33<o?"-orange":o<33?"-red":"",e/100*100,(n=(i=e)<50?"x-progress-text-back":"x-progress-text-front"+(Ext.isIE6?"-ie6":""),n=String.format('</div><div class="x-progress-text {0}" style="width:100%;" id="{1}">{2}</div></div>',n,Ext.id(),i+"%"),i<100/1.05?n.substring(0,n.length-6):n.substr(6))):""}})}],loader:{dataUrl:"./do/getWork",baseParams:{module:"workInProgress"},listeners:{beforeload:function(){Ext.getCmp("acc-work-in-progress").setIconClass("iconLoading")},load:function(){Ext.getCmp("acc-work-in-progress").setIconClass("iconWorkInProgress")}}}}),ui.cmp.WorkTreeGrid.superclass.initComponent.call(this),this.on("contextmenu",this.onContextMenu,this),this.on("resize",this.resizeCmp,this),this.on("dblclick",this.openFile,this),this.getRootNode().on("beforechildrenrendered",function(){this.updateFilesCounter.defer(200,this)},this)},resizeCmp:function(e,t,i,n){this.columns[0].width=n-(this.columns[1].width+this.columns[2].width+5),this.updateColumnWidths()},delRecord:function(e){for(var t,i,n,o,a,r=this.getRootNode(),s=0;s<r.childNodes.length;s++)for(n=r.childNodes[s],t=0;t<n.childNodes.length;t++)for(o=n.childNodes[t],i=0;i<o.childNodes.length;i++)if((a=o.childNodes[i]).attributes.idDB==e)return a.remove(!0),Ext.isEmpty(o.childNodes)?(o.remove(!0),Ext.isEmpty(n.childNodes)&&n.remove(!0),void this.updateFilesCounter()):void this.updateFilesCounter();this.updateFilesCounter()},addToWork:function(e){var t,i,n,o,a,r=this.getRootNode(),s=r.findChild("task",PhDOE.user.login);if(s||(s=new Ext.tree.TreeNode({task:PhDOE.user.login,type:"user",email:PhDOE.user.email,iconCls:"iconUser",expanded:!0}),r.appendChild(s),r.expand()),e)for(a=0;a<e.length;a++)(t=s.findChild("task",e[a].parentNode.attributes.task))||(t=new Ext.tree.TreeNode({task:e[a].parentNode.attributes.task,type:"folder",iconCls:"iconFolderOpen",expanded:!0}),s.appendChild(t),s.expand()),"update"===(i=e[a].attributes.type)&&(n="iconRefresh"),"new"===i&&(n="iconNewFiles"),"delete"===i&&(n="iconTrash"),o=new Date,o=new Ext.tree.TreeNode({task:e[a].attributes.task,type:i,iconCls:n,expanded:!0,last_modified:o.format("Y-m-d H:i:s"),progress:e[a].attributes.progress,idDB:e[a].attributes.idDB}),t.appendChild(o),t.expand();this.updateFilesCounter()},addRecord:function(e,t,i,n){var o,a=this.getRootNode(),r=a.findChild("task",PhDOE.user.login);r||(r=new Ext.tree.TreeNode({task:PhDOE.user.login,type:"user",email:PhDOE.user.email,iconCls:"iconUser",expanded:!0,nbFiles:1}),a.appendChild(r),a.expand()),(a=r.findChild("task",t))||(a=new Ext.tree.TreeNode({task:t,type:"folder",iconCls:"iconFolderOpen",expanded:!0}),r.appendChild(a),r.expand()),(t=a.findChild("task",i))||("update"===n&&(o="iconRefresh"),"new"===n&&(o="iconNewFiles"),"delete"===n&&(o="iconTrash"),r=new Date,t=new Ext.tree.TreeNode({task:i,type:n,iconCls:o,expanded:!0,last_modified:r.format("Y-m-d H:i:s"),progress:100,idDB:e}),a.appendChild(t),a.expand()),this.updateFilesCounter()},countFiles:function(){var e=this.getRootNode(),t=0;return e.cascade(function(e){e.isRoot||"user"===e.attributes.type||"folder"===e.attributes.type||e.parentNode.parentNode.attributes.task===PhDOE.user.login&&t++},this),t},updateFilesCounter:function(){var e=this.countFiles();Ext.getDom("acc-work-in-progress-nb").innerHTML=e},openFile:function(e){var t=e.attributes.type,i=e.parentNode.attributes.task,n=e.attributes.task;if("user"===t||"folder"===t)return!1;switch(e=i.split("/"),FileLang=e[0],e.shift(),i="/"+e.join("/"),t){case"new":ui.cmp.PendingTranslateGrid.getInstance().store.each(function(e){e.data.path===i&&e.data.name===n&&ui.cmp.PendingTranslateGrid.getInstance().openFile(e.data.id)});break;case"delete":ui.cmp.NotInENGrid.getInstance().store.each(function(e){e.data.path===i&&e.data.name===n&&ui.cmp.NotInENGrid.getInstance().openFile(e.data.id)});break;case"update":"en"===FileLang?ui.cmp.RepositoryTree.getInstance().openFile("byPath",FileLang+i,n):(found=!1,ui.cmp.StaleFileGrid.getInstance().store.each(function(e){e.data.path===i&&e.data.name===n&&(ui.cmp.StaleFileGrid.getInstance().openFile(e.data.id),found=!0)}),found||ui.cmp.ErrorFileGrid.getInstance().store.each(function(e){e.data.path===i&&e.data.name===n&&(ui.cmp.ErrorFileGrid.getInstance().openFile(e.data.id),found=!0)}),found||ui.cmp.PendingReviewGrid.getInstance().store.each(function(e){e.data.path===i&&e.data.name===n&&(ui.cmp.PendingReviewGrid.getInstance().openFile(e.data.id),found=!0)}),found||ui.cmp.RepositoryTree.getInstance().openFile("byPath",FileLang+i,n))}}}),ui.cmp._WorkTreeGrid.instance=null,ui.cmp.WorkTreeGrid.getInstance=function(e){return ui.cmp._WorkTreeGrid.instance||(e=e||{},ui.cmp._WorkTreeGrid.instance=new ui.cmp.WorkTreeGrid(e)),ui.cmp._WorkTreeGrid.instance};var PhDOE=(Ext.QuickTips.init(),{user:{userID:null,login:null,anonymousIdent:null,isAnonymous:null,haveKarma:!1,authService:null,authServiceID:null,isGlobalAdmin:!1,isLangAdmin:!1,lang:null,conf:"",email:"",patchList:new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:"./do/getPatchList"}),sortInfo:{field:"name",direction:"ASC"},reader:new Ext.data.JsonReader({root:"Items",totalProperty:"nbItems",idProperty:"id",fields:[{name:"id"},{name:"name"},{name:"description"},{name:"email"},{name:"date",type:"date",dateFormat:"Y-m-d H:i:s"}]})})},updateDataProgress:!1,topic:{global:{author:"",content:"",topicDate:""},lang:{author:"",content:"",topicDate:""}},app:{name:"Php Docbook Online Editor",ver:"X.XX",loaded:!1,uiRevision:"$Revision$",conf:"",extJsVersion:"3.3.1",codeMirror:"2.21"},lastInfoDate:null,project:"",FNTfilePendingOpen:[],FNUfilePendingOpen:[],FEfilePendingOpen:[],FNRfilePendingOpen:[],FNIENfilePendingOpen:[],AFfilePendingOpen:[],PPfilePendingOpen:[],init:function(){new ui.task.LoadConfigTask,Ext.Ajax.extraParams={csrfToken:csrfToken},Ext.data.Connection.prototype.extraParams={csrfToken:csrfToken},Ext.data.ScriptTagProxy.prototype.extraParams={csrfToken:csrfToken}},notify:function(e,t,i){var n;"info"==e&&(n="iconInfo"),"error"==e&&(n="iconError"),new Ext.ux.Notification({iconCls:n,title:t,html:i,autoDestroy:!0,hideDelay:5e3}).show(document)},winForbidden:function(e){var t=_("Forbidden"),i="";switch(e){case"fs_error":t=_("Error"),i=_("File system error. Check read/write permissions under data folder.");break;case"encoding_error":t=_("Error"),i=_('You have used characters that require the use of UTF-8 despite the XML header.<br>Please delete these characters or change the header of the XML file to UTF-8 ; i.e.:<br><br><center><i>&lt;?xml version="1.0" encoding="utf-8"?&gt;</i></center>');break;case"tabs_found":t=_("Error"),i=_('It seems that you have inserted tab characters into this file. Please, replace each one by a single space.<br>Tip: You can use the "Re-indent this entire file" button to replace all tabs by spaces.');break;case"folder_already_exist":t=_("Error"),i=_("This folder already exists in the current folder.");break;case"file_already_exist":t=_("Error"),i=_("This file already exists in the current folder.");break;case"save_you_cant_modify_it":t=_("Error"),i=_("You aren't allowed to modify this file as it has already been modified by different user. Contact an administrator if you want to be able to modify it.");break;case"file_isnt_owned_by_current_user":t=_("Error"),i=_("The file for which you want to clear local changes isn't owned by you.<br>You can only perform this action on your own files.");break;case"file_localchange_didnt_exist":t=_("Error"),i=_("The file you want to clear local changes in doesn't exist as a work in progress.");break;case"changeFilesOwnerNotAdmin":t=_("Error"),i=_("You aren't allowed to change this file's owner. You must be a global administrator or an administrator for this language to be able to do that.");break;case"patch_delete_dont_exist":t=_("Error"),i=_("The patch you want to delete doesn't exist.");break;case"patch_delete_isnt_own_by_current_user":t=_("Error"),i=_("The patch you want to delete isn't owned by you. Only the author of the patch or a global administrator can delete it.");break;case"action_only_global_admin":t=_("Error"),i=_("This action is available to global administrators only.");break;case"action_only_admin":t=_("Error"),i=_("This action is available to global administrators or to administrators for this language only.")}Ext.MessageBox.alert(t,i)},runDirectAccess:function(){directAccess.link&&("perm"==directAccess.link&&ui.cmp.RepositoryTree.getInstance().openFile("byPath",directAccess.lang+directAccess.path,directAccess.name),"patch"==directAccess.link&&Ext.getCmp("main-panel").openDiffTab({DiffType:"file",FilePath:directAccess.path,FileName:directAccess.name}),"patchID"==directAccess.link&&Ext.getCmp("main-panel").openDiffTab({DiffType:"file",patchID:directAccess.patchID,patchName:directAccess.patchName})),directAccess.action&&Ext.getCmp("main-panel").openDirectAction({action:directAccess.action,idDB:directAccess.idDB})},afterLoadAllStore:function(){this.app.loaded=!0,this.runDirectAccess(),this.user.conf.main.loadMailsAtStartUp&&ui.cmp.PortletLocalMail.getInstance().reloadData(),this.user.conf.main.loadBugsAtStartUp&&ui.cmp.PortletBugs.getInstance().reloadData(),PhDOE.setTopic(),PhDOE.setTopic(!0)},loadAllStore:function(){var t=new Ext.ProgressBar({width:300,renderTo:"loading-progressBar"}),i=[],i="en"!==PhDOE.user.lang?[ui.cmp._MainMenu.store,ui.cmp.StaleFileGrid.getInstance().store,ui.cmp.ErrorFileGrid.getInstance().store,ui.cmp.PendingReviewGrid.getInstance().store,ui.cmp.NotInENGrid.getInstance().store,ui.cmp.PortletSummary.getInstance().store,ui.cmp.PortletTranslationGraph.getInstance().store,ui.cmp.PortletTranslationsGraph.getInstance().store,ui.cmp.PortletTranslator.getInstance().storeTranslator,ui.cmp.PortletTranslator.getInstance().storeReviewer,ui.cmp.PendingTranslateGrid.getInstance().store,ui.cmp.PortletInfo.getInstance().store,ui.cmp.PortletInfo.getInstance().storeUsage,PhDOE.user.patchList]:[ui.cmp._MainMenu.store,ui.cmp.PortletTranslationsGraph.getInstance().store,ui.cmp.ErrorFileGrid.getInstance().store,ui.cmp.PortletInfo.getInstance().store,ui.cmp.PortletInfo.getInstance().storeUsage,PhDOE.user.patchList],n=function(e){t.updateProgress((e+1)/i.length,e+1+" of "+i.length+"..."),i[e].load({callback:function(){++e<i.length?n(e):(Ext.get("loading").remove(),Ext.fly("loading-mask").fadeOut({remove:!0}),t.destroy(),PhDOE.afterLoadAllStore())}})};t.show(),document.getElementById("loading-msg").innerHTML="Loading data...",n(0)},reloadAllStore:function(){var i=[],i="en"!==PhDOE.user.lang?[ui.cmp.PendingTranslateGrid.getInstance().store,ui.cmp.StaleFileGrid.getInstance().store,ui.cmp.ErrorFileGrid.getInstance().store,ui.cmp.PendingReviewGrid.getInstance().store,ui.cmp.NotInENGrid.getInstance().store,ui.cmp.WorkTreeGrid.getInstance().getRootNode(),ui.cmp.PatchesTreeGrid.getInstance().getRootNode(),ui.cmp.PortletSummary.getInstance().store,ui.cmp.PortletTranslator.getInstance().storeTranslator,ui.cmp.PortletTranslator.getInstance().storeReviewer,ui.cmp.PortletTranslationGraph.getInstance().store,ui.cmp.PortletTranslationsGraph.getInstance().store,ui.cmp.PortletInfo.getInstance().store]:[ui.cmp.WorkTreeGrid.getInstance().getRootNode(),ui.cmp.PatchesTreeGrid.getInstance().getRootNode(),ui.cmp.PortletInfo.getInstance().store],n=function(e){function t(){++e<i.length&&n(e)}i[e].reload(i[e]instanceof Ext.tree.AsyncTreeNode?t:{callback:t})};n(0)},saveTopic:function(e,t){ui.task.setTopicTask({content:e,isLang:t})},setTopic:function(e){var t=PhDOE.topic[e?"lang":"global"];Ext.get("topic-info-content"+(e?"-lang":"")).dom.innerHTML=t.content,Ext.get("topic-info-user"+(e?"-lang":"")).dom.innerHTML=String.format(_("Defined by {0}, {1}"),t.author,t.topicDate)},drawInterface:function(){var e,t=[],i=[],n=[],o={col1:["portletLocalMail","portletBugs"],col2:["portletInfo","portletTranslationsGraph"]},a={col1:["portletSummary","portletTranslator","portletLocalMail","portletBugs"],col2:["portletInfo","portletTranslationGraph","portletTranslationsGraph"]};"en"===PhDOE.user.lang?(e=PhDOE.user.conf.main.portalSortEN?Ext.util.JSON.decode(PhDOE.user.conf.main.portalSortEN):o,n.portletLocalMail=ui.cmp.PortletLocalMail.getInstance({lang:PhDOE.user.lang}),n.portletBugs=ui.cmp.PortletBugs.getInstance({lang:PhDOE.user.lang}),n.portletInfo=ui.cmp.PortletInfo.getInstance()):(e=PhDOE.user.conf.main.portalSortLANG?Ext.util.JSON.decode(PhDOE.user.conf.main.portalSortLANG):a,n.portletSummary=ui.cmp.PortletSummary.getInstance({lang:PhDOE.user.lang}),n.portletTranslator=ui.cmp.PortletTranslator.getInstance({lang:PhDOE.user.lang}),n.portletLocalMail=ui.cmp.PortletLocalMail.getInstance({lang:PhDOE.user.lang}),n.portletBugs=ui.cmp.PortletBugs.getInstance({lang:PhDOE.user.lang}),n.portletInfo=ui.cmp.PortletInfo.getInstance(),n.portletTranslationGraph=ui.cmp.PortletTranslationGraph.getInstance()),n.portletTranslationsGraph=ui.cmp.PortletTranslationsGraph.getInstance();for(var r=0;r<e.col1.length;r++)t.push(n[e.col1[r]]);for(var s,l=0;l<e.col2.length;l++)i.push(n[e.col2[l]]);ui.task.PingTask.getInstance().delay(3e4),new Ext.Viewport({layout:"border",id:"main-app",items:[{region:"north",html:'<h1 class="x-panel-header"><img src="themes/img/mini_php.png" style="vertical-align: middle;" />&nbsp;&nbsp;'+this.app.name+"</h1>",autoHeight:!0,border:!1,margins:"0 0 5 0"},{region:"west",id:"main-menu-panel",layout:"accordion",collapsible:!0,collapseMode:"mini",animate:!0,split:!0,width:PhDOE.user.conf.main.mainMenuWidth||300,header:!1,listeners:{resize:function(e,t){t&&t!=PhDOE.user.conf.main.mainMenuWidth&&new ui.task.UpdateConfTask({module:"main",itemName:"mainMenuWidth",value:t,notify:!1})}},tbar:[{text:_("Main menu"),iconCls:"MainMenu",menu:new ui.cmp.MainMenu}],items:[{id:"acc-need-translate",title:_("Files need translate")+' (<em id="acc-need-translate-nb">0</em>)',layout:"fit",border:!1,iconCls:"iconFilesNeedTranslate",hidden:"en"===PhDOE.user.lang,items:[ui.cmp.PendingTranslateGrid.getInstance()],collapsed:!0,listeners:{expand:function(e){Ext.getCmp("FNT-filter").wrap.setWidth(180),Ext.getCmp("FNT-filter").syncSize()}}},{id:"acc-need-update",title:_("Files need update")+' (<em id="acc-need-update-nb">0</em>)',layout:"fit",border:!1,iconCls:"iconFilesNeedUpdate",hidden:"en"===PhDOE.user.lang,items:[ui.cmp.StaleFileGrid.getInstance()],collapsed:!0,listeners:{expand:function(e){Ext.getCmp("FNU-filter").wrap.setWidth(180),Ext.getCmp("FNU-filter").syncSize()}}},{id:"acc-error",title:"en"===PhDOE.user.lang?"Number of failures to meet 'strict standards' (<em id=\"acc-error-nb\">0</em>)":_("Error in current translation")+' (<em id="acc-error-nb">0</em>)',layout:"fit",border:!1,iconCls:"iconFilesError",items:[ui.cmp.ErrorFileGrid.getInstance()],collapsed:!0,listeners:{expand:function(e){Ext.getCmp("FE-filter").wrap.setWidth(180),Ext.getCmp("FE-filter").syncSize()}}},{id:"acc-need-reviewed",title:_("Files need reviewed")+' (<em id="acc-need-reviewed-nb">0</em>)',layout:"fit",border:!1,iconCls:"iconFilesNeedReviewed",hidden:"en"===PhDOE.user.lang,items:[ui.cmp.PendingReviewGrid.getInstance()],collapsed:!0,listeners:{expand:function(e){Ext.getCmp("FNR-filter").wrap.setWidth(180),Ext.getCmp("FNR-filter").syncSize()}}},{id:"acc-notInEn",title:_("Not in EN tree")+' (<em id="acc-notInEn-nb">0</em>)',layout:"fit",border:!1,iconCls:"iconNotInEn",hidden:"en"===PhDOE.user.lang,items:[ui.cmp.NotInENGrid.getInstance()],collapsed:!0},{id:"acc-all-files",title:_("All files"),layout:"fit",border:!1,iconCls:"iconAllFiles",items:[ui.cmp.RepositoryTree.getInstance()],collapsed:!0,listeners:{expand:function(e){Ext.getCmp("AF-search").wrap.setWidth(180),Ext.getCmp("AF-search").syncSize()}}},{id:"acc-work-in-progress",title:_("Work in progress")+' (<em id="acc-work-in-progress-nb" qtip="'+_("Total number of your files")+'">0</em>)',layout:"fit",border:!1,iconCls:"iconWorkInProgress",items:[ui.cmp.WorkTreeGrid.getInstance()],collapsed:!0,tools:[{id:"refresh",qtip:_("Refresh"),handler:function(){ui.cmp.WorkTreeGrid.getInstance().getRootNode().reload()}}]},{id:"acc-patches",tools:[{id:"refresh",qtip:_("Refresh"),handler:function(){ui.cmp.PatchesTreeGrid.getInstance().getRootNode().reload()}},{id:"gear",hidden:PhDOE.user.haveKarma,qtip:_("Open the Log Message Manager"),handler:function(){Ext.getCmp("commit-log-win")||new ui.cmp.CommitLogManager,Ext.getCmp("commit-log-win").show("acc-patches")}}],title:_("Patches for review")+' (<em id="acc-patches-nb" qtip="'+_("Total number of your files")+'">0</em>)',layout:"fit",border:!1,iconCls:"iconPatch",items:[ui.cmp.PatchesTreeGrid.getInstance()],collapsed:!0},{id:"acc-bing-translate",title:_("Bing translation"),layout:"fit",border:!1,iconCls:"iconBing",hidden:"en"===PhDOE.user.lang,items:[new ui.cmp.BingTranslationPanel],collapsed:!0}]},{xtype:"mainpanel",id:"main-panel",region:"center",items:[{xtype:"panel",id:"MainInfoTabPanel",title:_("Home"),baseCls:"MainInfoTabPanel",autoScroll:!0,plain:!0,items:[{xtype:"container",layout:"column",border:!1,items:[{xtype:"container",columnWidth:.5,html:'<div class="topic-connected"><div class="x-box-tl"><div class="x-box-tr"><div class="x-box-tc"></div></div></div><div class="x-box-ml"><div class="x-box-mr"><div class="x-box-mc"><h3>'+_("Connected as")+' <em id="loginLibel"></em>, '+_("Project: ")+'<em id="Info-Project">'+PhDOE.project+"</em>, "+_("Language: ")+' <em id="Info-Language">-</em></h3></div></div></div><div class="x-box-bl"><div class="x-box-br"><div class="x-box-bc"></div></div></div></div><div class="x-box-like"><g:plusone size="medium" width="20"></g:plusone><br/><div class="fb-like" data-send="false" data-layout="button_count" data-width="40" data-show-faces="false"></div></div>',listeners:{afterrender:function(e){var t="",i=Ext.get("loginLibel");PhDOE.user.isGlobalAdmin||PhDOE.user.isLangAdmin?(i.addClass("userAdmin"),t='<img src="themes/img/icon_php.png" style="vertical-align:middle"> '+PhDOE.user.login):"VCS"==PhDOE.user.authService?t='<img src="themes/img/icon_php.png" style="vertical-align:middle"> '+PhDOE.user.login:"google"==PhDOE.user.authService?t='<img src="themes/img/auth_google.png" style="vertical-align:middle"> '+PhDOE.user.login:"facebook"==PhDOE.user.authService?t='<img src="themes/img/auth_facebook.png" style="vertical-align:middle"> '+PhDOE.user.login:"github"==PhDOE.user.authService?t='<img src="themes/img/auth_github.png" style="vertical-align:middle"> '+PhDOE.user.login:"stackoverflow"==PhDOE.user.authService?t='<img src="themes/img/auth_stackoverflow.png" style="vertical-align:middle"> '+PhDOE.user.login:"linkedin"==PhDOE.user.authService?t='<img src="themes/img/auth_linkedin.png" style="vertical-align:middle"> '+PhDOE.user.login:"instagram"==PhDOE.user.authService?t='<img src="themes/img/auth_instagram.png" style="vertical-align:middle"> '+PhDOE.user.login:"twitter"==PhDOE.user.authService&&(t='<img src="themes/img/auth_twitter.png" style="vertical-align:middle"> '+PhDOE.user.login),i.dom.innerHTML=t,t=_("Connected using")+" "+PhDOE.user.authService+"<br>",t+=PhDOE.user.isGlobalAdmin?_("You are a global Administrator")+"<br>":"",t+=PhDOE.user.isLangAdmin?_("You are an administrator for this language")+"<br>":"",new Ext.ToolTip({target:"loginLibel",anchor:"top",html:t})}}},{xtype:"container",columnWidth:.5,html:'<div class="topic-info"><div class="x-box-tl"><div class="x-box-tr"><div class="x-box-tc"></div></div></div><div class="x-box-ml"><div class="x-box-mr"><div class="x-box-mc"><div id="topic-info-container"><h3>'+_("Topic:")+'</h3><p id="topic-info-content">-</p><div id="topic-info-user">-</div></div><div id="topic-info-container-lang"><h3><em id="Topic-Language">-</em></h3><p id="topic-info-content-lang">-</p><div id="topic-info-user-lang">-</div></div></div></div></div><div class="x-box-bl"><div class="x-box-br"><div class="x-box-bc"></div></div></div></div>',listeners:{afterrender:function(e){var t;PhDOE.user.haveKarma&&(t=function(e){var t="topic-info-content"+(e?"-lang":""),i=Ext.get(t).dom.innerHTML;Ext.get(t).dom.innerHTML="",new Ext.FormPanel({renderTo:t,layout:"anchor",border:!1,items:[{xtype:"htmleditor",value:i,anchor:"100%"}],buttonAlign:"center",buttons:[{text:_("Save"),handler:function(){PhDOE.saveTopic(this.ownerCt.ownerCt.items.items[0].getValue(),e)}},{text:_("Cancel"),handler:function(){PhDOE.setTopic(e)}}]})},Ext.get("topic-info-container").on("dblclick",function(){t()}),Ext.get("topic-info-container-lang").on("dblclick",function(){t(!0)}))}}}]},{xtype:"portal",border:!1,items:[{columnWidth:.5,style:"padding:10px 5px 10px 5px",items:t},{columnWidth:.5,style:"padding:10px 5px 10px 5px",items:i}],listeners:{drop:function(e){for(var t,i,n=[],o=[],a=0;a<e.portal.items.items[0].items.items.length;a++)i=e.portal.items.items[0].items.items[a].id,n.push(i);for(var r=0;r<e.portal.items.items[1].items.items.length;r++)i=e.portal.items.items[1].items.items[r].id,o.push(i);t={col1:n,col2:o},new ui.task.UpdateConfTask({module:"main",itemName:"en"===PhDOE.user.lang?"portalSortEN":"portalSortLANG",value:Ext.util.JSON.encode(t),notify:!1})}}}]}]}]}),new Ext.dd.DropTarget(Ext.get("main-panel"),{ddGroup:"mainPanelDDGroup",notifyDrop:function(e,t,i){var n,o;if(i.nodes){for(n=0;n<i.nodes.length;n++)PhDOE.AFfilePendingOpen[n]={nodeID:i.nodes[n].attributes.id};return ui.cmp.RepositoryTree.getInstance().openFile("byId",PhDOE.AFfilePendingOpen[0].nodeID,!1),PhDOE.AFfilePendingOpen.shift(),!0}if("acc-need-pendingCommit"===i.grid.ownerCt.id)return i.grid.openFile(i.selections[0].data.id),!0;for(n=0;n<i.selections.length;n++)"acc-need-translate"===i.grid.ownerCt.id&&(PhDOE.FNTfilePendingOpen[n]={id:i.selections[n].data.id}),"acc-need-update"===i.grid.ownerCt.id&&(PhDOE.FNUfilePendingOpen[n]={id:i.selections[n].data.id}),"acc-error"===i.grid.ownerCt.id&&(PhDOE.FEfilePendingOpen[n]={id:i.selections[n].data.id}),"acc-need-reviewed"===i.grid.ownerCt.id&&(PhDOE.FNRfilePendingOpen[n]={id:i.selections[n].data.id}),"acc-notInEn"===i.grid.ownerCt.id&&(PhDOE.FNIENfilePendingOpen[n]={id:i.selections[n].data.id}),"acc-need-pendingPatch"===i.grid.ownerCt.id&&(PhDOE.PPfilePendingOpen[n]={id:i.selections[n].data.id}),"acc-need-pendingPatch"===i.grid.ownerCt.id&&(PhDOE.PPfilePendingOpen[n]={id:i.selections[n].data.id});return"acc-need-translate"===i.grid.ownerCt.id&&(o=PhDOE.FNTfilePendingOpen[0],PhDOE.FNTfilePendingOpen.shift()),"acc-need-update"===i.grid.ownerCt.id&&(o=PhDOE.FNUfilePendingOpen[0],PhDOE.FNUfilePendingOpen.shift()),"acc-error"===i.grid.ownerCt.id&&(o=PhDOE.FEfilePendingOpen[0],PhDOE.FEfilePendingOpen.shift()),"acc-need-reviewed"===i.grid.ownerCt.id&&(o=PhDOE.FNRfilePendingOpen[0],PhDOE.FNRfilePendingOpen.shift()),"acc-notInEn"===i.grid.ownerCt.id&&(o=PhDOE.FNIENfilePendingOpen[0],PhDOE.FNIENfilePendingOpen.shift()),"acc-need-pendingPatch"===i.grid.ownerCt.id&&(o=PhDOE.PPfilePendingOpen[0],PhDOE.PPfilePendingOpen.shift()),i.grid.openFile(o.id),!0}}),s=document,o="facebook-jssdk",a=s.getElementsByTagName("script")[0],s.getElementById(o)||((s=s.createElement("script")).id=o,s.src="https://connect.facebook.net/en_US/all.js#xfbml=1&appId=128417830579090",a.parentNode.insertBefore(s,a)),window.___gcfg={lang:"en-US",size:"medium",annotation:"bubble"},function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="https://apis.google.com/js/plusone.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}(),this.loadAllStore()}});Ext.EventManager.onDocumentReady(PhDOE.init,PhDOE,!0);